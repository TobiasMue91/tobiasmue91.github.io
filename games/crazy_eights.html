<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1.0"/>
    <title>Crazy Eights</title>
    <style>
        * {
            box-sizing: border-box;
        }

        body {
            margin: 0;
            padding: 0;
            font-family: Arial, sans-serif;
            background-color: #3a3a3a;
            color: white;
        }

        h2 {
            color: black;
        }

        .game {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            align-items: center;
            min-height: 60vh;
        }

        .players {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            margin: 0 1rem;
        }

        .player {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            margin: 1rem;
            width: 15rem;
            height: 20rem;
            background-color: #f2f2f2;
            border-radius: 1rem;
            box-shadow: 0 0.5rem 1rem rgba(0, 0, 0, 0.2);
        }

        .player h2 {
            margin: 0 0 1rem;
            font-size: 1.5rem;
        }

        .player .hand {
            display: flex;
            justify-content: center;
            align-items: center;
            flex-wrap: wrap;
            width: 100%;
            height: 100%;
            padding: 3rem;
            overflow: hidden;
        }

        .card {
            width: 8rem;
            height: 12rem;
            background-color: #fff;
            border-radius: 0.5rem;
            box-shadow: 0 0.5rem 1rem rgba(0, 0, 0, 0.2);
            margin-top: -150px;
            margin-bottom: -240px;
        }

        .card img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .deck {
            display: flex;
            justify-content: center;
            align-items: center;
            margin: 1rem;
            width: 15rem;
            height: 10rem;
            background-color: #f2f2f2;
            border-radius: 1rem;
            box-shadow: 0 0.5rem 1rem rgba(0, 0, 0, 0.2);
        }

        .draw-pile,
        .discard-pile {
            display: flex;
            justify-content: center;
            align-items: center;
            width: 100%;
            height: 100%;
            padding: 1rem;
        }

        .draw-pile img,
        .discard-pile img {
            width: 80%;
            height: 80%;
            object-fit: cover;
        }

        .controls {
            display: flex;
            justify-content: center;
            margin: 1rem;
        }

        .controls button, select {
            margin: 0 0.5rem;
            padding: 0.5rem 1rem;
            font-size: 1rem;
            font-weight: bold;
            text-transform: uppercase;
            background-color: #fff;
            border: none;
            border-radius: 0.5rem;
            box-shadow: 0 0.5rem 1rem rgba(0, 0, 0, 0.2);
            cursor: pointer;
        }

        .controls button:hover {
            transform: translateY(-0.25rem);
            box-shadow: 0 0.75rem 1.5rem rgba(0, 0, 0, 0.2);
        }

        .controls button:active {
            transform: translateY(0);
            box-shadow: 0 0.25rem 0.5rem rgba(0, 0, 0, 0.2);
        }

        .headline {
            color: white;
        }

        .info {
            padding: 30px;
            border: 1px solid black;
            font-size: 26px;
            margin: 120px auto 0;
            position: relative;
            width: 40%;
            border-radius: 20px;
            text-align: center;
        }

        .info p {
            white-space: pre-line;
            text-align: left;
        }

        .restart {
            margin-top: 10px;
            font-size: 20px;
        }

        .hidden {
            display: none;
        }
    </style>
</head>
<body>
<div class="info"></div>
<div class="game">
    <div class="players">
        <div class="player player-1">
            <h2>Player 1</h2>
            <div class="hand"></div>
        </div>
        <div class="player player-2">
            <h2>Player 2</h2>
            <div class="hand"></div>
        </div>
        <div class="player player-3 hidden">
            <h2>Player 3</h2>
            <div class="hand"></div>
        </div>
        <div class="player player-4 hidden">
            <h2>Player 4</h2>
            <div class="hand"></div>
        </div>
        <div class="player player-5 hidden">
            <h2>Player 5</h2>
            <div class="hand"></div>
        </div>
        <div class="player player-6 hidden">
            <h2>Player 6</h2>
            <div class="hand"></div>
        </div>
        <div class="player player-7 hidden">
            <h2>Player 7</h2>
            <div class="hand"></div>
        </div>
        <div class="player player-8 hidden">
            <h2>Player 8</h2>
            <div class="hand"></div>
        </div>
    </div>
    <div class="deck">
        <div class="draw-pile">
            <img src="cards/black_joker.png" alt="Draw Pile"/>
        </div>
        <div class="discard-pile">
            <img src="cards/black_joker.png" alt="Discard Pile"/>
        </div>
    </div>
    <h3 class="headline">Controls:</h3>
    <div class="controls">
        <button class="draw-card">Draw Card</button>
        <button class="end-turn">End Turn</button>
    </div>
    <label for="playerCount">Players: </label><select name="playerCount" id="playerCount">
    <option value="2">2 Players</option>
    <option value="3">3 Players</option>
    <option value="4">4 Players</option>
    <option value="5">5 Players</option>
    <option value="6">6 Players</option>
    <option value="7">7 Players</option>
    <option value="8">8 Players</option>
</select>
</div>
<div class="info">
<h3>Rules</h3>
<p>
    Crazy Eights is a classic card game that is played with a standard deck of 52 cards. The game can be played by 2 to 8 players and the objective is to be the first player to get rid of all their cards.

    Here are the rules of the game:

    1. The dealer shuffles the deck and deals each player five cards, one at a time. The remaining cards are placed in a draw pile in the center of the table.
    2. The top card of the draw pile is turned over and placed face up next to the draw pile to start a discard pile.
    3. The player to the left of the dealer goes first. They can play any card from their hand that matches the suit or rank of the top card on the discard pile.
    4. If a player cannot play a card, they must draw a card from the draw pile. If they are able to play the drawn card, they may do so. If not, they must keep the card in their hand and their turn ends.
    5. If an Eight is played, the player must declare a suit for the next player to play. The next player must play a card of that suit or another Eight to continue the chain.
    6. A player wins the game by getting rid of all their cards. The game continues until one player has no cards left in their hand, at which point the game ends.
    7. If the draw pile runs out of cards, the discard pile is shuffled and becomes the new draw pile.

    These are the basic rules of Crazy Eights, and with a little practice, you'll be able to master this classic card game.
</p>
</div>
<script type="text/javascript">
    // Define the deck of cards
    function getDeck() {
        return [
            {rank: '2', suit: 'hearts'},
            {rank: '3', suit: 'hearts'},
            {rank: '4', suit: 'hearts'},
            {rank: '5', suit: 'hearts'},
            {rank: '6', suit: 'hearts'},
            {rank: '7', suit: 'hearts'},
            {rank: '8', suit: 'hearts'},
            {rank: '9', suit: 'hearts'},
            {rank: '10', suit: 'hearts'},
            {rank: 'jack', suit: 'hearts'},
            {rank: 'queen', suit: 'hearts'},
            {rank: 'king', suit: 'hearts'},
            {rank: 'ace', suit: 'hearts'},
            {rank: '2', suit: 'diamonds'},
            {rank: '3', suit: 'diamonds'},
            {rank: '4', suit: 'diamonds'},
            {rank: '5', suit: 'diamonds'},
            {rank: '6', suit: 'diamonds'},
            {rank: '7', suit: 'diamonds'},
            {rank: '8', suit: 'diamonds'},
            {rank: '9', suit: 'diamonds'},
            {rank: '10', suit: 'diamonds'},
            {rank: 'jack', suit: 'diamonds'},
            {rank: 'queen', suit: 'diamonds'},
            {rank: 'king', suit: 'diamonds'},
            {rank: 'ace', suit: 'diamonds'},
            {rank: '2', suit: 'clubs'},
            {rank: '3', suit: 'clubs'},
            {rank: '4', suit: 'clubs'},
            {rank: '5', suit: 'clubs'},
            {rank: '6', suit: 'clubs'},
            {rank: '7', suit: 'clubs'},
            {rank: '8', suit: 'clubs'},
            {rank: '9', suit: 'clubs'},
            {rank: '10', suit: 'clubs'},
            {rank: 'jack', suit: 'clubs'},
            {rank: 'queen', suit: 'clubs'},
            {rank: 'king', suit: 'clubs'},
            {rank: 'ace', suit: 'clubs'},
            {rank: '2', suit: 'spades'},
            {rank: '3', suit: 'spades'},
            {rank: '4', suit: 'spades'},
            {rank: '5', suit: 'spades'},
            {rank: '6', suit: 'spades'},
            {rank: '7', suit: 'spades'},
            {rank: '8', suit: 'spades'},
            {rank: '9', suit: 'spades'},
            {rank: '10', suit: 'spades'},
            {rank: 'jack', suit: 'spades'},
            {rank: 'queen', suit: 'spades'},
            {rank: 'king', suit: 'spades'},
            {rank: 'ace', suit: 'spades'},
        ]
    }
    const deck = getDeck();

    // Define the players
    let players = [
        {name: 'Player 1', hand: []},
        {name: 'Player 2', hand: []},
    ];

    let initialCardCount = 3;

    // Define the draw pile and discard pile
    let drawPile = [];
    let discardPile = [];

    // Initialize the game
    function initGame() {
        shuffleDeck(deck);
        drawPile = Object.create(deck);
        dealCards(players);
        discardPile = [drawPile.pop()];
        updateUI();
    }

    // Shuffle the deck
    function shuffleDeck(deck) {
        for (let i = deck.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [deck[i], deck[j]] = [deck[j], deck[i]];
        }
    }

    // Deal cards to the players
    function dealCards(players) {
        for (let i = 0; i < initialCardCount; i++) {
            for (let j = 0; j < players.length; j++) {
                const card = drawPile.pop();
                players[j].hand.push(card);
            }
        }
    }

    // Update the UI
    function updateUI() {
        updatePlayersUI();
        updateDeckUI();
        updateControlsUI();
    }

    // Update the players UI
    function updatePlayersUI() {
        for (let i = 0; i < players.length; i++) {
            const player = players[i];
            const playerUI = document.querySelector(`.player-${i + 1}`);
            const handUI = playerUI.querySelector('.hand');
            handUI.innerHTML = '';
            for (let j = 0; j < player.hand.length; j++) {
                const card = player.hand[j];
                const cardUI = createCardUI(card);
                handUI.appendChild(cardUI);
            }
        }
    }

    // Create a card UI element
    function createCardUI(card) {
        const cardUI = document.createElement('div');
        cardUI.classList.add('card');
        const cardImg = document.createElement('img');
        cardImg.src = `cards/${card.rank}_of_${card.suit}.png`;
        cardImg.alt = `${card.rank} of ${card.suit}`;
        cardUI.appendChild(cardImg);
        return cardUI;
    }

    // Update the deck UI
    function updateDeckUI() {
        const drawPileUI = document.querySelector('.draw-pile');
        const discardPileUI = document.querySelector('.discard-pile');
        const drawPileImg = drawPileUI.querySelector('img');
        const discardPileImg = discardPileUI.querySelector('img');
        drawPileImg.src = `cards/black_joker.png`;
        drawPileImg.alt = `back of card`;
        if (discardPile.length) {
            discardPileImg.src = `cards/${discardPile[discardPile.length - 1].rank}_of_${discardPile[discardPile.length - 1].suit}.png`;
            discardPileImg.alt = `${discardPile[discardPile.length - 1].rank} of ${discardPile[discardPile.length - 1].suit}`;
        }
    }

    // Update the controls UI
    function updateControlsUI() {
        const controlsUI = document.querySelector('.controls');
        const currentPlayer = players[0];
        const playableCards = getPlayableCards(currentPlayer);
        const headline = document.querySelector('.headline');
        controlsUI.innerHTML = '';
        if (playableCards.length > 0) {
            for (let i = 0; i < playableCards.length; i++) {
                const card = playableCards[i];
                const cardBtn = createCardBtn(card);
                controlsUI.appendChild(cardBtn);
            }
            headline.textContent = 'Playable Cards:';
        } else {
            const drawBtn = createDrawBtn();
            controlsUI.appendChild(drawBtn);
            headline.textContent = 'Controls:';
        }
        const infoUI = document.querySelector('.info');
        const turnPlayer = players[0].name;
        infoUI.innerHTML = `It's ${turnPlayer}'s turn.`;
    }

    // Get the playable cards for the current player
    function getPlayableCards(player) {
        const playableCards = [];
        for (let i = 0; i < player.hand.length; i++) {
            const card = player.hand[i];
            if (card.suit === discardPile[discardPile.length - 1].suit || card.rank === discardPile[discardPile.length - 1].rank) {
                playableCards.push(card);
            } else if (card.rank === '8') {
                playableCards.push(card);
            }
        }
        return playableCards;
    }

    // Create a card button
    function createCardBtn(card) {
        const cardBtn = document.createElement('button');
        cardBtn.classList.add('card-btn');
        cardBtn.textContent = `${card.rank} of ${card.suit}`;
        cardBtn.addEventListener('click', function () {
            playCard(card);
        });
        return cardBtn;
    }

    // Create a draw button
    function createDrawBtn() {
        const drawBtn = document.createElement('button');
        drawBtn.classList.add('draw-btn');
        drawBtn.textContent = 'Draw Card';
        drawBtn.addEventListener('click', function () {
            drawCard();
        });
        return drawBtn;
    }

    // Create a restart button
    function createRestartBtn() {
        const restartBtn = document.createElement('button');
        restartBtn.classList.add('restart');
        restartBtn.textContent = 'Restart';
        restartBtn.addEventListener('click', function () {
            restartGame()
        });
        return restartBtn;
    }

    // Play a card
    function playCard(card) {
        const currentPlayer = players[0];
        const cardIndex = currentPlayer.hand.findIndex(c => c.rank === card.rank && c.suit === card.suit);
        discardPile.push(currentPlayer.hand.splice(cardIndex, 1)[0]);
        if (currentPlayer.hand.length === 0) {
            endGame(currentPlayer);
        } else {
            nextTurn();
        }
    }

    // Draw a card
    function drawCard() {
        const currentPlayer = players[0];
        if (!drawPile.length) {
            console.log('draw pile is empty. discard pile gets shuffled and repurposed.')
            shuffleDeck(discardPile);
            drawPile = Object.create(discardPile);
            discardPile = [];
        }
        const card = drawPile.pop();
        currentPlayer.hand.push(card);
        if (card.rank === '8') {
            const suits = ['hearts', 'diamonds', 'clubs', 'spades'];
            const suit = suits[Math.floor(Math.random() * suits.length)];
            console.log(`Next player must play ${suit}`);
        }
        nextTurn();
    }

    // Go to the next turn
    function nextTurn() {
        players.push(players.shift());
        updateUI();
    }

    // End the game
    function endGame(winner) {
        const controlsUI = document.querySelector('.controls');
        const headline = document.querySelector('.headline');
        const restartBtn = createRestartBtn();
        controlsUI.innerHTML = '';
        controlsUI.appendChild(restartBtn);
        headline.textContent = 'Controls:';
        const infoUI = document.querySelector('.info');
        infoUI.innerHTML = `${winner.name} wins!`;
    }

    // Restart the game
    function restartGame() {
        for (let i = 0; i < players.length; i++) {
            players[i].hand = [];
        }
        drawPile = [];
        discardPile = [];
        initGame();
    }

    function changePlayerCount(playerCount) {
        players = [];
        for (let i = 1; i <= playerCount; i++) {
            players.push({name: `Player ${i}`, hand: []})
        }
        document.querySelectorAll('.player').forEach((element, index) => {
            if (index < playerCount) {
                element.classList.remove('hidden');
            } else {
                element.classList.add('hidden');
            }
        })

        restartGame();
    }

    document.querySelector('#playerCount').addEventListener('change', (e, i) => {
        changePlayerCount(e.target.value);
    })

    // Initialize the game
    initGame();
</script>
<script src="../sidebar.js"></script>
</body>
</html>