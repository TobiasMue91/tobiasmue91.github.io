<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description"
          content="Improve your typing speed by practicing the alphabet. Track your progress with detailed statistics for each letter and beat your personal records.">
    <meta name="keywords"
          content="typing game, alphabet game, typing speed, keyboard practice, typing test, abcdefghijklmnqoprstuvwxyz, abcdefghijklmnqoprstuvwxyz game">
    <meta name="author" content="Typing Speed Trainer">
    <link rel="icon"
          href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>⌨️</text></svg>">
    <title>Alphabet Typing Speed Game | Improve Your Typing Speed</title>
    <script src="https://cdn.tailwindcss.com/"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600&family=JetBrains+Mono:wght@400;700&display=swap');

        body {
            font-family: 'Poppins', sans-serif;
            background-color: #f8fafc
        }

        #alphabet {
            font-family: 'JetBrains Mono', monospace;
            position: relative;
            text-align: center
        }

        .alphabet-row {
            display: flex;
            justify-content: center;
            margin-bottom: 0.5rem
        }

        #alphabet span {
            position: relative;
            transition: all 0.2s ease;
            display: inline-block;
            width: 1.5em;
            text-align: center
        }

        #alphabet span.current::after {
            content: '';
            position: absolute;
            width: 3px;
            height: 3.5rem;
            background-color: #2563eb;
            bottom: 4px;
            left: 6px;
            transform: translateX(-50%);
            animation: blink 1s infinite
        }

        .letter-typed {
            animation: pop 0.2s ease-out
        }

        @keyframes pop {
            0% {
                transform: scale(1)
            }
            50% {
                transform: scale(1.4)
            }
            100% {
                transform: scale(1)
            }
        }

        .progress-bar {
            height: 4px;
            background-color: #e2e8f0;
            border-radius: 2px;
            overflow: hidden;
            margin-top: 1rem
        }

        .progress-fill {
            height: 100%;
            background-color: #2563eb;
            width: 0%;
            transition: width 0.15s ease-out
        }

        .metric-card {
            background-color: white;
            border-radius: 0.5rem;
            padding: 1rem;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            transition: all 0.2s ease
        }

        .metric-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1)
        }

        .typing-area {
            background-color: white;
            border-radius: 0.75rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05), 0 10px 15px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden
        }

        .typing-area:focus-within {
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05), 0 10px 15px rgba(0, 0, 0, 0.1), 0 0 0 2px rgba(37, 99, 235, 0.3)
        }

        .button {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            padding: 0.5rem 1.5rem;
            border-radius: 0.375rem;
            font-weight: 500;
            transition: all 0.15s ease;
            cursor: pointer
        }

        .button-primary {
            background-color: #2563eb;
            color: white
        }

        .button-primary:hover {
            background-color: #1d4ed8
        }

        .button-secondary {
            background-color: #e2e8f0;
            color: #475569
        }

        .button-secondary:hover {
            background-color: #cbd5e1
        }

        .stats-grid {
            display: grid;
            grid-template-columns:repeat(auto-fill, minmax(70px, 1fr));
            gap: 0.5rem
        }

        .letter-stat {
            padding: 0.5rem;
            text-align: center;
            border-radius: 0.375rem;
            background-color: white;
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05);
            transition: all 0.2s ease;
            position: relative
        }

        .letter-stat:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1)
        }

        .letter-stat-slow {
            background-color: #fee2e2
        }

        .letter-stat-fast {
            background-color: #dcfce7
        }

        .letter-stat-average {
            background-color: #f3f4f6
        }

        .letter-stat-trigger {
            background-color: #f8fafc;
            opacity: 0.7
        }

        .tooltip {
            position: relative;
            display: inline-block
        }

        .tooltip .tooltiptext {
            visibility: hidden;
            width: 200px;
            background-color: #333;
            color: #fff;
            text-align: center;
            border-radius: 6px;
            padding: 5px;
            position: absolute;
            z-index: 10;
            bottom: 125%;
            left: 50%;
            margin-left: -100px;
            opacity: 0;
            transition: opacity 0.3s
        }

        .tooltip:hover .tooltiptext {
            visibility: visible;
            opacity: 1
        }

        .tooltip .tooltiptext::after {
            content: "";
            position: absolute;
            top: 100%;
            left: 50%;
            margin-left: -5px;
            border-width: 5px;
            border-style: solid;
            border-color: #333 transparent transparent transparent
        }

        .error-shake {
            animation: shake 0.5s cubic-bezier(.36, .07, .19, .97) both
        }

        @keyframes shake {
            10%, 90% {
                transform: translate3d(-1px, 0, 0)
            }
            20%, 80% {
                transform: translate3d(2px, 0, 0)
            }
            30%, 50%, 70% {
                transform: translate3d(-4px, 0, 0)
            }
            40%, 60% {
                transform: translate3d(4px, 0, 0)
            }
        }

        .stat-bar {
            height: 8px;
            background-color: #e2e8f0;
            border-radius: 4px;
            position: relative;
            overflow: hidden
        }

        .stat-bar-fill {
            position: absolute;
            height: 100%;
            left: 0;
            top: 0;
            background-color: #2563eb;
            min-width: 2px
        }

        .letter-history-chart {
            height: 200px;
            position: relative;
            margin-top: 1rem
        }

        .chart-column {
            position: absolute;
            bottom: 0;
            width: calc(100% / 26 - 4px);
            background-color: #bfdbfe;
            border-radius: 2px 2px 0 0;
            transition: height 0.3s ease
        }

        .chart-label {
            position: absolute;
            bottom: -20px;
            transform: translateX(-50%);
            font-family: 'JetBrains Mono', monospace;
            font-size: 12px;
            color: #475569
        }

        .keyboard-info {
            position: absolute;
            top: 10px;
            right: 10px;
            font-size: 12px;
            color: #64748b;
            padding: 4px 8px;
            border-radius: 4px;
            background-color: rgba(255, 255, 255, 0.8)
        }

        .history-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 1rem;
            font-size: 0.9rem
        }

        .history-table th {
            text-align: left;
            padding: 0.5rem;
            border-bottom: 2px solid #e2e8f0;
            font-weight: 600;
            color: #475569
        }

        .history-table td {
            padding: 0.5rem;
            border-bottom: 1px solid #e2e8f0
        }

        .history-table tr:last-child td {
            border-bottom: none
        }

        .history-table .best-time {
            color: #16a34a;
            font-weight: 600
        }

        .progress-chart {
            height: 200px;
            width: 100%;
            position: relative;
            margin-top: 1rem;
            border-bottom: 1px solid #e2e8f0;
            border-left: 1px solid #e2e8f0
        }

        .progress-point {
            position: absolute;
            width: 8px;
            height: 8px;
            background-color: #2563eb;
            border-radius: 50%;
            transform: translate(-50%, -50%);
            z-index: 2
        }

        .progress-line {
            position: absolute;
            height: 2px;
            background-color: #bfdbfe;
            z-index: 1
        }

        .chart-axis-label {
            position: absolute;
            font-size: 10px;
            color: #64748b
        }

        .progress-improvement {
            position: absolute;
            font-size: 10px;
            color: #16a34a;
            font-weight: 600
        }

        .tab-buttons {
            display: flex;
            border-bottom: 1px solid #e2e8f0;
            margin-bottom: 1rem
        }

        .tab-button {
            padding: 0.75rem 1rem;
            font-weight: 500;
            border-bottom: 2px solid transparent;
            cursor: pointer
        }

        .tab-button.active {
            border-color: #2563eb;
            color: #2563eb
        }

        .tab-content {
            display: none
        }

        .tab-content.active {
            display: block
        }

        .average-time {
            color: #2563eb;
            font-weight: 600
        }

        .data-card {
            background-color: white;
            border-radius: 0.5rem;
            padding: 1rem;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            margin-bottom: 1rem
        }

        @keyframes blink {
            0%, 49% {
                opacity: 1
            }
            50%, 100% {
                opacity: 0
            }
        }

        @media (max-width: 640px) {
            #alphabet {
                font-size: 2.5rem !important
            }

            #alphabet span {
                width: 1.2em
            }

            .alphabet-row {
                flex-wrap: wrap
            }

            .typing-area {
                padding: 6px !important
            }

            section.grid {
                grid-template-columns:repeat(2, 1fr)
            }

            .metric-card {
                padding: 0.75rem
            }

            .button {
                padding: 0.4rem 0.8rem;
                font-size: 0.875rem
            }

            .stats-grid {
                grid-template-columns:repeat(auto-fill, minmax(50px, 1fr))
            }

            .letter-history-chart, .progress-chart {
                height: 150px
            }

            .history-table {
                font-size: 0.75rem
            }

            .history-table th, .history-table td {
                padding: 0.375rem
            }

            .tab-buttons {
                overflow-x: auto;
                -webkit-overflow-scrolling: touch;
                scrollbar-width: none
            }

            .tab-buttons::-webkit-scrollbar {
                display: none
            }

            .tab-button {
                padding: 0.5rem 0.75rem;
                white-space: nowrap;
                font-size: 0.875rem
            }
        }

        @media (max-width: 480px) {
            #alphabet {
                font-size: 1.75rem !important
            }

            #alphabet span {
                width: 1.1em
            }

            #alphabet span.current::after {
                height: 2.5rem;
                bottom: 2px
            }

            .data-card {
                width: 100% !important
            }
        }

        @media (max-width: 360px) {
            #alphabet {
                font-size: 1.5rem !important
            }

            #alphabet span {
                width: 1em
            }
        }

        .mobile-keyboard-note {
            display: none
        }

        @media (max-width: 767px) {
            .mobile-keyboard-note {
                display: block;
                text-align: center;
                margin-top: 0.5rem;
                font-size: 0.875rem;
                color: #64748b
            }

            .virtual-keyboard {display: grid;}
        }

        .typing-area.keyboard-focused {
            border: 2px solid #2563eb
        }

        .virtual-keyboard {
            display: none;
            grid-template-columns:repeat(9, 1fr);
            gap: 0.25rem;
            max-width: 100%;
            margin: 0 auto;
            padding: 0.5rem
        }

        .vk-key {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 3rem;
            background-color: #e5e7eb;
            border-radius: 0.25rem;
            font-family: 'JetBrains Mono', monospace;
            font-size: 1.25rem;
            font-weight: bold;
            color: #374151;
            user-select: none;
            touch-action: manipulation
        }

        .vk-key:active {
            background-color: #d1d5db
        }

        .vk-key.current {
            background-color: #bfdbfe;
            color: #1e40af
        }

        @media (max-width: 400px) {
            .virtual-keyboard {
                grid-template-columns:repeat(7, 1fr)
            }

            .vk-key {
                height: 2.5rem;
                font-size: 1rem
            }
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen py-12 px-4 sm:px-6">
<div class="max-w-3xl mx-auto">
    <header class="text-center mb-8">
        <h1 class="text-4xl font-bold text-gray-900 mb-2">Alphabet Typing Speed Game</h1>
        <p class="text-gray-600 max-w-lg mx-auto">Type the alphabet from A to Z as quickly as you can. Press 'A' to
            start. Track your performance for each letter to focus on improving your weak spots!</p>
    </header>

    <main>
        <section class="typing-area p-4 sm:p-8 mb-8 relative" id="game-area" tabindex="0">
            <div class="keyboard-info" id="keyboard-info">Press 'A' to start</div>
            <div id="alphabet"
                 class="text-3xl sm:text-5xl md:text-6xl font-mono tracking-wide text-gray-800 py-4"></div>

            <div class="progress-bar">
                <div class="progress-fill" id="progress"></div>
            </div>

            <div id="game-message" class="mt-4 text-center text-lg font-medium">Press 'A' to start typing</div>
            <p class="mobile-keyboard-note">Use the keyboard below to type</p>
        </section>

        <!-- Virtual Keyboard for Mobile -->
        <section id="virtual-keyboard" class="mb-8 virtual-keyboard"></section>

        <section class="grid grid-cols-2 sm:grid-cols-4 gap-4 mb-8">
            <div class="metric-card">
                <div class="text-sm text-gray-500 mb-1">Current Time</div>
                <div id="result" class="text-xl sm:text-2xl font-bold text-gray-900">0 ms</div>
            </div>

            <div class="metric-card">
                <div class="text-sm text-gray-500 mb-1">High Score</div>
                <div id="highscore" class="text-xl sm:text-2xl font-bold text-blue-600">--</div>
            </div>

            <div class="metric-card">
                <div class="text-sm text-gray-500 mb-1">Letters/Sec</div>
                <div id="letters-per-second" class="text-xl sm:text-2xl font-bold text-gray-900">0.0</div>
            </div>

            <div class="metric-card">
                <div class="text-sm text-gray-500 mb-1">Attempts</div>
                <div id="attempts" class="text-xl sm:text-2xl font-bold text-gray-900">0</div>
            </div>
        </section>

        <section id="stats-section" class="bg-white rounded-lg p-4 sm:p-6 mb-8 shadow-sm hidden">
            <div class="tab-buttons">
                <div class="tab-button active" data-tab="progress">Training Progress</div>
                <div class="tab-button" data-tab="history">History</div>
                <div class="tab-button" data-tab="letters">Letter Timing</div>
            </div>

            <div id="progress-tab" class="tab-content active">
                <div class="flex flex-wrap justify-between mb-4">
                    <div class="data-card w-full sm:w-[32%]">
                        <div class="text-sm text-gray-500 mb-1">Average Time</div>
                        <div id="average-time" class="text-xl sm:text-2xl font-bold average-time">--</div>
                    </div>
                    <div class="data-card w-full sm:w-[32%]">
                        <div class="text-sm text-gray-500 mb-1">Best Time</div>
                        <div id="best-time" class="text-xl sm:text-2xl font-bold text-green-600">--</div>
                    </div>
                    <div class="data-card w-full sm:w-[32%]">
                        <div class="text-sm text-gray-500 mb-1">Recent Improvement</div>
                        <div id="improvement" class="text-xl sm:text-2xl font-bold text-gray-900">--</div>
                    </div>
                </div>

                <h3 class="text-lg font-medium mb-2">Training Progress</h3>
                <p class="text-sm text-gray-600 mb-4">Your typing speed over time (last 10 attempts)</p>
                <div id="progress-chart" class="progress-chart"></div>
            </div>

            <div id="history-tab" class="tab-content">
                <h3 class="text-lg font-medium mb-2">Attempt History</h3>
                <p class="text-sm text-gray-600 mb-4">Your recent typing sessions</p>
                <div class="overflow-x-auto">
                    <table class="history-table">
                        <thead>
                        <tr>
                            <th>Attempt #</th>
                            <th>Date</th>
                            <th>Time</th>
                            <th>Letters/Sec</th>
                        </tr>
                        </thead>
                        <tbody id="history-table-body">
                        </tbody>
                    </table>
                </div>
            </div>

            <div id="letters-tab" class="tab-content">
                <h3 class="text-lg font-medium mb-2">Letter Timing Statistics</h3>
                <div class="flex flex-wrap justify-between items-center mb-4 text-xs sm:text-sm">
                    <div>
                        <span class="inline-block w-3 h-3 bg-red-200 rounded-sm mr-1"></span>
                        <span class="text-gray-600">Slow</span>
                    </div>
                    <div>
                        <span class="inline-block w-3 h-3 bg-gray-200 rounded-sm mr-1"></span>
                        <span class="text-gray-600">Average</span>
                    </div>
                    <div>
                        <span class="inline-block w-3 h-3 bg-green-200 rounded-sm mr-1"></span>
                        <span class="text-gray-600">Fast</span>
                    </div>
                    <div>
                        <span class="inline-block w-3 h-3 opacity-50 bg-gray-200 rounded-sm mr-1"></span>
                        <span class="text-gray-600">Game Trigger</span>
                    </div>
                </div>
                <div id="letter-stats" class="stats-grid"></div>

                <div class="mt-8">
                    <h3 class="text-lg font-medium mb-2">Letter Performance</h3>
                    <p class="text-sm text-gray-600 mb-4">Your average time per letter (last 5 attempts)</p>
                    <div id="letter-history-chart" class="letter-history-chart"></div>
                </div>
            </div>
        </section>

        <section class="flex flex-wrap justify-center gap-2 sm:gap-4">
            <button id="restart-button" class="button button-primary">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" viewBox="0 0 20 20" fill="currentColor">
                    <path fill-rule="evenodd"
                          d="M4 2a1 1 0 011 1v2.101a7.002 7.002 0 0111.601 2.566 1 1 0 11-1.885.666A5.002 5.002 0 005.999 7H9a1 1 0 010 2H4a1 1 0 01-1-1V3a1 1 0 011-1zm.008 9.057a1 1 0 011.276.61A5.002 5.002 0 0014.001 13H11a1 1 0 110-2h5a1 1 0 011 1v5a1 1 0 11-2 0v-2.101a7.002 7.002 0 01-11.601-2.566 1 1 0 01.61-1.276z"
                          clip-rule="evenodd"/>
                </svg>
                Restart
            </button>

            <button id="toggle-stats-button" class="button button-secondary">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" viewBox="0 0 20 20" fill="currentColor">
                    <path d="M2 11a1 1 0 011-1h2a1 1 0 011 1v5a1 1 0 01-1 1H3a1 1 0 01-1-1v-5zM8 7a1 1 0 011-1h2a1 1 0 011 1v9a1 1 0 01-1 1H9a1 1 0 01-1-1V7zM14 4a1 1 0 011-1h2a1 1 0 011 1v12a1 1 0 01-1 1h-2a1 1 0 01-1-1V4z"/>
                </svg>
                Stats
            </button>

            <button id="reset-highscore" class="button button-secondary">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" viewBox="0 0 20 20" fill="currentColor">
                    <path fill-rule="evenodd"
                          d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z"
                          clip-rule="evenodd"/>
                </svg>
                Reset
            </button>
        </section>
    </main>

    <footer class="mt-12 text-center text-sm text-gray-500">
        <p>© 2025 Alphabet Typing Speed Game. Improve your typing skills and track your progress.</p>
    </footer>
</div>

<script>
    const GameState = {READY: 'ready', PLAYING: 'playing', COMPLETED: 'completed', ERROR: 'error'};
    const alphabet = Array.from("abcdefghijklmnopqrstuvwxyz");
    let currentState = GameState.READY;
    let currentIndex = 0;
    let startTime;
    let elapsedTime = 0;
    let timerInterval;
    let letterTimings = [];
    let letterTimestamps = [];
    let attempts = parseInt(localStorage.getItem("attempts") || "0");
    const MAX_HISTORY = 10;
    const alphabetEl = document.getElementById('alphabet');
    const resultEl = document.getElementById('result');
    const highscoreEl = document.getElementById('highscore');
    const attemptsEl = document.getElementById('attempts');
    const lpsEl = document.getElementById('letters-per-second');
    const progressEl = document.getElementById('progress');
    const gameMessageEl = document.getElementById('game-message');
    const gameAreaEl = document.getElementById('game-area');
    const keyboardInfoEl = document.getElementById('keyboard-info');
    const restartBtn = document.getElementById('restart-button');
    const resetHighscoreBtn = document.getElementById('reset-highscore');
    const letterStatsEl = document.getElementById('letter-stats');
    const statsSection = document.getElementById('stats-section');
    const letterHistoryChart = document.getElementById('letter-history-chart');
    const toggleStatsBtn = document.getElementById('toggle-stats-button');
    const progressChartEl = document.getElementById('progress-chart');
    const historyTableBody = document.getElementById('history-table-body');
    const averageTimeEl = document.getElementById('average-time');
    const bestTimeEl = document.getElementById('best-time');
    const improvementEl = document.getElementById('improvement');
    const tabButtons = document.querySelectorAll('.tab-button');
    const tabContents = document.querySelectorAll('.tab-content');
    const virtualKeyboardEl = document.getElementById('virtual-keyboard');

    function isMobileDevice() {
        return /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent) || window.innerWidth < 768;
    }

    function initGame() {
        const halfwayPoint = Math.ceil(alphabet.length / 2);
        const firstRow = alphabet.slice(0, halfwayPoint);
        const secondRow = alphabet.slice(halfwayPoint);
        alphabetEl.innerHTML = `<div class="alphabet-row">${firstRow.map((letter) => `<span class="letter">${letter}</span>`).join('')}</div><div class="alphabet-row">${secondRow.map((letter) => `<span class="letter">${letter}</span>`).join('')}</div>`;
        const highScore = localStorage.getItem("highScore");
        if (highScore) {
            highscoreEl.textContent = `${parseInt(highScore).toLocaleString()}ms`;
            bestTimeEl.textContent = `${parseInt(highScore).toLocaleString()}ms`;
        } else {
            highscoreEl.textContent = "--";
            bestTimeEl.textContent = "--";
        }
        attemptsEl.textContent = attempts;
        if (!localStorage.getItem("letterHistory")) {
            localStorage.setItem("letterHistory", JSON.stringify([]));
        }
        if (!localStorage.getItem("totalHistory")) {
            localStorage.setItem("totalHistory", JSON.stringify([]));
        }
        initVirtualKeyboard();
        gameAreaEl.focus();
        updateGameState(GameState.READY);
        updateStatistics();
        tabButtons.forEach(button => {
            button.addEventListener('click', () => {
                tabButtons.forEach(btn => btn.classList.remove('active'));
                tabContents.forEach(content => content.classList.remove('active'));
                button.classList.add('active');
                document.getElementById(`${button.dataset.tab}-tab`).classList.add('active');
                if (button.dataset.tab === 'progress') redrawCharts();
            });
        });
        document.querySelectorAll('.letter')[0].classList.add('current');
        redrawCharts();
    }

    function initVirtualKeyboard() {
        virtualKeyboardEl.innerHTML = "";
        for (let i = 0; i < alphabet.length; i++) {
            const key = document.createElement('div');
            key.className = 'vk-key';
            key.textContent = alphabet[i];
            key.setAttribute('data-key', alphabet[i]);
            if (i === 0) {
                key.classList.add('current');
            }
            key.addEventListener('click', () => {
                processKeyPress(alphabet[i]);
            });
            virtualKeyboardEl.appendChild(key);
        }
    }

    function updateVirtualKeyboard() {
        document.querySelectorAll('.vk-key').forEach((key, index) => {
            key.classList.remove('current');
            if (index === currentIndex) {
                key.classList.add('current');
            }
        });
    }

    function updateGameState(newState) {
        currentState = newState;
        const letters = document.querySelectorAll('.letter');
        switch (currentState) {
            case GameState.READY:
                gameMessageEl.textContent = "Press 'A' to start typing";
                gameMessageEl.classList.remove('text-red-600', 'text-green-600');
                gameMessageEl.classList.add('text-gray-600');
                keyboardInfoEl.textContent = "Press 'A' to start";
                currentIndex = 0;
                resetLetterStyles();
                updateProgress(0);
                letterTimings = [];
                letterTimestamps = [];
                updateVirtualKeyboard();
                break;
            case GameState.PLAYING:
                gameMessageEl.textContent = "Typing...";
                gameMessageEl.classList.remove('text-red-600');
                gameMessageEl.classList.add('text-blue-600');
                keyboardInfoEl.textContent = "Keep typing...";
                startTimer();
                highlightCurrentLetter();
                updateVirtualKeyboard();
                break;
            case GameState.COMPLETED:
                gameMessageEl.textContent = "Completed! Press 'A' to try again";
                gameMessageEl.classList.remove('text-blue-600');
                gameMessageEl.classList.add('text-green-600');
                keyboardInfoEl.textContent = "Well done!";
                stopTimer();
                saveGameData();
                updateStatistics();
                letters.forEach(letter => {
                    letter.classList.add('text-green-600');
                    letter.classList.remove('current')
                });
                letters[0].classList.add('current');
                updateVirtualKeyboard();
                break;
            case GameState.ERROR:
                gameMessageEl.textContent = "Error! Press 'A' to try again";
                gameMessageEl.classList.remove('text-blue-600');
                gameMessageEl.classList.add('text-red-600');
                keyboardInfoEl.textContent = "Oops! Try again.";
                gameAreaEl.classList.add('error-shake');
                letters.forEach(letter => letter.classList.remove('current'));
                letters[0].classList.add('current');
                setTimeout(() => {
                    gameAreaEl.classList.remove('error-shake');
                }, 500);
                stopTimer();
                updateVirtualKeyboard();
                break;
        }
    }

    function startTimer() {
        startTime = new Date().getTime();
        letterTimestamps[0] = startTime;
        timerInterval = setInterval(() => {
            elapsedTime = new Date().getTime() - startTime;
            resultEl.textContent = `${elapsedTime.toLocaleString()} ms`;
            if (currentIndex > 0) {
                const lps = (currentIndex / (elapsedTime / 1000)).toFixed(1);
                lpsEl.textContent = lps;
            }
        }, 50);
    }

    function stopTimer() {
        clearInterval(timerInterval);
    }

    function resetLetterStyles() {
        const letters = document.querySelectorAll('.letter');
        letters.forEach(letter => {
            letter.classList.remove('text-green-600', 'text-red-600', 'current');
        });
    }

    function highlightCurrentLetter() {
        resetLetterStyles();
        const letters = document.querySelectorAll('.letter');
        for (let i = 0; i < currentIndex; i++) {
            letters[i].classList.add('text-green-600');
        }
        if (currentIndex < alphabet.length) {
            letters[currentIndex].classList.add('current');
        }
    }

    function updateProgress(percent) {
        progressEl.style.width = `${percent}%`;
    }

    function updateHighScore(time) {
        const highScore = localStorage.getItem("highScore");
        if (!highScore || time < parseInt(highScore, 10)) {
            localStorage.setItem("highScore", time);
            highscoreEl.textContent = `${time.toLocaleString()} ms`;
            bestTimeEl.textContent = `${time.toLocaleString()} ms`;
            return true;
        }
        return false;
    }

    function saveGameData() {
        letterTimings = [{letter: 'a', time: 0}];
        for (let i = 1; i < alphabet.length; i++) {
            const startTs = letterTimestamps[i];
            const endTs = letterTimestamps[i + 1];
            letterTimings.push({letter: alphabet[i], time: endTs - startTs});
        }
        let letterHistory = JSON.parse(localStorage.getItem("letterHistory") || "[]");
        letterHistory.unshift({timestamp: new Date().getTime(), totalTime: elapsedTime, letterTimings: letterTimings});
        if (letterHistory.length > MAX_HISTORY) {
            letterHistory = letterHistory.slice(0, MAX_HISTORY);
        }
        localStorage.setItem("letterHistory", JSON.stringify(letterHistory));
        let totalHistory = JSON.parse(localStorage.getItem("totalHistory") || "[]");
        const lettersPerSecond = (alphabet.length / (elapsedTime / 1000)).toFixed(1);
        totalHistory.unshift({
            timestamp: new Date().getTime(),
            attemptNumber: attempts,
            totalTime: elapsedTime,
            lettersPerSecond: lettersPerSecond
        });
        if (totalHistory.length > MAX_HISTORY) {
            totalHistory = totalHistory.slice(0, MAX_HISTORY);
        }
        localStorage.setItem("totalHistory", JSON.stringify(totalHistory));
        updateHighScore(elapsedTime);
    }

    function updateStatistics() {
        updateLetterStatistics();
        updateLetterHistoryChart();
        updateProgressChart();
        updateHistoryTable();
        updateTotalStats();
        statsSection.classList.remove('hidden');
    }

    function updateLetterStatistics() {
        letterStatsEl.innerHTML = "";
        const history = JSON.parse(localStorage.getItem("letterHistory") || "[]");
        if (history.length === 0) return;
        const latestTimings = history[0].letterTimings;
        let totalTime = 0;
        let slowestTime = 0;
        let fastestTime = Infinity;
        latestTimings.slice(1).forEach(timing => {
            totalTime += timing.time;
            if (timing.time > slowestTime) slowestTime = timing.time;
            if (timing.time < fastestTime) fastestTime = timing.time;
        });
        const averageTime = totalTime / (latestTimings.length - 1);
        latestTimings.forEach(timing => {
            const letterStat = document.createElement('div');
            letterStat.className = "letter-stat";
            if (timing.letter === 'a') {
                letterStat.classList.add('letter-stat-trigger', 'tooltip');
                letterStat.innerHTML = `<div class="text-xl font-mono font-bold mb-1">${timing.letter}</div><div class="text-sm font-medium">0 ms</div><span class="tooltiptext">The letter 'a' always shows 0ms as it triggers the game start</span>`;
            } else {
                let speedClass = "letter-stat-average";
                if (timing.time < averageTime * 0.75) speedClass = "letter-stat-fast";
                if (timing.time > averageTime * 1.25) speedClass = "letter-stat-slow";
                letterStat.classList.add(speedClass);
                const percent = Math.min(100, Math.max(5, (timing.time / slowestTime) * 100));
                letterStat.innerHTML = `<div class="text-xl font-mono font-bold mb-1">${timing.letter}</div><div class="text-sm font-medium">${timing.time} ms</div><div class="stat-bar mt-1"><div class="stat-bar-fill" style="width:${percent}%"></div></div>`;
            }
            letterStatsEl.appendChild(letterStat);
        });
    }

    function updateLetterHistoryChart() {
        const history = JSON.parse(localStorage.getItem("letterHistory") || "[]");
        if (history.length === 0) return;
        letterHistoryChart.innerHTML = "";
        const letterAverages = {};
        alphabet.forEach(letter => {
            let total = 0;
            let count = 0;
            history.forEach(entry => {
                const timing = entry.letterTimings.find(t => t.letter === letter);
                if (timing) {
                    total += timing.time;
                    count++;
                }
            });
            letterAverages[letter] = count > 0 ? total / count : 0;
        });
        let maxTime = 0;
        Object.entries(letterAverages).forEach(([letter, time]) => {
            if (letter !== 'a' && time > maxTime) maxTime = time;
        });
        Object.entries(letterAverages).forEach(([letter, time], index) => {
            if (time === 0) return;
            const isGameTrigger = letter === 'a';
            const height = isGameTrigger ? 5 : Math.max(5, Math.min(100, (time / maxTime) * 100));
            const column = document.createElement('div');
            column.className = "chart-column";
            column.style.left = `${(index / alphabet.length) * 100}%`;
            column.style.height = `${height}%`;
            column.style.backgroundColor = isGameTrigger ? '#94a3b8' : time > maxTime * 0.75 ? '#fee2e2' : time < maxTime * 0.25 ? '#dcfce7' : '#bfdbfe';
            column.style.opacity = isGameTrigger ? '0.5' : '1';
            const label = document.createElement('div');
            label.className = "chart-label";
            label.textContent = letter;
            label.style.left = "50%";
            if (isGameTrigger) {
                column.title = "The letter 'a' always shows 0ms as it triggers the game start";
            }
            column.appendChild(label);
            letterHistoryChart.appendChild(column);
        });
    }

    function redrawCharts() {
        setTimeout(() => {
            updateLetterHistoryChart();
            updateProgressChart();
        }, 50);
    }

    function updateProgressChart() {
        const history = JSON.parse(localStorage.getItem("totalHistory") || "[]");
        if (history.length < 2) return;
        progressChartEl.innerHTML = "";
        const chartWidth = progressChartEl.offsetWidth || 300;
        let minTime = Infinity;
        let maxTime = 0;
        history.forEach(entry => {
            if (entry.totalTime < minTime) minTime = entry.totalTime;
            if (entry.totalTime > maxTime) maxTime = entry.totalTime;
        });
        const range = maxTime - minTime;
        const padding = range * 0.1;
        const effectiveMin = Math.max(0, minTime - padding);
        const effectiveMax = maxTime + padding;
        const points = [];
        history.reverse().forEach((entry, index) => {
            if (index >= MAX_HISTORY) return;
            const x = index * (chartWidth / (Math.min(history.length, MAX_HISTORY) - 1));
            const y = 180 - ((entry.totalTime - effectiveMin) / (effectiveMax - effectiveMin) * 180);
            const point = document.createElement('div');
            point.className = 'progress-point';
            point.style.left = `${x}px`;
            point.style.top = `${y}px`;
            point.title = `Attempt #${entry.attemptNumber}:${entry.totalTime.toLocaleString()}ms`;
            progressChartEl.appendChild(point);
            points.push({x, y});
            const label = document.createElement('div');
            label.className = 'chart-axis-label';
            label.textContent = `#${entry.attemptNumber}`;
            label.style.left = `${x}px`;
            label.style.bottom = '-20px';
            label.style.transform = 'translateX(-50%)';
            progressChartEl.appendChild(label);
        });
        for (let i = 0; i < points.length - 1; i++) {
            const start = points[i];
            const end = points[i + 1];
            const length = Math.sqrt(Math.pow(end.x - start.x, 2) + Math.pow(end.y - start.y, 2));
            const angle = Math.atan2(end.y - start.y, end.x - start.x) * 180 / Math.PI;
            const line = document.createElement('div');
            line.className = 'progress-line';
            line.style.width = `${length}px`;
            line.style.left = `${start.x}px`;
            line.style.top = `${start.y}px`;
            line.style.transform = `rotate(${angle}deg)`;
            line.style.transformOrigin = '0 0';
            progressChartEl.appendChild(line);
        }
        if (history.length >= 2) {
            const firstEntry = history[0];
            const lastEntry = history[history.length - 1];
            const improvement = firstEntry.totalTime - lastEntry.totalTime;
            if (improvement > 0) {
                const improvementLabel = document.createElement('div');
                improvementLabel.className = 'progress-improvement';
                improvementLabel.textContent = `↓ ${improvement.toLocaleString()}ms`;
                improvementLabel.style.right = '10px';
                improvementLabel.style.top = '10px';
                progressChartEl.appendChild(improvementLabel);
            }
        }
        const yLabels = [effectiveMin, (effectiveMin + effectiveMax) / 2, effectiveMax];
        yLabels.forEach((value, index) => {
            const y = 180 - (index * 90);
            const label = document.createElement('div');
            label.className = 'chart-axis-label';
            label.textContent = `${Math.round(value).toLocaleString()}ms`;
            label.style.left = '-5px';
            label.style.top = `${y}px`;
            label.style.transform = 'translateX(-100%) translateY(-50%)';
            progressChartEl.appendChild(label);
        });
    }

    function updateHistoryTable() {
        const history = JSON.parse(localStorage.getItem("totalHistory") || "[]");
        if (history.length === 0) return;
        historyTableBody.innerHTML = "";
        let bestTime = Infinity;
        history.forEach(entry => {
            if (entry.totalTime < bestTime) bestTime = entry.totalTime;
        });
        history.forEach(entry => {
            const row = document.createElement('tr');
            const date = new Date(entry.timestamp);
            const formattedDate = `${date.toLocaleDateString()} ${date.toLocaleTimeString([], {
                hour: '2-digit',
                minute: '2-digit'
            })}`;
            const isBestTime = entry.totalTime === bestTime;
            const timeClass = isBestTime ? 'best-time' : '';
            row.innerHTML = `<td>${entry.attemptNumber}</td><td>${formattedDate}</td><td class="${timeClass}">${entry.totalTime.toLocaleString()} ms</td><td>${entry.lettersPerSecond}</td>`;
            historyTableBody.appendChild(row);
        });
    }

    function updateTotalStats() {
        const history = JSON.parse(localStorage.getItem("totalHistory") || "[]");
        if (history.length === 0) return;
        let totalTime = 0;
        history.forEach(entry => {
            totalTime += entry.totalTime;
        });
        const averageTime = Math.round(totalTime / history.length);
        averageTimeEl.textContent = `${averageTime.toLocaleString()} ms`;
        if (history.length >= 2) {
            const lastTime = history[0].totalTime;
            const previousTime = history[1].totalTime;
            const improvement = previousTime - lastTime;
            if (improvement > 0) {
                const improvementPercent = Math.round((improvement / previousTime) * 100);
                improvementEl.textContent = `↓ ${improvement.toLocaleString()} ms (${improvementPercent}%)`;
                improvementEl.classList.add('text-green-600');
                improvementEl.classList.remove('text-red-600');
            } else {
                const decline = Math.abs(improvement);
                const declinePercent = Math.round((decline / previousTime) * 100);
                improvementEl.textContent = `↑ ${decline.toLocaleString()} ms (${declinePercent}%)`;
                improvementEl.classList.add('text-red-600');
                improvementEl.classList.remove('text-green-600');
            }
        } else {
            improvementEl.textContent = "--";
        }
    }

    function restartGame() {
        stopTimer();
        updateGameState(GameState.READY);
        gameAreaEl.focus();
    }

    function resetAllData() {
        if (confirm("Are you sure you want to reset all data? This will clear your high score and letter statistics.")) {
            localStorage.removeItem("highScore");
            localStorage.removeItem("letterHistory");
            localStorage.removeItem("totalHistory");
            localStorage.removeItem("attempts");
            attempts = 0;
            highscoreEl.textContent = "--";
            bestTimeEl.textContent = "--";
            averageTimeEl.textContent = "--";
            improvementEl.textContent = "--";
            attemptsEl.textContent = "0";
            letterHistoryChart.innerHTML = "";
            progressChartEl.innerHTML = "";
            historyTableBody.innerHTML = "";
            letterStatsEl.innerHTML = "";
            statsSection.classList.add('hidden');
            restartGame();
        }
    }

    function processKeyPress(key) {
        const lowerKey = key.toLowerCase();
        if (lowerKey === 'a' && currentState !== GameState.PLAYING) {
            document.querySelectorAll('.letter')[0].classList.remove('current');
            currentIndex = 1;
            attempts++;
            localStorage.setItem("attempts", attempts);
            attemptsEl.textContent = attempts;
            updateGameState(GameState.PLAYING);
            startTime = new Date().getTime();
            letterTimestamps[0] = startTime;
            letterTimestamps[1] = startTime;
            const letterEls = document.querySelectorAll('.letter');
            letterEls[0].classList.add('text-green-600');
            const progress = (currentIndex / alphabet.length) * 100;
            updateProgress(progress);
            highlightCurrentLetter();
            return;
        }
        if (currentState !== GameState.PLAYING) return;
        if (lowerKey === alphabet[currentIndex]) {
            const letterEls = document.querySelectorAll('.letter');
            letterEls[currentIndex].classList.add('letter-typed');
            currentIndex++;
            letterTimestamps[currentIndex] = new Date().getTime();
            const progress = (currentIndex / alphabet.length) * 100;
            updateProgress(progress);
            updateVirtualKeyboard();
            if (currentIndex === alphabet.length) {
                const finalTime = new Date().getTime() - startTime;
                resultEl.textContent = `${finalTime.toLocaleString()}ms`;
                const isNewHighScore = updateHighScore(finalTime);
                if (isNewHighScore) {
                    gameMessageEl.textContent = "New high score! Press 'A' to try again";
                }
                updateGameState(GameState.COMPLETED);
            } else {
                highlightCurrentLetter();
            }
        } else {
            const letterEls = document.querySelectorAll('.letter');
            letterEls[currentIndex].classList.add('text-red-600');
            updateGameState(GameState.ERROR);
        }
    }

    function handleKeyPress(event) {
        processKeyPress(event.key);
    }

    window.addEventListener("resize", () => {
        updateLetterHistoryChart();
        updateProgressChart();
    });
    window.addEventListener("load", redrawCharts);
    document.addEventListener("visibilitychange", () => {
        if (!document.hidden) redrawCharts();
    });
    document.addEventListener("keydown", handleKeyPress);
    restartBtn.addEventListener("click", restartGame);
    resetHighscoreBtn.addEventListener("click", resetAllData);
    toggleStatsBtn.addEventListener("click", () => {
        statsSection.classList.toggle('hidden');
        if (!statsSection.classList.contains('hidden')) {
            updateStatistics();
        }
    });
    initGame();
</script>

<script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "Game",
        "name": "Alphabet Typing Speed Game",
        "description": "Improve your typing speed by practicing the alphabet with detailed letter-by-letter statistics and performance tracking.",
        "genre": [
            "Educational",
            "Typing",
            "Skill Game"
        ],
        "audience": {
            "@type": "Audience",
            "audienceType": "Students, Typists, Anyone looking to improve typing skills"
        }
    }
</script>
<script src="../logo.js"></script>
</body>
</html>