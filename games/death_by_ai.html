<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Death by AI - Single Player</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ðŸ’€</text></svg>">
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gradient-to-r from-gray-800 to-gray-900 text-white min-h-screen flex items-center justify-center">
<div id="appContainer" class="container mx-auto p-4 max-w-2xl"></div>

<script>
    const appContainer = document.getElementById('appContainer');
    const scenarios = [
        "You are falling off a crumbling cliff",
        "You are trapped in a room with a black bear",
        "You're in a sinking ship",
        "You're caught in a tornado",
        "You're in a building on fire",
        "You're lost in a desert with no water",
        "You're facing a charging rhinoceros",
        "You're in a plane with failing engines",
        "You're caught in an avalanche",
        "You're in the path of a lava flow"
    ];

    let currentRound = 0;
    let playerScore = 0;

    function startGame() {
        currentRound = 0;
        playerScore = 0;
        nextRound();
    }

    function nextRound() {
        if (currentRound < 5) {
            currentRound++;
            const scenario = scenarios[Math.floor(Math.random() * scenarios.length)];
            renderPromptInput(scenario);
        } else {
            renderScoreboard();
        }
    }

    function renderPromptInput(scenario) {
        appContainer.innerHTML = `
            <div class="text-center bg-gray-700 p-8 rounded-lg shadow-lg">
                <h2 class="text-3xl mb-4 text-green-400">Round ${currentRound}/5: ${scenario}</h2>
                <textarea id="prompt-input" class="bg-gray-800 text-white px-4 py-2 rounded focus:outline-none focus:ring-2 focus:ring-green-500 w-full h-32 mb-4" placeholder="Enter your escape plan..."></textarea>
                <button id="submit-prompt" class="bg-green-500 hover:bg-green-600 text-white font-bold py-2 px-4 rounded transition duration-300 ease-in-out transform hover:scale-105 w-full">Submit</button>
            </div>
        `;
        document.getElementById('submit-prompt').addEventListener('click', () => submitPrompt(scenario));
    }

    async function submitPrompt(scenario) {
        const prompt = document.getElementById('prompt-input').value || "The player didn't submit a prompt";
        appContainer.innerHTML = `
            <div class="text-center bg-gray-700 p-8 rounded-lg shadow-lg">
                <h2 class="text-3xl mb-4 text-green-400">Resolving your fate</h2>
                <p class="text-xl">Please wait...</p>
            </div>
        `;

        try {
            const response = await fetch('https://chatgpt.tobiasmue91.workers.dev/', {
                method: 'POST',
                headers: {"Content-Type": "application/json", "Accept": "*/*"},
                body: JSON.stringify({
                    model: "gpt-3.5-turbo",
                    max_tokens: 150,
                    temperature: 0.7,
                    messages: [
                        {role: "system", content: "You are the AI judge in a game called 'Death by AI'. Your task is to determine if a player survives a given scenario based on their prompt. Respond with a JSON object containing 'survived' (boolean) and 'explanation' (string)."},
                        {role: "user", content: `Scenario: ${scenario}\nPlayer's action: ${prompt}`}
                    ]
                })
            });

            const data = await response.json();
            const fate = JSON.parse(data.choices[0].message.content);

            if (fate.survived) playerScore++;

            appContainer.innerHTML = `
                <div class="text-center bg-gray-700 p-8 rounded-lg shadow-lg">
                    <h2 class="text-3xl mb-4 text-green-400">Your Fate</h2>
                    <p class="text-xl mb-4">${fate.explanation}</p>
                    <p class="text-2xl font-bold ${fate.survived ? 'text-green-400' : 'text-red-400'}">${fate.survived ? 'You survived!' : 'You died!'}</p>
                    <button id="next-round" class="mt-4 bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded transition duration-300 ease-in-out transform hover:scale-105 w-full">Next Round</button>
                </div>
            `;
            document.getElementById('next-round').addEventListener('click', nextRound);
        } catch (error) {
            console.error('Error resolving fate:', error);
            appContainer.innerHTML = `
                <div class="text-center bg-gray-700 p-8 rounded-lg shadow-lg">
                    <h2 class="text-3xl mb-4 text-red-400">Error</h2>
                    <p class="text-xl">An error occurred while resolving your fate. Please try again.</p>
                    <button id="retry" class="mt-4 bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded transition duration-300 ease-in-out transform hover:scale-105 w-full">Retry</button>
                </div>
            `;
            document.getElementById('retry').addEventListener('click', () => renderPromptInput(scenario));
        }
    }

    function renderScoreboard() {
        appContainer.innerHTML = `
            <div class="text-center bg-gray-700 p-8 rounded-lg shadow-lg">
                <h2 class="text-3xl mb-4 text-green-400">Game Over</h2>
                <p class="text-2xl mb-4">Your final score: ${playerScore}/5</p>
                <button id="new-game" class="bg-green-500 hover:bg-green-600 text-white font-bold py-2 px-4 rounded transition duration-300 ease-in-out transform hover:scale-105 w-full">New Game</button>
            </div>
        `;
        document.getElementById('new-game').addEventListener('click', startGame);
    }

    startGame();
</script>
</body>
</html>