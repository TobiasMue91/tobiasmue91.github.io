<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Emoji Puzzle Mania Deluxe</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/howler/2.2.3/howler.min.js"></script>
</head>
<body class="bg-gradient-to-br from-purple-600 to-pink-600 min-h-screen flex items-center justify-center p-4">
<div id="game-container" class="bg-white rounded-lg shadow-2xl p-8 max-w-md w-full">
    <h1 class="text-4xl font-bold text-center mb-6 text-purple-600">Emoji Puzzle Mania Deluxe</h1>
    <div id="game-area" class="hidden">
        <div id="emoji-display" class="text-6xl text-center mb-4 animate-bounce"></div>
        <div id="button-grid" class="grid grid-cols-3 gap-4 mb-4"></div>
        <div class="flex justify-between items-center">
            <div id="score" class="text-2xl font-semibold text-purple-600">Score: 0</div>
            <div id="timer" class="text-2xl font-semibold text-pink-600">Time: 60s</div>
        </div>
        <div id="level" class="text-xl text-center mt-4 text-blue-600">Level: 1</div>
        <div id="combo" class="text-xl text-center mt-2 text-green-600">Combo: x1</div>
        <div id="powerup" class="mt-4 text-center">
            <button id="freeze-time" class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded mr-2 transition-colors duration-300">
                ‚ùÑÔ∏è Freeze (3)
            </button>
            <button id="reveal" class="bg-green-500 hover:bg-green-600 text-white font-bold py-2 px-4 rounded transition-colors duration-300">
                üîç Reveal (3)
            </button>
        </div>
    </div>
    <div id="start-screen" class="text-center">
        <p class="mb-4 text-lg">Match the emojis before time runs out! Use powerups wisely!</p>
        <button id="start-button" class="bg-green-500 hover:bg-green-600 text-white font-bold py-2 px-4 rounded text-lg transition-colors duration-300">
            Start Game
        </button>
    </div>
    <div id="game-over" class="hidden text-center">
        <h2 class="text-3xl font-bold mb-4 text-purple-600">Game Over!</h2>
        <p id="final-score" class="text-xl mb-2"></p>
        <p id="high-score" class="text-xl mb-4"></p>
        <button id="replay-button" class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded text-lg transition-colors duration-300">
            Play Again
        </button>
    </div>
</div>

<script>
    const emojis = ['üòÄ', 'üòé', 'ü§î', 'ü§Ø', 'ü•≥', 'üò¥', 'ü§†', 'ü•∏', 'ü§ì', 'üßê', 'üòá', 'ü§™', 'üòú', 'üòã', 'üòò', 'üöÄ', 'üåà', 'üçï', 'üé∏', 'üèÜ', 'ü¶Ñ', 'üç¶', 'üåÆ', 'üé®', 'üèÑ‚Äç‚ôÇÔ∏è'];
    let currentLevel = 1;
    let score = 0;
    let highScore = 0;
    let timeLeft = 60;
    let gameInterval;
    let currentEmojis = [];
    let combo = 1;
    let freezeTimeCount = 3;
    let revealCount = 3;

    const sounds = {
        correct: new Howl({ src: ['https://assets.mixkit.co/sfx/preview/mixkit-melodic-bonus-collect-1938.mp3'] }),
        wrong: new Howl({ src: ['https://assets.mixkit.co/sfx/preview/mixkit-funny-fail-low-tone-2876.mp3'] }),
        levelUp: new Howl({ src: ['https://assets.mixkit.co/sfx/preview/mixkit-achievement-bell-600.mp3'] }),
        gameOver: new Howl({ src: ['https://assets.mixkit.co/sfx/preview/mixkit-funny-fail-trumpet-ace-576.mp3'] }),
        powerup: new Howl({ src: ['https://assets.mixkit.co/sfx/preview/mixkit-magic-sweep-game-trophy-257.mp3'] })
    };

    const gameArea = document.getElementById('game-area');
    const startScreen = document.getElementById('start-screen');
    const gameOverScreen = document.getElementById('game-over');
    const startButton = document.getElementById('start-button');
    const replayButton = document.getElementById('replay-button');
    const emojiDisplay = document.getElementById('emoji-display');
    const buttonGrid = document.getElementById('button-grid');
    const scoreDisplay = document.getElementById('score');
    const timerDisplay = document.getElementById('timer');
    const levelDisplay = document.getElementById('level');
    const comboDisplay = document.getElementById('combo');
    const freezeTimeButton = document.getElementById('freeze-time');
    const revealButton = document.getElementById('reveal');

    startButton.addEventListener('click', startGame);
    replayButton.addEventListener('click', startGame);
    freezeTimeButton.addEventListener('click', freezeTime);
    revealButton.addEventListener('click', reveal);

    function startGame() {
        currentLevel = 1;
        score = 0;
        timeLeft = 60;
        combo = 1;
        freezeTimeCount = 3;
        revealCount = 3;
        updateScore();
        updateTimer();
        updateLevel();
        updateCombo();
        updatePowerups();
        startScreen.classList.add('hidden');
        gameOverScreen.classList.add('hidden');
        gameArea.classList.remove('hidden');
        nextRound();
        gameInterval = setInterval(updateGame, 1000);
    }

    function nextRound() {
        buttonGrid.innerHTML = '';
        currentEmojis = getRandomEmojis(currentLevel + 2);
        const targetEmoji = currentEmojis[Math.floor(Math.random() * currentEmojis.length)];
        emojiDisplay.textContent = targetEmoji;

        for (let emoji of shuffleArray(currentEmojis)) {
            const button = document.createElement('button');
            button.textContent = emoji;
            button.className = 'text-4xl bg-gray-200 hover:bg-gray-300 rounded p-2 transition-all duration-300 transform hover:scale-110 focus:outline-none focus:ring-2 focus:ring-purple-600';
            button.addEventListener('click', () => checkAnswer(emoji, targetEmoji));
            buttonGrid.appendChild(button);
        }
    }

    function checkAnswer(selected, target) {
        if (selected === target) {
            score += currentLevel * 10 * combo;
            updateScore();
            sounds.correct.play();
            combo++;
            updateCombo();
            if (score >= currentLevel * 50) {
                levelUp();
            } else {
                nextRound();
            }
        } else {
            sounds.wrong.play();
            timeLeft = Math.max(0, timeLeft - 5);
            combo = 1;
            updateCombo();
            updateTimer();
        }
    }

    function levelUp() {
        currentLevel++;
        updateLevel();
        sounds.levelUp.play();
        timeLeft = Math.min(timeLeft + 15, 60);
        updateTimer();
        nextRound();
    }

    function updateGame() {
        timeLeft--;
        updateTimer();
        if (timeLeft <= 0) {
            endGame();
        }
    }

    function endGame() {
        clearInterval(gameInterval);
        gameArea.classList.add('hidden');
        gameOverScreen.classList.remove('hidden');
        if (score > highScore) {
            highScore = score;
            localStorage.setItem('highScore', highScore);
        }
        document.getElementById('final-score').textContent = `Final Score: ${score}`;
        document.getElementById('high-score').textContent = `High Score: ${highScore}`;
        sounds.gameOver.play();
    }

    function updateScore() {
        scoreDisplay.textContent = `Score: ${score}`;
    }

    function updateTimer() {
        timerDisplay.textContent = `Time: ${timeLeft}s`;
    }

    function updateLevel() {
        levelDisplay.textContent = `Level: ${currentLevel}`;
    }

    function updateCombo() {
        comboDisplay.textContent = `Combo: x${combo}`;
    }

    function updatePowerups() {
        freezeTimeButton.textContent = `‚ùÑÔ∏è Freeze (${freezeTimeCount})`;
        revealButton.textContent = `üîç Reveal (${revealCount})`;
    }

    function freezeTime() {
        if (freezeTimeCount > 0) {
            freezeTimeCount--;
            timeLeft = Math.min(timeLeft + 10, 60);
            updateTimer();
            updatePowerups();
            sounds.powerup.play();
        }
    }

    function reveal() {
        if (revealCount > 0) {
            revealCount--;
            const targetEmoji = emojiDisplay.textContent;
            const buttons = buttonGrid.querySelectorAll('button');
            buttons.forEach(button => {
                if (button.textContent === targetEmoji) {
                    button.classList.add('bg-yellow-300', 'animate-pulse');
                }
            });
            updatePowerups();
            sounds.powerup.play();
        }
    }

    function getRandomEmojis(count) {
        return shuffleArray(emojis).slice(0, count);
    }

    function shuffleArray(array) {
        for (let i = array.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [array[i], array[j]] = [array[j], array[i]];
        }
        return array;
    }

    // Load high score from localStorage
    highScore = parseInt(localStorage.getItem('highScore')) || 0;
</script>
</body>
</html>