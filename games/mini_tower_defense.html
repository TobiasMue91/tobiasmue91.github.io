<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="description" content="Elite Tower Defense - Build towers, upgrade defenses, and battle waves of enemies in this action-packed strategy game. Features 5 unique tower types, boss battles, swarm waves, and special abilities.">
    <meta name="keywords" content="tower defense game, strategy game, defense game, tower defense online, free tower defense, browser game, strategy tower defense, tower upgrade game">
    <meta name="author" content="Claude Sonnet 4 prompted by Tobias M√ºller">
    <meta name="robots" content="index, follow">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="canonical" href="https://www.gptgames.dev/games/mini_tower_defense.html">
    <meta property="og:title" content="Elite Tower Defense - Free Online Strategy Game">
    <meta property="og:description" content="Build towers, upgrade defenses, and battle waves of enemies in this action-packed strategy game. Features 5 unique tower types, boss battles, swarm waves, and special abilities.">
    <meta property="og:image" content="https://www.gptgames.dev/screenshots/screenshot_213.webp">
    <meta property="og:image:alt" content="Elite Tower Defense game screenshot showing towers defending against enemy waves">
    <meta property="og:url" content="https://www.gptgames.dev/games/mini_tower_defense.html">
    <meta property="og:type" content="website">
    <meta property="og:site_name" content="GPT Games">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Elite Tower Defense - Free Online Strategy Game">
    <meta name="twitter:description" content="Build towers, upgrade defenses, and battle waves of enemies in this action-packed strategy game. Features 5 unique tower types, boss battles, swarm waves, and special abilities.">
    <meta name="twitter:image" content="https://www.gptgames.dev/screenshots/screenshot_213.webp">
    <meta name="twitter:image:alt" content="Elite Tower Defense game screenshot showing towers defending against enemy waves">
    <meta name="theme-color" content="#1a1a2e">
    <meta name="application-name" content="Elite Tower Defense">
    <meta name="msapplication-TileColor" content="#1a1a2e">
    <title>Elite Tower Defense</title>
    <style>* {
        margin: 0;
        padding: 0;
        box-sizing: border-box
    }

    body {
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        background: linear-gradient(135deg, #0c0c0c 0%, #1a1a2e 50%, #16213e 100%);
        color: #fff;
        display: flex;
        align-items: center;
        justify-content: center;
        min-height: 100vh;
        padding: 10px
    }

    @keyframes pulse {
        0%, 100% {
            transform: scale(1)
        }
        50% {
            transform: scale(1.05)
        }
    }

    @keyframes slideIn {
        from {
            transform: translateY(-20px);
            opacity: 0
        }
        to {
            transform: translateY(0);
            opacity: 1
        }
    }

    @keyframes bossGlow {
        0%, 100% {
            box-shadow: 0 0 10px #ff0000
        }
        50% {
            box-shadow: 0 0 25px #ff0000, 0 0 35px #ff4444
        }
    }

    @keyframes swarmWarning {
        0%, 100% {
            background: rgba(255, 0, 0, 0.1)
        }
        50% {
            background: rgba(255, 0, 0, 0.3)
        }
    }

    .container {
        background: linear-gradient(145deg, rgba(15, 15, 35, 0.95), rgba(25, 25, 45, 0.95));
        border-radius: 20px;
        padding: 20px;
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.7), inset 0 1px 0 rgba(255, 255, 255, 0.1);
        max-width: 900px;
        width: 100%;
        backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.1);
        animation: slideIn 0.8s ease-out
    }

    .header {
        display: grid;
        grid-template-columns:repeat(auto-fit, minmax(120px, 1fr));
        gap: 12px;
        margin-bottom: 16px
    }

    .stat {
        background: linear-gradient(145deg, rgba(30, 30, 60, 0.8), rgba(20, 20, 40, 0.8));
        padding: 12px;
        border-radius: 12px;
        text-align: center;
        border: 1px solid rgba(255, 255, 255, 0.1);
        transition: transform 0.2s ease
    }

    .stat:hover {
        transform: translateY(-1px)
    }

    .stat-value {
        font-size: 18px;
        font-weight: bold;
        display: block;
        background: linear-gradient(45deg, #4CAF50, #8BC34A);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text
    }

    .stat-label {
        font-size: 10px;
        color: #aaa;
        margin-top: 2px;
        letter-spacing: 0.5px
    }

    .board {
        display: grid;
        grid-template-columns:repeat(12, 38px);
        grid-template-rows:repeat(8, 38px);
        gap: 1px;
        background: linear-gradient(45deg, rgba(0, 0, 0, 0.8), rgba(10, 10, 20, 0.8));
        padding: 12px;
        border-radius: 12px;
        margin: 16px 0;
        position: relative;
        border: 2px solid rgba(255, 255, 255, 0.1)
    }

    .cell {
        width: 38px;
        height: 38px;
        border-radius: 6px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 16px;
        cursor: pointer;
        transition: all 0.3s ease;
        position: relative;
        overflow: hidden
    }

    .cell.grass {
        background: linear-gradient(135deg, #2e5d2e, #1e4d1e);
        border: 1px solid rgba(76, 175, 80, 0.3)
    }

    .cell.path {
        background: linear-gradient(135deg, #8b4513, #6b3410);
        border: 1px solid rgba(139, 69, 19, 0.5)
    }

    .cell.spawn {
        background: linear-gradient(135deg, #d32f2f, #b71c1c);
        border: 1px solid rgba(244, 67, 54, 0.7);
        animation: bossGlow 3s infinite
    }

    .cell.goal {
        background: linear-gradient(135deg, #1976d2, #0d47a1);
        border: 1px solid rgba(33, 150, 243, 0.7);
        animation: bossGlow 3s infinite reverse
    }

    .cell.grass:hover {
        background: linear-gradient(135deg, #4caf50, #66bb6a);
        transform: scale(1.05)
    }

    .cell.has-tower {
        cursor: pointer
    }

    .cell.has-tower:hover {
        background: linear-gradient(135deg, #ffa726, #ff9800);
        transform: scale(1.05)
    }

    .tower {
        font-size: 20px;
        text-shadow: 0 2px 4px rgba(0, 0, 0, 0.8);
        position: relative;
        z-index: 2;
        transition: all 0.3s ease
    }

    .tower.level-2 {
        transform: scale(1.15);
        filter: brightness(1.2) saturate(1.2)
    }

    .tower.level-3 {
        transform: scale(1.3);
        filter: brightness(1.4) saturate(1.4) drop-shadow(0 0 8px currentColor)
    }

    .enemy {
        position: absolute;
        font-size: 16px;
        z-index: 10;
        text-shadow: 0 2px 4px rgba(0, 0, 0, 0.8);
        transition: all 0.4s ease;
        filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.6))
    }

    .enemy.boss {
        font-size: 24px;
        animation: pulse 1.5s infinite;
        filter: drop-shadow(0 0 10px #ff0000)
    }

    .enemy.flying {
        animation: pulse 1s infinite alternate
    }

    .health-bar {
        position: absolute;
        top: -8px;
        left: 50%;
        transform: translateX(-50%);
        width: 30px;
        height: 4px;
        background: rgba(0, 0, 0, 0.7);
        border-radius: 2px;
        overflow: hidden;
        border: 1px solid rgba(255, 255, 255, 0.2)
    }

    .health-fill {
        height: 100%;
        background: linear-gradient(90deg, #f44336, #ff9800, #4caf50);
        transition: width 0.3s ease;
        border-radius: 1px
    }

    .projectile {
        position: absolute;
        width: 4px;
        height: 4px;
        border-radius: 50%;
        z-index: 5;
        transition: all 0.1s linear
    }

    .projectile.bullet {
        background: radial-gradient(circle, #ffd700, #ffb300);
        box-shadow: 0 0 6px rgba(255, 215, 0, 0.8)
    }

    .projectile.laser {
        background: radial-gradient(circle, #00ffff, #0080ff);
        box-shadow: 0 0 8px rgba(0, 255, 255, 0.8);
        width: 6px;
        height: 6px
    }

    .projectile.cannon {
        background: radial-gradient(circle, #ff4500, #ff6347);
        box-shadow: 0 0 10px rgba(255, 69, 0, 0.8);
        width: 8px;
        height: 8px
    }

    .explosion {
        position: absolute;
        width: 40px;
        height: 40px;
        border-radius: 50%;
        background: radial-gradient(circle, rgba(255, 165, 0, 0.8), rgba(255, 69, 0, 0.4), transparent);
        animation: explode 0.6s ease-out forwards;
        pointer-events: none;
        z-index: 15
    }

    @keyframes explode {
        0% {
            transform: scale(0);
            opacity: 1
        }
        100% {
            transform: scale(2);
            opacity: 0
        }
    }

    .controls {
        display: flex;
        gap: 8px;
        justify-content: center;
        margin-bottom: 12px;
        flex-wrap: wrap
    }

    .btn {
        background: linear-gradient(145deg, rgba(60, 60, 100, 0.9), rgba(40, 40, 70, 0.9));
        border: none;
        color: #fff;
        padding: 8px 12px;
        border-radius: 8px;
        cursor: pointer;
        font-size: 12px;
        transition: all 0.3s ease;
        border: 2px solid transparent;
        position: relative;
        min-width: 80px
    }

    .btn:hover:not(:disabled) {
        background: linear-gradient(145deg, rgba(80, 80, 120, 0.9), rgba(60, 60, 90, 0.9));
        transform: translateY(-1px)
    }

    .btn:disabled {
        opacity: 0.4;
        cursor: not-allowed
    }

    .btn.selected {
        border-color: #4caf50;
        background: linear-gradient(145deg, rgba(76, 175, 80, 0.8), rgba(56, 142, 60, 0.8))
    }

    .btn.options {
        background: linear-gradient(145deg, rgba(120, 120, 120, 0.8), rgba(80, 80, 80, 0.8));
        min-width: 60px
    }

    .game-controls {
        display: flex;
        gap: 8px;
        justify-content: center;
        margin-bottom: 12px
    }

    .speed-btn {
        padding: 6px 10px;
        font-size: 10px;
        min-width: 50px
    }

    .info {
        text-align: center;
        color: #bbb;
        margin: 8px 0;
        font-size: 14px;
        padding: 8px;
        border-radius: 8px;
        transition: all 0.3s ease
    }

    .info.warning {
        background: rgba(255, 152, 0, 0.2);
        color: #ffb74d;
        border: 1px solid rgba(255, 152, 0, 0.3)
    }

    .info.swarm {
        animation: swarmWarning 1s infinite;
        color: #ff5722;
        font-weight: bold
    }

    .range-indicator {
        position: absolute;
        border: 2px dashed rgba(76, 175, 80, 0.8);
        border-radius: 50%;
        pointer-events: none;
        z-index: 1;
        transition: all 0.2s ease
    }

    .upgrade-hint {
        position: absolute;
        background: rgba(255, 193, 7, 0.9);
        color: #000;
        padding: 4px 8px;
        border-radius: 4px;
        font-size: 10px;
        font-weight: bold;
        z-index: 20;
        pointer-events: none;
        animation: pulse 2s infinite
    }

    .freeze-effect {
        filter: hue-rotate(180deg) brightness(0.8) saturate(1.5)
    }

    .options-panel {
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background: linear-gradient(145deg, rgba(20, 20, 40, 0.98), rgba(30, 30, 50, 0.98));
        border: 2px solid rgba(255, 255, 255, 0.2);
        border-radius: 16px;
        padding: 24px;
        z-index: 100;
        min-width: 300px;
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.8);
        backdrop-filter: blur(20px)
    }

    .options-panel h3 {
        margin-bottom: 16px;
        text-align: center;
        color: #4CAF50
    }

    .option-row {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin: 12px 0;
        padding: 8px 0;
        border-bottom: 1px solid rgba(255, 255, 255, 0.1)
    }

    .option-row:last-child {
        border-bottom: none
    }

    .toggle {
        width: 50px;
        height: 24px;
        background: rgba(100, 100, 100, 0.5);
        border-radius: 12px;
        position: relative;
        cursor: pointer;
        transition: all 0.3s ease
    }

    .toggle.active {
        background: #4CAF50
    }

    .toggle-slider {
        width: 20px;
        height: 20px;
        background: #fff;
        border-radius: 50%;
        position: absolute;
        top: 2px;
        left: 2px;
        transition: all 0.3s ease
    }

    .toggle.active .toggle-slider {
        transform: translateX(26px)
    }

    .overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.7);
        z-index: 99
    }</style>
</head>
<body>
<div class="container">
    <div class="header">
        <div class="stat"><span class="stat-value" id="money">üí∞ 150</span><span class="stat-label">GOLD</span></div>
        <div class="stat"><span class="stat-value" id="lives">‚ù§Ô∏è 25</span><span class="stat-label">LIVES</span></div>
        <div class="stat"><span class="stat-value" id="score">‚≠ê 0</span><span class="stat-label">SCORE</span></div>
        <div class="stat"><span class="stat-value" id="wave">üåä 1</span><span class="stat-label">WAVE</span></div>
        <div class="stat"><span class="stat-value" id="kills">‚öîÔ∏è 0</span><span class="stat-label">KILLS</span></div>
    </div>
    <div class="game-controls">
        <button class="btn speed-btn" onclick="setSpeed(1)" id="speed1">1x</button>
        <button class="btn speed-btn selected" onclick="setSpeed(2)" id="speed2">2x</button>
        <button class="btn speed-btn" onclick="setSpeed(4)" id="speed4">4x</button>
        <button class="btn speed-btn" onclick="togglePause()" id="pauseBtn">‚è∏Ô∏è</button>
        <button class="btn options" onclick="toggleOptions()" id="optionsBtn">‚öôÔ∏è</button>
    </div>
    <div class="controls">
        <button class="btn" onclick="selectTower('gun')" id="gunBtn">üî´ Gun ($35)</button>
        <button class="btn" onclick="selectTower('laser')" id="laserBtn">‚ö° Laser ($60)</button>
        <button class="btn" onclick="selectTower('cannon')" id="cannonBtn">üí• Cannon ($100)</button>
        <button class="btn" onclick="selectTower('freeze')" id="freezeBtn">‚ùÑÔ∏è Freeze ($80)</button>
        <button class="btn" onclick="selectTower('lightning')" id="lightningBtn">‚ö° Chain ($120)</button>
        <button class="btn" onclick="useAbility('bomb')" id="bombBtn">üí£ Bomb ($50)</button>
        <button class="btn" onclick="useAbility('shield')" id="shieldBtn">üõ°Ô∏è Shield ($75)</button>
    </div>
    <div class="info" id="info">Build towers on green tiles ‚Ä¢ Click towers to upgrade them</div>
    <div class="board" id="board"></div>
</div>
<div id="optionsPanel" class="options-panel" style="display:none"><h3>‚öôÔ∏è Game Options</h3>
    <div class="option-row"><span>Sound Effects</span>
        <div class="toggle active" onclick="toggleSound()">
            <div class="toggle-slider"></div>
        </div>
    </div>
    <div class="option-row"><span>Visual Effects</span>
        <div class="toggle active" onclick="toggleEffects()">
            <div class="toggle-slider"></div>
        </div>
    </div>
    <div class="option-row"><span>Auto-Speed Up</span>
        <div class="toggle" onclick="toggleAutoSpeed()">
            <div class="toggle-slider"></div>
        </div>
    </div>
    <div style="text-align:center;margin-top:16px">
        <button class="btn" onclick="toggleOptions()">Close</button>
    </div>
</div>
<div id="overlay" class="overlay" style="display:none" onclick="toggleOptions()"></div>
<script>class EliteTowerDefense {
    constructor() {
        this.COLS = 12;
        this.ROWS = 8;
        this.CELL_SIZE = 38;
        this.PADDING = 12;
        this.money = 150;
        this.lives = 25;
        this.score = 0;
        this.wave = 1;
        this.kills = 0;
        this.selectedTower = null;
        this.gameSpeed = 2;
        this.paused = false;
        this.towers = [];
        this.enemies = [];
        this.projectiles = [];
        this.running = true;
        this.lastSpawn = 0;
        this.enemiesToSpawn = 8;
        this.enemiesSpawned = 0;
        this.rangeIndicator = null;
        this.audioContext = null;
        this.soundEnabled = true;
        this.effectsEnabled = true;
        this.autoSpeedUp = false;
        this.shieldActive = false;
        this.shieldTime = 0;
        this.initAudio();
        this.path = [{x: 1, y: 4}, {x: 2, y: 4}, {x: 3, y: 4}, {x: 4, y: 4}, {x: 4, y: 3}, {x: 4, y: 2}, {
            x: 5,
            y: 2
        }, {x: 6, y: 2}, {x: 7, y: 2}, {x: 8, y: 2}, {x: 8, y: 3}, {x: 8, y: 4}, {x: 8, y: 5}, {x: 9, y: 5}, {
            x: 10,
            y: 5
        }, {x: 11, y: 5}];
        this.towerData = {
            gun: {
                cost: 35,
                damage: 45,
                range: 2.2,
                rate: 800,
                emoji: 'üî´',
                projectile: 'bullet',
                upgrades: [{cost: 25, damage: 65, rate: 600}, {cost: 50, damage: 90, rate: 400}]
            },
            laser: {
                cost: 60,
                damage: 25,
                range: 2.8,
                rate: 300,
                emoji: '‚ö°',
                projectile: 'laser',
                upgrades: [{cost: 40, damage: 35, rate: 200}, {cost: 80, damage: 50, rate: 150}]
            },
            cannon: {
                cost: 100,
                damage: 120,
                range: 3.2,
                rate: 1600,
                emoji: 'üí•',
                projectile: 'cannon',
                splash: 1.5,
                upgrades: [{cost: 70, damage: 180, splash: 2}, {cost: 140, damage: 250, splash: 2.5}]
            },
            freeze: {
                cost: 80,
                damage: 15,
                range: 2.5,
                rate: 1200,
                emoji: '‚ùÑÔ∏è',
                projectile: 'laser',
                special: 'freeze',
                upgrades: [{cost: 60, damage: 25, range: 3}, {cost: 120, damage: 40, range: 3.5}]
            },
            lightning: {
                cost: 120,
                damage: 80,
                range: 2.8,
                rate: 1000,
                emoji: '‚ö°',
                projectile: 'laser',
                special: 'chain',
                upgrades: [{cost: 90, damage: 120, targets: 4}, {cost: 180, damage: 180, targets: 6}]
            }
        };
        this.enemyTypes = [{emoji: 'üëæ', hp: 80, speed: 1000, gold: 15, armor: 0}, {
            emoji: 'üêõ',
            hp: 50,
            speed: 600,
            gold: 12,
            armor: 0
        }, {emoji: 'ü¶é', hp: 140, speed: 1400, gold: 25, armor: 1}, {
            emoji: 'üõ∏',
            hp: 90,
            speed: 800,
            gold: 20,
            flying: true
        }, {emoji: '‚öîÔ∏è', hp: 200, speed: 1200, gold: 35, armor: 2}];
        this.bossTypes = [{emoji: 'üëπ', hp: 800, speed: 1800, gold: 150, armor: 3, boss: true}, {
            emoji: 'üêâ',
            hp: 1200,
            speed: 1600,
            gold: 200,
            armor: 4,
            boss: true,
            flying: true
        }];
        this.init();
        this.loop()
    }

    initAudio() {
        try {
            this.audioContext = new (window.AudioContext || window.webkitAudioContext)();
            this.sounds = {
                shoot: () => this.createTone(800, 0.1),
                hit: () => this.createTone(400, 0.15),
                kill: () => this.createTone(600, 0.2),
                place: () => this.createTone(1000, 0.1),
                wave: () => this.createTone(1200, 0.3)
            }
        } catch (e) {
            this.audioContext = null
        }
    }

    createTone(freq, duration) {
        if (!this.audioContext || !this.soundEnabled) return;
        const osc = this.audioContext.createOscillator();
        const gain = this.audioContext.createGain();
        osc.connect(gain);
        gain.connect(this.audioContext.destination);
        osc.frequency.setValueAtTime(freq, this.audioContext.currentTime);
        gain.gain.setValueAtTime(0.05, this.audioContext.currentTime);
        gain.gain.exponentialRampToValueAtTime(0.001, this.audioContext.currentTime + duration);
        osc.start(this.audioContext.currentTime);
        osc.stop(this.audioContext.currentTime + duration)
    }

    init() {
        const board = document.getElementById('board');
        board.innerHTML = '';
        for (let y = 0; y < this.ROWS; y++) {
            for (let x = 0; x < this.COLS; x++) {
                const cell = document.createElement('div');
                cell.className = 'cell';
                cell.dataset.x = x;
                cell.dataset.y = y;
                const onPath = this.path.some(p => p.x === x && p.y === y);
                if (x === 1 && y === 4) {
                    cell.className += ' spawn';
                    cell.innerHTML = 'üö™'
                } else if (x === 11 && y === 5) {
                    cell.className += ' goal';
                    cell.innerHTML = 'üéØ'
                } else if (onPath) {
                    cell.className += ' path'
                } else {
                    cell.className += ' grass';
                    cell.onclick = () => this.handleCellClick(x, y);
                    cell.onmouseenter = () => this.showRange(x, y);
                    cell.onmouseleave = () => this.hideRange()
                }
                board.appendChild(cell)
            }
        }
    }

    selectTower(type) {
        if (this.money < this.towerData[type].cost) return;
        this.selectedTower = type;
        this.updateButtons()
    }

    updateButtons() {
        document.querySelectorAll('.controls .btn').forEach(b => b.classList.remove('selected'));
        if (this.selectedTower) {
            document.getElementById(this.selectedTower + 'Btn').classList.add('selected')
        }
    }

    handleCellClick(x, y) {
        const tower = this.towers.find(t => t.x === x && t.y === y);
        if (tower) {
            this.upgradeTower(x, y)
        } else if (this.selectedTower) {
            this.buildTower(x, y)
        }
    }

    buildTower(x, y) {
        const data = this.towerData[this.selectedTower];
        if (this.money < data.cost || this.towers.some(t => t.x === x && t.y === y)) return;
        this.money -= data.cost;
        this.towers.push({x, y, type: this.selectedTower, level: 1, lastFire: 0, ...data});
        const cell = document.querySelector(`[data-x="${x}"][data-y="${y}"]`);
        cell.className = cell.className.replace('grass', 'has-tower');
        cell.innerHTML = `<div class="tower">${data.emoji}</div>`;
        cell.onclick = () => this.handleCellClick(x, y);
        this.selectedTower = null;
        this.updateButtons();
        this.playSound('place');
        this.update()
    }

    upgradeTower(x, y) {
        const tower = this.towers.find(t => t.x === x && t.y === y);
        if (!tower || tower.level >= 3) return;
        const upgrade = tower.upgrades[tower.level - 1];
        if (this.money < upgrade.cost) return;
        this.money -= upgrade.cost;
        tower.level++;
        Object.assign(tower, upgrade);
        const cell = document.querySelector(`[data-x="${x}"][data-y="${y}"]`);
        const towerEl = cell.querySelector('.tower');
        towerEl.className = `tower level-${tower.level}`;
        this.playSound('place');
        this.createUpgradeEffect(x, y);
        this.update()
    }

    createUpgradeEffect(x, y) {
        if (!this.effectsEnabled) return;
        const pos = this.getPixels(x, y);
        const effect = document.createElement('div');
        effect.textContent = '‚¨ÜÔ∏è';
        effect.style.position = 'absolute';
        effect.style.left = pos.x + 'px';
        effect.style.top = pos.y + 'px';
        effect.style.color = '#ffc107';
        effect.style.fontSize = '20px';
        effect.style.fontWeight = 'bold';
        effect.style.pointerEvents = 'none';
        effect.style.zIndex = '20';
        effect.style.animation = 'pulse 1s ease-out';
        document.getElementById('board').appendChild(effect);
        setTimeout(() => effect.remove(), 1000)
    }

    showRange(x, y) {
        if (!this.selectedTower) return;
        const data = this.towerData[this.selectedTower];
        this.hideRange();
        const range = data.range * this.CELL_SIZE * 1.3;
        this.rangeIndicator = document.createElement('div');
        this.rangeIndicator.className = 'range-indicator';
        this.rangeIndicator.style.width = range * 2 + 'px';
        this.rangeIndicator.style.height = range * 2 + 'px';
        this.rangeIndicator.style.left = (this.PADDING + x * 39 + 19 - range) + 'px';
        this.rangeIndicator.style.top = (this.PADDING + y * 39 + 19 - range) + 'px';
        document.getElementById('board').appendChild(this.rangeIndicator)
    }

    hideRange() {
        if (this.rangeIndicator) {
            this.rangeIndicator.remove();
            this.rangeIndicator = null
        }
    }

    spawn() {
        if (this.enemiesSpawned >= this.enemiesToSpawn) return;
        let template;
        const isSwarmWave = this.wave % 10 === 0;
        const isBossWave = this.wave % 5 === 0 && !isSwarmWave;
        if (isBossWave && this.enemiesSpawned === this.enemiesToSpawn - 1) {
            template = this.bossTypes[Math.floor(Math.random() * this.bossTypes.length)]
        } else {
            template = this.enemyTypes[Math.floor(Math.random() * this.enemyTypes.length)]
        }
        const hpMultiplier = isSwarmWave ? 0.7 : 1;
        const enemy = {
            id: Date.now() + Math.random(),
            pathPos: 0,
            x: 1,
            y: 4,
            hp: (template.hp + this.wave * 10) * hpMultiplier,
            maxHp: (template.hp + this.wave * 10) * hpMultiplier,
            lastMove: Date.now(),
            frozen: 0, ...template
        };
        this.enemies.push(enemy);
        this.enemiesSpawned++;
        this.renderEnemy(enemy)
    }

    moveEnemies() {
        const now = Date.now();
        this.enemies.forEach(enemy => {
            if (enemy.frozen > now) return;
            const speedMultiplier = this.autoSpeedUp && this.wave > 5 ? 1.5 : 1;
            if (now - enemy.lastMove >= enemy.speed / (this.gameSpeed * speedMultiplier)) {
                enemy.lastMove = now;
                enemy.pathPos++;
                if (enemy.pathPos >= this.path.length) {
                    enemy.escaped = true;
                    this.lives -= enemy.boss ? 5 : 1
                } else {
                    const pos = this.path[enemy.pathPos];
                    enemy.x = pos.x;
                    enemy.y = pos.y
                }
            }
        });
        this.enemies = this.enemies.filter(enemy => {
            if (enemy.escaped || enemy.hp <= 0) {
                document.getElementById(`enemy${enemy.id}`)?.remove();
                if (enemy.hp <= 0) {
                    this.money += enemy.gold;
                    this.score += enemy.gold;
                    this.kills++;
                    this.playSound('kill')
                }
                return false
            }
            return true
        });
        this.drawEnemies()
    }

    fireTowers() {
        const now = Date.now();
        this.towers.forEach(tower => {
            if (now - tower.lastFire < tower.rate / this.gameSpeed) return;
            const target = this.findTarget(tower);
            if (target) {
                tower.lastFire = now;
                this.fireProjectile(tower, target);
                this.playSound('shoot')
            }
        })
    }

    findTarget(tower) {
        let bestTarget = null;
        let bestScore = -1;
        this.enemies.forEach(enemy => {
            if (tower.special === 'freeze' && enemy.frozen > Date.now()) return;
            const dx = enemy.x - tower.x;
            const dy = enemy.y - tower.y;
            const dist = Math.sqrt(dx * dx + dy * dy);
            if (dist <= tower.range) {
                if (enemy.flying && !tower.canHitFlying && tower.type !== 'laser' && tower.type !== 'lightning') return;
                const score = enemy.pathPos * 1000 - dist * 100 + (enemy.boss ? 500 : 0);
                if (score > bestScore) {
                    bestTarget = enemy;
                    bestScore = score
                }
            }
        });
        return bestTarget
    }

    fireProjectile(tower, target) {
        const from = this.getPixels(tower.x, tower.y);
        const to = this.getPixels(target.x, target.y);
        this.projectiles.push({
            id: Date.now() + Math.random(),
            x: from.x,
            y: from.y,
            tx: to.x,
            ty: to.y,
            damage: tower.damage,
            speed: 400,
            targetId: target.id,
            type: tower.projectile,
            special: tower.special,
            splash: tower.splash,
            tower: tower
        });
        this.renderProjectile(this.projectiles[this.projectiles.length - 1])
    }

    moveProjectiles() {
        this.projectiles.forEach(proj => {
            const dx = proj.tx - proj.x;
            const dy = proj.ty - proj.y;
            const dist = Math.sqrt(dx * dx + dy * dy);
            if (dist < 6) {
                const target = this.enemies.find(e => e.id === proj.targetId);
                this.handleProjectileHit(proj, target);
                proj.hit = true
            } else {
                proj.x += dx / dist * proj.speed * (0.016 * this.gameSpeed);
                proj.y += dy / dist * proj.speed * (0.016 * this.gameSpeed)
            }
        });
        this.projectiles = this.projectiles.filter(p => {
            if (p.hit) {
                document.getElementById(`proj${p.id}`)?.remove();
                return false
            }
            return true
        });
        this.drawProjectiles()
    }

    handleProjectileHit(proj, target) {
        if (target) {
            let damage = Math.max(1, proj.damage - (target.armor || 0) * 5);
            target.hp -= damage;
            this.playSound('hit');
            if (proj.special === 'freeze') {
                target.frozen = Date.now() + 2000;
                const el = document.getElementById(`enemy${target.id}`);
                if (el) el.classList.add('freeze-effect');
                setTimeout(() => el?.classList.remove('freeze-effect'), 2000)
            }
            if (proj.special === 'chain' && proj.tower) {
                this.chainLightning(target, proj.tower, 3, proj.damage * 0.7)
            }
        }
        if (proj.splash) {
            this.createExplosion(proj.tx, proj.ty);
            this.enemies.forEach(enemy => {
                const dx = (enemy.x * 39 + 19) - proj.tx;
                const dy = (enemy.y * 39 + 19) - proj.ty;
                const dist = Math.sqrt(dx * dx + dy * dy);
                if (dist <= proj.splash * 30) {
                    let damage = Math.max(1, (proj.damage * 0.6) - (enemy.armor || 0) * 5);
                    enemy.hp -= damage
                }
            })
        }
    }

    chainLightning(source, tower, remaining, damage) {
        if (remaining <= 0) return;
        const targets = this.enemies.filter(e => e.id !== source.id).map(enemy => {
            const dx = enemy.x - source.x;
            const dy = enemy.y - source.y;
            return {enemy, dist: Math.sqrt(dx * dx + dy * dy)}
        }).filter(t => t.dist <= 2.5).sort((a, b) => a.dist - b.dist);
        if (targets.length > 0) {
            const next = targets[0].enemy;
            let finalDamage = Math.max(1, damage - (next.armor || 0) * 5);
            next.hp -= finalDamage;
            this.createLightningEffect(source, next);
            setTimeout(() => this.chainLightning(next, tower, remaining - 1, damage * 0.8), 100)
        }
    }

    createExplosion(x, y) {
        if (!this.effectsEnabled) return;
        const explosion = document.createElement('div');
        explosion.className = 'explosion';
        explosion.style.left = (x - 20) + 'px';
        explosion.style.top = (y - 20) + 'px';
        document.getElementById('board').appendChild(explosion);
        setTimeout(() => explosion.remove(), 600)
    }

    createLightningEffect(from, to) {
        if (!this.effectsEnabled) return;
        const line = document.createElement('div');
        line.style.position = 'absolute';
        line.style.background = 'linear-gradient(90deg,transparent,#00ffff,transparent)';
        line.style.height = '2px';
        line.style.zIndex = '11';
        line.style.pointerEvents = 'none';
        line.style.boxShadow = '0 0 8px #00ffff';
        const fromPos = this.getPixels(from.x, from.y);
        const toPos = this.getPixels(to.x, to.y);
        const dx = toPos.x - fromPos.x;
        const dy = toPos.y - fromPos.y;
        const dist = Math.sqrt(dx * dx + dy * dy);
        const angle = Math.atan2(dy, dx);
        line.style.width = dist + 'px';
        line.style.left = fromPos.x + 'px';
        line.style.top = fromPos.y + 'px';
        line.style.transformOrigin = '0 50%';
        line.style.transform = `rotate(${angle}rad)`;
        document.getElementById('board').appendChild(line);
        setTimeout(() => line.remove(), 200)
    }

    getPixels(gridX, gridY) {
        return {x: this.PADDING + gridX * 39 + 19, y: this.PADDING + gridY * 39 + 19}
    }

    renderEnemy(enemy) {
        const div = document.createElement('div');
        div.id = `enemy${enemy.id}`;
        div.className = `enemy${enemy.boss ? ' boss' : ''}${enemy.flying ? ' flying' : ''}`;
        div.innerHTML = `${enemy.emoji}<div class="health-bar"><div class="health-fill"></div></div>`;
        document.getElementById('board').appendChild(div)
    }

    drawEnemies() {
        this.enemies.forEach(enemy => {
            const el = document.getElementById(`enemy${enemy.id}`);
            if (!el) return;
            const pos = this.getPixels(enemy.x, enemy.y);
            el.style.left = (pos.x - 16) + 'px';
            el.style.top = (pos.y - 16) + 'px';
            const healthBar = el.querySelector('.health-fill');
            const healthPercent = Math.max(0, (enemy.hp / enemy.maxHp) * 100);
            healthBar.style.width = healthPercent + '%'
        })
    }

    renderProjectile(proj) {
        const div = document.createElement('div');
        div.id = `proj${proj.id}`;
        div.className = `projectile ${proj.type}`;
        div.style.left = (proj.x - 2) + 'px';
        div.style.top = (proj.y - 2) + 'px';
        document.getElementById('board').appendChild(div)
    }

    drawProjectiles() {
        this.projectiles.forEach(proj => {
            const el = document.getElementById(`proj${proj.id}`);
            if (el) {
                el.style.left = (proj.x - 2) + 'px';
                el.style.top = (proj.y - 2) + 'px'
            }
        })
    }

    useAbility(type) {
        if (type === 'bomb' && this.money >= 50) {
            this.money -= 50;
            this.enemies.forEach(enemy => {
                enemy.hp = Math.max(0, enemy.hp - 100);
                if (this.effectsEnabled) this.createExplosion(this.getPixels(enemy.x, enemy.y).x, this.getPixels(enemy.x, enemy.y).y)
            });
            this.playSound('hit')
        } else if (type === 'shield' && this.money >= 75) {
            this.money -= 75;
            this.shieldActive = true;
            this.shieldTime = Date.now() + 10000;
            document.getElementById('info').textContent = 'üõ°Ô∏è Shield Active!';
        }
        this.update()
    }

    setSpeed(speed) {
        this.gameSpeed = speed;
        document.querySelectorAll('.speed-btn').forEach(b => b.classList.remove('selected'));
        document.getElementById(`speed${speed}`).classList.add('selected')
    }

    togglePause() {
        this.paused = !this.paused;
        document.getElementById('pauseBtn').textContent = this.paused ? '‚ñ∂Ô∏è' : '‚è∏Ô∏è'
    }

    playSound(type) {
        if (this.sounds && this.sounds[type] && this.soundEnabled) {
            this.sounds[type]()
        }
    }

    update() {
        document.getElementById('money').textContent = `üí∞ ${this.money}`;
        document.getElementById('lives').textContent = `‚ù§Ô∏è ${this.lives}`;
        document.getElementById('score').textContent = `‚≠ê ${this.score}`;
        document.getElementById('wave').textContent = `üåä ${this.wave}`;
        document.getElementById('kills').textContent = `‚öîÔ∏è ${this.kills}`;
        Object.keys(this.towerData).forEach(type => {
            const btn = document.getElementById(type + 'Btn');
            btn.disabled = this.money < this.towerData[type].cost
        });
        document.getElementById('bombBtn').disabled = this.money < 50;
        document.getElementById('shieldBtn').disabled = this.money < 75;
        if (this.shieldActive) {
            if (Date.now() > this.shieldTime) {
                this.shieldActive = false;
                document.getElementById('info').classList.remove('warning');
                document.getElementById('info').textContent = 'Build towers on green tiles ‚Ä¢ Click towers to upgrade them'
            } else {
                document.getElementById('info').classList.add('warning')
            }
        }
        if (this.lives <= 0) {
            this.running = false;
            setTimeout(() => {
                if (confirm(`Game Over! Wave ${this.wave}, Score ${this.score}, Kills ${this.kills}. Play again?`)) location.reload()
            }, 1500)
        }
    }

    nextWave() {
        if (this.enemiesSpawned >= this.enemiesToSpawn && this.enemies.length === 0) {
            this.wave++;
            const isSwarmWave = this.wave % 10 === 0;
            if (isSwarmWave) {
                this.enemiesToSpawn = Math.min(30 + this.wave * 2, 50);
                document.getElementById('info').textContent = `‚ö†Ô∏è SWARM WAVE ${this.wave}! Get ready!`;
                document.getElementById('info').classList.add('swarm')
            } else {
                this.enemiesToSpawn = Math.min(8 + this.wave * 2, 25);
                document.getElementById('info').textContent = `Wave ${this.wave} incoming!`;
                document.getElementById('info').classList.remove('swarm')
            }
            this.enemiesSpawned = 0;
            this.playSound('wave');
            setTimeout(() => {
                document.getElementById('info').textContent = 'Build towers on green tiles ‚Ä¢ Click towers to upgrade them';
                document.getElementById('info').classList.remove('swarm')
            }, 3000)
        }
    }

    loop() {
        if (!this.running || this.paused) {
            requestAnimationFrame(() => this.loop());
            return
        }
        const now = Date.now();
        const spawnDelay = this.wave % 10 === 0 ? Math.max(300, 800 - this.wave * 10) : Math.max(1000, 2500 - this.wave * 50);
        if (this.enemiesSpawned < this.enemiesToSpawn && now - this.lastSpawn > spawnDelay / this.gameSpeed) {
            this.spawn();
            this.lastSpawn = now
        }
        this.moveEnemies();
        this.fireTowers();
        this.moveProjectiles();
        this.nextWave();
        this.update();
        requestAnimationFrame(() => this.loop())
    }
}

function selectTower(type) {
    game.selectTower(type)
}

function useAbility(type) {
    game.useAbility(type)
}

function setSpeed(speed) {
    game.setSpeed(speed)
}

function togglePause() {
    game.togglePause()
}

function toggleOptions() {
    const panel = document.getElementById('optionsPanel');
    const overlay = document.getElementById('overlay');
    const isVisible = panel.style.display !== 'none';
    panel.style.display = isVisible ? 'none' : 'block';
    overlay.style.display = isVisible ? 'none' : 'block'
}

function toggleSound() {
    game.soundEnabled = !game.soundEnabled;
    const toggle = event.target.closest('.toggle');
    toggle.classList.toggle('active', game.soundEnabled)
}

function toggleEffects() {
    game.effectsEnabled = !game.effectsEnabled;
    const toggle = event.target.closest('.toggle');
    toggle.classList.toggle('active', game.effectsEnabled)
}

function toggleAutoSpeed() {
    game.autoSpeedUp = !game.autoSpeedUp;
    const toggle = event.target.closest('.toggle');
    toggle.classList.toggle('active', game.autoSpeedUp)
}

const game = new EliteTowerDefense()</script>
<script src="../logo.js"></script>
</body>
</html>