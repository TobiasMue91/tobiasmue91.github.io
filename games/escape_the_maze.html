<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üåÄ</text></svg>">
    <title>Escape the Maze</title>
    <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=0">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js" crossorigin="anonymous"></script>
    <style>
        *{margin:0;padding:0;box-sizing:border-box}
        body{font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',sans-serif;background:#000;color:#fff;overflow:hidden;user-select:none}
        #game{width:100vw;height:100vh;position:relative}
        canvas{display:block}
        .overlay{position:absolute;top:0;left:0;width:100%;height:100%;display:flex;align-items:center;justify-content:center;flex-direction:column;background:rgba(0,0,0,0.92);backdrop-filter:blur(10px);z-index:10}
        .overlay.hidden{display:none}
        h1{font-size:3.5rem;font-weight:700;margin-bottom:1rem;color:#fff;letter-spacing:-0.02em}
        .subtitle{font-size:1.2rem;color:#aaa;margin-bottom:2.5rem;max-width:500px;text-align:center;line-height:1.5}
        .btn{padding:0.9rem 2.5rem;font-size:1rem;font-weight:600;background:#6366f1;color:#fff;border:none;border-radius:8px;cursor:pointer;transition:all 0.2s;margin:0.4rem;box-shadow:0 4px 15px rgba(99,102,241,0.4)}
        .btn:hover{background:#4f46e5;transform:translateY(-2px);box-shadow:0 6px 20px rgba(99,102,241,0.5)}
        .btn:active{transform:translateY(0)}
        .btn-secondary{background:#374151;box-shadow:0 4px 15px rgba(0,0,0,0.3)}
        .btn-secondary:hover{background:#4b5563;box-shadow:0 6px 20px rgba(0,0,0,0.4)}
        .controls{margin-top:2rem;padding:1.5rem 2rem;background:rgba(17,17,17,0.8);border-radius:12px;border:1px solid #333;backdrop-filter:blur(10px)}
        .control-grid{display:grid;grid-template-columns:repeat(3,60px);gap:8px;justify-content:center;margin-bottom:1rem}
        .key{padding:0.6rem;background:rgba(40,40,40,0.9);border:2px solid #444;border-radius:6px;text-align:center;font-weight:600;font-size:1rem;color:#fff;box-shadow:0 2px 8px rgba(0,0,0,0.5)}
        .key.arrow{font-size:1.2rem}
        .or{text-align:center;color:#666;font-size:0.9rem;margin:0.5rem 0}
        #hud{position:absolute;top:1rem;left:1rem;right:1rem;display:flex;gap:1rem;z-index:5;pointer-events:none}
        #hud.hidden{display:none}
        .hud-item{background:rgba(0,0,0,0.85);padding:0.8rem 1.2rem;border-radius:10px;border:1px solid rgba(255,255,255,0.1);display:flex;align-items:center;gap:0.7rem;font-size:1rem;font-weight:600;backdrop-filter:blur(10px);box-shadow:0 4px 15px rgba(0,0,0,0.5)}
        .hud-icon{font-size:1.3rem}
        .hud-value{min-width:25px;text-align:center;color:#fff}
        .boost-active{color:#10b981;text-shadow:0 0 10px #10b981}
        #minimap{position:absolute;bottom:1rem;right:1rem;width:180px;height:180px;background:rgba(0,0,0,0.85);border:2px solid rgba(255,255,255,0.15);border-radius:12px;z-index:5;pointer-events:none;backdrop-filter:blur(10px);box-shadow:0 4px 20px rgba(0,0,0,0.6)}
        #minimap.hidden{display:none}
        #minimap canvas{width:100%;height:100%;border-radius:10px}
        .stats{display:grid;grid-template-columns:repeat(2,1fr);gap:1.5rem;margin:2rem 0;max-width:400px}
        .stat{background:rgba(17,17,17,0.9);padding:1.2rem;border-radius:10px;border:1px solid #333;text-align:center;backdrop-filter:blur(10px)}
        .stat-label{font-size:0.85rem;color:#888;margin-bottom:0.4rem;text-transform:uppercase;letter-spacing:0.05em}
        .stat-value{font-size:2rem;font-weight:700;color:#6366f1}
        .message{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);background:#10b981;color:#fff;padding:1rem 2rem;border-radius:10px;font-size:1.1rem;font-weight:600;z-index:20;animation:pop 0.4s ease;box-shadow:0 8px 30px rgba(16,185,129,0.5)}
        @keyframes pop{0%,100%{transform:translate(-50%,-50%) scale(1)}50%{transform:translate(-50%,-50%) scale(1.05)}}
        .particle{position:absolute;width:6px;height:6px;border-radius:50%;pointer-events:none;z-index:15;animation:particle-rise 1s ease-out forwards}
        @keyframes particle-rise{0%{transform:translate(0,0) scale(1);opacity:1}100%{transform:translate(var(--x),var(--y)) scale(0);opacity:0}}
        @media(max-width:768px){h1{font-size:2.5rem}.hud-item{padding:0.6rem 0.9rem;font-size:0.9rem}#minimap{width:140px;height:140px}}
    </style>
</head>
<body>
<div id="game">
    <div id="menu" class="overlay">
        <h1>Escape the Maze</h1>
        <p class="subtitle">Navigate through atmospheric mazes lit by floating lamps. Collect power-ups and find the glowing exit!</p>
        <button class="btn" onclick="game.startGame()">Start Game</button>
        <div class="controls">
            <div class="control-grid">
                <div></div><div class="key arrow">‚Üë</div><div></div>
                <div class="key arrow">‚Üê</div><div class="key arrow">‚Üì</div><div class="key arrow">‚Üí</div>
            </div>
            <div class="or">or</div>
            <div class="control-grid">
                <div class="key">W</div><div></div><div></div>
                <div class="key">A</div><div class="key">S</div><div class="key">D</div>
            </div>
            <p style="margin-top:1rem;color:#888;font-size:0.9rem;text-align:center">Press ESC to pause</p>
        </div>
    </div>
    <div id="pause" class="overlay hidden">
        <h1>Paused</h1>
        <button class="btn" onclick="game.resume()">Resume</button>
        <button class="btn btn-secondary" onclick="game.menu()">Main Menu</button>
    </div>
    <div id="complete" class="overlay hidden">
        <h1>Level Complete! üéâ</h1>
        <p class="subtitle">Maze difficulty increased!</p>
        <div class="stats">
            <div class="stat"><div class="stat-label">Difficulty</div><div class="stat-value" id="complete-diff">0</div></div>
            <div class="stat"><div class="stat-label">Lives</div><div class="stat-value" id="complete-lives">0</div></div>
        </div>
        <button class="btn" onclick="game.nextLevel()">Continue</button>
    </div>
    <div id="gameover" class="overlay hidden">
        <h1>Game Over</h1>
        <p class="subtitle">Out of lives!</p>
        <div class="stats">
            <div class="stat"><div class="stat-label">Difficulty</div><div class="stat-value" id="over-diff">0</div></div>
            <div class="stat"><div class="stat-label">Mazes</div><div class="stat-value" id="over-mazes">0</div></div>
        </div>
        <button class="btn" onclick="game.startGame()">Play Again</button>
        <button class="btn btn-secondary" onclick="game.menu()">Main Menu</button>
    </div>
    <div id="hud" class="hidden">
        <div class="hud-item"><span class="hud-icon">‚ù§Ô∏è</span><span class="hud-value" id="lives">3</span></div>
        <div class="hud-item"><span class="hud-icon">‚ö°</span><span class="hud-value" id="speed">1.0x</span></div>
        <div class="hud-item"><span class="hud-icon">üèÜ</span><span class="hud-value" id="level">1</span></div>
    </div>
    <div id="minimap" class="hidden"><canvas id="minimap-canvas"></canvas></div>
</div>
<script>
    const game={
        state:'menu',scene:null,camera:null,renderer:null,player:null,walls:[],powerups:[],lamps:[],mazeGrid:[],mazeSize:21,lives:3,speedMult:1,difficulty:1,baseSpeed:0.12,keys:{},velocity:new THREE.Vector3(),mazesComplete:0,audioCtx:null,minimapCtx:null,exitPos:null,exitGlow:null,
        init(){
            this.audioCtx=new(window.AudioContext||window.webkitAudioContext)();
            this.scene=new THREE.Scene();
            this.scene.background=new THREE.Color(0x050810);
            this.scene.fog=new THREE.Fog(0x050810,25,50);
            this.camera=new THREE.PerspectiveCamera(75,window.innerWidth/window.innerHeight,0.1,1000);
            this.renderer=new THREE.WebGLRenderer({antialias:true});
            this.renderer.setSize(window.innerWidth,window.innerHeight);
            document.getElementById('game').appendChild(this.renderer.domElement);
            const ambientLight=new THREE.AmbientLight(0x2a3f5f,0.25);
            this.scene.add(ambientLight);
            const playerGeom=new THREE.CylinderGeometry(0.3,0.3,1,16);
            const playerMat=new THREE.MeshStandardMaterial({
                color:0x6366f1,
                emissive:0x4f46e5,
                emissiveIntensity:0.4,
                metalness:0.6,
                roughness:0.3
            });
            this.player=new THREE.Mesh(playerGeom,playerMat);
            this.player.position.y=0.5;
            this.scene.add(this.player);
            const playerLight=new THREE.PointLight(0x6366f1,1.2,4);
            playerLight.position.y=0.5;
            this.player.add(playerLight);
            this.camera.position.set(0,20,0);
            this.camera.lookAt(0,0,0);
            const mc=document.getElementById('minimap-canvas');
            mc.width=160;mc.height=160;
            this.minimapCtx=mc.getContext('2d');
            window.addEventListener('resize',()=>{
                this.camera.aspect=window.innerWidth/window.innerHeight;
                this.camera.updateProjectionMatrix();
                this.renderer.setSize(window.innerWidth,window.innerHeight);
            });
            document.addEventListener('keydown',e=>{
                this.keys[e.keyCode]=true;
                if(e.keyCode===27&&this.state==='playing')this.pauseGame();
            });
            document.addEventListener('keyup',e=>this.keys[e.keyCode]=false);
            this.animate();
        },
        playSound(freq,dur=0.1,type='square'){
            const o=this.audioCtx.createOscillator();
            const g=this.audioCtx.createGain();
            o.connect(g);g.connect(this.audioCtx.destination);
            o.frequency.value=freq;
            o.type=type;
            g.gain.setValueAtTime(0.15,this.audioCtx.currentTime);
            g.gain.exponentialRampToValueAtTime(0.01,this.audioCtx.currentTime+dur);
            o.start();o.stop(this.audioCtx.currentTime+dur);
        },
        generateMaze(){
            this.walls.forEach(w=>this.scene.remove(w));
            this.powerups.forEach(p=>this.scene.remove(p));
            this.lamps.forEach(l=>this.scene.remove(l));
            if(this.exitGlow)this.scene.remove(this.exitGlow);
            this.walls=[];this.powerups=[];this.lamps=[];
            const s=this.mazeSize;
            const grid=Array(s).fill().map(()=>Array(s).fill(1));
            const carve=(x,y)=>{
                grid[y][x]=0;
                const dirs=[[0,-2],[2,0],[0,2],[-2,0]].sort(()=>Math.random()-0.5);
                for(let[dx,dy]of dirs){
                    const nx=x+dx,ny=y+dy;
                    if(nx>0&&nx<s-1&&ny>0&&ny<s-1&&grid[ny][nx]){
                        grid[y+dy/2][x+dx/2]=0;
                        grid[ny][nx]=0;
                        carve(nx,ny);
                    }
                }
            };
            carve(1,1);
            grid[1][0]=0;grid[s-2][s-1]=0;
            this.mazeGrid=grid;
            this.exitPos={x:s-1,z:s-2};
            const wallMat=new THREE.MeshStandardMaterial({
                color:0x1e293b,
                metalness:0.2,
                roughness:0.8
            });
            const wallTopMat=new THREE.MeshStandardMaterial({
                color:0x334155,
                metalness:0.3,
                roughness:0.7
            });
            for(let y=0;y<s;y++){
                for(let x=0;x<s;x++){
                    if(grid[y][x]===1){
                        const wallGeom=new THREE.BoxGeometry(1,2.5,1);
                        const wall=new THREE.Mesh(wallGeom,[
                            wallMat,wallMat,wallTopMat,wallMat,wallMat,wallMat
                        ]);
                        wall.position.set(x-s/2+0.5,1.25,-y+s/2-0.5);
                        this.scene.add(wall);
                        this.walls.push(wall);
                    }
                }
            }
            const floorGeom=new THREE.PlaneGeometry(s,s);
            const floorMat=new THREE.MeshStandardMaterial({
                color:0x0f172a,
                metalness:0.1,
                roughness:0.9
            });
            const floor=new THREE.Mesh(floorGeom,floorMat);
            floor.rotation.x=-Math.PI/2;
            floor.position.y=0;
            this.scene.add(floor);
            for(let y=2;y<s-2;y+=5){
                for(let x=2;x<s-2;x+=5){
                    if(grid[y][x]===0){
                        const lampGroup=new THREE.Group();
                        const poleMat=new THREE.MeshStandardMaterial({
                            color:0x64748b,
                            metalness:0.7,
                            roughness:0.3
                        });
                        const pole=new THREE.Mesh(new THREE.CylinderGeometry(0.08,0.08,2,8),poleMat);
                        pole.position.y=1;
                        lampGroup.add(pole);
                        const lampMat=new THREE.MeshStandardMaterial({
                            color:0xfbbf24,
                            emissive:0xfbbf24,
                            emissiveIntensity:1,
                            metalness:0.2,
                            roughness:0.4
                        });
                        const lamp=new THREE.Mesh(new THREE.SphereGeometry(0.2,16,16),lampMat);
                        lamp.position.y=2;
                        lampGroup.add(lamp);
                        const light=new THREE.PointLight(0xfbbf24,1.8,7);
                        light.position.y=2;
                        lampGroup.add(light);
                        lampGroup.position.set(x-s/2+0.5,0,-y+s/2-0.5);
                        lampGroup.userData={time:Math.random()*100};
                        this.scene.add(lampGroup);
                        this.lamps.push(lampGroup);
                    }
                }
            }
            const exitGeom=new THREE.CylinderGeometry(1,1,0.3,32);
            const exitMat=new THREE.MeshStandardMaterial({
                color:0x10b981,
                emissive:0x10b981,
                emissiveIntensity:0.8,
                metalness:0.5,
                roughness:0.3
            });
            const exit=new THREE.Mesh(exitGeom,exitMat);
            exit.position.set(this.exitPos.x-s/2+0.5,0.15,-this.exitPos.z+s/2-0.5);
            this.scene.add(exit);
            this.exitGlow=exit;
            const exitLight=new THREE.PointLight(0x10b981,2,8);
            exitLight.position.set(this.exitPos.x-s/2+0.5,1,-this.exitPos.z+s/2-0.5);
            this.scene.add(exitLight);
            this.lamps.push(exitLight);
            const types=[
                {type:'speed',color:0x10b981,emissive:0x10b981},
                {type:'life',color:0x3b82f6,emissive:0x3b82f6},
                {type:'trap',color:0xef4444,emissive:0xef4444}
            ];
            const numPowerups=Math.min(6,Math.floor(this.difficulty*1.5)+3);
            for(let i=0;i<numPowerups;i++){
                let x,y,tries=0;
                do{
                    x=Math.floor(Math.random()*(s-4))+2;
                    y=Math.floor(Math.random()*(s-4))+2;
                    tries++;
                }while((grid[y][x]!==0||(x===1&&y===1))&&tries<100);
                if(grid[y][x]===0){
                    const t=types[i%types.length];
                    const geom=new THREE.OctahedronGeometry(0.3,0);
                    const mat=new THREE.MeshStandardMaterial({
                        color:t.color,
                        emissive:t.emissive,
                        emissiveIntensity:0.7,
                        metalness:0.5,
                        roughness:0.3
                    });
                    const p=new THREE.Mesh(geom,mat);
                    p.position.set(x-s/2+0.5,0.7,-y+s/2-0.5);
                    p.userData={type:t.type,collected:false,rotSpeed:Math.random()*0.02+0.03,bobPhase:Math.random()*Math.PI*2};
                    this.scene.add(p);
                    this.powerups.push(p);
                    const light=new THREE.PointLight(t.color,0.8,3.5);
                    light.position.copy(p.position);
                    this.scene.add(light);
                    this.lamps.push(light);
                }
            }
            this.player.position.set(1-s/2+0.5,0.5,-1+s/2-0.5);
            this.velocity.set(0,0,0);
            this.updateMinimap();
        },
        checkCollision(pos){
            const r=new THREE.Raycaster(pos,this.velocity.clone().normalize(),0,0.35);
            const intersects=r.intersectObjects(this.walls);
            return intersects.length>0;
        },
        update(time){
            if(this.state!=='playing')return;
            const speed=this.baseSpeed*this.speedMult;
            if(this.keys[38]||this.keys[87])this.velocity.z=-speed;
            else if(this.keys[40]||this.keys[83])this.velocity.z=speed;
            else this.velocity.z=0;
            if(this.keys[37]||this.keys[65])this.velocity.x=-speed;
            else if(this.keys[39]||this.keys[68])this.velocity.x=speed;
            else this.velocity.x=0;
            const newPos=this.player.position.clone().add(this.velocity);
            if(!this.checkCollision(newPos)){
                this.player.position.copy(newPos);
                this.camera.position.x=newPos.x;
                this.camera.position.z=newPos.z;
            }
            this.lamps.forEach(lamp=>{
                if(lamp.userData.time!==undefined){
                    lamp.userData.time+=0.016;
                    const flicker=Math.sin(lamp.userData.time*8)*0.05+0.95;
                    if(lamp.children[2]){
                        lamp.children[2].intensity=1.8*flicker;
                        lamp.children[1].material.emissiveIntensity=1*flicker;
                    }
                }
            });
            if(this.exitGlow){
                this.exitGlow.rotation.y+=0.02;
                const pulse=Math.sin(time*0.003)*0.1+0.9;
                this.exitGlow.material.emissiveIntensity=0.8*pulse;
                const exitX=this.exitPos.x-this.mazeSize/2+0.5;
                const exitZ=-this.exitPos.z+this.mazeSize/2-0.5;
                const distToExit=Math.sqrt((this.player.position.x-exitX)**2+(this.player.position.z-exitZ)**2);
                if(distToExit<1.2){
                    this.levelComplete();
                }
            }
            this.powerups.forEach((p,idx)=>{
                if(p.userData.collected)return;
                p.rotation.y+=p.userData.rotSpeed;
                p.rotation.x=Math.sin(time*0.001+p.userData.bobPhase)*0.3;
                p.position.y=0.7+Math.sin(time*0.002+p.userData.bobPhase)*0.15;
                const dist=this.player.position.distanceTo(p.position);
                if(dist<0.6){
                    this.collectPowerup(p.userData.type,p.position);
                    p.userData.collected=true;
                    this.scene.remove(p);
                }
            });
            this.updateMinimap();
        },
        collectPowerup(type,position){
            this.playSound(880,0.15,'sine');
            this.createParticles(position,type);
            switch(type){
                case'speed':
                    this.speedMult=2;
                    this.showMessage('‚ö° Speed Boost!');
                    document.getElementById('speed').classList.add('boost-active');
                    document.getElementById('speed').textContent='2.0x';
                    setTimeout(()=>{
                        this.speedMult=1;
                        document.getElementById('speed').classList.remove('boost-active');
                        document.getElementById('speed').textContent='1.0x';
                    },5000);
                    break;
                case'life':
                    this.lives++;
                    this.updateHUD();
                    this.showMessage('‚ù§Ô∏è Extra Life!');
                    break;
                case'trap':
                    this.lives--;
                    this.updateHUD();
                    this.showMessage('üíÄ Trap!');
                    this.playSound(220,0.3,'sawtooth');
                    if(this.lives<=0)this.gameOver();
                    break;
            }
        },
        createParticles(pos,type){
            const colors={speed:'#10b981',life:'#3b82f6',trap:'#ef4444'};
            const color=colors[type];
            for(let i=0;i<15;i++){
                const p=document.createElement('div');
                p.className='particle';
                p.style.background=color;
                p.style.boxShadow=`0 0 8px ${color}`;
                const screenX=(pos.x+this.mazeSize/2)/(this.mazeSize)*window.innerWidth;
                const screenY=(-pos.z+this.mazeSize/2)/(this.mazeSize)*window.innerHeight*0.5;
                p.style.left=screenX+'px';
                p.style.top=screenY+'px';
                const angle=Math.random()*Math.PI*2;
                const dist=50+Math.random()*50;
                p.style.setProperty('--x',Math.cos(angle)*dist+'px');
                p.style.setProperty('--y',Math.sin(angle)*dist+'px');
                document.getElementById('game').appendChild(p);
                setTimeout(()=>p.remove(),1000);
            }
        },
        levelComplete(){
            this.state='complete';
            this.mazesComplete++;
            this.difficulty++;
            this.baseSpeed=Math.min(0.2,this.baseSpeed*1.08);
            this.mazeSize=Math.min(41,this.mazeSize+4);
            this.playSound(1046,0.25,'sine');
            setTimeout(()=>this.playSound(1318,0.3,'sine'),150);
            document.getElementById('complete-diff').textContent=this.difficulty;
            document.getElementById('complete-lives').textContent=this.lives;
            document.getElementById('complete').classList.remove('hidden');
            document.getElementById('hud').classList.add('hidden');
            document.getElementById('minimap').classList.add('hidden');
        },
        nextLevel(){
            this.state='playing';
            document.getElementById('complete').classList.add('hidden');
            document.getElementById('hud').classList.remove('hidden');
            document.getElementById('minimap').classList.remove('hidden');
            this.updateHUD();
            this.generateMaze();
        },
        gameOver(){
            this.state='over';
            this.playSound(196,0.5,'sawtooth');
            document.getElementById('over-diff').textContent=this.difficulty;
            document.getElementById('over-mazes').textContent=this.mazesComplete;
            document.getElementById('gameover').classList.remove('hidden');
            document.getElementById('hud').classList.add('hidden');
            document.getElementById('minimap').classList.add('hidden');
        },
        pauseGame(){
            this.state='pause';
            document.getElementById('pause').classList.remove('hidden');
        },
        resume(){
            this.state='playing';
            document.getElementById('pause').classList.add('hidden');
        },
        startGame(){
            this.state='playing';
            this.lives=3;
            this.speedMult=1;
            this.difficulty=1;
            this.baseSpeed=0.12;
            this.mazeSize=21;
            this.mazesComplete=0;
            document.getElementById('menu').classList.add('hidden');
            document.getElementById('gameover').classList.add('hidden');
            document.getElementById('hud').classList.remove('hidden');
            document.getElementById('minimap').classList.remove('hidden');
            this.updateHUD();
            this.generateMaze();
            this.playSound(523,0.2,'triangle');
        },
        menu(){
            this.state='menu';
            ['pause','complete','gameover'].forEach(id=>document.getElementById(id).classList.add('hidden'));
            document.getElementById('menu').classList.remove('hidden');
            document.getElementById('hud').classList.add('hidden');
            document.getElementById('minimap').classList.add('hidden');
        },
        updateHUD(){
            document.getElementById('lives').textContent=this.lives;
            document.getElementById('level').textContent=this.difficulty;
        },
        showMessage(text){
            const msg=document.createElement('div');
            msg.className='message';
            msg.textContent=text;
            document.getElementById('game').appendChild(msg);
            setTimeout(()=>msg.remove(),1500);
        },
        updateMinimap(){
            const ctx=this.minimapCtx;
            const s=this.mazeSize;
            const scale=160/s;
            const grad=ctx.createLinearGradient(0,0,160,160);
            grad.addColorStop(0,'#0f172a');
            grad.addColorStop(1,'#050810');
            ctx.fillStyle=grad;
            ctx.fillRect(0,0,160,160);
            ctx.fillStyle='#1e293b';
            for(let y=0;y<s;y++){
                for(let x=0;x<s;x++){
                    if(this.mazeGrid[y][x]===1){
                        ctx.fillRect(x*scale,y*scale,scale,scale);
                    }
                }
            }
            this.lamps.forEach(lamp=>{
                if(lamp.position){
                    const lx=(lamp.position.x+s/2-0.5)*scale;
                    const ly=(-lamp.position.z+s/2-0.5)*scale;
                    const lampGrad=ctx.createRadialGradient(lx,ly,0,lx,ly,scale*2);
                    lampGrad.addColorStop(0,'rgba(251,191,36,0.6)');
                    lampGrad.addColorStop(1,'rgba(251,191,36,0)');
                    ctx.fillStyle=lampGrad;
                    ctx.fillRect(lx-scale*2,ly-scale*2,scale*4,scale*4);
                }
            });
            const exitGrad=ctx.createRadialGradient(this.exitPos.x*scale,this.exitPos.z*scale,0,this.exitPos.x*scale,this.exitPos.z*scale,scale*2.5);
            exitGrad.addColorStop(0,'#10b981');
            exitGrad.addColorStop(1,'rgba(16,185,129,0)');
            ctx.fillStyle=exitGrad;
            ctx.fillRect(this.exitPos.x*scale-scale*2.5,this.exitPos.z*scale-scale*2.5,scale*5,scale*5);
            const px=(this.player.position.x+s/2-0.5)*scale;
            const py=(-this.player.position.z+s/2-0.5)*scale;
            const playerGrad=ctx.createRadialGradient(px,py,0,px,py,scale*1.5);
            playerGrad.addColorStop(0,'#6366f1');
            playerGrad.addColorStop(0.7,'#4f46e5');
            playerGrad.addColorStop(1,'rgba(99,102,241,0)');
            ctx.fillStyle=playerGrad;
            ctx.beginPath();
            ctx.arc(px,py,scale*1.5,0,Math.PI*2);
            ctx.fill();
        },
        animate(time){
            requestAnimationFrame((t)=>this.animate(t));
            this.update(time);
            this.renderer.render(this.scene,this.camera);
        }
    };
    window.onload=()=>game.init();
</script>
<script src="../logo.js"></script>
</body>
</html>