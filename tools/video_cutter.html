<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description"
          content="Free online video cutter tool. Trim and cut videos directly in your browser with frame-accurate precision. No upload required - all processing happens locally on your device. Supports MP4, WebM, MOV, and AVI.">
    <meta name="keywords"
          content="video cutter, video trimmer, cut video online, trim video, video editor, free video cutter, browser video editor, MP4 cutter, WebM cutter, frame accurate video cut">
    <meta name="author" content="Claude Opus 4.5 prompted by Tobias M√ºller">
    <meta name="robots" content="index, follow">
    <link rel="canonical" href="https://www.gptgames.dev/tools/video_cutter.html">
    <meta property="og:title" content="Video Cutter - Free Online Video Trimming Tool">
    <meta property="og:description"
          content="Trim and cut videos directly in your browser with frame-accurate precision. No upload required - all processing happens locally on your device.">
    <meta property="og:image" content="https://www.gptgames.dev/screenshots/screenshot_241.webp">
    <meta property="og:url" content="https://www.gptgames.dev/tools/video_cutter.html">
    <meta property="og:type" content="website">
    <meta property="og:site_name" content="GPT Games">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Video Cutter - Free Online Video Trimming Tool">
    <meta name="twitter:description"
          content="Trim and cut videos directly in your browser with frame-accurate precision. No upload required - all processing happens locally.">
    <meta name="twitter:image" content="https://www.gptgames.dev/screenshots/screenshot_241.webp">
    <title>Video Cutter</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üéûÔ∏è</text></svg>">
    <style>
        *, *::before, *::after {
            box-sizing: border-box;
            margin: 0;
            padding: 0
        }

        :root {
            --bg: #f5f5f5;
            --card: #fff;
            --dark: #e9e9e9;
            --text: #171717;
            --dim: #666;
            --accent: #2563eb;
            --accent-h: #1d4ed8;
            --border: #d1d1d1;
            --radius: 12px;
            --shadow: 0 2px 12px rgba(0, 0, 0, 0.08);
            --success: #16a34a;
            --warning: #ca8a04
        }

        @media (prefers-color-scheme: dark) {
            :root {
                --bg: #0a0a0a;
                --card: #141414;
                --dark: #1c1c1c;
                --text: #f5f5f5;
                --dim: #888;
                --accent: #3b82f6;
                --accent-h: #60a5fa;
                --border: #2a2a2a;
                --shadow: 0 2px 12px rgba(0, 0, 0, 0.4)
            }
        }

        body {
            font-family: system-ui, -apple-system, sans-serif;
            background: var(--bg);
            color: var(--text);
            min-height: 100vh;
            padding: 20px
        }

        .app {
            max-width: 1000px;
            margin: 0 auto
        }

        header {
            text-align: center;
            margin-bottom: 32px
        }

        header h1 {
            font-size: 1.6rem;
            font-weight: 600;
            letter-spacing: -0.03em;
            margin-bottom: 4px
        }

        header p {
            color: var(--dim);
            font-size: 0.85rem
        }

        .upload-zone {
            background: var(--card);
            border: 2px dashed var(--border);
            border-radius: var(--radius);
            padding: 64px 24px;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s
        }

        .upload-zone:hover, .upload-zone.drag {
            border-color: var(--accent);
            background: color-mix(in srgb, var(--accent) 4%, var(--card))
        }

        .upload-icon {
            width: 48px;
            height: 48px;
            color: var(--dim);
            margin: 0 auto 16px
        }

        .upload-zone h2 {
            font-size: 1rem;
            font-weight: 500;
            margin-bottom: 6px
        }

        .upload-zone span {
            font-size: 0.8rem;
            color: var(--dim)
        }

        #fileInput {
            display: none
        }

        .workspace {
            display: none;
            background: var(--card);
            border-radius: var(--radius);
            overflow: hidden;
            box-shadow: var(--shadow)
        }

        .workspace.active {
            display: block
        }

        .video-wrap {
            background: #000;
            position: relative
        }

        .video-wrap video {
            width: 100%;
            display: block;
            max-height: 460px;
            object-fit: contain;
            background: #000
        }

        .video-loader {
            position: absolute;
            inset: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            background: #000;
            color: #fff;
            font-size: 0.85rem;
            gap: 12px
        }

        .video-loader.hide {
            display: none
        }

        .loader-spinner {
            width: 32px;
            height: 32px;
            border: 3px solid #333;
            border-top-color: #fff;
            border-radius: 50%;
            animation: spin 0.8s linear infinite
        }

        @keyframes spin {
            to {
                transform: rotate(360deg)
            }
        }

        .meta-bar {
            display: flex;
            gap: 6px;
            padding: 10px 16px;
            background: var(--dark);
            border-bottom: 1px solid var(--border);
            flex-wrap: wrap
        }

        .meta-item {
            display: flex;
            align-items: center;
            gap: 5px;
            font-size: 0.7rem;
            color: var(--dim);
            background: var(--card);
            padding: 4px 10px;
            border-radius: 6px
        }

        .meta-item svg {
            width: 12px;
            height: 12px;
            opacity: 0.7
        }

        .meta-item strong {
            color: var(--text);
            font-weight: 500
        }

        .player-bar {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 12px 16px;
            background: var(--card);
            border-bottom: 1px solid var(--border)
        }

        .player-btn {
            background: none;
            border: none;
            color: var(--text);
            cursor: pointer;
            padding: 8px;
            border-radius: 8px;
            display: flex;
            transition: background 0.15s
        }

        .player-btn:hover {
            background: var(--dark)
        }

        .player-btn.active {
            background: var(--accent);
            color: #fff
        }

        .player-btn svg {
            width: 20px;
            height: 20px
        }

        .time-display {
            font-family: ui-monospace, monospace;
            font-size: 0.8rem;
            color: var(--text);
            padding: 0 10px;
            display: flex;
            flex-direction: column;
            gap: 1px;
            min-width: 110px
        }

        .time-display .frame {
            font-size: 0.65rem;
            color: var(--dim)
        }

        .spacer {
            flex: 1
        }

        .player-bar select {
            background: var(--dark);
            border: 1px solid var(--border);
            color: var(--text);
            padding: 6px 10px;
            border-radius: 8px;
            font-size: 0.75rem;
            cursor: pointer
        }

        .vol-wrap {
            display: flex;
            align-items: center;
            gap: 4px
        }

        .vol-wrap input {
            width: 70px;
            accent-color: var(--accent)
        }

        .timeline-section {
            padding: 20px 16px
        }

        .timeline-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px
        }

        .selection-range {
            font-size: 0.75rem;
            color: var(--dim);
            font-family: ui-monospace, monospace
        }

        .selection-range strong {
            color: var(--text)
        }

        .zoom-ctrl {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.7rem;
            color: var(--dim)
        }

        .zoom-ctrl input {
            width: 90px;
            accent-color: var(--accent)
        }

        .zoom-ctrl span {
            min-width: 28px;
            text-align: center;
            font-family: ui-monospace, monospace
        }

        .timeline-outer {
            position: relative;
            border-radius: 10px;
            overflow: hidden
        }

        .timeline-scroll {
            overflow-x: auto;
            overflow-y: hidden;
            scrollbar-width: thin
        }

        .timeline-scroll::-webkit-scrollbar {
            height: 6px
        }

        .timeline-scroll::-webkit-scrollbar-track {
            background: var(--dark)
        }

        .timeline-scroll::-webkit-scrollbar-thumb {
            background: var(--border);
            border-radius: 3px
        }

        .timeline {
            position: relative;
            height: 72px;
            background: var(--dark);
            cursor: pointer;
            touch-action: none;
            min-width: 100%
        }

        .tl-thumbs {
            position: absolute;
            inset: 0;
            display: flex;
            overflow: hidden;
            opacity: 0.5
        }

        .tl-thumbs canvas {
            height: 100%;
            flex-shrink: 0
        }

        .tl-ticks {
            position: absolute;
            inset: 0;
            pointer-events: none
        }

        .tl-tick {
            position: absolute;
            top: 0;
            width: 1px;
            background: var(--border);
            opacity: 0.4
        }

        .tl-tick.major {
            height: 100%;
            opacity: 0.6
        }

        .tl-tick.minor {
            height: 25%
        }

        .tl-tick-label {
            position: absolute;
            bottom: 4px;
            font-size: 8px;
            color: var(--dim);
            font-family: ui-monospace, monospace;
            transform: translateX(-50%);
            white-space: nowrap;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.5)
        }

        .tl-sel {
            position: absolute;
            top: 0;
            height: 100%;
            background: color-mix(in srgb, var(--accent) 25%, transparent);
            border-top: 3px solid var(--accent);
            border-bottom: 3px solid var(--accent);
            pointer-events: none
        }

        .tl-head {
            position: absolute;
            top: 0;
            width: 2px;
            height: 100%;
            background: #ef4444;
            pointer-events: none;
            z-index: 5;
            transform: translateX(-1px)
        }

        .tl-head::before {
            content: '';
            position: absolute;
            top: -1px;
            left: -5px;
            width: 12px;
            height: 8px;
            background: #ef4444;
            border-radius: 2px 2px 0 0
        }

        .tl-handle {
            position: absolute;
            top: 0;
            width: 16px;
            height: 100%;
            background: var(--accent);
            cursor: ew-resize;
            z-index: 10;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background 0.15s, transform 0.1s
        }

        .tl-handle:hover, .tl-handle.on {
            background: var(--accent-h);
            transform: scaleX(1.1)
        }

        .tl-handle::after {
            content: '';
            width: 2px;
            height: 24px;
            background: rgba(255, 255, 255, 0.5);
            border-radius: 1px
        }

        .tl-handle.start {
            border-radius: 6px 0 0 6px;
            left: 0
        }

        .tl-handle.end {
            border-radius: 0 6px 6px 0;
            right: 0
        }

        .tl-tip {
            position: absolute;
            bottom: calc(100% + 6px);
            left: 50%;
            transform: translateX(-50%);
            background: var(--text);
            color: var(--bg);
            padding: 4px 8px;
            border-radius: 6px;
            font-size: 0.65rem;
            font-family: ui-monospace, monospace;
            white-space: nowrap;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.15s
        }

        .tl-handle:hover .tl-tip, .tl-handle.on .tl-tip {
            opacity: 1
        }

        .tl-hover {
            position: absolute;
            bottom: calc(100% + 6px);
            background: var(--text);
            color: var(--bg);
            padding: 3px 6px;
            border-radius: 4px;
            font-size: 0.6rem;
            font-family: ui-monospace, monospace;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.1s;
            transform: translateX(-50%);
            z-index: 20
        }

        .tl-hover.show {
            opacity: 1
        }

        .minimap {
            height: 6px;
            background: var(--dark);
            border-radius: 3px;
            margin-top: 10px;
            position: relative;
            display: none
        }

        .minimap.show {
            display: block
        }

        .minimap-view {
            position: absolute;
            height: 100%;
            background: var(--accent);
            border-radius: 3px;
            opacity: 0.4
        }

        .minimap-sel {
            position: absolute;
            height: 100%;
            background: var(--accent);
            border-radius: 2px;
            opacity: 0.8
        }

        .cut-panel {
            padding: 0 16px 20px
        }

        .cut-row {
            display: grid;
            grid-template-columns:1fr 1fr;
            gap: 12px;
            margin-bottom: 16px
        }

        @media (max-width: 600px) {
            .cut-row {
                grid-template-columns:1fr
            }
        }

        .cut-field {
            background: var(--dark);
            padding: 12px;
            border-radius: 10px
        }

        .cut-field-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 8px
        }

        .cut-field label {
            font-size: 0.65rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            color: var(--dim);
            font-weight: 600
        }

        .cut-field-actions {
            display: flex;
            gap: 4px
        }

        .cut-field-actions button {
            background: var(--card);
            border: 1px solid var(--border);
            color: var(--text);
            padding: 4px 8px;
            border-radius: 5px;
            font-size: 0.65rem;
            cursor: pointer;
            transition: background 0.15s
        }

        .cut-field-actions button:hover {
            background: var(--border)
        }

        .time-input-wrap {
            display: flex;
            align-items: center;
            gap: 6px
        }

        .time-input-wrap input {
            flex: 1;
            background: var(--card);
            border: 1px solid var(--border);
            border-radius: 6px;
            color: var(--text);
            font-family: ui-monospace, monospace;
            font-size: 0.9rem;
            padding: 8px 10px;
            min-width: 0
        }

        .time-input-wrap input:focus {
            outline: none;
            border-color: var(--accent)
        }

        .time-spin {
            display: flex;
            flex-direction: column;
            gap: 2px
        }

        .time-spin button {
            background: var(--card);
            border: 1px solid var(--border);
            color: var(--dim);
            width: 24px;
            height: 18px;
            border-radius: 4px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.1s
        }

        .time-spin button:hover {
            background: var(--border);
            color: var(--text)
        }

        .time-spin button svg {
            width: 10px;
            height: 10px
        }

        .sel-summary {
            display: flex;
            justify-content: center;
            gap: 24px;
            padding: 12px;
            background: var(--dark);
            border-radius: 8px;
            font-size: 0.8rem
        }

        .sel-stat {
            text-align: center
        }

        .sel-stat .value {
            font-family: ui-monospace, monospace;
            font-weight: 600;
            color: var(--text);
            font-size: 0.95rem
        }

        .sel-stat .label {
            font-size: 0.65rem;
            color: var(--dim);
            margin-top: 2px
        }

        .actions {
            display: flex;
            gap: 10px;
            padding: 0 16px 20px;
            flex-wrap: wrap;
            align-items: center
        }

        .btn {
            padding: 10px 16px;
            border: none;
            border-radius: 8px;
            font-size: 0.8rem;
            font-weight: 500;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 6px;
            transition: all 0.15s
        }

        .btn:active {
            transform: scale(0.97)
        }

        .btn svg {
            width: 16px;
            height: 16px
        }

        .btn-sec {
            background: var(--dark);
            color: var(--text)
        }

        .btn-sec:hover {
            background: var(--border)
        }

        .btn-pri {
            background: var(--accent);
            color: #fff
        }

        .btn-pri:hover {
            background: var(--accent-h)
        }

        .btn-ghost {
            background: none;
            color: var(--dim);
            padding: 10px 12px
        }

        .btn-ghost:hover {
            color: var(--text)
        }

        .export-opts {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-left: auto
        }

        .export-opts label {
            font-size: 0.7rem;
            color: var(--dim)
        }

        .export-opts select {
            background: var(--dark);
            border: 1px solid var(--border);
            color: var(--text);
            padding: 8px 12px;
            border-radius: 8px;
            font-size: 0.8rem;
            cursor: pointer
        }

        footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 16px;
            background: var(--dark);
            border-top: 1px solid var(--border);
            font-size: 0.75rem;
            gap: 12px;
            flex-wrap: wrap
        }

        .fname {
            color: var(--dim);
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            max-width: 200px
        }

        .shortcuts-toggle {
            background: none;
            border: none;
            color: var(--dim);
            font-size: 0.7rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 4px;
            padding: 4px 8px;
            border-radius: 4px
        }

        .shortcuts-toggle:hover {
            color: var(--text);
            background: var(--card)
        }

        .shortcuts-toggle svg {
            width: 14px;
            height: 14px
        }

        .shortcuts-panel {
            display: none;
            position: absolute;
            bottom: 100%;
            right: 0;
            background: var(--card);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 12px 16px;
            margin-bottom: 8px;
            box-shadow: var(--shadow);
            min-width: 200px;
            z-index: 50
        }

        .shortcuts-panel.show {
            display: block
        }

        .shortcuts-panel h4 {
            font-size: 0.7rem;
            color: var(--dim);
            margin-bottom: 8px;
            text-transform: uppercase;
            letter-spacing: 0.5px
        }

        .shortcut-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 4px 0;
            font-size: 0.75rem;
            color: var(--dim)
        }

        .shortcut-row kbd {
            background: var(--dark);
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 0.65rem;
            border: 1px solid var(--border);
            font-family: ui-monospace, monospace;
            color: var(--text)
        }

        .footer-right {
            display: flex;
            align-items: center;
            gap: 8px;
            position: relative
        }

        .modal {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.7);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 100;
            backdrop-filter: blur(4px)
        }

        .modal.active {
            display: flex
        }

        .modal-box {
            background: var(--card);
            border-radius: var(--radius);
            padding: 32px;
            text-align: center;
            max-width: 380px;
            width: 90%;
            box-shadow: var(--shadow)
        }

        .modal-box h3 {
            font-size: 1.1rem;
            margin-bottom: 20px;
            font-weight: 600
        }

        .prog-ring {
            width: 80px;
            height: 80px;
            margin: 0 auto 20px;
            position: relative
        }

        .prog-ring svg {
            transform: rotate(-90deg)
        }

        .prog-ring circle {
            fill: none;
            stroke-width: 6
        }

        .prog-ring .bg {
            stroke: var(--dark)
        }

        .prog-ring .fg {
            stroke: var(--accent);
            stroke-linecap: round;
            transition: stroke-dashoffset 0.2s
        }

        .prog-ring .pct {
            position: absolute;
            inset: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.1rem;
            font-weight: 600;
            font-family: ui-monospace, monospace
        }

        .prog-text {
            font-size: 0.85rem;
            color: var(--dim)
        }

        .err-text {
            color: #dc2626;
            margin-top: 12px;
            font-size: 0.85rem;
            display: none
        }

        .modal-close {
            margin-top: 20px
        }

        .confirm-modal .modal-box {
            max-width: 320px
        }

        .confirm-modal p {
            color: var(--dim);
            margin-bottom: 20px;
            font-size: 0.9rem
        }

        .confirm-btns {
            display: flex;
            gap: 10px;
            justify-content: center
        }

        .toast {
            position: fixed;
            bottom: 24px;
            left: 50%;
            transform: translateX(-50%);
            background: var(--text);
            color: var(--bg);
            padding: 10px 20px;
            border-radius: 8px;
            font-size: 0.85rem;
            opacity: 0;
            transition: opacity 0.2s;
            pointer-events: none;
            z-index: 200
        }

        .toast.show {
            opacity: 1
        }
    </style>
</head>
<body>
<div class="app">
    <header><h1>Video Cutter</h1>
        <p>Trim videos in your browser ‚Äî nothing leaves your device</p></header>
    <div class="upload-zone" id="uploadZone">
        <svg class="upload-icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5"
             stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round"
                  d="m15.75 10.5 4.72-4.72a.75.75 0 0 1 1.28.53v11.38a.75.75 0 0 1-1.28.53l-4.72-4.72M4.5 18.75h9a2.25 2.25 0 0 0 2.25-2.25v-9a2.25 2.25 0 0 0-2.25-2.25h-9A2.25 2.25 0 0 0 2.25 7.5v9a2.25 2.25 0 0 0 2.25 2.25Z"/>
        </svg>
        <h2>Drop video here or click to browse</h2>
        <span>MP4, WebM, MOV, AVI supported</span>
        <input type="file" id="fileInput" accept="video/*">
    </div>
    <div class="workspace" id="workspace">
        <div class="video-wrap">
            <video id="video" playsinline></video>
            <div class="video-loader" id="loader">
                <div class="loader-spinner"></div>
                Loading video...
            </div>
        </div>
        <div class="meta-bar" id="metaBar">
            <div class="meta-item">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2"
                     stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round"
                          d="M12 6v6h4.5m4.5 0a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z"/>
                </svg>
                <strong id="infoDur">--:--</strong></div>
            <div class="meta-item">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2"
                     stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round"
                          d="M3.75 3.75v4.5m0-4.5h4.5m-4.5 0L9 9M3.75 20.25v-4.5m0 4.5h4.5m-4.5 0L9 15M20.25 3.75h-4.5m4.5 0v4.5m0-4.5L15 9m5.25 11.25h-4.5m4.5 0v-4.5m0 4.5L15 15"/>
                </svg>
                <strong id="infoRes">--</strong></div>
            <div class="meta-item">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2"
                     stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round"
                          d="M3.375 19.5h17.25m-17.25 0a1.125 1.125 0 0 1-1.125-1.125M3.375 19.5h1.5C5.496 19.5 6 18.996 6 18.375m-2.625 0V5.625m0 12.75v-1.5c0-.621.504-1.125 1.125-1.125m18.375 2.625V5.625m0 12.75c0 .621-.504 1.125-1.125 1.125m1.125-1.125v-1.5c0-.621-.504-1.125-1.125-1.125m0 3.75h-1.5A1.125 1.125 0 0 1 18 18.375M20.625 4.5H3.375m17.25 0c.621 0 1.125.504 1.125 1.125M20.625 4.5h-1.5C18.504 4.5 18 5.004 18 5.625m3.75 0v1.5c0 .621-.504 1.125-1.125 1.125M3.375 4.5c-.621 0-1.125.504-1.125 1.125M3.375 4.5h1.5C5.496 4.5 6 5.004 6 5.625m-2.625 0v1.5c0 .621.504 1.125 1.125 1.125m0 0h1.5m-1.5 0c-.621 0-1.125.504-1.125 1.125v1.5c0 .621.504 1.125 1.125 1.125m1.5-3.75C5.496 8.25 6 7.746 6 7.125v-1.5M4.875 8.25C5.496 8.25 6 8.754 6 9.375v1.5m0-5.25v5.25m0-5.25C6 5.004 6.504 4.5 7.125 4.5h9.75c.621 0 1.125.504 1.125 1.125m1.125 2.625h1.5m-1.5 0A1.125 1.125 0 0 1 18 7.125v-1.5m1.125 2.625c-.621 0-1.125.504-1.125 1.125v1.5m2.625-2.625c.621 0 1.125.504 1.125 1.125v1.5c0 .621-.504 1.125-1.125 1.125M18 5.625v5.25M7.125 12h9.75m-9.75 0A1.125 1.125 0 0 1 6 10.875M7.125 12C6.504 12 6 12.504 6 13.125m0-2.25C6 11.496 5.496 12 4.875 12M18 10.875c0 .621-.504 1.125-1.125 1.125M18 10.875c0 .621.504 1.125 1.125 1.125m-2.25 0c.621 0 1.125.504 1.125 1.125m-12 5.25v-5.25m0 5.25c0 .621.504 1.125 1.125 1.125h9.75c.621 0 1.125-.504 1.125-1.125m-12 0v-1.5c0-.621-.504-1.125-1.125-1.125M18 18.375v-5.25m0 5.25v-1.5c0-.621.504-1.125 1.125-1.125M18 13.125v1.5c0 .621.504 1.125 1.125 1.125M18 13.125c0-.621.504-1.125 1.125-1.125M6 13.125v1.5c0 .621-.504 1.125-1.125 1.125M6 13.125C6 12.504 5.496 12 4.875 12m-1.5 0h1.5m-1.5 0c-.621 0-1.125.504-1.125 1.125v1.5c0 .621.504 1.125 1.125 1.125M19.125 12h1.5m0 0c.621 0 1.125.504 1.125 1.125v1.5c0 .621-.504 1.125-1.125 1.125m-17.25 0h1.5m14.25 0h1.5"/>
                </svg>
                <strong id="infoFps">--</strong> fps
            </div>
            <div class="meta-item">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2"
                     stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round"
                          d="M19.5 14.25v-2.625a3.375 3.375 0 0 0-3.375-3.375h-1.5A1.125 1.125 0 0 1 13.5 7.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H8.25m2.25 0H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 0 0-9-9Z"/>
                </svg>
                <strong id="infoSize">--</strong></div>
            <div class="meta-item">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2"
                     stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round"
                          d="m15.75 10.5 4.72-4.72a.75.75 0 0 1 1.28.53v11.38a.75.75 0 0 1-1.28.53l-4.72-4.72M4.5 18.75h9a2.25 2.25 0 0 0 2.25-2.25v-9a2.25 2.25 0 0 0-2.25-2.25h-9A2.25 2.25 0 0 0 2.25 7.5v9a2.25 2.25 0 0 0 2.25 2.25Z"/>
                </svg>
                <strong id="infoType">--</strong></div>
        </div>
        <div class="player-bar">
            <button class="player-btn" id="playBtn" title="Play/Pause (Space)">
                <svg id="playIco" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5"
                     stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round"
                          d="M5.25 5.653c0-.856.917-1.398 1.667-.986l11.54 6.348a1.125 1.125 0 0 1 0 1.971l-11.54 6.348a1.125 1.125 0 0 1-1.667-.986V5.653Z"/>
                </svg>
            </button>
            <button class="player-btn" id="backBtn" title="Back 5s (J) / 1 frame (‚Üê)">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5"
                     stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round"
                          d="M21 16.811c0 .864-.933 1.405-1.683.977l-7.108-4.062a1.125 1.125 0 0 1 0-1.953l7.108-4.062A1.125 1.125 0 0 1 21 8.688v8.123ZM11.25 16.811c0 .864-.933 1.405-1.683.977l-7.108-4.062a1.125 1.125 0 0 1 0-1.953l7.108-4.062a1.125 1.125 0 0 1 1.683.977v8.123Z"/>
                </svg>
            </button>
            <button class="player-btn" id="fwdBtn" title="Forward 5s (L) / 1 frame (‚Üí)">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5"
                     stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round"
                          d="M3 8.689c0-.864.933-1.405 1.683-.977l7.108 4.062a1.125 1.125 0 0 1 0 1.953l-7.108 4.062A1.125 1.125 0 0 1 3 16.811V8.689ZM12.75 8.689c0-.864.933-1.405 1.683-.977l7.108 4.062a1.125 1.125 0 0 1 0 1.953l-7.108 4.062a1.125 1.125 0 0 1-1.683-.977V8.689Z"/>
                </svg>
            </button>
            <div class="time-display"><span id="timeText">0:00.000 / 0:00</span><span class="frame" id="frameText">Frame 0 / 0</span>
            </div>
            <span class="spacer"></span>
            <select id="speed" title="Playback Speed">
                <option value="0.25">0.25√ó</option>
                <option value="0.5">0.5√ó</option>
                <option value="1" selected>1√ó</option>
                <option value="1.5">1.5√ó</option>
                <option value="2">2√ó</option>
            </select>
            <div class="vol-wrap">
                <button class="player-btn" id="muteBtn" title="Mute (M)">
                    <svg id="volIco" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
                         stroke-width="1.5" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round"
                              d="M19.114 5.636a9 9 0 0 1 0 12.728M16.463 8.288a5.25 5.25 0 0 1 0 7.424M6.75 8.25l4.72-4.72a.75.75 0 0 1 1.28.53v15.88a.75.75 0 0 1-1.28.53l-4.72-4.72H4.51c-.88 0-1.704-.507-1.938-1.354A9.009 9.009 0 0 1 2.25 12c0-.83.112-1.633.322-2.396C2.806 8.756 3.63 8.25 4.51 8.25H6.75Z"/>
                    </svg>
                </button>
                <input type="range" id="vol" min="0" max="1" step="0.05" value="1">
            </div>
            <button class="player-btn" id="fsBtn" title="Fullscreen (F)">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5"
                     stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round"
                          d="M3.75 3.75v4.5m0-4.5h4.5m-4.5 0L9 9M3.75 20.25v-4.5m0 4.5h4.5m-4.5 0L9 15M20.25 3.75h-4.5m4.5 0v4.5m0-4.5L15 9m5.25 11.25h-4.5m4.5 0v-4.5m0 4.5L15 15"/>
                </svg>
            </button>
        </div>
        <div class="timeline-section">
            <div class="timeline-header">
                <div class="selection-range"><strong id="lbl0">0:00</strong> ‚Üí <strong id="lbl1">0:00</strong></div>
                <div class="zoom-ctrl"><span>Zoom</span><input type="range" id="zoomSlider" min="1" max="20" step="0.5"
                                                               value="1"><span id="zoomVal">1√ó</span></div>
            </div>
            <div class="timeline-outer">
                <div class="timeline-scroll" id="tlScroll">
                    <div class="timeline" id="tl">
                        <div class="tl-thumbs" id="tlThumbs"></div>
                        <div class="tl-ticks" id="tlTicks"></div>
                        <div class="tl-sel" id="sel"></div>
                        <div class="tl-head" id="head"></div>
                        <div class="tl-handle start" id="hStart"><span class="tl-tip" id="tipS">0:00.000</span></div>
                        <div class="tl-handle end" id="hEnd"><span class="tl-tip" id="tipE">0:00.000</span></div>
                        <div class="tl-hover" id="tlHover">0:00.000</div>
                    </div>
                </div>
            </div>
            <div class="minimap" id="minimap">
                <div class="minimap-view" id="minimapView"></div>
                <div class="minimap-sel" id="minimapSel"></div>
            </div>
        </div>
        <div class="cut-panel">
            <div class="cut-row">
                <div class="cut-field">
                    <div class="cut-field-header"><label>Start Point</label>
                        <div class="cut-field-actions">
                            <button id="setIn" title="Set to current (I)">Set Here</button>
                            <button id="goIn" title="Go to start (Home)">Go</button>
                        </div>
                    </div>
                    <div class="time-input-wrap"><input type="text" id="inTime" value="00:00.000">
                        <div class="time-spin">
                            <button id="inUp" title="+1 frame">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M18 15l-6-6-6 6"/>
                                </svg>
                            </button>
                            <button id="inDown" title="-1 frame">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M6 9l6 6 6-6"/>
                                </svg>
                            </button>
                        </div>
                    </div>
                </div>
                <div class="cut-field">
                    <div class="cut-field-header"><label>End Point</label>
                        <div class="cut-field-actions">
                            <button id="setOut" title="Set to current (O)">Set Here</button>
                            <button id="goOut" title="Go to end (End)">Go</button>
                        </div>
                    </div>
                    <div class="time-input-wrap"><input type="text" id="outTime" value="00:00.000">
                        <div class="time-spin">
                            <button id="outUp" title="+1 frame">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M18 15l-6-6-6 6"/>
                                </svg>
                            </button>
                            <button id="outDown" title="-1 frame">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M6 9l6 6 6-6"/>
                                </svg>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            <div class="sel-summary">
                <div class="sel-stat">
                    <div class="value" id="selDur">0.000s</div>
                    <div class="label">Duration</div>
                </div>
                <div class="sel-stat">
                    <div class="value" id="selPct">0%</div>
                    <div class="label">of original</div>
                </div>
                <div class="sel-stat">
                    <div class="value" id="estSize">~0 MB</div>
                    <div class="label">Est. size</div>
                </div>
            </div>
        </div>
        <div class="actions">
            <button class="btn btn-sec" id="previewBtn">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5"
                     stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round"
                          d="M5.25 5.653c0-.856.917-1.398 1.667-.986l11.54 6.348a1.125 1.125 0 0 1 0 1.971l-11.54 6.348a1.125 1.125 0 0 1-1.667-.986V5.653Z"/>
                </svg>
                Preview
            </button>
            <button class="btn btn-sec" id="loopBtn" title="Loop preview (P)">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5"
                     stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round"
                          d="M19.5 12c0-1.232-.046-2.453-.138-3.662a4.006 4.006 0 0 0-3.7-3.7 48.678 48.678 0 0 0-7.324 0 4.006 4.006 0 0 0-3.7 3.7c-.017.22-.032.441-.046.662M19.5 12l3-3m-3 3-3-3m-12 3c0 1.232.046 2.453.138 3.662a4.006 4.006 0 0 0 3.7 3.7 48.656 48.656 0 0 0 7.324 0 4.006 4.006 0 0 0 3.7-3.7c.017-.22.032-.441.046-.662M4.5 12l3 3m-3-3-3 3"/>
                </svg>
                Loop
            </button>
            <button class="btn btn-sec" id="resetSel">Reset</button>
            <div class="export-opts"><label>Format</label><select id="exportFmt">
                <option value="mp4">MP4</option>
                <option value="webm">WebM</option>
            </select></div>
            <button class="btn btn-pri" id="exportBtn">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5"
                     stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round"
                          d="M3 16.5v2.25A2.25 2.25 0 0 0 5.25 21h13.5A2.25 2.25 0 0 0 21 18.75V16.5M16.5 12 12 16.5m0 0L7.5 12m4.5 4.5V3"/>
                </svg>
                Export
            </button>
        </div>
        <footer>
            <span class="fname" id="fname"></span>
            <div class="footer-right">
                <button class="shortcuts-toggle" id="shortcutsToggle">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5"
                         stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round"
                              d="M3.75 6A2.25 2.25 0 0 1 6 3.75h2.25A2.25 2.25 0 0 1 10.5 6v2.25a2.25 2.25 0 0 1-2.25 2.25H6a2.25 2.25 0 0 1-2.25-2.25V6ZM3.75 15.75A2.25 2.25 0 0 1 6 13.5h2.25a2.25 2.25 0 0 1 2.25 2.25V18a2.25 2.25 0 0 1-2.25 2.25H6A2.25 2.25 0 0 1 3.75 18v-2.25ZM13.5 6a2.25 2.25 0 0 1 2.25-2.25H18A2.25 2.25 0 0 1 20.25 6v2.25A2.25 2.25 0 0 1 18 10.5h-2.25a2.25 2.25 0 0 1-2.25-2.25V6ZM13.5 15.75a2.25 2.25 0 0 1 2.25-2.25H18a2.25 2.25 0 0 1 2.25 2.25V18A2.25 2.25 0 0 1 18 20.25h-2.25A2.25 2.25 0 0 1 13.5 18v-2.25Z"/>
                    </svg>
                    Shortcuts
                </button>
                <div class="shortcuts-panel" id="shortcutsPanel">
                    <h4>Keyboard Shortcuts</h4>
                    <div class="shortcut-row"><span>Play/Pause</span><kbd>Space</kbd></div>
                    <div class="shortcut-row"><span>Seek ¬±5s</span><kbd>J</kbd> <kbd>L</kbd></div>
                    <div class="shortcut-row"><span>Frame step</span><kbd>‚Üê</kbd> <kbd>‚Üí</kbd></div>
                    <div class="shortcut-row"><span>Set In/Out</span><kbd>I</kbd> <kbd>O</kbd></div>
                    <div class="shortcut-row"><span>Go to In/Out</span><kbd>Home</kbd> <kbd>End</kbd></div>
                    <div class="shortcut-row"><span>Toggle loop</span><kbd>P</kbd></div>
                    <div class="shortcut-row"><span>Mute</span><kbd>M</kbd></div>
                    <div class="shortcut-row"><span>Fullscreen</span><kbd>F</kbd></div>
                    <div class="shortcut-row"><span>Zoom ¬±</span><kbd>+</kbd> <kbd>-</kbd></div>
                </div>
                <button class="btn btn-ghost" id="closeBtn">Close</button>
            </div>
        </footer>
    </div>
</div>
<div class="modal" id="modal">
    <div class="modal-box">
        <h3 id="mTitle">Processing...</h3>
        <div class="prog-ring">
            <svg width="80" height="80" viewBox="0 0 80 80">
                <circle class="bg" cx="40" cy="40" r="34"/>
                <circle class="fg" id="progCircle" cx="40" cy="40" r="34" stroke-dasharray="213.6"
                        stroke-dashoffset="213.6"/>
            </svg>
            <div class="pct" id="progPct">0%</div>
        </div>
        <p class="prog-text" id="progText">Initializing...</p>
        <p class="err-text" id="errText"></p>
        <button class="btn btn-sec modal-close" id="mClose" style="display:none">Close</button>
    </div>
</div>
<div class="modal confirm-modal" id="confirmModal">
    <div class="modal-box">
        <h3>Close video?</h3>
        <p>You have an active selection. Are you sure you want to close?</p>
        <div class="confirm-btns">
            <button class="btn btn-sec" id="confirmNo">Cancel</button>
            <button class="btn btn-pri" id="confirmYes">Close</button>
        </div>
    </div>
</div>
<div class="toast" id="toast"></div>
<script src="./coi-serviceworker.min.js"></script>
<script src="./ffmpeg.js"></script>
<script src="./ffmpeg-util.js"></script>
<script>
    const {FFmpeg} = FFmpegWASM, {fetchFile} = FFmpegUtil, $ = id => document.getElementById(id);
    const uploadZone = $('uploadZone'), fileInput = $('fileInput'), workspace = $('workspace'), video = $('video'),
        loader = $('loader'),
        tl = $('tl'), tlScroll = $('tlScroll'), tlTicks = $('tlTicks'), tlThumbs = $('tlThumbs'), sel = $('sel'),
        head = $('head'),
        hStart = $('hStart'), hEnd = $('hEnd'), tipS = $('tipS'), tipE = $('tipE'), tlHover = $('tlHover'),
        inTime = $('inTime'), outTime = $('outTime'), selDur = $('selDur'), selPct = $('selPct'),
        estSize = $('estSize'),
        playBtn = $('playBtn'), playIco = $('playIco'), backBtn = $('backBtn'), fwdBtn = $('fwdBtn'),
        timeText = $('timeText'), frameText = $('frameText'), speedSel = $('speed'),
        muteBtn = $('muteBtn'), volIco = $('volIco'), volSlider = $('vol'), fsBtn = $('fsBtn'),
        lbl0 = $('lbl0'), lbl1 = $('lbl1'), setInBtn = $('setIn'), setOutBtn = $('setOut'), goInBtn = $('goIn'),
        goOutBtn = $('goOut'),
        inUp = $('inUp'), inDown = $('inDown'), outUp = $('outUp'), outDown = $('outDown'),
        previewBtn = $('previewBtn'), loopBtn = $('loopBtn'), resetSel = $('resetSel'),
        exportBtn = $('exportBtn'), exportFmt = $('exportFmt'), closeBtn = $('closeBtn'), fname = $('fname'),
        modal = $('modal'), mTitle = $('mTitle'), progCircle = $('progCircle'), progPct = $('progPct'),
        progText = $('progText'),
        errText = $('errText'), mClose = $('mClose'), zoomSlider = $('zoomSlider'), zoomVal = $('zoomVal'),
        minimap = $('minimap'), minimapView = $('minimapView'), minimapSel = $('minimapSel'),
        infoDur = $('infoDur'), infoRes = $('infoRes'), infoFps = $('infoFps'), infoSize = $('infoSize'),
        infoType = $('infoType'),
        shortcutsToggle = $('shortcutsToggle'), shortcutsPanel = $('shortcutsPanel'),
        confirmModal = $('confirmModal'), confirmNo = $('confirmNo'), confirmYes = $('confirmYes'), toast = $('toast');

    let ffmpeg = null, videoFile = null, dur = 0, sp = 0, ep = 1, drag = null, preview = false, loopMode = false,
        lastVol = 1, zoom = 1, fps = 30, fileSize = 0, selModified = false;

    const fmt = (s, sh) => {
        const m = Math.floor(s / 60);
        return sh ? `${m}:${String(Math.floor(s % 60)).padStart(2, '0')}` : `${String(m).padStart(2, '0')}:${(s % 60).toFixed(3).padStart(6, '0')}`
    };
    const fmtMs = s => `${Math.floor(s / 60)}:${(s % 60).toFixed(3).padStart(6, '0')}`;
    const parse = str => {
        const p = str.split(':');
        if (p.length === 2) return parseInt(p[0]) * 60 + parseFloat(p[1]);
        if (p.length === 3) return parseInt(p[0]) * 3600 + parseInt(p[1]) * 60 + parseFloat(p[2]);
        return parseFloat(str)
    };
    const clamp = (v, a, b) => Math.max(a, Math.min(b, v));
    const fmtSize = b => {
        if (b < 1024) return b + 'B';
        if (b < 1048576) return (b / 1024).toFixed(1) + 'KB';
        if (b < 1073741824) return (b / 1048576).toFixed(1) + 'MB';
        return (b / 1073741824).toFixed(2) + 'GB'
    };
    const showToast = msg => {
        toast.textContent = msg;
        toast.classList.add('show');
        setTimeout(() => toast.classList.remove('show'), 2000)
    };

    function updZoom() {
        zoom = parseFloat(zoomSlider.value);
        zoomVal.textContent = zoom + '√ó';
        tl.style.width = zoom * 100 + '%';
        minimap.classList.toggle('show', zoom > 1);
        updMinimap();
        updTicks();
        updSel()
    }

    function updMinimap() {
        if (zoom <= 1) return;
        const sw = tlScroll.clientWidth, tw = tl.clientWidth, sl = tlScroll.scrollLeft;
        const vw = (sw / tw) * 100, vl = (sl / tw) * 100;
        minimapView.style.width = vw + '%';
        minimapView.style.left = vl + '%';
        minimapSel.style.left = sp * 100 + '%';
        minimapSel.style.width = (ep - sp) * 100 + '%'
    }

    function updTicks() {
        tlTicks.innerHTML = '';
        const w = tl.clientWidth;
        let interval = dur / 10;
        const intervals = [0.1, 0.25, 0.5, 1, 2, 5, 10, 15, 30, 60, 120, 300, 600];
        for (let i of intervals) {
            if (dur / i <= w / 60) {
                interval = i;
                break
            }
        }
        const minorInt = interval / 5;
        for (let t = 0; t <= dur; t += minorInt) {
            const pct = (t / dur) * 100,
                major = Math.abs(t % interval) < 0.001 || Math.abs(t % interval - interval) < 0.001;
            const tick = document.createElement('div');
            tick.className = 'tl-tick ' + (major ? 'major' : 'minor');
            tick.style.left = pct + '%';
            tlTicks.appendChild(tick);
            if (major && t < dur) {
                const lbl = document.createElement('span');
                lbl.className = 'tl-tick-label';
                lbl.style.left = pct + '%';
                lbl.textContent = fmt(t, true);
                tlTicks.appendChild(lbl)
            }
        }
    }

    function updSel() {
        const l = sp * 100, w = (ep - sp) * 100;
        sel.style.left = l + '%';
        sel.style.width = w + '%';
        hStart.style.left = `calc(${l}% - 8px)`;
        hEnd.style.left = `calc(${ep * 100}% - 8px)`;
        inTime.value = fmt(sp * dur);
        outTime.value = fmt(ep * dur);
        tipS.textContent = fmtMs(sp * dur);
        tipE.textContent = fmtMs(ep * dur);
        const selSec = (ep - sp) * dur;
        selDur.textContent = selSec.toFixed(3) + 's';
        selPct.textContent = Math.round((ep - sp) * 100) + '%';
        const estBytes = fileSize * (ep - sp);
        estSize.textContent = '~' + fmtSize(estBytes);
        lbl0.textContent = fmt(sp * dur, true);
        lbl1.textContent = fmt(ep * dur, true);
        updMinimap()
    }

    function updHead() {
        if (dur > 0) {
            const pct = (video.currentTime / dur) * 100;
            head.style.left = pct + '%';
            timeText.textContent = `${fmtMs(video.currentTime)} / ${fmt(dur, true)}`;
            const curFrame = Math.floor(video.currentTime * fps), totalFrames = Math.floor(dur * fps);
            frameText.textContent = `Frame ${curFrame} / ${totalFrames}`;
            if (!video.paused && zoom > 1) {
                const headPos = pct / 100 * tl.clientWidth, scrollL = tlScroll.scrollLeft,
                    scrollW = tlScroll.clientWidth;
                if (headPos < scrollL + 50 || headPos > scrollL + scrollW - 50) {
                    tlScroll.scrollLeft = headPos - scrollW / 2
                }
            }
        }
    }

    function updPlay() {
        playIco.innerHTML = video.paused ? '<path stroke-linecap="round" stroke-linejoin="round" d="M5.25 5.653c0-.856.917-1.398 1.667-.986l11.54 6.348a1.125 1.125 0 0 1 0 1.971l-11.54 6.348a1.125 1.125 0 0 1-1.667-.986V5.653Z"/>' : '<path stroke-linecap="round" stroke-linejoin="round" d="M15.75 5.25v13.5m-7.5-13.5v13.5"/>'
    }

    function updVol() {
        volIco.innerHTML = video.muted || video.volume === 0 ? '<path stroke-linecap="round" stroke-linejoin="round" d="M17.25 9.75 19.5 12m0 0 2.25 2.25M19.5 12l2.25-2.25M19.5 12l-2.25 2.25m-10.5-6 4.72-4.72a.75.75 0 0 1 1.28.53v15.88a.75.75 0 0 1-1.28.53l-4.72-4.72H4.51c-.88 0-1.704-.507-1.938-1.354A9.009 9.009 0 0 1 2.25 12c0-.83.112-1.633.322-2.396C2.806 8.756 3.63 8.25 4.51 8.25H6.75Z"/>' : '<path stroke-linecap="round" stroke-linejoin="round" d="M19.114 5.636a9 9 0 0 1 0 12.728M16.463 8.288a5.25 5.25 0 0 1 0 7.424M6.75 8.25l4.72-4.72a.75.75 0 0 1 1.28.53v15.88a.75.75 0 0 1-1.28.53l-4.72-4.72H4.51c-.88 0-1.704-.507-1.938-1.354A9.009 9.009 0 0 1 2.25 12c0-.83.112-1.633.322-2.396C2.806 8.756 3.63 8.25 4.51 8.25H6.75Z"/>'
    }

    function genThumbs() {
        tlThumbs.innerHTML = '';
        const count = Math.min(30, Math.ceil(dur));
        const thumbW = Math.max(80, tl.clientWidth / count);
        for (let i = 0; i < count; i++) {
            const t = (i / count) * dur;
            const canvas = document.createElement('canvas');
            canvas.width = thumbW;
            canvas.height = 72;
            const ctx = canvas.getContext('2d');
            const tempVid = document.createElement('video');
            tempVid.src = video.src;
            tempVid.currentTime = t;
            tempVid.addEventListener('seeked', () => {
                const vw = tempVid.videoWidth, vh = tempVid.videoHeight, ar = vw / vh;
                const dw = thumbW, dh = 72, dar = dw / dh;
                let sw, sh, sx, sy;
                if (ar > dar) {
                    sh = vh;
                    sw = vh * dar;
                    sx = (vw - sw) / 2;
                    sy = 0
                } else {
                    sw = vw;
                    sh = vw / dar;
                    sx = 0;
                    sy = (vh - sh) / 2
                }
                ctx.drawImage(tempVid, sx, sy, sw, sh, 0, 0, dw, dh)
            }, {once: true});
            tlThumbs.appendChild(canvas)
        }
    }

    uploadZone.onclick = () => fileInput.click();
    uploadZone.ondragover = e => {
        e.preventDefault();
        uploadZone.classList.add('drag')
    };
    uploadZone.ondragleave = () => uploadZone.classList.remove('drag');
    uploadZone.ondrop = e => {
        e.preventDefault();
        uploadZone.classList.remove('drag');
        e.dataTransfer.files[0] && load(e.dataTransfer.files[0])
    };
    fileInput.onchange = e => e.target.files[0] && load(e.target.files[0]);

    function load(f) {
        videoFile = f;
        fileSize = f.size;
        fname.textContent = f.name;
        infoSize.textContent = fmtSize(f.size);
        infoType.textContent = f.type.split('/')[1]?.toUpperCase() || 'Video';
        loader.classList.remove('hide');
        video.src = URL.createObjectURL(f);
        video.onloadedmetadata = () => {
            dur = video.duration;
            sp = 0;
            ep = 1;
            selModified = false;
            infoDur.textContent = fmt(dur, true);
            infoRes.textContent = video.videoWidth + '√ó' + video.videoHeight;
            const detectedFps = 30;
            fps = detectedFps;
            infoFps.textContent = fps;
            zoomSlider.value = 1;
            zoom = 1;
            zoomVal.textContent = '1√ó';
            tl.style.width = '100%';
            minimap.classList.remove('show');
            updTicks();
            updSel();
            updHead();
            setTimeout(genThumbs, 100);
            loader.classList.add('hide');
            uploadZone.style.display = 'none';
            workspace.classList.add('active')
        };
        video.onerror = () => {
            loader.classList.add('hide');
            alert('Error loading video')
        }
    }

    video.ontimeupdate = () => {
        updHead();
        if (preview && video.currentTime >= ep * dur) {
            if (loopMode) {
                video.currentTime = sp * dur
            } else {
                video.pause();
                preview = false
            }
        }
    };
    video.onplay = updPlay;
    video.onpause = updPlay;
    video.onvolumechange = updVol;

    playBtn.onclick = () => {
        preview = false;
        video.paused ? video.play() : video.pause()
    };
    backBtn.onclick = () => {
        video.pause();
        video.currentTime = Math.max(0, video.currentTime - 1 / fps)
    };
    fwdBtn.onclick = () => {
        video.pause();
        video.currentTime = Math.min(dur, video.currentTime + 1 / fps)
    };
    speedSel.onchange = e => video.playbackRate = +e.target.value;
    muteBtn.onclick = () => {
        video.muted = !video.muted;
        if (!video.muted && video.volume === 0) {
            video.volume = lastVol || 0.5;
            volSlider.value = video.volume
        }
    };
    volSlider.oninput = e => {
        video.volume = +e.target.value;
        video.muted = false;
        if (video.volume > 0) lastVol = video.volume
    };
    fsBtn.onclick = () => {
        document.fullscreenElement ? document.exitFullscreen() : workspace.requestFullscreen().catch(() => {
        })
    };
    zoomSlider.oninput = updZoom;
    tlScroll.onscroll = updMinimap;

    const tlPos = e => {
        const r = tl.getBoundingClientRect();
        return clamp((e.clientX - r.left) / r.width, 0, 1)
    };
    hStart.onmousedown = e => {
        e.stopPropagation();
        drag = 's';
        hStart.classList.add('on')
    };
    hEnd.onmousedown = e => {
        e.stopPropagation();
        drag = 'e';
        hEnd.classList.add('on')
    };
    tl.onmousedown = e => {
        if (e.target === tl || e.target === sel || e.target.classList.contains('tl-tick') || e.target.closest('.tl-thumbs')) {
            video.currentTime = tlPos(e) * dur;
            updHead()
        }
    };
    tl.onmousemove = e => {
        if (drag) return;
        const p = tlPos(e);
        tlHover.textContent = fmtMs(p * dur);
        tlHover.style.left = p * 100 + '%';
        tlHover.classList.add('show')
    };
    tl.onmouseleave = () => tlHover.classList.remove('show');
    document.onmousemove = e => {
        if (!drag) return;
        const p = tlPos(e);
        drag === 's' ? sp = clamp(p, 0, ep - 0.002) : ep = clamp(p, sp + 0.002, 1);
        selModified = true;
        updSel()
    };
    document.onmouseup = () => {
        drag = null;
        hStart.classList.remove('on');
        hEnd.classList.remove('on')
    };

    const tPos = e => {
        const r = tl.getBoundingClientRect();
        return clamp((e.touches[0].clientX - r.left) / r.width, 0, 1)
    };
    hStart.ontouchstart = e => {
        e.preventDefault();
        drag = 's';
        hStart.classList.add('on')
    };
    hEnd.ontouchstart = e => {
        e.preventDefault();
        drag = 'e';
        hEnd.classList.add('on')
    };
    document.ontouchmove = e => {
        if (!drag) return;
        const p = tPos(e);
        drag === 's' ? sp = clamp(p, 0, ep - 0.002) : ep = clamp(p, sp + 0.002, 1);
        selModified = true;
        updSel()
    };
    document.ontouchend = () => {
        drag = null;
        hStart.classList.remove('on');
        hEnd.classList.remove('on')
    };

    inTime.onchange = e => {
        const t = parse(e.target.value);
        if (!isNaN(t) && t >= 0 && t < ep * dur) {
            sp = t / dur;
            selModified = true;
            updSel()
        } else {
            e.target.value = fmt(sp * dur)
        }
    };
    outTime.onchange = e => {
        const t = parse(e.target.value);
        if (!isNaN(t) && t > sp * dur && t <= dur) {
            ep = t / dur;
            selModified = true;
            updSel()
        } else {
            e.target.value = fmt(ep * dur)
        }
    };
    setInBtn.onclick = () => {
        if (video.currentTime < ep * dur) {
            sp = video.currentTime / dur;
            selModified = true;
            updSel();
            showToast('Start point set')
        }
    };
    setOutBtn.onclick = () => {
        if (video.currentTime > sp * dur) {
            ep = video.currentTime / dur;
            selModified = true;
            updSel();
            showToast('End point set')
        }
    };
    goInBtn.onclick = () => video.currentTime = sp * dur;
    goOutBtn.onclick = () => video.currentTime = ep * dur;

    const frameStep = 1 / fps;
    inUp.onclick = () => {
        const newT = Math.min(sp * dur + frameStep, (ep * dur) - frameStep);
        sp = newT / dur;
        selModified = true;
        updSel()
    };
    inDown.onclick = () => {
        const newT = Math.max(sp * dur - frameStep, 0);
        sp = newT / dur;
        selModified = true;
        updSel()
    };
    outUp.onclick = () => {
        const newT = Math.min(ep * dur + frameStep, dur);
        ep = newT / dur;
        selModified = true;
        updSel()
    };
    outDown.onclick = () => {
        const newT = Math.max(ep * dur - frameStep, (sp * dur) + frameStep);
        ep = newT / dur;
        selModified = true;
        updSel()
    };

    previewBtn.onclick = () => {
        preview = true;
        video.currentTime = sp * dur;
        video.play()
    };
    loopBtn.onclick = () => {
        loopMode = !loopMode;
        loopBtn.classList.toggle('active', loopMode);
        showToast(loopMode ? 'Loop enabled' : 'Loop disabled')
    };
    resetSel.onclick = () => {
        sp = 0;
        ep = 1;
        selModified = false;
        updSel();
        showToast('Selection reset')
    };

    function tryClose() {
        if (selModified && (sp > 0 || ep < 1)) {
            confirmModal.classList.add('active')
        } else {
            doClose()
        }
    }

    function doClose() {
        video.pause();
        URL.revokeObjectURL(video.src);
        video.src = '';
        videoFile = null;
        selModified = false;
        workspace.classList.remove('active');
        uploadZone.style.display = '';
        fileInput.value = '';
        tlThumbs.innerHTML = ''
    }

    closeBtn.onclick = tryClose;
    confirmNo.onclick = () => confirmModal.classList.remove('active');
    confirmYes.onclick = () => {
        confirmModal.classList.remove('active');
        doClose()
    };

    shortcutsToggle.onclick = e => {
        e.stopPropagation();
        shortcutsPanel.classList.toggle('show')
    };
    document.onclick = e => {
        if (!shortcutsPanel.contains(e.target) && e.target !== shortcutsToggle) shortcutsPanel.classList.remove('show')
    };

    document.onkeydown = e => {
        if (!workspace.classList.contains('active') || e.target.tagName === 'INPUT') return;
        switch (e.code) {
            case'Space':
                e.preventDefault();
                video.paused ? video.play() : video.pause();
                break;
            case'KeyK':
                e.preventDefault();
                video.paused ? video.play() : video.pause();
                break;
            case'KeyJ':
                e.preventDefault();
                video.currentTime = Math.max(0, video.currentTime - 5);
                break;
            case'KeyL':
                e.preventDefault();
                video.currentTime = Math.min(dur, video.currentTime + 5);
                break;
            case'ArrowLeft':
                e.preventDefault();
                video.pause();
                video.currentTime = Math.max(0, video.currentTime - 1 / fps);
                break;
            case'ArrowRight':
                e.preventDefault();
                video.pause();
                video.currentTime = Math.min(dur, video.currentTime + 1 / fps);
                break;
            case'KeyI':
                e.preventDefault();
                if (video.currentTime < ep * dur) {
                    sp = video.currentTime / dur;
                    selModified = true;
                    updSel();
                    showToast('Start point set')
                }
                break;
            case'KeyO':
                e.preventDefault();
                if (video.currentTime > sp * dur) {
                    ep = video.currentTime / dur;
                    selModified = true;
                    updSel();
                    showToast('End point set')
                }
                break;
            case'KeyP':
                e.preventDefault();
                loopBtn.click();
                break;
            case'Home':
                e.preventDefault();
                video.currentTime = sp * dur;
                break;
            case'End':
                e.preventDefault();
                video.currentTime = ep * dur;
                break;
            case'KeyM':
                e.preventDefault();
                video.muted = !video.muted;
                break;
            case'KeyF':
                e.preventDefault();
                fsBtn.click();
                break;
            case'Equal':
            case'NumpadAdd':
                e.preventDefault();
                zoomSlider.value = Math.min(20, zoom + 1);
                updZoom();
                break;
            case'Minus':
            case'NumpadSubtract':
                e.preventDefault();
                zoomSlider.value = Math.max(1, zoom - 1);
                updZoom();
                break;
            case'Escape':
                shortcutsPanel.classList.remove('show');
                break
        }
    };

    async function initFF(){
        if(ffmpeg)return true;
        ffmpeg=new FFmpeg();
        ffmpeg.on('progress',({progress})=>{
            const pct=Math.round(progress*100);
            progCircle.style.strokeDashoffset=213.6*(1-progress);
            progPct.textContent=pct+'%';
            progText.textContent=`Processing: ${pct}%`
        });
        try{
            progText.textContent='Loading FFmpeg...';
            const baseURL='https://unpkg.com/@ffmpeg/core@0.12.6/dist/umd';
            await ffmpeg.load({
                coreURL:await FFmpegUtil.toBlobURL(`${baseURL}/ffmpeg-core.js`,'text/javascript'),
                wasmURL:await FFmpegUtil.toBlobURL(`${baseURL}/ffmpeg-core.wasm`,'application/wasm')
            });
            return true
        }catch(e){
            console.error('FFmpeg load error:',e);
            return false
        }
    }

    exportBtn.onclick = async () => {
        if (!videoFile) return;
        modal.classList.add('active');
        errText.style.display = 'none';
        mClose.style.display = 'none';
        progCircle.style.strokeDashoffset = 213.6;
        progPct.textContent = '0%';
        mTitle.textContent = 'Processing...';
        if (!await initFF()) {
            errText.textContent = 'Failed to load FFmpeg. SharedArrayBuffer may not be supported.';
            errText.style.display = 'block';
            mTitle.textContent = 'Error';
            mClose.style.display = 'block';
            return
        }
        try {
            progText.textContent = 'Reading file...';
            const fmtVal = exportFmt.value, ext = videoFile.name.substring(videoFile.name.lastIndexOf('.')),
                inp = 'input' + ext, out = 'output.' + (fmtVal === 'webm' ? 'webm' : 'mp4');
            await ffmpeg.writeFile(inp, await fetchFile(videoFile));
            progText.textContent = 'Cutting video...';
            const args = fmtVal === 'webm' ? ['-i', inp, '-ss', String(sp * dur), '-to', String(ep * dur), '-c:v', 'libvpx-vp9', '-c:a', 'libopus', '-b:v', '2M', out] : ['-i', inp, '-ss', String(sp * dur), '-to', String(ep * dur), '-c', 'copy', '-avoid_negative_ts', 'make_zero', out];
            await ffmpeg.exec(args);
            progText.textContent = 'Preparing download...';
            const data = await ffmpeg.readFile(out);
            const a = document.createElement('a');
            a.href = URL.createObjectURL(new Blob([data.buffer], {type: fmtVal === 'webm' ? 'video/webm' : 'video/mp4'}));
            a.download = 'cut_' + videoFile.name.replace(/\.[^.]+$/, '.' + (fmtVal === 'webm' ? 'webm' : 'mp4'));
            a.click();
            URL.revokeObjectURL(a.href);
            await ffmpeg.deleteFile(inp);
            await ffmpeg.deleteFile(out);
            selModified = false;
            modal.classList.remove('active');
            showToast('Export complete!')
        } catch (e) {
            errText.textContent = 'Error: ' + e.message;
            errText.style.display = 'block';
            mTitle.textContent = 'Error';
            mClose.style.display = 'block'
        }
    };

    mClose.onclick = () => modal.classList.remove('active');
    modal.onclick = e => {
        if (e.target === modal && errText.style.display !== 'none') modal.classList.remove('active')
    };

    timeText.onclick = () => {
        navigator.clipboard.writeText(fmtMs(video.currentTime)).then(() => showToast('Timestamp copied'))
    };
    timeText.style.cursor = 'pointer';
    timeText.title = 'Click to copy timestamp';
</script>
<script src="../logo.js"></script>
</body>
</html>