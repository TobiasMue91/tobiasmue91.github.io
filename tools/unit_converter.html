<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üìè</text></svg>">
    <title>Unit Converter</title>
    <style>
        :root {
            --color-primary: #4361ee;
            --color-primary-light: #4895ef;
            --color-primary-dark: #3f37c9;
            --color-bg: #ffffff;
            --color-bg-offset: #f8f9fa;
            --color-bg-elevated: #ffffff;
            --color-border: #e9ecef;
            --color-text: #212529;
            --color-text-secondary: #6c757d;
            --color-text-tertiary: #adb5bd;
            --color-success: #38b000;
            --color-focus: rgba(67, 97, 238, 0.3);
            --font-sans: system-ui, -apple-system, "Segoe UI", Roboto, sans-serif;
            --font-mono: "SFMono-Regular", Consolas, "Liberation Mono", Menlo, monospace;
            --shadow-sm: 0 1px 2px rgba(0, 0, 0, 0.05);
            --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            --radius-sm: 0.25rem;
            --radius-md: 0.375rem;
            --radius-lg: 0.5rem;
            --radius-xl: 0.75rem;
            --transition-fast: 150ms cubic-bezier(0.4, 0, 0.2, 1);
            --transition-normal: 250ms cubic-bezier(0.4, 0, 0.2, 1);
        }

        .dark {
            --color-primary: #4cc9f0;
            --color-primary-light: #64dfdf;
            --color-primary-dark: #3a86ff;
            --color-bg: #121212;
            --color-bg-offset: #1e1e1e;
            --color-bg-elevated: #2d2d2d;
            --color-border: #333333;
            --color-text: #f8f9fa;
            --color-text-secondary: #e9ecef;
            --color-text-tertiary: #adb5bd;
            --color-focus: rgba(76, 201, 240, 0.3);
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        html {
            height: 100%;
        }

        body {
            font-family: var(--font-sans);
            color: var(--color-text);
            background-color: var(--color-bg);
            line-height: 1.5;
            min-height: 100%;
            transition: background-color var(--transition-normal), color var(--transition-normal);
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            padding: 1rem;
        }

        .app-container {
            max-width: 640px;
            margin: 2rem auto;
            border-radius: var(--radius-xl);
            overflow: hidden;
            box-shadow: var(--shadow-lg);
            background-color: var(--color-bg-elevated);
            border: 1px solid var(--color-border);
        }

        .app-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 1.25rem 1.5rem;
            background: linear-gradient(to right, var(--color-primary), var(--color-primary-light));
            color: white;
        }

        .app-title {
            font-size: 1.5rem;
            font-weight: 600;
            margin: 0;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .app-title svg {
            width: 1.75rem;
            height: 1.75rem;
        }

        .theme-toggle {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            cursor: pointer;
            width: 2.5rem;
            height: 2.5rem;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background-color var(--transition-fast);
            -webkit-tap-highlight-color: transparent;
        }

        .theme-toggle:hover, .theme-toggle:focus-visible {
            background: rgba(255, 255, 255, 0.3);
            outline: none;
        }

        .theme-toggle svg {
            width: 1.25rem;
            height: 1.25rem;
        }

        .tabs {
            display: flex;
            background-color: var(--color-bg-offset);
            position: relative;
            overflow-x: auto;
            scrollbar-width: none;
            -ms-overflow-style: none;
            scroll-behavior: smooth;
            padding: 0 1rem;
        }

        .tabs::-webkit-scrollbar {
            display: none;
        }

        .tab {
            padding: 1rem 1.25rem;
            font-weight: 500;
            color: var(--color-text-secondary);
            cursor: pointer;
            border: none;
            background: transparent;
            white-space: nowrap;
            position: relative;
            transition: color var(--transition-fast);
            -webkit-tap-highlight-color: transparent;
        }

        .tab.active {
            color: var(--color-primary);
        }

        .tab-indicator {
            position: absolute;
            bottom: 0;
            left: 0;
            height: 3px;
            background-color: var(--color-primary);
            border-radius: 3px 3px 0 0;
            transition: transform var(--transition-normal), width var(--transition-normal);
        }

        .content-area {
            padding: 1.5rem;
        }

        .tab-content {
            display: none;
            animation: fadeIn 0.3s ease-in-out;
        }

        .tab-content.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .conversion-panel {
            background-color: var(--color-bg-offset);
            border-radius: var(--radius-lg);
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            box-shadow: var(--shadow-sm);
        }

        .conversion-group {
            display: grid;
            grid-template-columns: 1fr auto 1fr;
            gap: 1rem;
            align-items: center;
        }

        @media (max-width: 640px) {
            .conversion-group {
                grid-template-columns: 1fr;
                grid-template-rows: auto auto auto;
                gap: 1.25rem;
            }
        }

        .input-group {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .input-label {
            font-size: 0.875rem;
            font-weight: 500;
            color: var(--color-text-secondary);
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: relative;
        }

        .input-wrapper {
            position: relative;
            display: flex;
            box-shadow: var(--shadow-sm);
            border-radius: var(--radius-md);
            overflow: hidden;
            border: 1px solid var(--color-border);
            background-color: var(--color-bg-elevated);
            transition: border-color var(--transition-fast), box-shadow var(--transition-fast);
            height: 3rem; /* Fixed height for consistent alignment */
        }

        .input-wrapper:focus-within {
            border-color: var(--color-primary);
            box-shadow: 0 0 0 3px var(--color-focus);
        }

        .number-input, .unit-select {
            font-size: 1rem;
            padding: 0.75rem;
            color: var(--color-text);
            border: none;
            background-color: transparent;
            height: 100%;
            appearance: none;
        }

        .number-input {
            padding-right: 0.5rem;
            border-right: 1px solid var(--color-border);
            width: 40%;
            font-family: var(--font-mono);
        }

        .number-input:focus, .unit-select:focus {
            outline: none;
        }

        .number-input::placeholder {
            color: var(--color-text-tertiary);
        }

        .unit-select {
            width: 60%;
            font-weight: 500;
            cursor: pointer;
            padding-right: 1.75rem;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 24 24' stroke='%236c757d'%3E%3Cpath stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M19 9l-7 7-7-7'%3E%3C/path%3E%3C/svg%3E");
            background-position: right 0.5rem center;
            background-repeat: no-repeat;
            background-size: 1rem;
        }

        .dark .unit-select {
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 24 24' stroke='%23e9ecef'%3E%3Cpath stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M19 9l-7 7-7-7'%3E%3C/path%3E%3C/svg%3E");
        }

        .unit-select option {
            background: var(--color-bg-elevated);
        }

        .readonly-input {
            user-select: all;
            cursor: text;
            background-color: var(--color-bg-offset);
        }

        .copy-btn {
            position: absolute;
            right: 0;
            display: flex;
            align-items: center;
            gap: 0.25rem;
            background: transparent;
            border: 1px solid var(--color-border);
            padding: 0.375rem 0.5rem;
            font-size: 0.875rem;
            color: var(--color-primary);
            cursor: pointer;
            border-radius: var(--radius-sm);
            transition: background-color var(--transition-fast), border-color var(--transition-fast);
            -webkit-tap-highlight-color: transparent;
        }

        .copy-btn:hover, .copy-btn:focus-visible {
            background-color: rgba(67, 97, 238, 0.1);
            border-color: var(--color-primary);
            outline: none;
        }

        .dark .copy-btn {
            border-color: var(--color-border);
        }

        .dark .copy-btn:hover, .dark .copy-btn:focus-visible {
            background-color: rgba(76, 201, 240, 0.1);
            border-color: var(--color-primary);
        }

        .swap-btn {
            --size: 3rem;
            width: var(--size);
            height: var(--size);
            border-radius: 50%;
            border: none;
            background: linear-gradient(to right, var(--color-primary), var(--color-primary-light));
            color: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: var(--shadow-md);
            transition: transform var(--transition-fast), box-shadow var(--transition-fast);
            -webkit-tap-highlight-color: transparent;
        }

        .swap-btn:hover, .swap-btn:focus-visible {
            transform: scale(1.05);
            box-shadow: var(--shadow-lg);
            outline: none;
        }

        .swap-btn:active {
            transform: scale(0.95);
        }

        @media (max-width: 640px) {
            .swap-btn {
                margin: 0 auto;
                transform: rotate(90deg);
            }

            .swap-btn:hover, .swap-btn:focus-visible {
                transform: rotate(90deg) scale(1.05);
            }

            .swap-btn:active {
                transform: rotate(90deg) scale(0.95);
            }
        }

        .formula-display {
            text-align: center;
            padding: 1rem 0 0;
            color: var(--color-text-secondary);
            font-size: 0.875rem;
            font-family: var(--font-mono);
        }

        .history-panel {
            background-color: var(--color-bg-offset);
            border-radius: var(--radius-lg);
            overflow: hidden;
            box-shadow: var(--shadow-sm);
        }

        .history-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem 1.25rem;
            background-color: var(--color-bg-elevated);
            border-bottom: 1px solid var(--color-border);
            cursor: pointer;
            user-select: none;
            -webkit-tap-highlight-color: transparent;
        }

        .history-header-title {
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .history-toggle-icon {
            transition: transform var(--transition-fast);
        }

        .history-toggle-icon.expanded {
            transform: rotate(180deg);
        }

        .history-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height var(--transition-normal);
        }

        .history-content.expanded {
            max-height: 300px;
            overflow-y: auto;
        }

        .history-empty {
            padding: 1.5rem;
            text-align: center;
            color: var(--color-text-tertiary);
        }

        .history-list {
            list-style: none;
            margin: 0;
            padding: 0;
        }

        .history-item {
            padding: 0.75rem 1.25rem;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            border-bottom: 1px solid var(--color-border);
            transition: background-color var(--transition-fast);
            -webkit-tap-highlight-color: transparent;
        }

        .history-item:hover {
            background-color: rgba(67, 97, 238, 0.05);
        }

        .dark .history-item:hover {
            background-color: rgba(76, 201, 240, 0.05);
        }

        .history-item:last-child {
            border-bottom: none;
        }

        .history-item-text {
            font-size: 0.875rem;
        }

        .history-item-time {
            font-size: 0.75rem;
            color: var(--color-text-tertiary);
        }

        .notification {
            position: fixed;
            bottom: 1.5rem;
            left: 50%;
            transform: translateX(-50%) translateY(100%);
            background-color: var(--color-success);
            color: white;
            padding: 0.75rem 1.5rem;
            border-radius: var(--radius-md);
            box-shadow: var(--shadow-lg);
            z-index: 100;
            opacity: 0;
            transition: transform var(--transition-normal), opacity var(--transition-normal);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .notification.visible {
            transform: translateX(-50%) translateY(0);
            opacity: 1;
        }

        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border-width: 0;
        }

        button, input, select {
            font-family: inherit;
        }

        /* Add light pulsing animation to the result field when value updates */
        @keyframes pulse {
            0% { background-color: var(--color-bg-offset); }
            50% { background-color: rgba(67, 97, 238, 0.1); }
            100% { background-color: var(--color-bg-offset); }
        }

        .dark @keyframes pulse {
                  0% { background-color: var(--color-bg-offset); }
                  50% { background-color: rgba(76, 201, 240, 0.1); }
                  100% { background-color: var(--color-bg-offset); }
              }

        .pulse {
            animation: pulse 1s ease-in-out;
        }
    </style>
</head>
<body>
<div class="app-container">
    <header class="app-header">
        <h1 class="app-title">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"/>
            </svg>
            Unit Converter
        </h1>
        <button class="theme-toggle" aria-label="Toggle dark mode">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <circle cx="12" cy="12" r="5"></circle>
                <path d="M12 1v2M12 21v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M1 12h2M21 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42"></path>
            </svg>
        </button>
    </header>

    <div class="tabs" role="tablist">
        <div class="tab-indicator"></div>
        <button class="tab active" role="tab" aria-selected="true" aria-controls="length" data-tab="length" tabindex="0">Length</button>
        <button class="tab" role="tab" aria-selected="false" aria-controls="area" data-tab="area" tabindex="-1">Area</button>
        <button class="tab" role="tab" aria-selected="false" aria-controls="temperature" data-tab="temperature" tabindex="-1">Temperature</button>
        <button class="tab" role="tab" aria-selected="false" aria-controls="weight" data-tab="weight" tabindex="-1">Weight</button>
        <button class="tab" role="tab" aria-selected="false" aria-controls="volume" data-tab="volume" tabindex="-1">Volume</button>
    </div>

    <div class="content-area">
        <div id="length" class="tab-content active" role="tabpanel" aria-labelledby="length-tab">
            <div class="conversion-panel">
                <div class="conversion-group">
                    <div class="input-group">
                        <div class="input-label">
                            <span>From</span>
                        </div>
                        <div class="input-wrapper">
                            <input type="number" id="length-from-value" class="number-input" placeholder="Enter value" aria-label="Value to convert">
                            <select id="length-from-unit" class="unit-select" aria-label="Unit to convert from"></select>
                        </div>
                    </div>

                    <button class="swap-btn" aria-label="Swap units">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M7 16V4M7 4L3 8M7 4L11 8M17 8v12M17 20l4-4M17 20l-4-4"></path>
                        </svg>
                    </button>

                    <div class="input-group">
                        <div class="input-label">
                            <span>To</span>
                            <button class="copy-btn" aria-label="Copy result">
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
                                    <path d="M5 15H4a2 2 0 01-2-2V4a2 2 0 012-2h9a2 2 0 012 2v1"></path>
                                </svg>
                                <span>Copy</span>
                            </button>
                        </div>
                        <div class="input-wrapper">
                            <input type="text" id="length-to-value" class="number-input readonly-input" placeholder="Result" readonly aria-label="Conversion result">
                            <select id="length-to-unit" class="unit-select" aria-label="Unit to convert to"></select>
                        </div>
                    </div>
                </div>

                <div class="formula-display" id="length-formula"></div>
            </div>
        </div>

        <!-- Other tab contents will be dynamically created with the same structure -->
    </div>

    <div class="history-panel">
        <div class="history-header" id="history-toggle">
            <div class="history-header-title">
                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <circle cx="12" cy="12" r="10"></circle>
                    <polyline points="12 6 12 12 16 14"></polyline>
                </svg>
                <span>Recent Conversions</span>
            </div>
            <svg class="history-toggle-icon" xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <polyline points="6 9 12 15 18 9"></polyline>
            </svg>
        </div>
        <div class="history-content" id="history-content">
            <ul class="history-list" id="history-list"></ul>
        </div>
    </div>
</div>

<div class="notification" id="notification" role="alert">
    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <path d="M22 11.08V12a10 10 0 11-5.93-9.14"></path>
        <polyline points="22 4 12 14.01 9 11.01"></polyline>
    </svg>
    <span id="notification-text"></span>
</div>

<script>
    // Unit data model - centralized conversion system
    const unitData = {
        length: {
            base: "m",
            units: {
                m: { name: "Meters", factor: 1 },
                km: { name: "Kilometers", factor: 0.001 },
                cm: { name: "Centimeters", factor: 100 },
                mm: { name: "Millimeters", factor: 1000 },
                in: { name: "Inches", factor: 39.3701 },
                ft: { name: "Feet", factor: 3.28084 },
                yd: { name: "Yards", factor: 1.09361 },
                mi: { name: "Miles", factor: 0.000621371 }
            }
        },
        area: {
            base: "m2",
            units: {
                "m2": { name: "Square Meters", factor: 1 },
                "km2": { name: "Square Kilometers", factor: 0.000001 },
                "cm2": { name: "Square Centimeters", factor: 10000 },
                "mm2": { name: "Square Millimeters", factor: 1000000 },
                "in2": { name: "Square Inches", factor: 1550.0031 },
                "ft2": { name: "Square Feet", factor: 10.7639104 },
                "yd2": { name: "Square Yards", factor: 1.19599 },
                "mi2": { name: "Square Miles", factor: 0.00000038610216 },
                "ac": { name: "Acres", factor: 0.000247105 },
                "ha": { name: "Hectares", factor: 0.0001 }
            }
        },
        temperature: {
            units: {
                c: {
                    name: "Celsius",
                    toBase: value => value,
                    fromBase: value => value
                },
                f: {
                    name: "Fahrenheit",
                    toBase: value => (value - 32) * 5/9,
                    fromBase: value => value * 9/5 + 32
                },
                k: {
                    name: "Kelvin",
                    toBase: value => value - 273.15,
                    fromBase: value => value + 273.15
                }
            }
        },
        weight: {
            base: "g",
            units: {
                g: { name: "Grams", factor: 1 },
                kg: { name: "Kilograms", factor: 0.001 },
                mg: { name: "Milligrams", factor: 1000 },
                lb: { name: "Pounds", factor: 0.00220462 },
                oz: { name: "Ounces", factor: 0.035274 }
            }
        },
        volume: {
            base: "ml",
            units: {
                ml: { name: "Milliliters", factor: 1 },
                l: { name: "Liters", factor: 0.001 },
                "m3": { name: "Cubic Meters", factor: 0.000001 },
                gal: { name: "Gallons (US)", factor: 0.000264172 },
                qt: { name: "Quarts (US)", factor: 0.00105669 },
                pt: { name: "Pints (US)", factor: 0.00211338 },
                "fl-oz": { name: "Fluid Ounces (US)", factor: 0.033814 }
            }
        }
    };

    // App state
    let state = {
        activeTab: 'length',
        history: [],
        darkMode: window.matchMedia('(prefers-color-scheme: dark)').matches,
        historyExpanded: false
    };

    // Initialize the app
    function init() {
        // Apply dark mode if needed
        if (state.darkMode) document.body.classList.add('dark');

        // Set up tabs
        setupTabs();

        // Generate all tab contents
        Object.keys(unitData).forEach(createTabContent);

        // Generate unit selectors for all tabs
        Object.keys(unitData).forEach(category => {
            setupUnitSelectors(category);
            setupEventListeners(category);
        });

        // Position the tab indicator
        positionTabIndicator();

        // Setup theme toggle
        document.querySelector('.theme-toggle').addEventListener('click', toggleTheme);

        // Setup history toggle
        document.getElementById('history-toggle').addEventListener('click', toggleHistory);

        // Load saved state
        loadSavedState();

        // Initialize first formula
        updateFormula('length');

        // Update tab indicator on window resize
        window.addEventListener('resize', positionTabIndicator);
    }

    // Set up tab switching
    function setupTabs() {
        document.querySelectorAll('.tab').forEach(tab => {
            tab.addEventListener('click', () => {
                const category = tab.dataset.tab;
                switchTab(category);
            });

            // Keyboard navigation
            tab.addEventListener('keydown', e => {
                if (e.key === 'Enter' || e.key === ' ') {
                    e.preventDefault();
                    const category = tab.dataset.tab;
                    switchTab(category);
                }
            });
        });
    }

    // Position the tab indicator under the active tab
    function positionTabIndicator() {
        const activeTab = document.querySelector('.tab.active');
        const indicator = document.querySelector('.tab-indicator');

        if (activeTab && indicator) {
            const tabRect = activeTab.getBoundingClientRect();
            const tabsRect = document.querySelector('.tabs').getBoundingClientRect();

            indicator.style.width = `${tabRect.width}px`;
            indicator.style.transform = `translateX(${tabRect.left - tabsRect.left}px)`;
        }
    }

    // Switch active tab
    function switchTab(category) {
        // Don't do anything if already on the selected tab
        if (state.activeTab === category) return;

        // Update tab states
        document.querySelectorAll('.tab').forEach(tab => {
            const isActive = tab.dataset.tab === category;
            tab.classList.toggle('active', isActive);
            tab.setAttribute('aria-selected', isActive);
            tab.tabIndex = isActive ? 0 : -1;
        });

        // Update tab content visibility
        document.querySelectorAll('.tab-content').forEach(content => {
            content.classList.toggle('active', content.id === category);
        });

        // Update state
        state.activeTab = category;
        saveState();

        // Update formula for the new tab
        updateFormula(category);

        // Position the indicator
        positionTabIndicator();
    }

    // Create tab content for a category
    function createTabContent(category) {
        // Skip if tab already exists
        if (document.getElementById(category)) return;

        // Create tab content container
        const tabContent = document.createElement('div');
        tabContent.id = category;
        tabContent.className = 'tab-content';
        tabContent.setAttribute('role', 'tabpanel');
        tabContent.setAttribute('aria-labelledby', `${category}-tab`);

        // Create the conversion panel
        const panel = document.createElement('div');
        panel.className = 'conversion-panel';

        // Create the conversion group
        const group = document.createElement('div');
        group.className = 'conversion-group';

        // Create input group
        function createInputGroup(type) {
            const inputGroup = document.createElement('div');
            inputGroup.className = 'input-group';

            const label = document.createElement('div');
            label.className = 'input-label';
            const labelText = document.createElement('span');
            labelText.textContent = type === 'from' ? 'From' : 'To';
            label.appendChild(labelText);

            // Add copy button to "To" label
            if (type === 'to') {
                const copyBtn = document.createElement('button');
                copyBtn.className = 'copy-btn';
                copyBtn.setAttribute('aria-label', 'Copy result');

                const copyIcon = document.createElementNS('http://www.w3.org/2000/svg', 'svg');
                copyIcon.setAttribute('xmlns', 'http://www.w3.org/2000/svg');
                copyIcon.setAttribute('width', '16');
                copyIcon.setAttribute('height', '16');
                copyIcon.setAttribute('viewBox', '0 0 24 24');
                copyIcon.setAttribute('fill', 'none');
                copyIcon.setAttribute('stroke', 'currentColor');
                copyIcon.setAttribute('stroke-width', '2');
                copyIcon.setAttribute('stroke-linecap', 'round');
                copyIcon.setAttribute('stroke-linejoin', 'round');

                const rect = document.createElementNS('http://www.w3.org/2000/svg', 'rect');
                rect.setAttribute('x', '9');
                rect.setAttribute('y', '9');
                rect.setAttribute('width', '13');
                rect.setAttribute('height', '13');
                rect.setAttribute('rx', '2');
                rect.setAttribute('ry', '2');

                const path = document.createElementNS('http://www.w3.org/2000/svg', 'path');
                path.setAttribute('d', 'M5 15H4a2 2 0 01-2-2V4a2 2 0 012-2h9a2 2 0 012 2v1');

                copyIcon.appendChild(rect);
                copyIcon.appendChild(path);

                const copyText = document.createElement('span');
                copyText.textContent = 'Copy';

                copyBtn.appendChild(copyIcon);
                copyBtn.appendChild(copyText);

                label.appendChild(copyBtn);
            }

            const wrapper = document.createElement('div');
            wrapper.className = 'input-wrapper';

            const input = document.createElement('input');
            input.type = type === 'from' ? 'number' : 'text';
            input.id = `${category}-${type}-value`;
            input.className = 'number-input' + (type === 'to' ? ' readonly-input' : '');
            input.placeholder = type === 'from' ? 'Enter value' : 'Result';
            input.setAttribute('aria-label', type === 'from' ? 'Value to convert' : 'Conversion result');
            if (type === 'to') input.readOnly = true;

            const select = document.createElement('select');
            select.id = `${category}-${type}-unit`;
            select.className = 'unit-select';
            select.setAttribute('aria-label', type === 'from' ? 'Unit to convert from' : 'Unit to convert to');

            wrapper.appendChild(input);
            wrapper.appendChild(select);

            inputGroup.appendChild(label);
            inputGroup.appendChild(wrapper);

            return inputGroup;
        }

        // Create from & to input groups
        const fromGroup = createInputGroup('from');
        const toGroup = createInputGroup('to');

        // Create swap button
        const swapBtn = document.createElement('button');
        swapBtn.className = 'swap-btn';
        swapBtn.setAttribute('aria-label', 'Swap units');

        const swapIcon = document.createElementNS('http://www.w3.org/2000/svg', 'svg');
        swapIcon.setAttribute('xmlns', 'http://www.w3.org/2000/svg');
        swapIcon.setAttribute('width', '20');
        swapIcon.setAttribute('height', '20');
        swapIcon.setAttribute('viewBox', '0 0 24 24');
        swapIcon.setAttribute('fill', 'none');
        swapIcon.setAttribute('stroke', 'currentColor');
        swapIcon.setAttribute('stroke-width', '2');
        swapIcon.setAttribute('stroke-linecap', 'round');
        swapIcon.setAttribute('stroke-linejoin', 'round');

        const path = document.createElementNS('http://www.w3.org/2000/svg', 'path');
        path.setAttribute('d', 'M7 16V4M7 4L3 8M7 4L11 8M17 8v12M17 20l4-4M17 20l-4-4');

        swapIcon.appendChild(path);
        swapBtn.appendChild(swapIcon);

        // Create formula display
        const formula = document.createElement('div');
        formula.className = 'formula-display';
        formula.id = `${category}-formula`;

        // Assemble everything
        group.appendChild(fromGroup);
        group.appendChild(swapBtn);
        group.appendChild(toGroup);

        panel.appendChild(group);
        panel.appendChild(formula);

        tabContent.appendChild(panel);

        // Add to the document
        document.querySelector('.content-area').appendChild(tabContent);
    }

    // Set up unit selectors for a category
    function setupUnitSelectors(category) {
        const units = unitData[category].units;
        const fromUnitSelect = document.getElementById(`${category}-from-unit`);
        const toUnitSelect = document.getElementById(`${category}-to-unit`);

        if (!fromUnitSelect || !toUnitSelect) return;

        // Clear existing options
        fromUnitSelect.innerHTML = '';
        toUnitSelect.innerHTML = '';

        // Add unit options
        Object.keys(units).forEach(code => {
            const unit = units[code];

            const fromOption = document.createElement('option');
            fromOption.value = code;
            fromOption.textContent = unit.name;
            fromUnitSelect.appendChild(fromOption);

            const toOption = document.createElement('option');
            toOption.value = code;
            toOption.textContent = unit.name;
            toUnitSelect.appendChild(toOption);
        });

        // Set default selections
        if (category === 'length') {
            fromUnitSelect.value = 'm';
            toUnitSelect.value = 'cm';
        } else if (category === 'temperature') {
            fromUnitSelect.value = 'c';
            toUnitSelect.value = 'f';
        } else if (category === 'area') {
            fromUnitSelect.value = 'm2';
            toUnitSelect.value = 'ft2';
        } else if (category === 'weight') {
            fromUnitSelect.value = 'kg';
            toUnitSelect.value = 'lb';
        } else if (category === 'volume') {
            fromUnitSelect.value = 'l';
            toUnitSelect.value = 'gal';
        }
    }

    // Set up event listeners for a category
    function setupEventListeners(category) {
        const panel = document.getElementById(category);
        if (!panel) return;

        const fromValue = document.getElementById(`${category}-from-value`);
        const fromUnit = document.getElementById(`${category}-from-unit`);
        const toValue = document.getElementById(`${category}-to-value`);
        const toUnit = document.getElementById(`${category}-to-unit`);
        const swapBtn = panel.querySelector('.swap-btn');
        const copyBtn = panel.querySelector('.copy-btn');

        // Auto-convert on input changes
        fromValue.addEventListener('input', () => performConversion(category));

        fromUnit.addEventListener('change', () => {
            performConversion(category);
            updateFormula(category);
        });

        toUnit.addEventListener('change', () => {
            performConversion(category);
            updateFormula(category);
        });

        // Swap units
        swapBtn.addEventListener('click', () => {
            const temp = fromUnit.value;
            fromUnit.value = toUnit.value;
            toUnit.value = temp;
            performConversion(category);
            updateFormula(category);
        });

        // Copy result
        copyBtn.addEventListener('click', () => {
            const result = toValue.value;
            if (result) {
                navigator.clipboard.writeText(result).then(() => {
                    showNotification('Copied to clipboard!');
                }).catch(err => {
                    console.error('Could not copy text: ', err);
                });
            }
        });
    }

    // Perform conversion calculation
    function performConversion(category) {
        const fromValue = document.getElementById(`${category}-from-value`);
        const fromUnit = document.getElementById(`${category}-from-unit`);
        const toValue = document.getElementById(`${category}-to-value`);
        const toUnit = document.getElementById(`${category}-to-unit`);

        const value = parseFloat(fromValue.value);

        if (isNaN(value)) {
            toValue.value = '';
            return;
        }

        let result;

        // Special handling for temperature
        if (category === 'temperature') {
            // Convert to base unit (Celsius)
            const baseValue = unitData[category].units[fromUnit.value].toBase(value);
            // Convert from base to target
            result = unitData[category].units[toUnit.value].fromBase(baseValue);
        } else {
            // Standard conversion
            const units = unitData[category].units;
            const fromFactor = units[fromUnit.value].factor;
            const toFactor = units[toUnit.value].factor;

            // Convert via base unit
            const baseValue = value / fromFactor;
            result = baseValue * toFactor;
        }

        // Format result with appropriate precision
        const formattedResult = formatNumber(result);
        toValue.value = formattedResult;

        // Add pulse animation for visual feedback
        toValue.classList.remove('pulse');
        void toValue.offsetWidth; // Trigger reflow
        toValue.classList.add('pulse');

        // Add to history
        addToHistory(category, value, fromUnit.value, formattedResult, toUnit.value);
    }

    // Format number with appropriate precision
    function formatNumber(num) {
        // Handle very small numbers that should be zero
        if (Math.abs(num) < 1e-10) return '0';

        if (Math.abs(num) >= 1000000) return num.toExponential(4);
        if (Math.abs(num) >= 1000) return num.toFixed(2).replace(/\.?0+$/, '');
        if (Math.abs(num) >= 100) return num.toFixed(3).replace(/\.?0+$/, '');
        if (Math.abs(num) >= 10) return num.toFixed(4).replace(/\.?0+$/, '');
        if (Math.abs(num) >= 1) return num.toFixed(5).replace(/\.?0+$/, '');
        if (Math.abs(num) >= 0.1) return num.toFixed(6).replace(/\.?0+$/, '');
        if (Math.abs(num) >= 0.01) return num.toFixed(7).replace(/\.?0+$/, '');
        if (Math.abs(num) >= 0.001) return num.toFixed(8).replace(/\.?0+$/, '');

        // For very small numbers, use exponential notation
        return num.toExponential(4);
    }

    // Update conversion formula display
    function updateFormula(category) {
        const formulaEl = document.getElementById(`${category}-formula`);
        if (!formulaEl) return;

        const fromUnit = document.getElementById(`${category}-from-unit`);
        const toUnit = document.getElementById(`${category}-to-unit`);

        if (!fromUnit || !toUnit) return;

        let formula = '';

        // When units are the same
        if (fromUnit.value === toUnit.value) {
            formulaEl.textContent = 'No conversion needed';
            return;
        }

        // Special case for temperature
        if (category === 'temperature') {
            if (fromUnit.value === 'c' && toUnit.value === 'f') {
                formula = '¬∞C to ¬∞F: (¬∞C √ó 9/5) + 32';
            } else if (fromUnit.value === 'f' && toUnit.value === 'c') {
                formula = '¬∞F to ¬∞C: (¬∞F - 32) √ó 5/9';
            } else if (fromUnit.value === 'c' && toUnit.value === 'k') {
                formula = '¬∞C to K: ¬∞C + 273.15';
            } else if (fromUnit.value === 'k' && toUnit.value === 'c') {
                formula = 'K to ¬∞C: K - 273.15';
            } else if (fromUnit.value === 'f' && toUnit.value === 'k') {
                formula = '¬∞F to K: (¬∞F - 32) √ó 5/9 + 273.15';
            } else if (fromUnit.value === 'k' && toUnit.value === 'f') {
                formula = 'K to ¬∞F: (K - 273.15) √ó 9/5 + 32';
            }
        } else {
            // Standard formula for other categories
            const units = unitData[category].units;
            const ratio = calculateConversionRatio(category, fromUnit.value, toUnit.value);
            const fromSymbol = getUnitSymbol(fromUnit.value);
            const toSymbol = getUnitSymbol(toUnit.value);
            formula = `1 ${fromSymbol} = ${formatNumber(ratio)} ${toSymbol}`;
        }

        formulaEl.textContent = formula;
    }

    // Get proper unit symbol for display
    function getUnitSymbol(unitCode) {
        // Special formatting for some units
        const specialCases = {
            'm2': 'm¬≤',
            'cm2': 'cm¬≤',
            'km2': 'km¬≤',
            'mm2': 'mm¬≤',
            'in2': 'in¬≤',
            'ft2': 'ft¬≤',
            'yd2': 'yd¬≤',
            'mi2': 'mi¬≤',
            'm3': 'm¬≥'
        };

        return specialCases[unitCode] || unitCode;
    }

    // Calculate conversion ratio between units
    function calculateConversionRatio(category, fromUnit, toUnit) {
        if (category === 'temperature') return 1; // Not applicable

        const units = unitData[category].units;
        const fromFactor = units[fromUnit].factor;
        const toFactor = units[toUnit].factor;

        return toFactor / fromFactor;
    }

    // Add a conversion to history
    function addToHistory(category, fromValue, fromUnit, toValue, toUnit) {
        // Don't add if values are the same or if there's no result
        if (fromUnit === toUnit || !toValue) return;

        // Format units for display
        const fromSymbol = getUnitSymbol(fromUnit);
        const toSymbol = getUnitSymbol(toUnit);

        const entry = {
            category,
            from: { value: fromValue, unit: fromUnit, display: fromSymbol },
            to: { value: toValue, unit: toUnit, display: toSymbol },
            timestamp: Date.now()
        };

        // Check if this conversion is already at the top of history
        if (state.history.length > 0) {
            const last = state.history[0];
            if (last.category === category &&
                last.from.unit === fromUnit &&
                last.to.unit === toUnit &&
                Math.abs(last.from.value - fromValue) < 0.0001) {
                // Just update the timestamp and result
                state.history[0].to.value = toValue;
                state.history[0].timestamp = Date.now();
                updateHistoryDisplay();
                saveState();
                return;
            }
        }

        // Add to beginning of array
        state.history.unshift(entry);

        // Limit history to 10 items
        if (state.history.length > 10) {
            state.history.pop();
        }

        // Update display and save
        updateHistoryDisplay();
        saveState();
    }

    // Update history display
    function updateHistoryDisplay() {
        const historyList = document.getElementById('history-list');
        historyList.innerHTML = '';

        if (state.history.length === 0) {
            const emptyMessage = document.createElement('div');
            emptyMessage.className = 'history-empty';
            emptyMessage.textContent = 'No recent conversions';
            document.getElementById('history-content').appendChild(emptyMessage);
            return;
        }

        // Remove any existing empty message
        const emptyMessage = document.querySelector('.history-empty');
        if (emptyMessage) emptyMessage.remove();

        state.history.forEach(entry => {
            const item = document.createElement('li');
            item.className = 'history-item';
            item.setAttribute('data-category', entry.category);
            item.setAttribute('data-from-value', entry.from.value);
            item.setAttribute('data-from-unit', entry.from.unit);
            item.setAttribute('data-to-unit', entry.to.unit);

            const text = document.createElement('span');
            text.className = 'history-item-text';
            text.textContent = `${entry.from.value} ${entry.from.display} = ${entry.to.value} ${entry.to.display}`;

            const time = document.createElement('span');
            time.className = 'history-item-time';

            // Format the time difference
            const now = Date.now();
            const diff = now - entry.timestamp;

            if (diff < 60000) { // Less than a minute
                time.textContent = 'Just now';
            } else if (diff < 3600000) { // Less than an hour
                const minutes = Math.floor(diff / 60000);
                time.textContent = `${minutes}m ago`;
            } else if (diff < 86400000) { // Less than a day
                const hours = Math.floor(diff / 3600000);
                time.textContent = `${hours}h ago`;
            } else {
                time.textContent = new Date(entry.timestamp).toLocaleDateString(undefined, {
                    month: 'short',
                    day: 'numeric'
                });
            }

            item.appendChild(text);
            item.appendChild(time);
            historyList.appendChild(item);

            // Add click to reuse this conversion
            item.addEventListener('click', () => {
                switchTab(entry.category);

                // Set values from history
                document.getElementById(`${entry.category}-from-value`).value = entry.from.value;
                document.getElementById(`${entry.category}-from-unit`).value = entry.from.unit;
                document.getElementById(`${entry.category}-to-unit`).value = entry.to.unit;

                // Perform conversion
                performConversion(entry.category);
            });
        });
    }

    // Toggle history panel visibility
    function toggleHistory() {
        const content = document.getElementById('history-content');
        const toggleIcon = document.querySelector('.history-toggle-icon');

        state.historyExpanded = !state.historyExpanded;
        content.classList.toggle('expanded', state.historyExpanded);
        toggleIcon.classList.toggle('expanded', state.historyExpanded);

        saveState();
    }

    // Toggle dark/light theme
    function toggleTheme() {
        state.darkMode = !state.darkMode;
        document.body.classList.toggle('dark', state.darkMode);

        // Switch theme toggle icon
        const themeBtn = document.querySelector('.theme-toggle');
        if (state.darkMode) {
            themeBtn.innerHTML = `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path></svg>`;
        } else {
            themeBtn.innerHTML = `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"></circle><path d="M12 1v2M12 21v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M1 12h2M21 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42"></path></svg>`;
        }

        saveState();
    }

    // Show a notification
    function showNotification(message) {
        const notification = document.getElementById('notification');
        const notificationText = document.getElementById('notification-text');

        notificationText.textContent = message;
        notification.classList.add('visible');

        setTimeout(() => {
            notification.classList.remove('visible');
        }, 2000);
    }

    // Save state to localStorage
    function saveState() {
        localStorage.setItem('unitConverter', JSON.stringify({
            activeTab: state.activeTab,
            history: state.history,
            darkMode: state.darkMode,
            historyExpanded: state.historyExpanded
        }));
    }

    // Load state from localStorage
    function loadSavedState() {
        const saved = localStorage.getItem('unitConverter');
        if (!saved) return;

        try {
            const parsed = JSON.parse(saved);

            // Restore active tab
            if (parsed.activeTab) {
                state.activeTab = parsed.activeTab;
                switchTab(parsed.activeTab);
            }

            // Restore history
            if (Array.isArray(parsed.history)) {
                state.history = parsed.history;
                updateHistoryDisplay();
            }

            // Restore theme
            if (typeof parsed.darkMode === 'boolean') {
                state.darkMode = parsed.darkMode;
                document.body.classList.toggle('dark', state.darkMode);

                // Update theme toggle icon
                const themeBtn = document.querySelector('.theme-toggle');
                if (state.darkMode) {
                    themeBtn.innerHTML = `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path></svg>`;
                }
            }

            // Restore history expanded state
            if (typeof parsed.historyExpanded === 'boolean') {
                state.historyExpanded = parsed.historyExpanded;
                document.getElementById('history-content').classList.toggle('expanded', state.historyExpanded);
                document.querySelector('.history-toggle-icon').classList.toggle('expanded', state.historyExpanded);
            }
        } catch (e) {
            console.error('Failed to load saved state:', e);
        }
    }

    // Initialize the app when the DOM is ready
    document.addEventListener('DOMContentLoaded', init);
</script>
<script src="../logo.js"></script>
</body>
</html>