<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sleep Cycle Calculator</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-primary: #f8fafc;
            --bg-secondary: #ffffff;
            --bg-tertiary: #f1f5f9;
            --text-primary: #0f172a;
            --text-secondary: #475569;
            --text-muted: #94a3b8;
            --accent: #6366f1;
            --accent-hover: #4f46e5;
            --border: #e2e8f0;
            --optimal: #10b981;
            --good: #f59e0b;
            --minimal: #64748b;
            --warning: #ef4444;
            --shadow: 0 1px 3px rgba(0, 0, 0, 0.08);
            --radius: 12px;
            --radius-sm: 8px
        }

        @media (prefers-color-scheme: dark) {
            :root {
                --bg-primary: #0f172a;
                --bg-secondary: #1e293b;
                --bg-tertiary: #334155;
                --text-primary: #f1f5f9;
                --text-secondary: #cbd5e1;
                --text-muted: #64748b;
                --border: #334155;
                --shadow: 0 1px 3px rgba(0, 0, 0, 0.3)
            }
        }

        *, *::before, *::after {
            box-sizing: border-box;
            margin: 0;
            padding: 0
        }

        body {
            font-family: 'Inter', -apple-system, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            min-height: 100vh;
            line-height: 1.6;
            padding: 24px 16px
        }

        .container {
            max-width: 540px;
            margin: 0 auto
        }

        header {
            text-align: center;
            margin-bottom: 32px
        }

        h1 {
            font-size: 1.75rem;
            font-weight: 700;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px
        }

        .subtitle {
            color: var(--text-secondary);
            font-size: 0.95rem
        }

        .clock-display {
            margin-top: 16px;
            padding: 12px 24px;
            background: var(--bg-secondary);
            border-radius: var(--radius-sm);
            display: inline-block;
            box-shadow: var(--shadow)
        }

        .clock-time {
            font-size: 1.75rem;
            font-weight: 600;
            font-variant-numeric: tabular-nums;
            letter-spacing: -0.02em
        }

        .clock-date {
            font-size: 0.75rem;
            color: var(--text-muted);
            margin-top: 2px
        }

        .card {
            background: var(--bg-secondary);
            border-radius: var(--radius);
            padding: 24px;
            box-shadow: var(--shadow);
            margin-bottom: 20px
        }

        .tabs {
            display: flex;
            gap: 4px;
            background: var(--bg-tertiary);
            padding: 4px;
            border-radius: var(--radius-sm);
            margin-bottom: 24px
        }

        .tab {
            flex: 1;
            padding: 10px 12px;
            border: none;
            background: transparent;
            color: var(--text-secondary);
            font-size: 0.875rem;
            font-weight: 500;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s;
            font-family: inherit
        }

        .tab:hover {
            color: var(--text-primary)
        }

        .tab.active {
            background: var(--bg-secondary);
            color: var(--text-primary);
            box-shadow: var(--shadow)
        }

        .tab:focus-visible {
            outline: 2px solid var(--accent);
            outline-offset: 2px
        }

        .input-group {
            margin-bottom: 20px
        }

        .input-group label {
            display: block;
            font-size: 0.875rem;
            font-weight: 500;
            margin-bottom: 8px;
            color: var(--text-secondary)
        }

        .time-input {
            width: 100%;
            padding: 14px 16px;
            font-size: 1.25rem;
            font-family: inherit;
            border: 2px solid var(--border);
            border-radius: var(--radius-sm);
            background: var(--bg-primary);
            color: var(--text-primary);
            transition: border-color 0.2s
        }

        .time-input:focus {
            outline: none;
            border-color: var(--accent)
        }

        .settings-toggle {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.8rem;
            color: var(--text-muted);
            background: none;
            border: none;
            cursor: pointer;
            padding: 8px 0;
            margin-bottom: 16px;
            font-family: inherit;
            transition: color 0.2s
        }

        .settings-toggle:hover {
            color: var(--text-secondary)
        }

        .settings-toggle svg {
            transition: transform 0.2s
        }

        .settings-toggle.open svg {
            transform: rotate(180deg)
        }

        .settings-panel {
            display: grid;
            grid-template-rows:0fr;
            transition: grid-template-rows 0.25s ease
        }

        .settings-panel.open {
            grid-template-rows:1fr
        }

        .settings-inner {
            overflow: hidden
        }

        .settings-content {
            background: var(--bg-tertiary);
            border-radius: var(--radius-sm);
            padding: 16px;
            margin-bottom: 16px
        }

        .setting-row {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 16px
        }

        .setting-label {
            font-size: 0.85rem;
            color: var(--text-secondary)
        }

        .setting-value {
            display: flex;
            align-items: center;
            gap: 8px
        }

        .setting-input {
            width: 60px;
            padding: 8px;
            font-size: 0.9rem;
            font-family: inherit;
            border: 1px solid var(--border);
            border-radius: 6px;
            background: var(--bg-secondary);
            color: var(--text-primary);
            text-align: center
        }

        .setting-input:focus {
            outline: none;
            border-color: var(--accent)
        }

        .setting-unit {
            font-size: 0.8rem;
            color: var(--text-muted)
        }

        .btn {
            width: 100%;
            padding: 14px 24px;
            font-size: 1rem;
            font-weight: 600;
            font-family: inherit;
            border: none;
            border-radius: var(--radius-sm);
            cursor: pointer;
            transition: all 0.2s
        }

        .btn-primary {
            background: var(--accent);
            color: white
        }

        .btn-primary:hover {
            background: var(--accent-hover);
            transform: translateY(-1px)
        }

        .btn-primary:active {
            transform: translateY(0)
        }

        .btn:focus-visible {
            outline: 2px solid var(--accent);
            outline-offset: 2px
        }

        .results {
            margin-top: 24px
        }

        .results-title {
            font-size: 0.875rem;
            color: var(--text-secondary);
            margin-bottom: 16px;
            font-weight: 500
        }

        .times-grid {
            display: grid;
            gap: 12px
        }

        .time-card {
            display: flex;
            align-items: center;
            gap: 16px;
            padding: 16px;
            background: var(--bg-tertiary);
            border-radius: var(--radius-sm);
            border-left: 4px solid var(--minimal);
            opacity: 0;
            transform: translateY(8px);
            transition: opacity 0.3s, transform 0.3s
        }

        .time-card.show {
            opacity: 1;
            transform: translateY(0)
        }

        .time-card.optimal {
            border-left-color: var(--optimal)
        }

        .time-card.good {
            border-left-color: var(--good)
        }

        .time-card.passed {
            opacity: 0.5
        }

        .time-card.passed.show {
            opacity: 0.5
        }

        .time-main {
            flex: 1;
            min-width: 0
        }

        .time-value {
            font-size: 1.4rem;
            font-weight: 700;
            font-variant-numeric: tabular-nums
        }

        .time-relative {
            font-size: 0.75rem;
            color: var(--text-muted);
            margin-top: 2px
        }

        .time-relative.passed {
            color: var(--warning)
        }

        .cycle-bar {
            display: flex;
            gap: 3px;
            margin-top: 10px
        }

        .cycle-block {
            height: 4px;
            flex: 1;
            border-radius: 2px;
            background: var(--border)
        }

        .cycle-block.filled {
            background: var(--minimal)
        }

        .optimal .cycle-block.filled {
            background: var(--optimal)
        }

        .good .cycle-block.filled {
            background: var(--good)
        }

        .time-meta {
            text-align: right;
            flex-shrink: 0
        }

        .cycles {
            font-size: 0.875rem;
            font-weight: 600
        }

        .cycles.optimal {
            color: var(--optimal)
        }

        .cycles.good {
            color: var(--good)
        }

        .cycles.minimal {
            color: var(--minimal)
        }

        .sleep-hours {
            font-size: 0.75rem;
            color: var(--text-muted);
            margin-top: 2px
        }

        .info {
            background: var(--bg-secondary);
            border-radius: var(--radius);
            padding: 20px;
            box-shadow: var(--shadow)
        }

        .info h3 {
            font-size: 0.9rem;
            font-weight: 600;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 8px
        }

        .info p {
            font-size: 0.825rem;
            color: var(--text-secondary);
            margin-bottom: 8px
        }

        .info p:last-child {
            margin-bottom: 0
        }

        .legend {
            display: flex;
            gap: 16px;
            margin-top: 16px;
            flex-wrap: wrap
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 0.75rem;
            color: var(--text-secondary)
        }

        .legend-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%
        }

        .legend-dot.optimal {
            background: var(--optimal)
        }

        .legend-dot.good {
            background: var(--good)
        }

        .legend-dot.minimal {
            background: var(--minimal)
        }

        .hidden {
            display: none
        }

        @media (max-width: 480px) {
            .tab {
                padding: 8px 6px;
                font-size: 0.8rem
            }

            h1 {
                font-size: 1.5rem
            }

            .time-value {
                font-size: 1.25rem
            }

            .clock-time {
                font-size: 1.5rem
            }
        }
    </style>
</head>
<body>
<div class="container">
    <header>
        <h1>
            <svg width="28" height="28" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/>
            </svg>
            Sleep Cycle Calculator
        </h1>
        <p class="subtitle">Wake up refreshed by completing full sleep cycles</p>
        <div class="clock-display">
            <div class="clock-time" id="clock-time"></div>
            <div class="clock-date" id="clock-date"></div>
        </div>
    </header>
    <main>
        <div class="card">
            <div class="tabs" role="tablist">
                <button class="tab active" data-mode="wake" role="tab" aria-selected="true">Wake up at</button>
                <button class="tab" data-mode="sleep" role="tab" aria-selected="false">Go to bed at</button>
                <button class="tab" data-mode="now" role="tab" aria-selected="false">Sleep now</button>
            </div>
            <div id="input-section">
                <div class="input-group">
                    <label for="time-input" id="input-label">I need to wake up at:</label>
                    <input type="time" class="time-input" id="time-input" value="07:00">
                </div>
            </div>
            <button class="settings-toggle" id="settings-toggle" aria-expanded="false">
                <svg width="14" height="14" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                    <path d="M6 9l6 6 6-6"/>
                </svg>
                <span>Adjust fall-asleep time</span>
            </button>
            <div class="settings-panel" id="settings-panel">
                <div class="settings-inner">
                    <div class="settings-content">
                        <div class="setting-row">
                            <span class="setting-label">Time to fall asleep</span>
                            <div class="setting-value">
                                <input type="number" class="setting-input" id="fall-asleep" min="5" max="45" value="14"
                                       aria-label="Minutes to fall asleep">
                                <span class="setting-unit">min</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <button class="btn btn-primary" id="calculate">Calculate Bedtimes</button>
            <div class="results hidden" id="results" aria-live="polite">
                <p class="results-title" id="results-title">Go to bed at one of these times:</p>
                <div class="times-grid" id="times-grid"></div>
            </div>
        </div>
        <div class="info">
            <h3>
                <svg width="16" height="16" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                    <circle cx="12" cy="12" r="10"/>
                    <path d="M12 16v-4M12 8h.01"/>
                </svg>
                How it works
            </h3>
            <p>A complete sleep cycle lasts about <strong>90 minutes</strong> and includes all stages from light sleep
                to deep sleep and REM. Waking at the end of a cycle helps you feel more alert and refreshed.</p>
            <p>The calculator adds your fall-asleep time and finds times that align with complete cycles.</p>
            <div class="legend">
                <div class="legend-item"><span class="legend-dot optimal"></span>Optimal (5-6 cycles)</div>
                <div class="legend-item"><span class="legend-dot good"></span>Good (4 cycles)</div>
                <div class="legend-item"><span class="legend-dot minimal"></span>Minimal (3 cycles)</div>
            </div>
        </div>
    </main>
</div>
<script>
    (function () {
        const CYCLE = 90, STORE = 'sleepCalcPrefs', $ = id => document.getElementById(id),
            $$ = s => document.querySelectorAll(s);
        const tabs = $$('.tab'), inputSection = $('input-section'), inputLabel = $('input-label'),
            timeInput = $('time-input'),
            calcBtn = $('calculate'), resultsDiv = $('results'), resultsTitle = $('results-title'),
            timesGrid = $('times-grid'),
            settingsToggle = $('settings-toggle'), settingsPanel = $('settings-panel'),
            fallAsleepInput = $('fall-asleep');
        let mode = 'wake', fallAsleep = 14;

        function loadPrefs() {
            try {
                const p = JSON.parse(localStorage.getItem(STORE) || '{}');
                if (p.mode && ['wake', 'sleep', 'now'].includes(p.mode)) {
                    mode = p.mode;
                    tabs.forEach(t => {
                        const a = t.dataset.mode === mode;
                        t.classList.toggle('active', a);
                        t.setAttribute('aria-selected', a)
                    })
                }
                if (p.fallAsleep >= 5 && p.fallAsleep <= 45) {
                    fallAsleep = p.fallAsleep;
                    fallAsleepInput.value = fallAsleep
                }
                if (p.wakeTime && mode === 'wake') timeInput.value = p.wakeTime;
                if (p.sleepTime && mode === 'sleep') timeInput.value = p.sleepTime
            } catch (e) {
            }
        }

        function savePrefs() {
            try {
                localStorage.setItem(STORE, JSON.stringify({
                    mode,
                    fallAsleep,
                    wakeTime: mode === 'wake' ? timeInput.value : undefined,
                    sleepTime: mode === 'sleep' ? timeInput.value : undefined
                }))
            } catch (e) {
            }
        }

        function updateClock() {
            const now = new Date();
            $('clock-time').textContent = now.toLocaleTimeString([], {hour: '2-digit', minute: '2-digit'});
            $('clock-date').textContent = now.toLocaleDateString([], {weekday: 'long', month: 'short', day: 'numeric'})
        }

        function formatTime(d) {
            return d.toLocaleTimeString([], {hour: '2-digit', minute: '2-digit'})
        }

        function addMin(d, m) {
            return new Date(d.getTime() + m * 60000)
        }

        function quality(c) {
            return c >= 5 ? 'optimal' : c === 4 ? 'good' : 'minimal'
        }

        function parseTime(v) {
            const [h, m] = v.split(':').map(Number);
            const d = new Date();
            d.setHours(h, m, 0, 0);
            return d
        }

        function relativeTime(target, ref) {
            const diff = target - ref, mins = Math.round(diff / 60000);
            if (mins < 0) {
                const a = Math.abs(mins);
                return {text: a < 60 ? `${a}m ago` : `${Math.floor(a / 60)}h ${a % 60}m ago`, passed: true}
            }
            const h = Math.floor(mins / 60), m = mins % 60;
            const tomorrow = target.getDate() !== ref.getDate();
            let text = mins < 60 ? `in ${mins}m` : m > 0 ? `in ${h}h ${m}m` : `in ${h}h`;
            if (tomorrow) text += ' Â· tomorrow';
            return {text, passed: false}
        }

        function updateUI() {
            if (mode === 'now') {
                inputSection.classList.add('hidden');
                calcBtn.textContent = 'Calculate Wake Times'
            } else {
                inputSection.classList.remove('hidden');
                inputLabel.textContent = mode === 'wake' ? 'I need to wake up at:' : 'I plan to go to bed at:';
                calcBtn.textContent = mode === 'wake' ? 'Calculate Bedtimes' : 'Calculate Wake Times';
                timeInput.value = mode === 'wake' ? '07:00' : '23:00'
            }
            resultsDiv.classList.add('hidden')
        }

        function calculate() {
            const times = [], now = new Date();
            fallAsleep = parseInt(fallAsleepInput.value) || 14;
            savePrefs();

            if (mode === 'wake') {
                let wake = parseTime(timeInput.value);
                if (wake <= now) wake = addMin(wake, 1440);
                for (let c = 6; c >= 3; c--) times.push({
                    time: addMin(wake, -(c * CYCLE + fallAsleep)),
                    cycles: c,
                    hours: c * CYCLE / 60
                });
                resultsTitle.textContent = 'Go to bed at one of these times:'
            } else if (mode === 'sleep') {
                const sleep = addMin(parseTime(timeInput.value), fallAsleep);
                for (let c = 6; c >= 3; c--) times.push({
                    time: addMin(sleep, c * CYCLE),
                    cycles: c,
                    hours: c * CYCLE / 60
                });
                times.reverse();
                resultsTitle.textContent = 'Wake up at one of these times:'
            } else {
                const sleep = addMin(now, fallAsleep);
                for (let c = 3; c <= 6; c++) times.push({
                    time: addMin(sleep, c * CYCLE),
                    cycles: c,
                    hours: c * CYCLE / 60
                });
                resultsTitle.textContent = 'Wake up at one of these times:'
            }

            timesGrid.innerHTML = times.map((t, i) => {
                const q = quality(t.cycles), rel = relativeTime(t.time, now);
                let bars = '';
                for (let j = 0; j < 6; j++) bars += `<div class="cycle-block${j < t.cycles ? ' filled' : ''}"></div>`;
                return `<div class="time-card ${q}${rel.passed ? ' passed' : ''}" style="transition-delay:${i * 50}ms">
<div class="time-main"><span class="time-value">${formatTime(t.time)}</span>
<div class="time-relative${rel.passed ? ' passed' : ''}">${rel.text}</div>
<div class="cycle-bar">${bars}</div></div>
<div class="time-meta"><div class="cycles ${q}">${t.cycles} cycles</div>
<div class="sleep-hours">${t.hours}h sleep</div></div></div>`
            }).join('');

            resultsDiv.classList.remove('hidden');
            requestAnimationFrame(() => timesGrid.querySelectorAll('.time-card').forEach(c => c.classList.add('show')))
        }

        settingsToggle.addEventListener('click', () => {
            const open = settingsPanel.classList.toggle('open');
            settingsToggle.classList.toggle('open', open);
            settingsToggle.setAttribute('aria-expanded', open)
        });

        fallAsleepInput.addEventListener('change', () => {
            let v = parseInt(fallAsleepInput.value);
            if (isNaN(v) || v < 5) v = 5;
            if (v > 45) v = 45;
            fallAsleepInput.value = v;
            fallAsleep = v;
            savePrefs()
        });

        tabs.forEach(tab => tab.addEventListener('click', () => {
            tabs.forEach(t => {
                t.classList.remove('active');
                t.setAttribute('aria-selected', 'false')
            });
            tab.classList.add('active');
            tab.setAttribute('aria-selected', 'true');
            mode = tab.dataset.mode;
            updateUI();
            savePrefs()
        }));

        calcBtn.addEventListener('click', calculate);
        timeInput.addEventListener('keypress', e => {
            if (e.key === 'Enter') calculate()
        });

        loadPrefs();
        updateUI();
        updateClock();
        setInterval(updateClock, 1000);
    })();
</script>
<script src="../logo.js"></script>
</body>
</html>