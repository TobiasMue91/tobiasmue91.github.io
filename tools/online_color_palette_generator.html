<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Palette Craft | Designer Color Tool and Online Color Palette Generator</title>
    <link rel="icon"
          href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ðŸŽ¨</text></svg>">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>:root {
        --primary: #4361ee;
        --text: #333;
        --text-light: #777;
        --bg: #f8f9fa;
        --card: #fff;
        --border: #e0e0e0;
        --shadow: rgba(0, 0, 0, 0.08);
        --accent: #ef476f;
        --success: #06d6a0;
        --warning: #ffd166;
        --error: #ef476f;
    }

    .dark-mode {
        --primary: #4361ee;
        --text: #f0f0f0;
        --text-light: #aaa;
        --bg: #121212;
        --card: #1e1e1e;
        --border: #333;
        --shadow: rgba(0, 0, 0, 0.2);
    }

    * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
    }

    body {
        background-color: var(--bg);
        color: var(--text);
        font-family: 'Inter', sans-serif;
        transition: all 0.3s;
        line-height: 1.5;
    }

    .container {
        max-width: 1200px;
        margin: 0 auto;
        padding: 20px;
    }

    .header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
    }

    .logo {
        font-size: 24px;
        font-weight: 700;
        display: flex;
        align-items: center;
        gap: 8px;
    }

    .card {
        background: var(--card);
        border-radius: 12px;
        box-shadow: 0 4px 20px var(--shadow);
        border: 1px solid var(--border);
        transition: all 0.3s;
        margin-bottom: 20px;
        overflow: hidden;
    }

    .card-header {
        padding: 16px 20px;
        border-bottom: 1px solid var(--border);
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    .card-title {
        font-size: 18px;
        font-weight: 600;
        margin: 0;
    }

    .card-body {
        padding: 20px;
    }

    button {
        background: var(--primary);
        color: white;
        border: none;
        border-radius: 6px;
        padding: 8px 16px;
        font-size: 14px;
        font-weight: 500;
        cursor: pointer;
        transition: all 0.2s;
        display: inline-flex;
        align-items: center;
        gap: 8px;
    }

    button:hover {
        opacity: 0.9;
        transform: translateY(-1px);
    }

    button.secondary {
        background: transparent;
        border: 1px solid var(--border);
        color: var(--text);
    }

    button.sm {
        padding: 4px 8px;
        font-size: 12px;
    }

    select, input[type="number"] {
        display: block;
        width: 100%;
        padding: 8px 12px;
        border-radius: 6px;
        border: 1px solid var(--border);
        background: var(--card);
        color: var(--text);
        font-size: 14px;
        margin-bottom: 16px;
        transition: all 0.2s;
    }

    select:focus, input:focus {
        outline: none;
        border-color: var(--primary);
    }

    .swatch-container {
        display: flex;
        gap: 2px;
        overflow: hidden;
        border-radius: 8px;
        margin-bottom: 16px;
        flex-wrap: wrap;
    }

    .color-swatch {
        flex: 1;
        min-height: 120px;
        position: relative;
        min-width: 120px;
    }

    .swatch-inner {
        height: 100%;
        width: 100%;
        display: flex;
        flex-direction: column;
        justify-content: flex-end;
        padding: 12px;
        transition: all 0.2s;
    }

    .swatch-inner:hover {
        filter: brightness(1.1);
    }

    .color-hex {
        font-family: monospace;
        font-size: 14px;
        margin-bottom: 4px;
    }

    .color-info {
        font-size: 12px;
        opacity: 0.8;
    }

    .color-tools {
        position: absolute;
        top: 8px;
        right: 8px;
        display: flex;
        gap: 4px;
    }

    .swatch-lock, .swatch-copy {
        width: 24px;
        height: 24px;
        background: rgba(255, 255, 255, 0.2);
        border-radius: 4px;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        transition: all 0.2s;
    }

    .swatch-lock:hover, .swatch-copy:hover {
        background: rgba(255, 255, 255, 0.3);
    }

    .swatch-lock.locked {
        background: rgba(255, 255, 255, 0.4);
    }

    .tabs {
        display: flex;
        border-bottom: 1px solid var(--border);
        margin-bottom: 16px;
    }

    .tab {
        padding: 8px 16px;
        cursor: pointer;
        font-weight: 500;
        border-bottom: 2px solid transparent;
        transition: all 0.2s;
    }

    .tab.active {
        border-color: var(--primary);
        color: var(--primary);
    }

    .tab-content {
        display: none;
    }

    .tab-content.active {
        display: block;
    }

    .form-group {
        margin-bottom: 16px;
    }

    .form-group label {
        display: block;
        margin-bottom: 8px;
        font-weight: 500;
        font-size: 14px;
    }

    .row {
        display: flex;
        flex-wrap: wrap;
        margin: 0 -10px;
    }

    .col {
        padding: 0 10px;
        flex: 1;
    }

    .slider-container {
        display: flex;
        align-items: center;
        gap: 12px;
    }

    .slider-container input[type="range"] {
        flex: 1;
        -webkit-appearance: none;
        height: 6px;
        background: var(--border);
        border-radius: 3px;
        margin: 0;
    }

    .slider-container input[type="range"]::-webkit-slider-thumb {
        -webkit-appearance: none;
        width: 16px;
        height: 16px;
        background: var(--primary);
        border-radius: 50%;
        cursor: pointer;
    }

    .slider-value {
        width: 40px;
        text-align: center;
        font-size: 14px;
    }

    .palettes-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
        gap: 16px;
    }

    .palette-preview {
        cursor: pointer;
        height: 100px;
        border-radius: 8px;
        overflow: hidden;
        transition: all 0.2s;
        box-shadow: 0 2px 10px var(--shadow);
    }

    .palette-preview:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 15px var(--shadow);
    }

    .palette-name {
        margin-top: 8px;
        font-size: 14px;
        font-weight: 500;
    }

    .saved-palette-item {
        display: flex;
        align-items: center;
        margin-bottom: 12px;
        border-radius: 8px;
        overflow: hidden;
        background: var(--card);
        border: 1px solid var(--border);
        box-shadow: 0 2px 10px var(--shadow);
    }

    .saved-palette-colors {
        display: flex;
        flex-grow: 1;
        height: 50px;
    }

    .saved-palette-color {
        flex: 1;
        min-width: 20px;
    }

    .saved-palette-info {
        padding: 12px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        width: 100%;
    }

    .saved-palette-actions {
        display: flex;
        gap: 8px;
    }

    .toggle-container {
        position: relative;
        display: flex;
        align-items: center;
        gap: 8px;
    }

    .toggle {
        position: relative;
        width: 40px;
        height: 22px;
    }

    .toggle input {
        opacity: 0;
        width: 0;
        height: 0;
    }

    .toggle-slider {
        position: absolute;
        cursor: pointer;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background-color: var(--border);
        transition: .3s;
        border-radius: 34px;
    }

    .toggle-slider:before {
        position: absolute;
        content: "";
        height: 18px;
        width: 18px;
        left: 2px;
        bottom: 2px;
        background-color: white;
        transition: .3s;
        border-radius: 50%;
    }

    input:checked + .toggle-slider {
        background-color: var(--primary);
    }

    input:checked + .toggle-slider:before {
        transform: translateX(18px);
    }

    .toggle-label {
        font-size: 14px;
        font-weight: 500;
    }

    .export-options {
        display: flex;
        gap: 8px;
        flex-wrap: wrap;
    }

    .color-blindness-preview {
        margin-top: 16px;
    }

    .contrast-check {
        margin-top: 16px;
        padding: 16px;
        border: 1px solid var(--border);
        border-radius: 8px;
    }

    .contrast-pair {
        display: flex;
        align-items: center;
        margin-bottom: 12px;
    }

    .contrast-sample {
        width: 100px;
        height: 40px;
        display: flex;
        align-items: center;
        justify-content: center;
        margin-right: 12px;
        border-radius: 4px;
    }

    .contrast-info {
        font-size: 14px;
    }

    .contrast-score {
        font-weight: 600;
        display: inline-block;
        padding: 2px 8px;
        border-radius: 4px;
        margin-left: 8px;
    }

    .pass {
        background: var(--success);
        color: #000;
    }

    .fail {
        background: var(--error);
        color: #fff;
    }

    .swatch-editor {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0, 0, 0, 0.5);
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 1000;
    }

    .editor-content {
        background: var(--card);
        border-radius: 12px;
        width: 90%;
        max-width: 500px;
        padding: 20px;
        box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
    }

    .editor-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
    }

    .editor-title {
        font-size: 18px;
        font-weight: 600;
    }

    .color-formats {
        margin-bottom: 20px;
    }

    .color-format {
        display: flex;
        align-items: center;
        margin-bottom: 8px;
    }

    .format-label {
        width: 50px;
        font-size: 14px;
        color: var(--text-light);
    }

    .format-value {
        flex: 1;
        font-family: monospace;
        padding: 6px 12px;
        background: var(--bg);
        border-radius: 4px;
        cursor: pointer;
    }

    .format-value:hover {
        background-color: rgba(67, 97, 238, 0.1);
    }

    .color-adjustments {
        margin-bottom: 20px;
    }

    .tooltip {
        position: relative;
        display: inline-block;
    }

    .tooltip .tooltiptext {
        visibility: hidden;
        width: 120px;
        background-color: var(--card);
        color: var(--text);
        text-align: center;
        border-radius: 6px;
        padding: 5px;
        position: absolute;
        z-index: 1;
        bottom: 125%;
        left: 50%;
        margin-left: -60px;
        opacity: 0;
        transition: opacity 0.3s;
        box-shadow: 0 2px 10px var(--shadow);
        border: 1px solid var(--border);
        font-size: 12px;
    }

    .tooltip:hover .tooltiptext {
        visibility: visible;
        opacity: 1;
    }

    @media (max-width: 768px) {
        .row {
            flex-direction: column;
        }

        .col {
            width: 100%;
            margin-bottom: 16px;
        }

        .swatch-container {
            flex-direction: column;
        }

        .color-swatch {
            width: 100%;
            height: 80px;
            min-width: auto;
        }

        .export-options {
            flex-direction: column;
        }

        .palettes-grid {
            grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
        }
    }</style>
</head>
<body>
<div class="container">
    <div class="header">
        <div class="logo"><span>ðŸŽ¨</span><span>Palette Craft</span></div>
        <button id="theme-toggle" class="secondary"><span class="material-icons">dark_mode</span></button>
    </div>
    <div class="row">
        <div class="col" style="flex: 2;">
            <div class="card">
                <div class="card-header"><h2 class="card-title">Color Palette</h2>
                    <div class="toggle-container"><span class="toggle-label">Auto Update</span><label
                            class="toggle"><input type="checkbox" id="auto-update" checked><span
                            class="toggle-slider"></span></label></div>
                </div>
                <div class="card-body">
                    <div id="palette-container" class="swatch-container"></div>
                    <div class="export-options">
                        <button id="save-palette-btn"><span class="material-icons">favorite</span>Save Palette</button>
                        <button id="random-palette-btn"><span class="material-icons">shuffle</span>Random</button>
                        <button id="export-btn" class="secondary"><span class="material-icons">download</span>Export
                        </button>
                        <button id="share-btn" class="secondary"><span class="material-icons">share</span>Share</button>
                    </div>
                </div>
            </div>
            <div class="card">
                <div class="card-header"><h2 class="card-title">Palette Analysis</h2></div>
                <div class="card-body">
                    <div class="tabs">
                        <div class="tab active" data-tab="contrast">Contrast Check</div>
                        <div class="tab" data-tab="colorblind">Color Blindness</div>
                        <div class="tab" data-tab="harmony">Harmony</div>
                    </div>
                    <div class="tab-content active" id="contrast-tab">
                        <div id="contrast-check" class="contrast-check"></div>
                    </div>
                    <div class="tab-content" id="colorblind-tab">
                        <div class="color-blindness-preview">
                            <div class="form-group"><label>Simulation Type</label><select id="colorblind-type">
                                <option value="protanopia">Protanopia (red-blind)</option>
                                <option value="deuteranopia">Deuteranopia (green-blind)</option>
                                <option value="tritanopia">Tritanopia (blue-blind)</option>
                                <option value="achromatopsia">Achromatopsia (no color)</option>
                            </select></div>
                            <div id="colorblind-preview" class="swatch-container"></div>
                        </div>
                    </div>
                    <div class="tab-content" id="harmony-tab">
                        <div id="harmony-score"></div>
                        <div id="harmony-suggestions"></div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col" style="flex: 1;">
            <div class="card">
                <div class="card-header"><h2 class="card-title">Generator</h2>
                    <button id="generate-btn"><span class="material-icons">colorize</span>Generate</button>
                </div>
                <div class="card-body">
                    <div class="form-group"><label>Palette Type</label><select id="palette-type">
                        <option value="designer">Designer Palette</option>
                        <option value="brand">Brand Palette</option>
                        <option value="ui">UI System</option>
                        <option value="gradient">Gradient Friendly</option>
                        <option value="accessible">Accessible (WCAG)</option>
                        <option value="monochrome">Monochromatic</option>
                        <option value="analogous">Analogous</option>
                        <option value="complementary">Complementary</option>
                        <option value="triadic">Triadic</option>
                        <option value="tetradic">Tetradic</option>
                        <option value="split">Split Complementary</option>
                        <option value="double-split">Double Split Complementary</option>
                        <option value="square">Square</option>
                    </select></div>
                    <div class="form-group"><label>Base Color</label>
                        <div class="color-input-wrapper" style="display: flex; gap: 8px; align-items: center;"><input
                                type="color" id="base-color" value="#4361ee"
                                style="width: 40px; height: 40px; border: none; background: none; cursor: pointer;"><input
                                type="text" id="color-hex-input" value="#4361ee"
                                style="flex: 1; font-family: monospace;"></div>
                    </div>
                    <div class="form-group"><label for="colors-count">Number of Colors: <span
                            id="colors-count-value">5</span></label>
                        <div class="slider-container"><input type="range" id="colors-count" min="3" max="20"
                                                             value="5"><span id="colors-count-display"
                                                                             class="slider-value">5</span></div>
                    </div>
                    <div class="form-group"><label>Color Distribution</label><select id="distribution-method">
                        <option value="balanced">Balanced</option>
                        <option value="weighted">Weighted to Light</option>
                        <option value="weighted-dark">Weighted to Dark</option>
                        <option value="contrasting">High Contrast</option>
                        <option value="pastel">Pastel</option>
                        <option value="vivid">Vivid</option>
                        <option value="muted">Muted</option>
                    </select></div>
                    <div class="form-group"><label for="saturation-range">Saturation Variance</label>
                        <div class="slider-container"><input type="range" id="saturation-variance" min="0" max="100"
                                                             value="30"><span id="saturation-value"
                                                                              class="slider-value">30%</span></div>
                    </div>
                    <div class="form-group"><label for="brightness-range">Brightness Variance</label>
                        <div class="slider-container"><input type="range" id="brightness-variance" min="0" max="100"
                                                             value="50"><span id="brightness-value"
                                                                              class="slider-value">50%</span></div>
                    </div>
                </div>
            </div>
            <div class="card">
                <div class="card-header"><h2 class="card-title">Saved Palettes</h2></div>
                <div class="card-body">
                    <div id="saved-palettes"></div>
                </div>
            </div>
        </div>
    </div>
</div>
<div id="swatch-editor" class="swatch-editor" style="display: none;">
    <div class="editor-content">
        <div class="editor-header"><h3 class="editor-title">Edit Color</h3>
            <button id="close-editor" class="secondary sm"><span class="material-icons">close</span></button>
        </div>
        <div class="color-formats">
            <div class="color-format"><span class="format-label">HEX</span>
                <div class="format-value" id="editor-hex">#4361EE</div>
            </div>
            <div class="color-format"><span class="format-label">RGB</span>
                <div class="format-value" id="editor-rgb">rgb(67, 97, 238)</div>
            </div>
            <div class="color-format"><span class="format-label">HSL</span>
                <div class="format-value" id="editor-hsl">hsl(230, 83%, 60%)</div>
            </div>
        </div>
        <div class="color-adjustments">
            <div class="form-group"><label for="editor-hue">Hue</label>
                <div class="slider-container"><input type="range" id="editor-hue" min="0" max="360" value="230"><span
                        id="editor-hue-value" class="slider-value">230Â°</span></div>
            </div>
            <div class="form-group"><label for="editor-saturation">Saturation</label>
                <div class="slider-container"><input type="range" id="editor-saturation" min="0" max="100"
                                                     value="83"><span id="editor-saturation-value" class="slider-value">83%</span>
                </div>
            </div>
            <div class="form-group"><label for="editor-lightness">Lightness</label>
                <div class="slider-container"><input type="range" id="editor-lightness" min="0" max="100"
                                                     value="60"><span id="editor-lightness-value" class="slider-value">60%</span>
                </div>
            </div>
        </div>
        <div class="form-group">
            <button id="editor-apply" style="width: 100%;">Apply Changes</button>
        </div>
    </div>
</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/chroma-js/2.4.2/chroma.min.js"></script>
<script>(function () {
    const state = {
        baseColor: '#4361ee',
        paletteType: 'designer',
        colorsCount: 5,
        distribution: 'balanced',
        saturationVariance: 30,
        brightnessVariance: 50,
        autoUpdate: true,
        currentPalette: [],
        lockedColors: {},
        savedPalettes: [],
        activeTab: 'contrast',
        colorblindType: 'protanopia',
        isDarkMode: localStorage.getItem('paletteCraftDarkMode') === 'true' || false,
        currentEditingColor: null
    };

    function init() {
        loadSavedPalettes();
        setupEventListeners();
        applyTheme();
        generatePalette();
    }

    function setupEventListeners() {
        document.getElementById('theme-toggle').addEventListener('click', toggleTheme);
        document.getElementById('base-color').addEventListener('input', handleBaseColorChange);
        document.getElementById('color-hex-input').addEventListener('input', handleHexInputChange);
        document.getElementById('palette-type').addEventListener('change', handleControlChange);
        document.getElementById('colors-count').addEventListener('input', handleColorsCountChange);
        document.getElementById('distribution-method').addEventListener('change', handleControlChange);
        document.getElementById('saturation-variance').addEventListener('input', handleSaturationChange);
        document.getElementById('brightness-variance').addEventListener('input', handleBrightnessChange);
        document.getElementById('generate-btn').addEventListener('click', generatePalette);
        document.getElementById('random-palette-btn').addEventListener('click', generateRandomPalette);
        document.getElementById('auto-update').addEventListener('change', toggleAutoUpdate);
        document.querySelectorAll('.tab').forEach(tab => {
            tab.addEventListener('click', () => {
                switchTab(tab.dataset.tab);
            });
        });
        document.getElementById('colorblind-type').addEventListener('change', updateColorblindPreview);
        document.getElementById('save-palette-btn').addEventListener('click', savePalette);
        document.getElementById('export-btn').addEventListener('click', exportAsCSS);
        document.getElementById('share-btn').addEventListener('click', sharePalette);
        document.getElementById('close-editor').addEventListener('click', closeSwatchEditor);
        document.getElementById('editor-hue').addEventListener('input', updateEditorColor);
        document.getElementById('editor-saturation').addEventListener('input', updateEditorColor);
        document.getElementById('editor-lightness').addEventListener('input', updateEditorColor);
        document.getElementById('editor-apply').addEventListener('click', applyColorEdit);
        document.getElementById('editor-hex').addEventListener('click', copyToClipboard);
        document.getElementById('editor-rgb').addEventListener('click', copyToClipboard);
        document.getElementById('editor-hsl').addEventListener('click', copyToClipboard);
    }

    function handleColorsCountChange(e) {
        state.colorsCount = parseInt(e.target.value);
        document.getElementById('colors-count-display').textContent = state.colorsCount;
        document.getElementById('colors-count-value').textContent = state.colorsCount;
        if (state.autoUpdate) {
            generatePalette();
        }
    }

    function generatePalette() {
        const {baseColor, paletteType, colorsCount, distribution, saturationVariance, brightnessVariance} = state;
        let base = chroma(baseColor);
        let colors = [];
        switch (paletteType) {
            case 'designer':
                colors = generateDesignerPalette(base, colorsCount, distribution);
                break;
            case 'brand':
                colors = generateBrandPalette(base, colorsCount);
                break;
            case 'ui':
                colors = generateUIPalette(base);
                break;
            case 'gradient':
                colors = generateGradientPalette(base, colorsCount);
                break;
            case 'accessible':
                colors = generateAccessiblePalette(base, colorsCount);
                break;
            case 'monochrome':
                colors = generateMonochromePalette(base, colorsCount);
                break;
            case 'analogous':
                colors = generateAnalogousPalette(base, colorsCount);
                break;
            case 'complementary':
                colors = generateComplementaryPalette(base, colorsCount);
                break;
            case 'triadic':
                colors = generateTriadicPalette(base, colorsCount);
                break;
            case 'tetradic':
                colors = generateTetradicPalette(base, colorsCount);
                break;
            case 'split':
                colors = generateSplitComplementaryPalette(base, colorsCount);
                break;
            case 'double-split':
                colors = generateDoubleSplitComplementaryPalette(base, colorsCount);
                break;
            case 'square':
                colors = generateSquarePalette(base, colorsCount);
                break;
            default:
                colors = generateDesignerPalette(base, colorsCount, distribution);
        }
        if (paletteType !== 'ui') {
            colors = applyVariance(colors, saturationVariance, brightnessVariance);
        }
        for (let i = 0; i < colors.length; i++) {
            if (state.lockedColors[i] && i < state.currentPalette.length) {
                colors[i] = state.currentPalette[i];
            }
        }
        state.currentPalette = colors;
        renderPalette();
        updateAnalysis();
    }

    function generateDesignerPalette(baseColor, count, distribution) {
        const hsl = baseColor.hsl();
        const h = hsl[0] || 0;
        switch (distribution) {
            case 'balanced':
                return chroma.scale([chroma.hsl((h + 30) % 360, 0.9, 0.3), baseColor, chroma.hsl((h - 30) % 360, 0.7, 0.7)]).mode('lch').colors(count);
            case 'weighted':
                return chroma.scale([baseColor.set('hsl.l', 0.8), baseColor, baseColor.set('hsl.l', 0.4)]).mode('lch').padding([0.2, 0]).colors(count);
            case 'weighted-dark':
                return chroma.scale([baseColor.set('hsl.l', 0.6), baseColor, baseColor.set('hsl.l', 0.2)]).mode('lch').padding([0, 0.2]).colors(count);
            case 'contrasting':
                const complement = baseColor.set('hsl.h', (h + 180) % 360);
                return chroma.scale([baseColor.set('hsl.l', 0.9), baseColor, complement, complement.set('hsl.l', 0.2)]).mode('lch').colors(count);
            case 'pastel':
                return chroma.scale([chroma.hsl((h + 40) % 360, 0.5, 0.8), chroma.hsl(h, 0.4, 0.8), chroma.hsl((h - 40) % 360, 0.5, 0.8)]).mode('lch').colors(count);
            case 'vivid':
                return chroma.scale([chroma.hsl((h + 60) % 360, 1, 0.5), chroma.hsl(h, 1, 0.5), chroma.hsl((h - 60) % 360, 1, 0.5)]).mode('lch').colors(count);
            case 'muted':
                return chroma.scale([chroma.hsl((h + 30) % 360, 0.3, 0.6), chroma.hsl(h, 0.3, 0.5), chroma.hsl((h - 30) % 360, 0.3, 0.4)]).mode('lch').colors(count);
            default:
                return chroma.scale([baseColor]).colors(count);
        }
    }

    function generateBrandPalette(baseColor, count) {
        const hsl = baseColor.hsl();
        const h = hsl[0] || 0;
        const primary = baseColor;
        const primaryLight = primary.set('hsl.l', '+0.15');
        const primaryDark = primary.set('hsl.l', '-0.15');
        const secondary = chroma.hsl((h + 120) % 360, hsl[1], hsl[2]);
        const secondaryLight = secondary.set('hsl.l', '+0.15');
        const secondaryDark = secondary.set('hsl.l', '-0.15');
        const accent = chroma.hsl((h + 180) % 360, Math.min(hsl[1] + 0.2, 1), hsl[2]);
        const neutral = primary.set('hsl.s', 0.05).set('hsl.l', 0.5);
        const neutralLight = neutral.set('hsl.l', 0.8);
        const neutralDark = neutral.set('hsl.l', 0.2);
        const colors = [primary, primaryLight, primaryDark, secondary, secondaryLight, secondaryDark, accent, neutral, neutralLight, neutralDark];
        return colors.slice(0, count);
    }

    function generateUIPalette(baseColor) {
        const hsl = baseColor.hsl();
        const h = hsl[0] || 0;
        const primary = baseColor;
        const primaryLight = primary.set('hsl.l', '+0.15');
        const primaryDark = primary.set('hsl.l', '-0.15');
        const success = chroma.hsl((h + 100) % 360, 0.75, 0.45);
        const warning = chroma.hsl((h + 40) % 360, 0.85, 0.5);
        const error = chroma.hsl((h + 320) % 360, 0.85, 0.5);
        const info = chroma.hsl((h + 200) % 360, 0.75, 0.5);
        const black = chroma('#212121');
        const darkGray = chroma('#424242');
        const midGray = chroma('#9E9E9E');
        const lightGray = chroma('#E0E0E0');
        const white = chroma('#FFFFFF');
        return [primary, primaryLight, primaryDark, success, warning, error, info, black, darkGray, midGray, lightGray, white];
    }

    function generateGradientPalette(baseColor, count) {
        const hsl = baseColor.hsl();
        const h = hsl[0] || 0;
        const targetHue = (h + 60) % 360;
        const endColor = chroma.hsl(targetHue, hsl[1], hsl[2] - 0.2);
        return chroma.scale([baseColor, endColor]).mode('lch').colors(count);
    }

    function generateAccessiblePalette(baseColor, count) {
        const background = chroma('#ffffff');
        const darkBackground = chroma('#222222');
        let colors = [];
        const baseContrast = chroma.contrast(baseColor, background);
        let mainColor = baseColor;
        if (baseContrast < 4.5) {
            const hsl = baseColor.hsl();
            mainColor = chroma.hsl(hsl[0], hsl[1], hsl[2] > 0.5 ? 0.4 : 0.6);
        }
        colors.push(mainColor);
        const h = mainColor.hsl()[0] || 0;
        let secondaryColor = chroma.hsl((h + 180) % 360, mainColor.hsl()[1], mainColor.hsl()[2]);
        if (chroma.contrast(secondaryColor, background) < 4.5) {
            secondaryColor = secondaryColor.set('hsl.l', secondaryColor.get('hsl.l') > 0.5 ? 0.4 : 0.6);
        }
        colors.push(secondaryColor);
        const textColor = chroma.hsl(h, 0.3, 0.2);
        colors.push(textColor);
        const lightColor = chroma.hsl(h, 0.1, 0.9);
        colors.push(lightColor);
        const midGray = chroma.hsl(h, 0.05, 0.5);
        colors.push(midGray);
        while (colors.length < count) {
            const index = colors.length % 2;
            const baseCol = colors[index];
            colors.push(baseCol.set('hsl.l', baseCol.get('hsl.l') > 0.5 ? '-0.2' : '+0.2'));
        }
        return colors.slice(0, count);
    }

    function generateMonochromePalette(baseColor, count) {
        const hsl = baseColor.hsl();
        const colors = [];
        for (let i = 0; i < count; i++) {
            const lightness = 0.9 - (i / (count - 1)) * 0.7;
            const saturation = hsl[1] * (1 - (i % 3) * 0.2);
            colors.push(chroma.hsl(hsl[0], saturation, lightness));
        }
        return colors;
    }

    function generateAnalogousPalette(baseColor, count) {
        const hsl = baseColor.hsl();
        const h = hsl[0] || 0;
        const hueRange = 60;
        const hueStep = hueRange / (count - 1);
        const colors = [];
        for (let i = 0; i < count; i++) {
            const hue = (h - hueRange / 2 + hueStep * i + 360) % 360;
            colors.push(chroma.hsl(hue, hsl[1], hsl[2]));
        }
        return colors;
    }

    function generateComplementaryPalette(baseColor, count) {
        const hsl = baseColor.hsl();
        const h = hsl[0] || 0;
        const complement = (h + 180) % 360;
        return chroma.scale([baseColor, chroma.hsl(complement, hsl[1], hsl[2])]).mode('lch').colors(count);
    }

    function generateTriadicPalette(baseColor, count) {
        const hsl = baseColor.hsl();
        const h = hsl[0] || 0;
        const hue1 = h;
        const hue2 = (h + 120) % 360;
        const hue3 = (h + 240) % 360;
        const colors = [baseColor, chroma.hsl(hue2, hsl[1], hsl[2]), chroma.hsl(hue3, hsl[1], hsl[2])];
        if (count > 3) {
            return chroma.scale(colors).mode('lch').colors(count);
        }
        return colors.slice(0, count);
    }

    function generateTetradicPalette(baseColor, count) {
        const hsl = baseColor.hsl();
        const h = hsl[0] || 0;
        const hue1 = h;
        const hue2 = (h + 60) % 360;
        const hue3 = (h + 180) % 360;
        const hue4 = (h + 240) % 360;
        const colors = [baseColor, chroma.hsl(hue2, hsl[1], hsl[2]), chroma.hsl(hue3, hsl[1], hsl[2]), chroma.hsl(hue4, hsl[1], hsl[2])];
        if (count > 4) {
            return chroma.scale(colors).mode('lch').colors(count);
        }
        return colors.slice(0, count);
    }

    function generateSplitComplementaryPalette(baseColor, count) {
        const hsl = baseColor.hsl();
        const h = hsl[0] || 0;
        const hue1 = h;
        const hue2 = (h + 150) % 360;
        const hue3 = (h + 210) % 360;
        const colors = [baseColor, chroma.hsl(hue2, hsl[1], hsl[2]), chroma.hsl(hue3, hsl[1], hsl[2])];
        if (count > 3) {
            return chroma.scale(colors).mode('lch').colors(count);
        }
        return colors.slice(0, count);
    }

    function generateDoubleSplitComplementaryPalette(baseColor, count) {
        const hsl = baseColor.hsl();
        const h = hsl[0] || 0;
        const hue1 = h;
        const hue2 = (h + 30) % 360;
        const hue3 = (h + 150) % 360;
        const hue4 = (h + 180) % 360;
        const hue5 = (h + 210) % 360;
        const colors = [baseColor, chroma.hsl(hue2, hsl[1], hsl[2]), chroma.hsl(hue3, hsl[1], hsl[2]), chroma.hsl(hue4, hsl[1], hsl[2]), chroma.hsl(hue5, hsl[1], hsl[2])];
        if (count > 5) {
            return chroma.scale(colors).mode('lch').colors(count);
        }
        return colors.slice(0, count);
    }

    function generateSquarePalette(baseColor, count) {
        const hsl = baseColor.hsl();
        const h = hsl[0] || 0;
        const hue1 = h;
        const hue2 = (h + 90) % 360;
        const hue3 = (h + 180) % 360;
        const hue4 = (h + 270) % 360;
        const colors = [baseColor, chroma.hsl(hue2, hsl[1], hsl[2]), chroma.hsl(hue3, hsl[1], hsl[2]), chroma.hsl(hue4, hsl[1], hsl[2])];
        if (count > 4) {
            return chroma.scale(colors).mode('lch').colors(count);
        }
        return colors.slice(0, count);
    }

    function applyVariance(colors, satVar, brightVar) {
        if (satVar === 0 && brightVar === 0) return colors;
        return colors.map((color, i) => {
            // Ensure color is a chroma object
            const chromaColor = typeof color === 'string' ? chroma(color) : color;
            const hsl = chromaColor.hsl();
            const satChange = (satVar / 100) * Math.sin(i * Math.PI / colors.length);
            const brightChange = (brightVar / 100) * Math.cos(i * Math.PI / colors.length);
            const newSat = Math.max(0, Math.min(1, hsl[1] + satChange));
            const newLight = Math.max(0.1, Math.min(0.9, hsl[2] + brightChange));
            return chroma.hsl(hsl[0], newSat, newLight);
        });
    }

    function generateRandomPalette() {
        const randomHue = Math.floor(Math.random() * 360);
        const randomSat = 0.7 + Math.random() * 0.3;
        const randomLight = 0.4 + Math.random() * 0.3;
        const randomColor = chroma.hsl(randomHue, randomSat, randomLight);
        document.getElementById('base-color').value = randomColor.hex();
        document.getElementById('color-hex-input').value = randomColor.hex();
        state.baseColor = randomColor.hex();
        const paletteTypes = ['designer', 'brand', 'monochrome', 'analogous', 'complementary', 'triadic', 'tetradic', 'split'];
        const randomType = paletteTypes[Math.floor(Math.random() * paletteTypes.length)];
        document.getElementById('palette-type').value = randomType;
        state.paletteType = randomType;
        if (randomType === 'designer') {
            const distributions = ['balanced', 'weighted', 'weighted-dark', 'contrasting', 'pastel', 'vivid', 'muted'];
            const randomDist = distributions[Math.floor(Math.random() * distributions.length)];
            document.getElementById('distribution-method').value = randomDist;
            state.distribution = randomDist;
        }
        generatePalette();
    }

    function renderPalette() {
        const container = document.getElementById('palette-container');
        let html = '';
        state.currentPalette.forEach((color, index) => {
            const isLocked = state.lockedColors[index] || false;
            const hex = color.hex();
            const rgb = color.css();
            const hsl = color.css('hsl');
            const textColor = color.luminance() > 0.5 ? '#000' : '#fff';
            html += `<div class="color-swatch" data-index="${index}" data-color="${hex}"><div class="swatch-inner" style="background-color: ${hex}"><div class="color-tools"><div class="swatch-lock ${isLocked ? 'locked' : ''}" data-index="${index}"><span class="material-icons" style="color: ${textColor}; font-size: 16px;">${isLocked ? 'lock' : 'lock_open'}</span></div><div class="swatch-copy" data-color="${hex}"><span class="material-icons" style="color: ${textColor}; font-size: 16px;">content_copy</span></div></div><span class="color-hex" style="color: ${textColor}">${hex}</span><span class="color-info" style="color: ${textColor}">${Math.round(color.hsl()[0] || 0)}Â° ${Math.round(color.hsl()[1] * 100)}% ${Math.round(color.hsl()[2] * 100)}%</span></div></div>`;
        });
        container.innerHTML = html;
        document.querySelectorAll('.swatch-lock').forEach(el => {
            el.addEventListener('click', (e) => {
                e.stopPropagation();
                const index = parseInt(el.dataset.index);
                state.lockedColors[index] = !state.lockedColors[index];
                renderPalette();
            })
        });
        document.querySelectorAll('.swatch-copy').forEach(el => {
            el.addEventListener('click', (e) => {
                e.stopPropagation();
                const color = el.dataset.color;
                copyToClipboard(color);
                showToast(`Copied ${color}`);
            })
        });
        document.querySelectorAll('.color-swatch').forEach(el => {
            el.addEventListener('click', () => {
                const index = parseInt(el.dataset.index);
                const color = state.currentPalette[index];
                openSwatchEditor(color, index);
            })
        });
        updateColorblindPreview();
    }

    function updateAnalysis() {
        updateContrastCheck();
        updateColorblindPreview();
    }

    function updateContrastCheck() {
        const container = document.getElementById('contrast-check');
        let html = '<h3 style="margin-bottom: 16px;">Text Contrast Ratios (WCAG)</h3>';
        const backgrounds = state.currentPalette;
        const foregrounds = state.currentPalette;
        html += '<div style="max-height: 300px; overflow-y: auto;">';
        backgrounds.forEach((bg, bgIndex) => {
            foregrounds.forEach((fg, fgIndex) => {
                if (bgIndex !== fgIndex) {
                    const ratio = chroma.contrast(bg, fg).toFixed(2);
                    const passesAA = ratio >= 4.5;
                    const passesAAA = ratio >= 7;
                    const bgHex = bg.hex();
                    const fgHex = fg.hex();
                    html += `<div class="contrast-pair"><div class="contrast-sample" style="background-color: ${bgHex};"><span style="color: ${fgHex};">Sample</span></div><div class="contrast-info">${fgHex} on ${bgHex}<span class="contrast-score ${passesAA ? 'pass' : 'fail'}">${ratio} ${passesAAA ? '(AAA)' : passesAA ? '(AA)' : '(Fails)'}</span></div></div>`;
                }
            });
        });
        html += '</div>';
        container.innerHTML = html;
    }

    function updateColorblindPreview() {
        const container = document.getElementById('colorblind-preview');
        const type = document.getElementById('colorblind-type').value;
        state.colorblindType = type;
        let html = '';
        state.currentPalette.forEach((color, index) => {
            const hex = color.hex();
            const simulatedColor = simulateColorBlindness(color, type);
            const textColor = simulatedColor.luminance() > 0.5 ? '#000' : '#fff';
            html += `<div class="color-swatch"><div class="swatch-inner" style="background-color: ${simulatedColor.hex()}"><span class="color-hex" style="color: ${textColor}">${simulatedColor.hex()}</span><span class="color-info" style="color: ${textColor}">Original: ${hex}</span></div></div>`;
        });
        container.innerHTML = html;
    }

    function simulateColorBlindness(color, type) {
        const rgb = color.rgb();
        switch (type) {
            case 'protanopia':
                return chroma.rgb(0.567 * rgb[1] + 0.433 * rgb[2], 0.558 * rgb[0] + 0.442 * rgb[1], 0.242 * rgb[0] + 0.758 * rgb[2]);
            case 'deuteranopia':
                return chroma.rgb(0.625 * rgb[0] + 0.375 * rgb[2], 0.7 * rgb[0] + 0.3 * rgb[2], 0.3 * rgb[0] + 0.7 * rgb[2]);
            case 'tritanopia':
                return chroma.rgb(0.95 * rgb[0] + 0.05 * rgb[1], 0.433 * rgb[0] + 0.567 * rgb[1], 0.475 * rgb[0] + 0.525 * rgb[1]);
            case 'achromatopsia':
                const gray = 0.299 * rgb[0] + 0.587 * rgb[1] + 0.114 * rgb[2];
                return chroma.rgb(gray, gray, gray);
            default:
                return color;
        }
    }

    function savePalette() {
        const paletteName = prompt('Enter a name for this palette:', `Palette ${state.savedPalettes.length + 1}`);
        if (!paletteName) return;
        const newPalette = {id: Date.now(), name: paletteName, colors: state.currentPalette.map(c => c.hex())};
        state.savedPalettes.push(newPalette);
        localStorage.setItem('savedPalettes', JSON.stringify(state.savedPalettes));
        renderSavedPalettes();
        showToast('Palette saved!');
    }

    function loadSavedPalettes() {
        const saved = localStorage.getItem('savedPalettes');
        if (saved) {
            state.savedPalettes = JSON.parse(saved);
            renderSavedPalettes();
        }
    }

    function renderSavedPalettes() {
        const container = document.getElementById('saved-palettes');
        if (state.savedPalettes.length === 0) {
            container.innerHTML = '<p>No saved palettes yet. Create some!</p>';
            return;
        }
        let html = '';
        state.savedPalettes.forEach(palette => {
            html += `<div class="saved-palette-item"><div class="saved-palette-colors">${palette.colors.map(color => `<div class="saved-palette-color" style="background-color: ${color}"></div>`).join('')}</div><div class="saved-palette-info"><span>${palette.name}</span><div class="saved-palette-actions"><button class="secondary sm load-palette-btn" data-id="${palette.id}"><span class="material-icons">refresh</span></button><button class="secondary sm delete-palette-btn" data-id="${palette.id}"><span class="material-icons">delete</span></button></div></div></div>`;
        });
        container.innerHTML = html;
        document.querySelectorAll('.load-palette-btn').forEach(btn => {
            btn.addEventListener('click', loadPalette);
        });
        document.querySelectorAll('.delete-palette-btn').forEach(btn => {
            btn.addEventListener('click', deletePalette);
        });
    }

    function loadPalette(e) {
        const id = parseInt(e.currentTarget.dataset.id);
        const palette = state.savedPalettes.find(p => p.id === id);
        if (palette) {
            state.currentPalette = palette.colors.map(c => chroma(c));
            state.baseColor = palette.colors[0];
            state.lockedColors = {};
            document.getElementById('base-color').value = state.baseColor;
            document.getElementById('color-hex-input').value = state.baseColor;
            renderPalette();
            updateAnalysis();
            showToast(`Loaded palette: ${palette.name}`);
        }
    }

    function deletePalette(e) {
        if (!confirm('Are you sure you want to delete this palette?')) return;
        const id = parseInt(e.currentTarget.dataset.id);
        state.savedPalettes = state.savedPalettes.filter(p => p.id !== id);
        localStorage.setItem('savedPalettes', JSON.stringify(state.savedPalettes));
        renderSavedPalettes();
        showToast('Palette deleted');
    }

    function showToast(message) {
        const toast = document.createElement('div');
        toast.style.position = 'fixed';
        toast.style.bottom = '20px';
        toast.style.left = '50%';
        toast.style.transform = 'translateX(-50%)';
        toast.style.backgroundColor = 'rgba(0,0,0,0.8)';
        toast.style.color = 'white';
        toast.style.padding = '10px 20px';
        toast.style.borderRadius = '4px';
        toast.style.zIndex = '1000';
        toast.textContent = message;
        document.body.appendChild(toast);
        setTimeout(() => {
            toast.style.opacity = '0';
            toast.style.transition = 'opacity 0.5s';
            setTimeout(() => {
                document.body.removeChild(toast);
            }, 500);
        }, 3000);
    }

    function handleBaseColorChange(e) {
        const color = e.target.value;
        document.getElementById('color-hex-input').value = color;
        state.baseColor = color;
        if (state.autoUpdate) {
            generatePalette();
        }
    }

    function handleHexInputChange(e) {
        let color = e.target.value;
        if (color[0] !== '#') {
            color = '#' + color;
        }
        if (/^#[0-9A-F]{6}$/i.test(color)) {
            document.getElementById('base-color').value = color;
            state.baseColor = color;
            if (state.autoUpdate) {
                generatePalette();
            }
        }
    }

    function handleControlChange() {
        state.paletteType = document.getElementById('palette-type').value;
        state.distribution = document.getElementById('distribution-method').value;
        if (state.autoUpdate) {
            generatePalette();
        }
    }

    function handleSaturationChange(e) {
        state.saturationVariance = parseInt(e.target.value);
        document.getElementById('saturation-value').textContent = state.saturationVariance + '%';
        if (state.autoUpdate) {
            generatePalette();
        }
    }

    function handleBrightnessChange(e) {
        state.brightnessVariance = parseInt(e.target.value);
        document.getElementById('brightness-value').textContent = state.brightnessVariance + '%';
        if (state.autoUpdate) {
            generatePalette();
        }
    }

    function toggleAutoUpdate(e) {
        state.autoUpdate = e.target.checked;
    }

    function switchTab(tabId) {
        state.activeTab = tabId;
        document.querySelectorAll('.tab').forEach(tab => {
            tab.classList.toggle('active', tab.dataset.tab === tabId);
        });
        document.querySelectorAll('.tab-content').forEach(content => {
            content.classList.toggle('active', content.id === tabId + '-tab');
        });
    }

    function sharePalette() {
        const colors = state.currentPalette.map(c => c.hex().substring(1)).join('-');
        const url = `${window.location.origin}${window.location.pathname}?colors=${colors}`;
        navigator.clipboard.writeText(url).then(() => {
            showToast('Shareable link copied to clipboard!');
        }).catch(err => {
            console.error('Could not copy: ', err);
            showToast('Failed to copy link.');
        });
    }

    function exportAsCSS() {
        let css = `:root {\n`;
        state.currentPalette.forEach((color, i) => {
            css += `  --color-${i + 1}: ${color.hex()};\n`;
        });
        if (state.paletteType === 'brand') {
            css += `  --color-primary: ${state.currentPalette[0].hex()};\n`;
            css += `  --color-primary-light: ${state.currentPalette[1].hex()};\n`;
            css += `  --color-primary-dark: ${state.currentPalette[2].hex()};\n`;
            if (state.currentPalette.length > 3) {
                css += `  --color-secondary: ${state.currentPalette[3].hex()};\n`;
            }
            if (state.currentPalette.length > 6) {
                css += `  --color-accent: ${state.currentPalette[6].hex()};\n`;
            }
        } else if (state.paletteType === 'ui') {
            css += `  --color-primary: ${state.currentPalette[0].hex()};\n`;
            css += `  --color-success: ${state.currentPalette[3].hex()};\n`;
            css += `  --color-warning: ${state.currentPalette[4].hex()};\n`;
            css += `  --color-error: ${state.currentPalette[5].hex()};\n`;
            css += `  --color-info: ${state.currentPalette[6].hex()};\n`;
        }
        css += `}\n\n`;
        state.currentPalette.forEach((color, i) => {
            css += `.bg-color-${i + 1} { background-color: ${color.hex()}; }\n`;
            css += `.text-color-${i + 1} { color: ${color.hex()}; }\n`;
        });
        const blob = new Blob([css], {type: 'text/css'});
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = 'palette-craft-colors.css';
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
    }

    function toggleTheme() {
        state.isDarkMode = !state.isDarkMode;
        applyTheme();
        localStorage.setItem('paletteCraftDarkMode', state.isDarkMode);
    }

    function applyTheme() {
        document.body.classList.toggle('dark-mode', state.isDarkMode);
        const icon = state.isDarkMode ? 'light_mode' : 'dark_mode';
        document.getElementById('theme-toggle').innerHTML = `<span class="material-icons">${icon}</span>`;
    }

    function openSwatchEditor(color, index) {
        state.currentEditingColor = {color, index};
        const hsl = color.hsl();
        const h = Math.round(hsl[0] || 0);
        const s = Math.round(hsl[1] * 100);
        const l = Math.round(hsl[2] * 100);
        document.getElementById('editor-hex').textContent = color.hex();
        document.getElementById('editor-rgb').textContent = color.css();
        document.getElementById('editor-hsl').textContent = `hsl(${h}, ${s}%, ${l}%)`;
        document.getElementById('editor-hue').value = h;
        document.getElementById('editor-hue-value').textContent = `${h}Â°`;
        document.getElementById('editor-saturation').value = s;
        document.getElementById('editor-saturation-value').textContent = `${s}%`;
        document.getElementById('editor-lightness').value = l;
        document.getElementById('editor-lightness-value').textContent = `${l}%`;
        document.getElementById('swatch-editor').style.display = 'flex';
    }

    function closeSwatchEditor() {
        document.getElementById('swatch-editor').style.display = 'none';
        state.currentEditingColor = null;
    }

    function updateEditorColor() {
        const h = parseInt(document.getElementById('editor-hue').value);
        const s = parseInt(document.getElementById('editor-saturation').value);
        const l = parseInt(document.getElementById('editor-lightness').value);
        document.getElementById('editor-hue-value').textContent = `${h}Â°`;
        document.getElementById('editor-saturation-value').textContent = `${s}%`;
        document.getElementById('editor-lightness-value').textContent = `${l}%`;
        const newColor = chroma.hsl(h, s / 100, l / 100);
        document.getElementById('editor-hex').textContent = newColor.hex();
        document.getElementById('editor-rgb').textContent = newColor.css();
        document.getElementById('editor-hsl').textContent = `hsl(${h}, ${s}%, ${l}%)`;
    }

    function applyColorEdit() {
        if (!state.currentEditingColor) return;
        const h = parseInt(document.getElementById('editor-hue').value);
        const s = parseInt(document.getElementById('editor-saturation').value);
        const l = parseInt(document.getElementById('editor-lightness').value);
        const newColor = chroma.hsl(h, s / 100, l / 100);
        const index = state.currentEditingColor.index;
        state.lockedColors[index] = true;
        state.currentPalette[index] = newColor;
        closeSwatchEditor();
        renderPalette();
        updateAnalysis();
    }

    function copyToClipboard(e) {
        let text;
        if (typeof e === 'string') {
            text = e;
        } else {
            text = e.target.textContent;
        }
        navigator.clipboard.writeText(text).then(() => {
            showToast(`Copied ${text}`);
        }).catch(err => {
            console.error('Failed to copy: ', err);
            showToast('Failed to copy text');
        });
    }

    init();
})();</script>
<script src="../logo.js"></script>
</body>
</html>