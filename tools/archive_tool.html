<!DOCTYPE html>
<html lang="en">
<head>
    <script src="coi-serviceworker.min.js"></script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <meta name="description" content="Extract and create ZIP, TAR, TAR.GZ, 7Z, RAR, and ISO archives directly in your browser. No uploads, no installations - fast, private, and free.">
    <meta name="keywords" content="archive tool, zip extractor, tar extractor, unzip online, create zip, compress files, extract archive, browser tool, file compression">
    <meta name="author" content="Claude Opus 4.5 prompted by Tobias Müller">
    <meta name="robots" content="index, follow">
    <link rel="canonical" href="https://www.gptgames.dev/tools/archive_tool.html">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://www.gptgames.dev/tools/archive_tool.html">
    <meta property="og:title" content="Archive Tool - Extract & Create Archives in Browser">
    <meta property="og:description" content="Extract and create ZIP, TAR, TAR.GZ, 7Z, RAR, and ISO archives directly in your browser. No uploads, no installations - fast, private, and free.">
    <meta property="og:image" content="https://www.gptgames.dev/screenshots/screenshot_243.webp">
    <meta property="og:site_name" content="GPT Games">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:url" content="https://www.gptgames.dev/tools/archive_tool.html">
    <meta name="twitter:title" content="Archive Tool - Extract & Create Archives in Browser">
    <meta name="twitter:description" content="Extract and create ZIP, TAR, TAR.GZ, 7Z, RAR, and ISO archives directly in your browser. No uploads, no installations - fast, private, and free.">
    <meta name="twitter:image" content="https://www.gptgames.dev/screenshots/screenshot_243.webp">
    <title>Archive Tool</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pako/2.1.0/pako.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box
        }

        :root {
            --bg: #f8f9fb;
            --bg2: #fff;
            --bg3: #eef1f5;
            --text: #111827;
            --text2: #4b5563;
            --text3: #9ca3af;
            --primary: #2563eb;
            --primary-hover: #1d4ed8;
            --primary-light: #eff6ff;
            --border: #e5e7eb;
            --success: #059669;
            --warning: #d97706;
            --danger: #dc2626;
            --radius: 8px;
            --shadow: 0 1px 3px rgba(0, 0, 0, 0.08)
        }

        @media (prefers-color-scheme: dark) {
            :root {
                --bg: #0f1117;
                --bg2: #1a1d27;
                --bg3: #252936;
                --text: #f3f4f6;
                --text2: #9ca3af;
                --text3: #6b7280;
                --primary: #3b82f6;
                --primary-hover: #2563eb;
                --primary-light: #1e3a5f;
                --border: #2d3140;
                --shadow: 0 1px 3px rgba(0, 0, 0, 0.3)
            }
        }

        body {
            font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: var(--bg);
            color: var(--text);
            min-height: 100vh;
            padding: 24px 16px;
            line-height: 1.5
        }

        .container {
            max-width: 920px;
            margin: 0 auto
        }

        header {
            margin-bottom: 24px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            flex-wrap: wrap;
            gap: 16px
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 12px
        }

        .logo-icon {
            width: 44px;
            height: 44px;
            background: var(--primary);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #fff;
            font-size: 1.25rem
        }

        .logo h1 {
            font-size: 1.25rem;
            font-weight: 600;
            letter-spacing: -0.02em
        }

        .logo p {
            font-size: 0.8rem;
            color: var(--text2);
            margin-top: 1px
        }

        .tabs {
            display: flex;
            background: var(--bg2);
            border-radius: var(--radius);
            padding: 4px;
            border: 1px solid var(--border)
        }

        .tab {
            padding: 10px 20px;
            border: none;
            background: transparent;
            color: var(--text2);
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.875rem;
            font-weight: 500;
            transition: all 0.15s;
            display: flex;
            align-items: center;
            gap: 8px
        }

        .tab:hover {
            color: var(--text)
        }

        .tab.active {
            background: var(--primary);
            color: #fff
        }

        .card {
            background: var(--bg2);
            border-radius: var(--radius);
            border: 1px solid var(--border);
            margin-bottom: 16px;
            box-shadow: var(--shadow);
            overflow: hidden
        }

        .card-header {
            padding: 14px 20px;
            border-bottom: 1px solid var(--border);
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 12px;
            flex-wrap: wrap;
            background: var(--bg)
        }

        .card-title {
            font-size: 0.875rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px
        }

        .card-title i {
            color: var(--primary)
        }

        .card-body {
            padding: 20px
        }

        .dropzone {
            border: 2px dashed var(--border);
            border-radius: var(--radius);
            padding: 48px 24px;
            text-align: center;
            transition: all 0.2s;
            cursor: pointer;
            background: var(--bg)
        }

        .dropzone:hover, .dropzone.dragover {
            border-color: var(--primary);
            background: var(--primary-light)
        }

        .dropzone-icon {
            width: 64px;
            height: 64px;
            background: var(--primary-light);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 16px;
            color: var(--primary);
            font-size: 1.5rem;
            transition: transform 0.2s
        }

        .dropzone:hover .dropzone-icon {
            transform: scale(1.05)
        }

        .dropzone h3 {
            font-size: 1rem;
            font-weight: 600;
            margin-bottom: 6px
        }

        .dropzone p {
            color: var(--text2);
            font-size: 0.875rem
        }

        .formats {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
            justify-content: center;
            margin-top: 16px
        }

        .formats span {
            padding: 4px 10px;
            background: var(--bg3);
            border-radius: 4px;
            font-size: 0.7rem;
            color: var(--text2);
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.02em
        }

        .file-input {
            display: none
        }

        .search-bar {
            position: relative;
            flex: 1;
            max-width: 240px
        }

        .search-bar input {
            width: 100%;
            padding: 8px 12px 8px 36px;
            border: 1px solid var(--border);
            border-radius: 6px;
            background: var(--bg2);
            color: var(--text);
            font-size: 0.875rem
        }

        .search-bar input:focus {
            outline: none;
            border-color: var(--primary)
        }

        .search-bar i {
            position: absolute;
            left: 12px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--text3);
            font-size: 0.875rem
        }

        .stats {
            display: flex;
            gap: 16px;
            font-size: 0.8rem;
            color: var(--text2)
        }

        .stats span {
            display: flex;
            align-items: center;
            gap: 6px
        }

        .file-list {
            max-height: 400px;
            overflow-y: auto
        }

        .file-table {
            width: 100%;
            border-collapse: collapse
        }

        .file-table th {
            text-align: left;
            padding: 10px 16px;
            font-size: 0.75rem;
            font-weight: 600;
            color: var(--text2);
            text-transform: uppercase;
            letter-spacing: 0.03em;
            border-bottom: 1px solid var(--border);
            background: var(--bg);
            position: sticky;
            top: 0;
            z-index: 1;
            user-select: none
        }

        .file-table th.sortable {
            cursor: pointer
        }

        .file-table th.sortable:hover {
            color: var(--text)
        }

        .file-table th i {
            margin-left: 4px;
            font-size: 0.65rem;
            opacity: 0.5
        }

        .file-table th.sorted i {
            opacity: 1
        }

        .file-table td {
            padding: 10px 16px;
            border-bottom: 1px solid var(--border);
            font-size: 0.875rem
        }

        .file-table tr:last-child td {
            border-bottom: none
        }

        .file-table tbody tr {
            transition: background 0.1s
        }

        .file-table tbody tr:hover td {
            background: var(--bg)
        }

        .file-table tbody tr.selected td {
            background: var(--primary-light)
        }

        .file-name {
            display: flex;
            align-items: center;
            gap: 10px;
            word-break: break-all
        }

        .file-name i {
            color: var(--text3);
            width: 18px;
            text-align: center;
            flex-shrink: 0
        }

        .file-name i.fa-folder {
            color: var(--warning)
        }

        .file-name .path {
            color: var(--text3);
            font-size: 0.8rem
        }

        .file-size {
            color: var(--text2);
            white-space: nowrap;
            text-align: right;
            font-variant-numeric: tabular-nums
        }

        .file-actions {
            text-align: right;
            white-space: nowrap
        }

        .file-actions button {
            padding: 6px 8px;
            border: none;
            background: transparent;
            color: var(--text3);
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.8rem;
            transition: all 0.1s
        }

        .file-actions button:hover {
            background: var(--bg3);
            color: var(--primary)
        }

        .file-actions button.remove:hover {
            color: var(--danger)
        }

        .select-cell {
            width: 40px;
            text-align: center
        }

        .select-cell input {
            width: 16px;
            height: 16px;
            cursor: pointer;
            accent-color: var(--primary)
        }

        .toolbar {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            padding: 14px 20px;
            border-top: 1px solid var(--border);
            background: var(--bg);
            align-items: center
        }

        .btn {
            padding: 9px 16px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.875rem;
            font-weight: 500;
            transition: all 0.15s;
            display: inline-flex;
            align-items: center;
            gap: 8px
        }

        .btn-primary {
            background: var(--primary);
            color: #fff
        }

        .btn-primary:hover:not(:disabled) {
            background: var(--primary-hover)
        }

        .btn-secondary {
            background: var(--bg3);
            color: var(--text)
        }

        .btn-secondary:hover:not(:disabled) {
            background: var(--border)
        }

        .btn-ghost {
            background: transparent;
            color: var(--text2)
        }

        .btn-ghost:hover:not(:disabled) {
            background: var(--bg3);
            color: var(--text)
        }

        .btn-danger {
            background: transparent;
            color: var(--danger)
        }

        .btn-danger:hover:not(:disabled) {
            background: rgba(220, 38, 38, 0.1)
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed
        }

        .btn-sm {
            padding: 6px 12px;
            font-size: 0.8rem
        }

        .archive-header {
            display: flex;
            align-items: center;
            gap: 14px;
            padding: 16px 20px;
            background: var(--bg)
        }

        .archive-icon {
            width: 48px;
            height: 48px;
            background: var(--primary-light);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--primary);
            font-size: 1.25rem
        }

        .archive-details h3 {
            font-size: 0.95rem;
            font-weight: 600;
            margin-bottom: 2px;
            display: flex;
            align-items: center;
            gap: 8px
        }

        .archive-details p {
            font-size: 0.8rem;
            color: var(--text2)
        }

        .archive-badge {
            font-size: 0.65rem;
            padding: 2px 6px;
            background: var(--bg3);
            border-radius: 4px;
            color: var(--text2);
            font-weight: 600;
            text-transform: uppercase
        }

        .create-options {
            display: flex;
            gap: 12px;
            align-items: flex-end;
            flex: 1;
            flex-wrap: wrap
        }

        .form-group {
            display: flex;
            flex-direction: column;
            gap: 4px
        }

        .form-group label {
            font-size: 0.75rem;
            color: var(--text2);
            font-weight: 500
        }

        .form-group input, .form-group select {
            padding: 8px 12px;
            border: 1px solid var(--border);
            border-radius: 6px;
            background: var(--bg2);
            color: var(--text);
            font-size: 0.875rem
        }

        .form-group input:focus, .form-group select:focus {
            outline: none;
            border-color: var(--primary)
        }

        .compression-group {
            display: flex;
            align-items: center;
            gap: 10px
        }

        .compression-group input[type=range] {
            width: 80px;
            accent-color: var(--primary)
        }

        .compression-group span {
            font-size: 0.8rem;
            color: var(--text2);
            min-width: 20px
        }

        .progress-container {
            padding: 0 20px 14px;
            display: none
        }

        .progress-container.active {
            display: block
        }

        .progress-bar {
            height: 4px;
            background: var(--bg3);
            border-radius: 2px;
            overflow: hidden
        }

        .progress-bar .fill {
            height: 100%;
            background: var(--primary);
            transition: width 0.15s;
            width: 0
        }

        .progress-text {
            font-size: 0.8rem;
            color: var(--text2);
            margin-top: 8px;
            display: flex;
            justify-content: space-between
        }

        .toast {
            position: fixed;
            bottom: 24px;
            right: 24px;
            padding: 14px 18px;
            background: var(--bg2);
            border: 1px solid var(--border);
            border-radius: var(--radius);
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 0.875rem;
            transform: translateY(100px);
            opacity: 0;
            transition: all 0.25s;
            z-index: 1000;
            max-width: 360px
        }

        .toast.show {
            transform: translateY(0);
            opacity: 1
        }

        .toast.success {
            border-left: 3px solid var(--success)
        }

        .toast.success i {
            color: var(--success)
        }

        .toast.error {
            border-left: 3px solid var(--danger)
        }

        .toast.error i {
            color: var(--danger)
        }

        .toast.warning {
            border-left: 3px solid var(--warning)
        }

        .toast.warning i {
            color: var(--warning)
        }

        .empty-state {
            text-align: center;
            padding: 48px 24px;
            color: var(--text2)
        }

        .empty-state i {
            font-size: 2.5rem;
            margin-bottom: 14px;
            opacity: 0.3
        }

        .empty-state p {
            font-size: 0.9rem
        }

        .modal-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1001;
            opacity: 0;
            visibility: hidden;
            transition: all 0.2s;
            backdrop-filter: blur(2px)
        }

        .modal-overlay.show {
            opacity: 1;
            visibility: visible
        }

        .modal {
            background: var(--bg2);
            border-radius: var(--radius);
            width: 90%;
            max-width: 720px;
            max-height: 85vh;
            display: flex;
            flex-direction: column;
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.25);
            transform: scale(0.95);
            transition: transform 0.2s
        }

        .modal-overlay.show .modal {
            transform: scale(1)
        }

        .modal-header {
            padding: 16px 20px;
            border-bottom: 1px solid var(--border);
            display: flex;
            align-items: center;
            justify-content: space-between
        }

        .modal-header h3 {
            font-size: 1rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 10px
        }

        .modal-header h3 i {
            color: var(--primary)
        }

        .modal-close {
            background: none;
            border: none;
            color: var(--text2);
            cursor: pointer;
            padding: 8px;
            border-radius: 6px;
            font-size: 1rem;
            line-height: 1
        }

        .modal-close:hover {
            background: var(--bg3);
            color: var(--text)
        }

        .modal-body {
            flex: 1;
            overflow: auto;
            padding: 20px
        }

        .modal-footer {
            padding: 14px 20px;
            border-top: 1px solid var(--border);
            display: flex;
            gap: 10px;
            justify-content: flex-end
        }

        .preview-text {
            font-family: 'SF Mono', Monaco, Consolas, monospace;
            font-size: 0.8rem;
            white-space: pre-wrap;
            word-break: break-all;
            background: var(--bg);
            padding: 16px;
            border-radius: 6px;
            max-height: 420px;
            overflow: auto;
            line-height: 1.6;
            tab-size: 2
        }

        .preview-image {
            max-width: 100%;
            max-height: 420px;
            display: block;
            margin: 0 auto;
            border-radius: 6px
        }

        .preview-unsupported {
            text-align: center;
            padding: 48px;
            color: var(--text2)
        }

        .preview-unsupported i {
            font-size: 3rem;
            margin-bottom: 14px;
            opacity: 0.3
        }

        .preview-unsupported p {
            margin-bottom: 16px
        }

        .kbd {
            display: inline-block;
            padding: 2px 6px;
            background: var(--bg3);
            border-radius: 4px;
            font-size: 0.7rem;
            font-family: monospace;
            color: var(--text2);
            margin-left: 8px
        }

        .hidden {
            display: none !important
        }

        .spacer {
            flex: 1
        }

        .estimate {
            font-size: 0.8rem;
            color: var(--text2);
            display: flex;
            align-items: center;
            gap: 6px
        }

        .dragging {
            opacity: 0.5
        }

        .drag-over td {
            background: var(--primary-light) !important
        }

        .loading-overlay {
            position: absolute;
            inset: 0;
            background: var(--bg2);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 12px;
            z-index: 10
        }

        .loading-overlay i {
            font-size: 1.5rem;
            color: var(--primary);
            animation: spin 1s linear infinite
        }

        @keyframes spin {
            to {
                transform: rotate(360deg)
            }
        }

        @media (max-width: 640px) {
            header {
                flex-direction: column;
                align-items: stretch
            }

            .tabs {
                width: 100%
            }

            .tab {
                flex: 1;
                justify-content: center;
                padding: 10px 12px
            }

            .toolbar {
                flex-direction: column
            }

            .create-options {
                flex-direction: column;
                align-items: stretch
            }

            .btn {
                width: 100%;
                justify-content: center
            }

            .search-bar {
                max-width: 100%
            }

            .stats {
                flex-wrap: wrap;
                gap: 12px
            }

            .archive-header {
                flex-direction: column;
                text-align: center
            }

            .archive-details h3 {
                justify-content: center
            }
        }
    </style>
</head>
<body>
<div class="container">
    <header>
        <div class="logo">
            <div class="logo-icon"><i class="fas fa-box-archive"></i></div>
            <div><h1>Archive Tool</h1>
                <p>Extract & create archives in-browser</p></div>
        </div>
        <div class="tabs" role="tablist">
            <button class="tab active" data-mode="extract" role="tab" aria-selected="true"><i
                    class="fas fa-box-open"></i> Extract
            </button>
            <button class="tab" data-mode="create" role="tab" aria-selected="false"><i class="fas fa-file-zipper"></i>
                Create
            </button>
        </div>
    </header>
    <main>
        <div id="extract-panel" role="tabpanel">
            <div class="card">
                <div class="card-body">
                    <div class="dropzone" id="extract-dropzone" role="button" tabindex="0"
                         aria-label="Drop archive file here or click to browse">
                        <div class="dropzone-icon"><i class="fas fa-cloud-arrow-up"></i></div>
                        <h3>Drop archive here or click to browse</h3>
                        <p>Extract files directly in your browser — nothing uploaded</p>
                        <div class="formats">
                            <span>ZIP</span><span>TAR</span><span>TAR.GZ</span><span>7Z</span><span>RAR</span><span>ISO</span>
                        </div>
                    </div>
                </div>
            </div>
            <input type="file" class="file-input" id="extract-input" accept=".zip,.tar,.gz,.tgz,.7z,.rar,.iso">
            <div class="card hidden" id="extract-results">
                <div class="archive-header">
                    <div class="archive-icon"><i class="fas fa-file-zipper"></i></div>
                    <div class="archive-details"><h3 id="archive-name">archive.zip <span class="archive-badge"
                                                                                         id="archive-type">ZIP</span>
                    </h3>
                        <p id="archive-meta">0 files · 0 B</p></div>
                </div>
                <div class="card-header">
                    <div class="search-bar"><i class="fas fa-search"></i><input type="text" id="search-input"
                                                                                placeholder="Filter files..."
                                                                                aria-label="Filter files"></div>
                    <div class="stats"><span id="stats-selected"><i
                            class="fas fa-check-square"></i> 0 selected</span><span id="stats-shown"><i
                            class="fas fa-file"></i> 0 files</span></div>
                </div>
                <div class="file-list" id="extract-file-list" style="position:relative">
                    <table class="file-table" role="grid">
                        <thead>
                        <tr>
                            <th class="select-cell"><input type="checkbox" id="select-all" title="Select all"
                                                           aria-label="Select all files"></th>
                            <th class="sortable" data-sort="name">Name <i class="fas fa-sort"></i></th>
                            <th class="sortable" data-sort="size" style="text-align:right">Size <i
                                    class="fas fa-sort"></i></th>
                            <th style="width:80px"></th>
                        </tr>
                        </thead>
                        <tbody id="file-tbody"></tbody>
                    </table>
                    <div class="loading-overlay hidden" id="extract-loading"><i class="fas fa-circle-notch"></i><span>Extracting archive...</span>
                    </div>
                </div>
                <div class="progress-container" id="extract-progress">
                    <div class="progress-bar">
                        <div class="fill"></div>
                    </div>
                    <div class="progress-text"><span>Preparing...</span><span></span></div>
                </div>
                <div class="toolbar">
                    <button class="btn btn-primary" id="extract-selected-btn" disabled><i class="fas fa-download"></i>
                        Extract Selected
                    </button>
                    <button class="btn btn-secondary" id="extract-all-btn"><i class="fas fa-file-export"></i> Extract
                        All
                    </button>
                    <div class="spacer"></div>
                    <button class="btn btn-ghost" id="close-archive-btn"><i class="fas fa-times"></i> Close<span
                            class="kbd">Esc</span></button>
                </div>
            </div>
        </div>
        <div id="create-panel" class="hidden" role="tabpanel">
            <div class="card">
                <div class="card-body">
                    <div class="dropzone" id="create-dropzone" role="button" tabindex="0"
                         aria-label="Drop files or folders here or click to add">
                        <div class="dropzone-icon"><i class="fas fa-plus"></i></div>
                        <h3>Drop files or folders here</h3>
                        <p>Add files to include in your archive</p>
                    </div>
                </div>
            </div>
            <input type="file" class="file-input" id="create-input" multiple>
            <input type="file" class="file-input" id="create-folder-input" webkitdirectory multiple>
            <div class="card hidden" id="create-files-card">
                <div class="card-header">
                    <div class="card-title"><i class="fas fa-layer-group"></i> Files to Archive</div>
                    <div class="stats"><span id="create-stats"><i class="fas fa-file"></i> 0 files · 0 B</span></div>
                </div>
                <div class="file-list" id="create-file-list"></div>
                <div class="progress-container" id="create-progress">
                    <div class="progress-bar">
                        <div class="fill"></div>
                    </div>
                    <div class="progress-text"><span>Creating archive...</span><span></span></div>
                </div>
                <div class="toolbar">
                    <div class="create-options">
                        <div class="form-group"><label for="archive-filename">Filename</label><input type="text"
                                                                                                     id="archive-filename"
                                                                                                     value="archive"
                                                                                                     placeholder="archive">
                        </div>
                        <div class="form-group"><label for="format-select">Format</label><select id="format-select">
                            <option value="zip">.zip</option>
                            <option value="tar">.tar</option>
                            <option value="tar.gz">.tar.gz</option>
                        </select></div>
                        <div class="form-group" id="compression-option"><label>Compression</label>
                            <div class="compression-group"><input type="range" id="compression-level" min="1" max="9"
                                                                  value="6" aria-label="Compression level"><span
                                    id="compression-value">6</span></div>
                        </div>
                    </div>
                    <div class="estimate" id="size-estimate"><i class="fas fa-calculator"></i> <span>Est. ~0 B</span>
                    </div>
                    <button class="btn btn-primary" id="create-archive-btn"><i class="fas fa-download"></i> Create &
                        Download
                    </button>
                    <button class="btn btn-danger" id="clear-files-btn"><i class="fas fa-trash"></i> Clear</button>
                </div>
            </div>
        </div>
    </main>
</div>
<div class="toast" id="toast" role="alert" aria-live="polite"><i class="fas fa-check-circle"></i><span></span></div>
<div class="modal-overlay" id="preview-modal" role="dialog" aria-modal="true" aria-labelledby="preview-title">
    <div class="modal">
        <div class="modal-header"><h3><i class="fas fa-eye"></i> <span id="preview-title">Preview</span></h3>
            <button class="modal-close" id="close-preview" aria-label="Close preview"><i class="fas fa-times"></i>
            </button>
        </div>
        <div class="modal-body" id="preview-body"></div>
    </div>
</div>
<div class="modal-overlay" id="confirm-modal" role="dialog" aria-modal="true">
    <div class="modal" style="max-width:400px">
        <div class="modal-header"><h3><i class="fas fa-exclamation-triangle" style="color:var(--warning)"></i> <span
                id="confirm-title">Confirm</span></h3></div>
        <div class="modal-body"><p id="confirm-message">Are you sure?</p></div>
        <div class="modal-footer">
            <button class="btn btn-ghost" id="confirm-cancel">Cancel</button>
            <button class="btn btn-primary" id="confirm-ok">Confirm</button>
        </div>
    </div>
</div>
<script>
    const App = {
        mode: 'extract',
        archiveFiles: [],
        createFiles: [],
        currentArchive: null,
        selectedFiles: new Set(),
        sortField: 'name',
        sortAsc: true,
        searchQuery: '',
        lastSelectedIdx: null,
        dragSrcIdx: null,
        Archive: null,
        libarchiveReady: false,
        init() {
            this.bindEvents();
            this.loadLibarchive();
            document.addEventListener('keydown', e => this.handleKeyboard(e))
        },
        handleKeyboard(e) {
            if (e.key === 'Escape') {
                this.closePreview();
                this.closeConfirm();
                if (this.currentArchive && this.mode === 'extract') this.closeArchive()
            }
            if (e.target.tagName === 'INPUT') return;
            if (e.ctrlKey && e.key === 'a' && this.mode === 'extract' && this.currentArchive) {
                e.preventDefault();
                this.toggleSelectAll(true)
            }
            if (e.key === 'Delete' && this.mode === 'create' && this.createFiles.length) {
                e.preventDefault();
                this.clearCreateFiles()
            }
        },
        bindEvents() {
            document.querySelectorAll('.tab').forEach(t => t.addEventListener('click', () => this.switchMode(t.dataset.mode)));
            const ed = document.getElementById('extract-dropzone'), ei = document.getElementById('extract-input');
            ed.addEventListener('click', () => ei.click());
            ed.addEventListener('keydown', e => {
                if (e.key === 'Enter' || e.key === ' ') ei.click()
            });
            ed.addEventListener('dragover', e => {
                e.preventDefault();
                ed.classList.add('dragover')
            });
            ed.addEventListener('dragleave', () => ed.classList.remove('dragover'));
            ed.addEventListener('drop', e => {
                e.preventDefault();
                ed.classList.remove('dragover');
                if (e.dataTransfer.files[0]) this.loadArchive(e.dataTransfer.files[0])
            });
            ei.addEventListener('change', e => {
                if (e.target.files[0]) this.loadArchive(e.target.files[0])
            });
            const cd = document.getElementById('create-dropzone'), ci = document.getElementById('create-input'),
                cfi = document.getElementById('create-folder-input');
            cd.addEventListener('click', () => ci.click());
            cd.addEventListener('keydown', e => {
                if (e.key === 'Enter' || e.key === ' ') ci.click()
            });
            cd.addEventListener('dragover', e => {
                e.preventDefault();
                cd.classList.add('dragover')
            });
            cd.addEventListener('dragleave', () => cd.classList.remove('dragover'));
            cd.addEventListener('drop', e => {
                e.preventDefault();
                cd.classList.remove('dragover');
                this.handleCreateDrop(e.dataTransfer)
            });
            ci.addEventListener('change', e => this.addCreateFiles(e.target.files));
            cfi.addEventListener('change', e => this.addCreateFiles(e.target.files));
            document.getElementById('extract-all-btn').addEventListener('click', () => this.extractAll());
            document.getElementById('extract-selected-btn').addEventListener('click', () => this.extractSelected());
            document.getElementById('close-archive-btn').addEventListener('click', () => this.closeArchive());
            document.getElementById('create-archive-btn').addEventListener('click', () => this.createArchive());
            document.getElementById('clear-files-btn').addEventListener('click', () => this.confirmAction('Clear all files?', 'This will remove all files from the list.', () => this.clearCreateFiles()));
            document.getElementById('select-all').addEventListener('change', e => this.toggleSelectAll(e.target.checked));
            document.getElementById('search-input').addEventListener('input', e => {
                this.searchQuery = e.target.value.toLowerCase();
                this.renderArchiveContents()
            });
            document.querySelectorAll('[data-sort]').forEach(th => th.addEventListener('click', () => {
                const f = th.dataset.sort;
                if (this.sortField === f) this.sortAsc = !this.sortAsc; else {
                    this.sortField = f;
                    this.sortAsc = true
                }
                this.renderArchiveContents()
            }));
            document.getElementById('close-preview').addEventListener('click', () => this.closePreview());
            document.getElementById('preview-modal').addEventListener('click', e => {
                if (e.target.id === 'preview-modal') this.closePreview()
            });
            document.getElementById('confirm-modal').addEventListener('click', e => {
                if (e.target.id === 'confirm-modal') this.closeConfirm()
            });
            document.getElementById('confirm-cancel').addEventListener('click', () => this.closeConfirm());
            document.getElementById('format-select').addEventListener('change', e => {
                document.getElementById('compression-option').classList.toggle('hidden', e.target.value !== 'zip');
                this.updateSizeEstimate()
            });
            document.getElementById('compression-level').addEventListener('input', e => {
                document.getElementById('compression-value').textContent = e.target.value;
                this.updateSizeEstimate()
            });
        },
        async loadLibarchive() {
            try {
                const workerResponse = await fetch('https://cdn.jsdelivr.net/npm/libarchive.js@1.3.0/dist/worker-bundle.js');
                const workerText = await workerResponse.text();
                const wasmBaseUrl = 'https://cdn.jsdelivr.net/npm/libarchive.js@1.3.0/dist/';
                const patchedWorker = workerText.replace(/wasm-gen\//g, wasmBaseUrl + 'wasm-gen/');
                const blob = new Blob([patchedWorker], {type: 'application/javascript'});
                const workerUrl = URL.createObjectURL(blob);
                const {Archive} = await import('https://cdn.jsdelivr.net/npm/libarchive.js@1.3.0/+esm');
                Archive.init({workerUrl});
                this.Archive = Archive;
                this.libarchiveReady = true
            } catch (e) {
                console.warn('libarchive failed:', e);
                this.libarchiveReady = false
            }
        },
        switchMode(mode) {
            this.mode = mode;
            document.querySelectorAll('.tab').forEach(t => {
                t.classList.toggle('active', t.dataset.mode === mode);
                t.setAttribute('aria-selected', t.dataset.mode === mode)
            });
            document.getElementById('extract-panel').classList.toggle('hidden', mode !== 'extract');
            document.getElementById('create-panel').classList.toggle('hidden', mode !== 'create')
        },
        formatSize(b) {
            if (b === 0) return '0 B';
            const k = 1024, s = ['B', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(b) / Math.log(k));
            return parseFloat((b / Math.pow(k, i)).toFixed(1)) + ' ' + s[i]
        },
        getIcon(name, isDir) {
            if (isDir) return 'fa-folder';
            const ext = name.split('.').pop().toLowerCase();
            const m = {
                pdf: 'fa-file-pdf',
                doc: 'fa-file-word',
                docx: 'fa-file-word',
                xls: 'fa-file-excel',
                xlsx: 'fa-file-excel',
                ppt: 'fa-file-powerpoint',
                pptx: 'fa-file-powerpoint',
                jpg: 'fa-file-image',
                jpeg: 'fa-file-image',
                png: 'fa-file-image',
                gif: 'fa-file-image',
                svg: 'fa-file-image',
                webp: 'fa-file-image',
                bmp: 'fa-file-image',
                mp3: 'fa-file-audio',
                wav: 'fa-file-audio',
                ogg: 'fa-file-audio',
                flac: 'fa-file-audio',
                mp4: 'fa-file-video',
                avi: 'fa-file-video',
                mov: 'fa-file-video',
                mkv: 'fa-file-video',
                webm: 'fa-file-video',
                zip: 'fa-file-zipper',
                '7z': 'fa-file-zipper',
                rar: 'fa-file-zipper',
                tar: 'fa-file-zipper',
                gz: 'fa-file-zipper',
                js: 'fa-file-code',
                ts: 'fa-file-code',
                py: 'fa-file-code',
                html: 'fa-file-code',
                css: 'fa-file-code',
                json: 'fa-file-code',
                xml: 'fa-file-code',
                java: 'fa-file-code',
                cpp: 'fa-file-code',
                c: 'fa-file-code',
                go: 'fa-file-code',
                rs: 'fa-file-code',
                rb: 'fa-file-code',
                php: 'fa-file-code',
                txt: 'fa-file-lines',
                md: 'fa-file-lines',
                csv: 'fa-file-csv',
                sql: 'fa-database',
                iso: 'fa-compact-disc'
            };
            return m[ext] || 'fa-file'
        },
        getArchiveType(name) {
            const n = name.toLowerCase();
            if (n.endsWith('.tar.gz') || n.endsWith('.tgz')) return 'TAR.GZ';
            if (n.endsWith('.tar')) return 'TAR';
            if (n.endsWith('.zip')) return 'ZIP';
            if (n.endsWith('.7z')) return '7Z';
            if (n.endsWith('.rar')) return 'RAR';
            if (n.endsWith('.iso')) return 'ISO';
            return 'Archive'
        },
        showToast(msg, type = 'success') {
            const t = document.getElementById('toast');
            t.className = 'toast ' + type + ' show';
            t.querySelector('i').className = 'fas fa-' + (type === 'success' ? 'check-circle' : type === 'error' ? 'exclamation-circle' : 'exclamation-triangle');
            t.querySelector('span').textContent = msg;
            setTimeout(() => t.classList.remove('show'), 4000)
        },
        setProgress(id, pct, text, detail = '') {
            const c = document.getElementById(id);
            c.classList.toggle('active', pct > 0 && pct < 100);
            c.querySelector('.fill').style.width = pct + '%';
            const spans = c.querySelectorAll('.progress-text span');
            if (text) spans[0].textContent = text;
            spans[1].textContent = detail
        },
        showLoading(show, text = 'Extracting archive...') {
            const el = document.getElementById('extract-loading');
            el.classList.toggle('hidden', !show);
            el.querySelector('span').textContent = text
        },
        confirmAction(title, message, callback) {
            document.getElementById('confirm-title').textContent = title;
            document.getElementById('confirm-message').textContent = message;
            document.getElementById('confirm-modal').classList.add('show');
            const okBtn = document.getElementById('confirm-ok');
            const newOk = okBtn.cloneNode(true);
            okBtn.parentNode.replaceChild(newOk, okBtn);
            newOk.addEventListener('click', () => {
                this.closeConfirm();
                callback()
            })
        },
        closeConfirm() {
            document.getElementById('confirm-modal').classList.remove('show')
        },
        async loadArchive(file) {
            const name = file.name.toLowerCase();
            const ext = name.split('.').pop();
            this.currentArchive = {name: file.name, size: file.size, file, type: this.getArchiveType(file.name)};
            this.archiveFiles = [];
            this.selectedFiles.clear();
            this.searchQuery = '';
            this.lastSelectedIdx = null;
            document.getElementById('search-input').value = '';
            document.getElementById('extract-results').classList.remove('hidden');
            this.showLoading(true);
            try {
                if (ext === 'zip') await this.loadZip(file);
                else if (ext === 'tar' || name.endsWith('.tar.gz') || name.endsWith('.tgz')) await this.loadTar(file);
                else if (['7z', 'rar', 'iso'].includes(ext)) {
                    if (!this.libarchiveReady) {
                        throw new Error('libarchive.js not available. Try refreshing the page.')
                    }
                    await this.loadLibarchiveFile(file)
                } else throw new Error('Unsupported format: .' + ext);
                this.showLoading(false);
                this.renderArchiveContents();
                this.showToast(`Loaded ${this.archiveFiles.length} files from ${this.currentArchive.type}`)
            } catch (e) {
                console.error(e);
                this.showLoading(false);
                this.closeArchive();
                this.showToast('Failed to load: ' + e.message, 'error')
            }
        },
        async loadZip(file) {
            const zip = await JSZip.loadAsync(file);
            const entries = [];
            zip.forEach((path, entry) => {
                if (!entry.dir) entries.push({path, entry})
            });
            for (let i = 0; i < entries.length; i++) {
                const e = entries[i];
                const data = await e.entry.async('uint8array');
                this.archiveFiles.push({path: e.path, size: data.length, data})
            }
        },
        async loadTar(file) {
            let buffer = await file.arrayBuffer();
            let data = new Uint8Array(buffer);
            if (file.name.endsWith('.gz') || file.name.endsWith('.tgz')) data = pako.ungzip(data);
            let offset = 0;
            while (offset < data.length - 512) {
                const header = data.slice(offset, offset + 512);
                if (header.every(b => b === 0)) break;
                const name = this.readStr(header, 0, 100).replace(/^\.?\//, '');
                const size = parseInt(this.readStr(header, 124, 12), 8) || 0;
                const type = header[156];
                offset += 512;
                if (type === 0 || type === 48) {
                    const fd = data.slice(offset, offset + size);
                    if (name) this.archiveFiles.push({path: name, size, data: new Uint8Array(fd)})
                }
                offset += Math.ceil(size / 512) * 512
            }
        },
        readStr(arr, s, l) {
            let r = '';
            for (let i = s; i < s + l && arr[i] !== 0; i++) r += String.fromCharCode(arr[i]);
            return r
        },
        async loadLibarchiveFile(file) {
            const archive = await this.Archive.open(file);
            const entries = await archive.getFilesArray();
            for (let i = 0; i < entries.length; i++) {
                const e = entries[i];
                if (e.file.size === 0) continue;
                try {
                    const extracted = await e.file.extract();
                    const data = new Uint8Array(await extracted.arrayBuffer());
                    this.archiveFiles.push({path: e.file.path, size: data.length, data})
                } catch (err) {
                    console.warn('Failed to extract:', e.file.path, err)
                }
            }
            await archive.close()
        },
        renderArchiveContents() {
            document.getElementById('archive-name').innerHTML = `${this.escapeHtml(this.currentArchive.name)} <span class="archive-badge">${this.currentArchive.type}</span>`;
            const total = this.archiveFiles.reduce((a, f) => a + f.size, 0);
            const filtered = this.getFilteredFiles();
            document.getElementById('archive-meta').textContent = `${this.archiveFiles.length} files · ${this.formatSize(total)}`;
            document.getElementById('stats-shown').innerHTML = `<i class="fas fa-file"></i> ${filtered.length} files`;
            this.updateSelectedStats();
            const tbody = document.getElementById('file-tbody');
            if (filtered.length === 0) {
                tbody.innerHTML = `<tr><td colspan="4"><div class="empty-state"><i class="fas fa-folder-open"></i><p>${this.searchQuery ? 'No matching files' : 'Archive is empty'}</p></div></td></tr>`;
                return
            }
            const sorted = [...filtered].sort((a, b) => {
                let cmp = 0;
                if (this.sortField === 'name') cmp = a.path.localeCompare(b.path); else cmp = a.size - b.size;
                return this.sortAsc ? cmp : -cmp
            });
            tbody.innerHTML = sorted.map((f, i) => {
                const name = f.path.split('/').pop();
                const dir = f.path.includes('/') ? f.path.substring(0, f.path.lastIndexOf('/')) : '';
                return `<tr data-idx="${f.idx}" class="${this.selectedFiles.has(f.idx) ? 'selected' : ''}">
<td class="select-cell"><input type="checkbox" data-idx="${f.idx}" ${this.selectedFiles.has(f.idx) ? 'checked' : ''} aria-label="Select ${name}"></td>
<td><div class="file-name"><i class="fas ${this.getIcon(name)}"></i><span>${this.escapeHtml(name)}${dir ? `<span class="path"> — ${this.escapeHtml(dir)}</span>` : ''}</span></div></td>
<td class="file-size">${this.formatSize(f.size)}</td>
<td class="file-actions"><button onclick="App.previewFile(${f.idx})" title="Preview" aria-label="Preview ${name}"><i class="fas fa-eye"></i></button><button onclick="App.downloadFile(${f.idx})" title="Download" aria-label="Download ${name}"><i class="fas fa-download"></i></button></td></tr>`
            }).join('');
            tbody.querySelectorAll('input[type=checkbox]').forEach((cb, i) => cb.addEventListener('click', e => {
                const idx = parseInt(e.target.dataset.idx);
                if (e.shiftKey && this.lastSelectedIdx !== null) {
                    const sortedIdxs = sorted.map(f => f.idx);
                    const start = sortedIdxs.indexOf(this.lastSelectedIdx);
                    const end = sortedIdxs.indexOf(idx);
                    const [from, to] = [Math.min(start, end), Math.max(start, end)];
                    for (let j = from; j <= to; j++) {
                        if (e.target.checked) this.selectedFiles.add(sortedIdxs[j]); else this.selectedFiles.delete(sortedIdxs[j])
                    }
                    this.renderArchiveContents()
                } else {
                    if (e.target.checked) this.selectedFiles.add(idx); else this.selectedFiles.delete(idx);
                    this.lastSelectedIdx = idx;
                    this.updateSelectedStats();
                    e.target.closest('tr').classList.toggle('selected', e.target.checked)
                }
            }));
            document.querySelectorAll('.file-table th.sortable').forEach(th => {
                th.classList.toggle('sorted', th.dataset.sort === this.sortField);
                const icon = th.querySelector('i');
                if (th.dataset.sort === this.sortField) icon.className = `fas fa-sort-${this.sortAsc ? 'up' : 'down'}`;
                else icon.className = 'fas fa-sort'
            })
        },
        getFilteredFiles() {
            let files = this.archiveFiles.map((f, idx) => ({...f, idx}));
            if (this.searchQuery) files = files.filter(f => f.path.toLowerCase().includes(this.searchQuery));
            return files
        },
        updateSelectedStats() {
            const count = this.selectedFiles.size;
            document.getElementById('stats-selected').innerHTML = `<i class="fas fa-check-square"></i> ${count} selected`;
            document.getElementById('extract-selected-btn').disabled = count === 0;
            const filtered = this.getFilteredFiles();
            document.getElementById('select-all').checked = count > 0 && count === filtered.length;
            document.getElementById('select-all').indeterminate = count > 0 && count < filtered.length
        },
        toggleSelectAll(checked) {
            const filtered = this.getFilteredFiles();
            if (checked) filtered.forEach(f => this.selectedFiles.add(f.idx)); else this.selectedFiles.clear();
            this.renderArchiveContents()
        },
        previewFile(idx) {
            const f = this.archiveFiles[idx];
            const name = f.path.split('/').pop();
            const ext = name.split('.').pop().toLowerCase();
            document.getElementById('preview-title').textContent = name;
            const body = document.getElementById('preview-body');
            const textExts = ['txt', 'md', 'json', 'xml', 'html', 'css', 'js', 'ts', 'py', 'java', 'c', 'cpp', 'h', 'csv', 'log', 'yml', 'yaml', 'ini', 'conf', 'sh', 'bat', 'sql', 'go', 'rs', 'rb', 'php', 'swift', 'kt'];
            const imgExts = ['jpg', 'jpeg', 'png', 'gif', 'webp', 'bmp', 'svg', 'ico'];
            if (textExts.includes(ext)) {
                const text = new TextDecoder().decode(f.data);
                const truncated = text.length > 100000;
                body.innerHTML = `<pre class="preview-text">${this.escapeHtml(text.slice(0, 100000))}${truncated ? '\n\n[Content truncated — download to view full file]' : ''}</pre>`
            } else if (imgExts.includes(ext)) {
                const blob = new Blob([f.data], {type: `image/${ext === 'svg' ? 'svg+xml' : ext}`});
                const url = URL.createObjectURL(blob);
                body.innerHTML = `<img class="preview-image" src="${url}" alt="${this.escapeHtml(name)}">`
            } else {
                body.innerHTML = `<div class="preview-unsupported"><i class="fas fa-file"></i><p>Preview not available for .${ext} files</p><button class="btn btn-primary" onclick="App.downloadFile(${idx});App.closePreview()"><i class="fas fa-download"></i> Download to view</button></div>`
            }
            document.getElementById('preview-modal').classList.add('show');
            document.getElementById('close-preview').focus()
        },
        escapeHtml(t) {
            return t.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;').replace(/"/g, '&quot;')
        },
        closePreview() {
            document.getElementById('preview-modal').classList.remove('show')
        },
        downloadFile(idx) {
            const f = this.archiveFiles[idx];
            const blob = new Blob([f.data]);
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = f.path.split('/').pop();
            a.click();
            URL.revokeObjectURL(url);
            this.showToast('Downloaded ' + f.path.split('/').pop())
        },
        async extractSelected() {
            if (this.selectedFiles.size === 0) return;
            const files = this.archiveFiles.filter((_, i) => this.selectedFiles.has(i));
            await this.downloadAsZip(files, 'selected-files.zip')
        },
        async extractAll() {
            if (this.archiveFiles.length === 0) return;
            const baseName = this.currentArchive.name.replace(/\.(zip|tar|tar\.gz|tgz|7z|rar|iso)$/i, '');
            await this.downloadAsZip(this.archiveFiles, baseName + '-extracted.zip')
        },
        async downloadAsZip(files, filename) {
            this.setProgress('extract-progress', 1, 'Preparing files...', `0/${files.length}`);
            const zip = new JSZip();
            files.forEach((f, i) => {
                zip.file(f.path, f.data);
                this.setProgress('extract-progress', (i + 1) / files.length * 50, `Adding files...`, `${i + 1}/${files.length}`)
            });
            const blob = await zip.generateAsync({type: 'blob'}, m => this.setProgress('extract-progress', 50 + m.percent / 2, `Compressing...`, `${Math.round(m.percent)}%`));
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            a.click();
            URL.revokeObjectURL(url);
            this.setProgress('extract-progress', 100, 'Complete!', this.formatSize(blob.size));
            this.showToast(`Extracted ${files.length} files (${this.formatSize(blob.size)})`);
            setTimeout(() => this.setProgress('extract-progress', 0), 2000)
        },
        closeArchive() {
            this.archiveFiles = [];
            this.currentArchive = null;
            this.selectedFiles.clear();
            document.getElementById('extract-results').classList.add('hidden');
            document.getElementById('extract-input').value = ''
        },
        async handleCreateDrop(dt) {
            const items = dt.items;
            if (items && items[0] && items[0].webkitGetAsEntry) {
                const entries = [];
                for (const item of items) {
                    const e = item.webkitGetAsEntry();
                    if (e) entries.push(e)
                }
                await this.processEntries(entries)
            } else {
                this.addCreateFiles(dt.files)
            }
        },
        async processEntries(entries) {
            const files = [];
            const readEntry = async (entry, path = '') => {
                if (entry.isFile) {
                    return new Promise(resolve => {
                        entry.file(f => {
                            f.relativePath = path + f.name;
                            files.push(f);
                            resolve()
                        })
                    })
                } else if (entry.isDirectory) {
                    const reader = entry.createReader();
                    const subEntries = await new Promise(resolve => reader.readEntries(resolve));
                    for (const sub of subEntries) await readEntry(sub, path + entry.name + '/')
                }
            };
            for (const e of entries) await readEntry(e);
            this.addCreateFilesWithPaths(files)
        },
        addCreateFilesWithPaths(files) {
            let added = 0, dupes = 0;
            const processFile = (f) => {
                const path = f.relativePath || f.name;
                if (this.createFiles.some(c => c.path === path)) {
                    dupes++;
                    return
                }
                const reader = new FileReader();
                reader.onload = e => {
                    this.createFiles.push({name: f.name, path, size: f.size, data: new Uint8Array(e.target.result)});
                    added++;
                    if (added + dupes === files.length) this.renderCreateFiles()
                };
                reader.readAsArrayBuffer(f)
            };
            for (const f of files) processFile(f);
            if (files.length === 0) return;
            setTimeout(() => {
                if (dupes > 0) this.showToast(`${dupes} duplicate(s) skipped`, 'warning')
            }, 100)
        },
        addCreateFiles(files) {
            const arr = Array.from(files);
            arr.forEach(f => f.relativePath = f.webkitRelativePath || f.name);
            this.addCreateFilesWithPaths(arr)
        },
        renderCreateFiles() {
            const card = document.getElementById('create-files-card');
            card.classList.toggle('hidden', !this.createFiles.length);
            if (!this.createFiles.length) return;
            const total = this.createFiles.reduce((a, f) => a + f.size, 0);
            document.getElementById('create-stats').innerHTML = `<i class="fas fa-file"></i> ${this.createFiles.length} files · ${this.formatSize(total)}`;
            this.updateSizeEstimate();
            const list = document.getElementById('create-file-list');
            list.innerHTML = `<table class="file-table"><thead><tr><th>Name</th><th style="text-align:right">Size</th><th style="width:50px"></th></tr></thead><tbody>${this.createFiles.map((f, i) => `<tr draggable="true" data-idx="${i}"><td><div class="file-name"><i class="fas ${this.getIcon(f.name)}"></i><span>${this.escapeHtml(f.path)}</span></div></td><td class="file-size">${this.formatSize(f.size)}</td><td class="file-actions"><button class="remove" onclick="App.removeCreateFile(${i})" title="Remove" aria-label="Remove ${f.name}"><i class="fas fa-times"></i></button></td></tr>`).join('')}</tbody></table>`;
            this.setupDragReorder()
        },
        setupDragReorder() {
            const rows = document.querySelectorAll('#create-file-list tbody tr');
            rows.forEach(row => {
                row.addEventListener('dragstart', e => {
                    this.dragSrcIdx = parseInt(row.dataset.idx);
                    row.classList.add('dragging');
                    e.dataTransfer.effectAllowed = 'move'
                });
                row.addEventListener('dragend', () => {
                    row.classList.remove('dragging');
                    document.querySelectorAll('.drag-over').forEach(r => r.classList.remove('drag-over'))
                });
                row.addEventListener('dragover', e => {
                    e.preventDefault();
                    e.dataTransfer.dropEffect = 'move';
                    row.classList.add('drag-over')
                });
                row.addEventListener('dragleave', () => row.classList.remove('drag-over'));
                row.addEventListener('drop', e => {
                    e.preventDefault();
                    row.classList.remove('drag-over');
                    const targetIdx = parseInt(row.dataset.idx);
                    if (this.dragSrcIdx !== targetIdx) {
                        const item = this.createFiles.splice(this.dragSrcIdx, 1)[0];
                        this.createFiles.splice(targetIdx, 0, item);
                        this.renderCreateFiles()
                    }
                })
            })
        },
        updateSizeEstimate() {
            if (!this.createFiles.length) {
                document.getElementById('size-estimate').querySelector('span').textContent = 'Est. ~0 B';
                return
            }
            const total = this.createFiles.reduce((a, f) => a + f.size, 0);
            const format = document.getElementById('format-select').value;
            const level = parseInt(document.getElementById('compression-level').value);
            let estimate = total;
            if (format === 'zip') {
                const ratio = 0.3 + (1 - level / 9) * 0.5;
                estimate = Math.round(total * ratio)
            } else if (format === 'tar.gz') {
                estimate = Math.round(total * 0.4)
            }
            document.getElementById('size-estimate').querySelector('span').textContent = `Est. ~${this.formatSize(estimate)}`
        },
        removeCreateFile(i) {
            this.createFiles.splice(i, 1);
            this.renderCreateFiles()
        },
        clearCreateFiles() {
            this.createFiles = [];
            this.renderCreateFiles();
            document.getElementById('create-input').value = ''
        },
        async createArchive() {
            if (!this.createFiles.length) {
                this.showToast('Add files first', 'warning');
                return
            }
            const name = document.getElementById('archive-filename').value.trim() || 'archive';
            const format = document.getElementById('format-select').value;
            const level = parseInt(document.getElementById('compression-level').value);
            this.setProgress('create-progress', 1, 'Starting...', `0/${this.createFiles.length}`);
            let blob, filename;
            try {
                if (format === 'zip') {
                    const zip = new JSZip();
                    this.createFiles.forEach((f, i) => {
                        zip.file(f.path, f.data);
                        this.setProgress('create-progress', (i + 1) / this.createFiles.length * 40, `Adding files...`, `${i + 1}/${this.createFiles.length}`)
                    });
                    blob = await zip.generateAsync({
                        type: 'blob',
                        compression: 'DEFLATE',
                        compressionOptions: {level}
                    }, m => this.setProgress('create-progress', 40 + m.percent * 0.6, `Compressing...`, `${Math.round(m.percent)}%`));
                    filename = name + '.zip'
                } else {
                    const tarData = this.createTar();
                    this.setProgress('create-progress', 80, 'Finalizing...');
                    if (format === 'tar.gz') {
                        blob = new Blob([pako.gzip(tarData)]);
                        filename = name + '.tar.gz'
                    } else {
                        blob = new Blob([tarData]);
                        filename = name + '.tar'
                    }
                }
                this.setProgress('create-progress', 100, 'Complete!', this.formatSize(blob.size));
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = filename;
                a.click();
                URL.revokeObjectURL(url);
                this.showToast(`Created ${filename} (${this.formatSize(blob.size)})`);
                setTimeout(() => this.setProgress('create-progress', 0), 2000)
            } catch (e) {
                console.error(e);
                this.showToast('Failed: ' + e.message, 'error');
                this.setProgress('create-progress', 0)
            }
        },
        createTar() {
            const blocks = [];
            const enc = new TextEncoder();
            for (const f of this.createFiles) {
                const header = new Uint8Array(512);
                const pathBytes = enc.encode(f.path.slice(0, 99));
                header.set(pathBytes, 0);
                header.set(enc.encode('0000644'), 100);
                header.set(enc.encode('0000000'), 108);
                header.set(enc.encode('0000000'), 116);
                header.set(enc.encode(f.size.toString(8).padStart(11, '0')), 124);
                header.set(enc.encode(Math.floor(Date.now() / 1000).toString(8).padStart(11, '0')), 136);
                header[156] = 48;
                header.set(enc.encode('ustar'), 257);
                header.set(enc.encode('00'), 263);
                header.set(new Uint8Array(8).fill(32), 148);
                let checksum = 0;
                for (let i = 0; i < 512; i++) checksum += header[i];
                header.set(enc.encode(checksum.toString(8).padStart(6, '0') + '\0 '), 148);
                blocks.push(header, f.data);
                const pad = 512 - f.data.length % 512;
                if (pad < 512) blocks.push(new Uint8Array(pad))
            }
            blocks.push(new Uint8Array(1024));
            const total = blocks.reduce((a, b) => a + b.length, 0);
            const result = new Uint8Array(total);
            let off = 0;
            for (const b of blocks) {
                result.set(b, off);
                off += b.length
            }
            return result
        }
    };
    App.init();
</script>
<script src="../logo.js"></script>
</body>
</html>