<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Online LaTeX Editor | Free Browser-Based LaTeX Editing Tool</title>
    <meta name="description" content="Create and edit LaTeX documents with this free browser-based LaTeX editor. Features real-time preview, syntax highlighting, and math formula rendering.">
    <meta name="keywords" content="LaTeX, editor, online, mathematical formulas, equations, document editor, typesetting, math, academic writing">
    <meta name="author" content="Claude 3.7 Sonnet prompted by Tobias MÃ¼ller">
    <meta name="robots" content="index, follow">
    <meta name="language" content="English">
    <link rel="canonical" href="https://www.gptgames.dev/tools/latex_editor.html">
    <meta property="og:title" content="Online LaTeX Editor | Free Browser-Based LaTeX Editing Tool">
    <meta property="og:description" content="Create and edit LaTeX documents with this free browser-based LaTeX editor. Features real-time preview, syntax highlighting, and math formula rendering.">
    <meta property="og:image" content="https://www.gptgames.dev/screenshots/screenshot_187.webp">
    <meta property="og:url" content="https://www.gptgames.dev/tools/latex_editor.html">
    <meta property="og:type" content="website">
    <meta property="og:site_name" content="GPT Games Tools">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Online LaTeX Editor | Free Browser-Based LaTeX Editing Tool">
    <meta name="twitter:description" content="Create and edit LaTeX documents with this free browser-based LaTeX editor. Features real-time preview, syntax highlighting, and math formula rendering.">
    <meta name="twitter:image" content="https://www.gptgames.dev/screenshots/screenshot_187.webp">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/codemirror.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/theme/nord.min.css">
    <script>
        MathJax = {
            tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']],
                displayMath: [['$$', '$$'], ['\\[', '\\]']],
                processEnvironments: true,
                processRefs: true
            },
            options: {
                skipHtmlTags: ['script', 'noscript', 'style', 'textarea', 'code'],
                ignoreHtmlClass: 'tex2jax_ignore'
            }
        };
    </script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            height: 100vh;
            display: flex;
            flex-direction: column;
            background-color: #f5f5f5;
        }

        header {
            background-color: #2e3440;
            color: white;
            padding: 1rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .title {
            font-size: 1.5rem;
            font-weight: bold;
        }

        .controls {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
        }

        button, select {
            background-color: #4c566a;
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        button:hover, select:hover {
            background-color: #5e81ac;
        }

        button:active, select:active {
            background-color: #81a1c1;
        }

        .container {
            display: flex;
            flex: 1;
            overflow: hidden;
        }

        .editor-pane, .preview-pane {
            flex: 1;
            overflow: auto;
            position: relative;
        }

        .editor-pane {
            background-color: #eceff4;
            display: flex;
            flex-direction: column;
        }

        .preview-pane {
            background-color: white;
            border-left: 1px solid #d8dee9;
            padding: 1rem;
        }

        @media (max-width: 768px) {
            .container {
                flex-direction: column;
            }

            .editor-pane, .preview-pane {
                flex: 1;
                max-height: 50%;
            }
        }

        .CodeMirror {
            flex: 1;
            font-family: 'Fira Mono', monospace;
            font-size: 15px;
            height: auto;
        }

        .preview-content {
            max-width: 800px;
            margin: 0 auto;
            padding: 1rem;
            font-size: 16px;
            line-height: 1.6;
        }

        .document-title {
            font-size: 2rem;
            margin-bottom: 1rem;
            text-align: center;
            font-weight: bold;
        }

        .document-author {
            text-align: center;
            margin-bottom: 2rem;
            font-style: italic;
        }

        .document-date {
            text-align: center;
            margin-bottom: 2rem;
        }

        .section-title {
            font-size: 1.5rem;
            margin-top: 1.5rem;
            margin-bottom: 0.5rem;
            font-weight: bold;
        }

        .subsection-title {
            font-size: 1.2rem;
            margin-top: 1.2rem;
            margin-bottom: 0.5rem;
            font-weight: bold;
        }

        .paragraph {
            margin-bottom: 1rem;
        }

        .latex-itemize, .latex-enumerate {
            margin-left: 2rem;
            margin-bottom: 1rem;
        }

        .latex-itemize li, .latex-enumerate li {
            margin-bottom: 0.5rem;
        }

        .latex-item {
            margin-bottom: 0.5rem;
        }

        footer {
            background-color: #2e3440;
            color: white;
            padding: 0.5rem 1rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .templates-menu {
            position: absolute;
            top: 4rem;
            right: 1rem;
            background-color: white;
            border: 1px solid #d8dee9;
            border-radius: 4px;
            padding: 1rem;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            display: none;
            z-index: 100;
            width: 250px;
        }

        .templates-menu.visible {
            display: block;
        }

        .template-item {
            padding: 0.5rem;
            cursor: pointer;
            border-radius: 4px;
        }

        .template-item:hover {
            background-color: #e5e9f0;
        }

        .toolbar {
            background-color: #e5e9f0;
            padding: 0.5rem;
            display: flex;
            flex-wrap: wrap;
            gap: 0.3rem;
            border-bottom: 1px solid #d8dee9;
        }

        .toolbar button {
            padding: 0.3rem 0.5rem;
            font-size: 0.9rem;
            background-color: #d8dee9;
            color: #434c5e;
        }

        .toolbar button:hover {
            background-color: #81a1c1;
            color: white;
        }

        .toolbar-group {
            display: flex;
            gap: 0.3rem;
            padding: 0.3rem;
            border-right: 1px solid #d8dee9;
            margin-right: 0.3rem;
        }

        .toolbar-group:last-child {
            border-right: none;
        }

        .message-container {
            position: absolute;
            top: 10px;
            left: 0;
            right: 0;
            z-index: 1000;
            display: flex;
            justify-content: center;
            pointer-events: none;
        }

        .error-message, .success-message {
            padding: 0.7rem 1.2rem;
            border-radius: 4px;
            max-width: 80%;
            margin: 0 auto;
            display: none;
            opacity: 0;
            transition: opacity 0.3s;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
        }

        .error-message {
            background-color: #bf616a;
            color: white;
        }

        .success-message {
            background-color: #a3be8c;
            color: white;
        }

        .error-message.visible, .success-message.visible {
            display: block;
            opacity: 1;
        }

        .latex-letter {
            line-height: 1.5;
        }

        .letter-address {
            margin-bottom: 1rem;
        }

        .letter-date {
            margin: 1rem 0;
        }

        .letter-recipient {
            margin-bottom: 1rem;
        }

        .letter-greeting {
            margin-bottom: 1rem;
        }

        .letter-body {
            margin-bottom: 1rem;
        }

        .letter-closing {
            margin-bottom: 2rem;
        }

        .letter-signature {
            margin-top: 1rem;
        }

        .centered {
            text-align: center;
        }

        .noindent {
            text-indent: 0;
        }

        .vspace {
            margin-top: 1rem;
        }

        .keyboard-shortcuts {
            position: fixed;
            bottom: 10px;
            right: 10px;
            background-color: rgba(46, 52, 64, 0.8);
            color: white;
            padding: 0.5rem;
            border-radius: 4px;
            font-size: 0.8rem;
            z-index: 50;
            display: none;
        }

        .keyboard-shortcuts.visible {
            display: block;
        }

        .keyboard-shortcuts-table {
            border-collapse: collapse;
        }

        .keyboard-shortcuts-table td {
            padding: 0.2rem 0.5rem;
        }

        .keyboard-shortcuts-table td:first-child {
            font-weight: bold;
        }

        .loading {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: rgba(46, 52, 64, 0.7);
            color: white;
            padding: 1rem;
            border-radius: 4px;
            display: none;
        }

        .loading.visible {
            display: block;
        }

        .shortcut-hint {
            position: absolute;
            bottom: 10px;
            right: 10px;
            background-color: rgba(46, 52, 64, 0.7);
            color: white;
            padding: 0.5rem;
            border-radius: 4px;
            font-size: 0.8rem;
            z-index: 50;
        }
    </style>
</head>
<body>
<header>
    <div class="title">LaTeX Editor</div>
    <div class="controls">
        <button id="new-btn" title="New Document (Ctrl+N)">New</button>
        <button id="save-btn" title="Save Document (Ctrl+S)">Save</button>
        <button id="load-btn" title="Load Document (Ctrl+O)">Load</button>
        <button id="export-btn" title="Export as .tex (Ctrl+E)">Export</button>
        <button id="templates-btn" title="Choose Template (Ctrl+T)">Templates</button>
        <button id="compile-btn" title="Compile Preview (Ctrl+Enter)">Compile</button>
        <button id="help-btn" title="Help (F1)">Help</button>
    </div>
</header>

<div class="container">
    <div class="editor-pane">
        <div class="toolbar">
            <div class="toolbar-group">
                <button data-insert="\section{Section Title}">Section</button>
                <button data-insert="\subsection{Subsection Title}">Subsection</button>
            </div>
            <div class="toolbar-group">
                <button data-insert="$$ $$" data-cursor-offset="3">Display Math</button>
                <button data-insert="$ $" data-cursor-offset="2">Inline Math</button>
            </div>
            <div class="toolbar-group">
                <button data-insert="\begin{align}\n  \n\end{align}" data-cursor-offset="12">Align</button>
                <button data-insert="\begin{gather}\n  \n\end{gather}" data-cursor-offset="14">Gather</button>
                <button data-insert="\begin{cases}\n  \n\end{cases}" data-cursor-offset="13">Cases</button>
            </div>
            <div class="toolbar-group">
                <button data-insert="\begin{itemize}\n  \item Item 1\n  \item Item 2\n\end{itemize}"
                        data-cursor-offset="17">Itemize
                </button>
                <button data-insert="\begin{enumerate}\n  \item Item 1\n  \item Item 2\n\end{enumerate}"
                        data-cursor-offset="19">Enumerate
                </button>
            </div>
            <div class="toolbar-group">
                <button data-insert="\frac{}{}" data-cursor-offset="6">Fraction</button>
                <button data-insert="\sqrt{}" data-cursor-offset="6">Square Root</button>
                <button data-insert="^{}" data-cursor-offset="2">Superscript</button>
                <button data-insert="_{}" data-cursor-offset="2">Subscript</button>
            </div>
            <div class="toolbar-group">
                <button data-insert="\int_{a}^{b}" data-cursor-offset="9">Integral</button>
                <button data-insert="\sum_{i=1}^{n}" data-cursor-offset="11">Sum</button>
                <button data-insert="\lim_{x \to \infty}" data-cursor-offset="17">Limit</button>
            </div>
        </div>
        <div class="message-container">
            <div id="error-message" class="error-message"></div>
            <div id="success-message" class="success-message"></div>
        </div>
        <textarea id="editor"></textarea>
        <div id="loading-indicator" class="loading">Compiling...</div>
        <div id="shortcut-hint" class="shortcut-hint">Press F1 for keyboard shortcuts</div>
    </div>
    <div class="preview-pane">
        <div id="preview" class="preview-content"></div>
    </div>
</div>

<footer>
    <div id="status">Ready</div>
    <div id="word-count">Words: 0</div>
</footer>

<div id="templates-menu" class="templates-menu">
    <div class="template-item" data-template="article">Article</div>
    <div class="template-item" data-template="math">Math Document</div>
    <div class="template-item" data-template="letter">Letter</div>
    <div class="template-item" data-template="notes">Lecture Notes</div>
    <div class="template-item" data-template="exercise">Exercise Sheet</div>
</div>

<div id="keyboard-shortcuts" class="keyboard-shortcuts">
    <h3>Keyboard Shortcuts</h3>
    <table class="keyboard-shortcuts-table">
        <tr>
            <td>Ctrl+S</td>
            <td>Save document</td>
        </tr>
        <tr>
            <td>Ctrl+N</td>
            <td>New document</td>
        </tr>
        <tr>
            <td>Ctrl+O</td>
            <td>Open document</td>
        </tr>
        <tr>
            <td>Ctrl+E</td>
            <td>Export document</td>
        </tr>
        <tr>
            <td>Ctrl+T</td>
            <td>Templates menu</td>
        </tr>
        <tr>
            <td>Ctrl+Enter</td>
            <td>Compile preview</td>
        </tr>
        <tr>
            <td>F1</td>
            <td>Show/hide help</td>
        </tr>
        <tr>
            <td>Esc</td>
            <td>Close popups</td>
        </tr>
    </table>
</div>

<!-- CodeMirror JS -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/codemirror.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/mode/stex/stex.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/addon/edit/matchbrackets.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/addon/edit/closebrackets.min.js"></script>

<!-- MathJax JS -->
<script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>

<script>
    // Templates
    const templates = {
        article: `\\documentclass{article}\n\\title{Sample Article}\n\\author{Your Name}\n\\date{\\today}\n\n\\begin{document}\n\n\\maketitle\n\n\\section{Introduction}\nThis is an introduction to your article. You can include inline math like $E=mc^2$ or display math:\n$$F = G\\frac{m_1 m_2}{r^2}$$\n\n\\section{Methods}\nThis section describes your methods.\n\n\\subsection{Experimental Setup}\nDetail your experimental setup here.\n\n\\section{Results}\nPresent your results here. You can use the align environment for equations:\n\\begin{align}\n  x &= \\frac{-b \\pm \\sqrt{b^2 - 4ac}}{2a}\\\\  \n  y &= mx + b\n\\end{align}\n\nYou can create lists:\n\\begin{itemize}\n  \\item First item\n  \\item Second item\n  \\item Third item with math: $f(x) = x^2$\n\\end{itemize}\n\nOr numbered lists:\n\\begin{enumerate}\n  \\item First step\n  \\item Second step\n  \\item Third step\n\\end{enumerate}\n\n\\section{Conclusion}\nSummarize your findings here.\n\n\\end{document}`,

        math: `\\documentclass{article}\n\\usepackage{amsmath,amssymb}\n\\title{Mathematical Expressions}\n\\author{Your Name}\n\\date{\\today}\n\n\\begin{document}\n\n\\maketitle\n\n\\section{Basic Math}\nHere are some basic mathematical expressions:\n\n$x^2 + y^2 = z^2$ is the Pythagorean theorem.\n\nThe quadratic formula is:\n$$x = \\frac{-b \\pm \\sqrt{b^2 - 4ac}}{2a}$$\n\n\\section{Advanced Math}\n\nA definite integral:\n$$\\int_{a}^{b} f(x) \\, dx = F(b) - F(a)$$\n\nA system of equations:\n\\begin{align}\n  a_1x + b_1y &= c_1 \\\\\n  a_2x + b_2y &= c_2\n\\end{align}\n\nA piecewise function:\n$$f(x) = \\begin{cases}\n  x^2 & \\text{if } x > 0 \\\\\n  0 & \\text{if } x = 0 \\\\\n  -x^2 & \\text{if } x < 0\n\\end{cases}$$\n\n\\section{Calculus}\n\nThe derivative of a function:\n$$\\frac{d}{dx}[x^n] = nx^{n-1}$$\n\nA limit expression:\n$$\\lim_{x \\to \\infty} \\frac{1}{x} = 0$$\n\nA summation:\n$$\\sum_{i=1}^{n} i = \\frac{n(n+1)}{2}$$\n\n\\end{document}`,

        letter: `\\documentclass{article}\n\\usepackage{geometry}\n\\geometry{margin=1in}\n\\title{Sample Letter}\n\\author{Your Name}\n\\date{\\today}\n\\begin{document}\n\n\\noindent Your Name \\\\\nYour Address \\\\\nCity, State ZIP \\\\\nYour Email\n\n\\vspace{1cm}\n\\noindent May 16, 2025\n\n\\vspace{0.5cm}\n\\noindent Recipient Name \\\\\nRecipient Title \\\\\nCompany Name \\\\\nStreet Address \\\\\nCity, State ZIP\n\n\\vspace{0.5cm}\n\\noindent Dear Recipient,\n\n\\vspace{0.3cm}\nThis is the first paragraph of your letter. State the purpose of your letter here.\n\nThis is the second paragraph. Provide additional details here.\n\nThis is the final paragraph. Conclude your letter appropriately.\n\n\\vspace{0.5cm}\n\\noindent Sincerely,\n\n\\vspace{1cm}\n\\noindent Your Name\n\n\\end{document}`,

        notes: `\\documentclass{article}\n\\usepackage{amsmath,amssymb}\n\\title{Lecture Notes: Introduction to LaTeX}\n\\author{Your Name}\n\\date{\\today}\n\n\\begin{document}\n\n\\maketitle\n\n\\section{Introduction}\nThese are lecture notes for our class. We'll cover several important concepts.\n\n\\subsection{Key Concepts}\nHere are the key concepts we'll explore:\n\\begin{itemize}\n  \\item Document Structure\n  \\item Mathematical Typesetting\n  \\item Figures and Tables\n\\end{itemize}\n\n\\section{Mathematical Notation}\nLaTeX excels at typesetting mathematics:\n\n\\subsection{Equations}\nThe mass-energy equivalence is given by:\n$$E = mc^2$$\n\nNewton's Second Law states:\n$$F = ma$$\n\n\\subsection{Multi-line Equations}\nSolving a quadratic equation:\n\\begin{align}\n  ax^2 + bx + c &= 0 \\\\\n  x^2 + \\frac{b}{a}x + \\frac{c}{a} &= 0 \\\\\n  x &= \\frac{-b \\pm \\sqrt{b^2 - 4ac}}{2a}\n\\end{align}\n\n\\section{Important Theorems}\n\\begin{enumerate}\n  \\item \\textbf{Pythagorean Theorem:} In a right triangle, $a^2 + b^2 = c^2$\n  \\item \\textbf{Fundamental Theorem of Calculus:} $\\int_a^b f'(x)\\,dx = f(b) - f(a)$\n\\end{enumerate}\n\n\\end{document}`,

        exercise: `\\documentclass{article}\n\\usepackage{amsmath,amssymb}\n\\title{Mathematics Exercise Sheet 1}\n\\author{Course Instructor}\n\\date{\\today}\n\n\\begin{document}\n\n\\maketitle\n\n\\section*{Instructions}\nSolve the following problems and submit your solutions by the deadline. Show all your work clearly.\n\n\\section{Algebra}\n\\begin{enumerate}\n  \\item Solve for $x$: $3x + 5 = 11$\n  \n  \\item Factor completely: $x^2 - 9$\n  \n  \\item Solve the system of equations:\n  \\begin{align}\n    2x + y &= 5 \\\\\n    x - y &= 1\n  \\end{align}\n\\end{enumerate}\n\n\\section{Calculus}\n\\begin{enumerate}\n  \\item Find the derivative of $f(x) = x^3 + 2x^2 - 4x + 7$\n  \n  \\item Evaluate: $\\int_0^1 (x^2 + 3x)\\,dx$\n  \n  \\item Find the local extrema of $f(x) = x^3 - 3x^2 - 9x + 5$\n\\end{enumerate}\n\n\\section{Bonus Problem}\nProve that for any positive integer $n$:\n$$1 + 2 + 3 + \\ldots + n = \\frac{n(n+1)}{2}$$\n\n\\end{document}`
    };

    // Initialize CodeMirror
    const editor = CodeMirror.fromTextArea(document.getElementById("editor"), {
        mode: "stex",
        theme: "nord",
        lineNumbers: true,
        matchBrackets: true,
        autoCloseBrackets: true,
        lineWrapping: true,
        indentUnit: 2,
        extraKeys: {
            "Tab": function (cm) {
                const spaces = Array(cm.getOption("indentUnit") + 1).join(" ");
                cm.replaceSelection(spaces);
            }
        }
    });

    // Initialize with default template
    editor.setValue(templates.article);

    // Variables
    let previewTimeout;
    const previewDelay = 800; // Delay for preview update
    const preview = document.getElementById("preview");
    const status = document.getElementById("status");
    const wordCount = document.getElementById("word-count");
    const errorMessage = document.getElementById("error-message");
    const successMessage = document.getElementById("success-message");
    const loadingIndicator = document.getElementById("loading-indicator");
    const keyboardShortcuts = document.getElementById("keyboard-shortcuts");
    const shortcutHint = document.getElementById("shortcut-hint");

    // Hide shortcut hint after 5 seconds
    setTimeout(() => {
        shortcutHint.style.display = "none";
    }, 5000);

    // Custom LaTeX to HTML parser
    function parseLatexToHtml(latexCode) {
        try {
            // Extract metadata (title, author, date)
            let title = "Untitled Document";
            let author = "";
            let date = "";

            const titleMatch = latexCode.match(/\\title\{(.*?)\}/);
            if (titleMatch) title = titleMatch[1];

            const authorMatch = latexCode.match(/\\author\{(.*?)\}/);
            if (authorMatch) author = authorMatch[1];

            const dateMatch = latexCode.match(/\\date\{(.*?)\}/);
            if (dateMatch) date = dateMatch[1];
            if (date === "\\today") {
                const today = new Date();
                date = today.toLocaleDateString('en-US', {year: 'numeric', month: 'long', day: 'numeric'});
            }

            // Extract content between \begin{document} and \end{document}
            let content = latexCode;
            const docMatch = latexCode.match(/\\begin\{document\}([\s\S]*?)\\end\{document\}/);
            if (docMatch) {
                content = docMatch[1];
            }

            // Remove \maketitle command and add title/author/date manually
            let html = '';
            if (content.includes('\\maketitle')) {
                content = content.replace(/\\maketitle/, '');
                html += `<div class="document-title">${title}</div>`;
                if (author) html += `<div class="document-author">${author}</div>`;
                if (date) html += `<div class="document-date">${date}</div>`;
            }

            // Check if it's a letter format
            const isLetter = content.includes('\\noindent') && content.includes('Dear ');

            if (isLetter) {
                // Handle letter format differently
                return parseLetter(content, title);
            }

            // Replace section and subsection commands
            content = content.replace(/\\section\*?\{(.*?)\}/g, '<div class="section-title">$1</div>');
            content = content.replace(/\\subsection\*?\{(.*?)\}/g, '<div class="subsection-title">$1</div>');
            content = content.replace(/\\chapter\*?\{(.*?)\}/g, '<div class="section-title">$1</div>');

            // Process environments
            content = processEnvironments(content);

            // Process line breaks
            content = content.replace(/\\\\/g, '<br>');

            // Handle special LaTeX commands
            content = content.replace(/\\noindent\s+/g, '<span class="noindent">');
            content = content.replace(/\\vspace\{.*?\}/g, '<div class="vspace"></div>');
            content = content.replace(/\\textbf\{(.*?)\}/g, '<strong>$1</strong>');
            content = content.replace(/\\textit\{(.*?)\}/g, '<em>$1</em>');
            content = content.replace(/\\emph\{(.*?)\}/g, '<em>$1</em>');

            // Process content by paragraphs
            const paragraphs = content.split(/\n\s*\n/);

            for (const para of paragraphs) {
                if (para.trim() === '') continue;

                // Skip if already a section or subsection
                if (para.includes('class="section-title"') || para.includes('class="subsection-title"') ||
                    para.includes('latex-itemize') || para.includes('latex-enumerate')) {
                    html += para;
                } else {
                    // Regular paragraph
                    html += `<div class="paragraph">${para}</div>`;
                }
            }

            return html;
        } catch (err) {
            console.error('LaTeX parsing error:', err);
            return `<div class="error">Error parsing LaTeX: ${err.message}</div>${latexCode}`;
        }
    }

    // Process LaTeX environments (itemize, enumerate, etc.)
    function processEnvironments(content) {
        // Process itemize
        content = processItemizeEnvironment(content);

        // Process enumerate
        content = processEnumerateEnvironment(content);

        return content;
    }

    // Process itemize environment
    function processItemizeEnvironment(content) {
        let result = content;
        const itemizeRegex = /\\begin\{itemize\}([\s\S]*?)\\end\{itemize\}/g;

        result = result.replace(itemizeRegex, function (match, itemsContent) {
            // Process \item commands
            const items = itemsContent.split('\\item').filter(item => item.trim() !== '');

            let itemsHtml = '<ul class="latex-itemize">';
            for (const item of items) {
                itemsHtml += `<li class="latex-item">${item.trim()}</li>`;
            }
            itemsHtml += '</ul>';

            return itemsHtml;
        });

        return result;
    }

    // Process enumerate environment
    function processEnumerateEnvironment(content) {
        let result = content;
        const enumerateRegex = /\\begin\{enumerate\}([\s\S]*?)\\end\{enumerate\}/g;

        result = result.replace(enumerateRegex, function (match, itemsContent) {
            // Process \item commands
            const items = itemsContent.split('\\item').filter(item => item.trim() !== '');

            let itemsHtml = '<ol class="latex-enumerate">';
            for (const item of items) {
                itemsHtml += `<li class="latex-item">${item.trim()}</li>`;
            }
            itemsHtml += '</ol>';

            return itemsHtml;
        });

        return result;
    }

    // Special parsing for letter format
    function parseLetter(content, title) {
        let html = `<div class="document-title">${title || 'Letter'}</div>`;
        html += '<div class="latex-letter">';

        // Extract sender info
        const senderMatch = content.match(/\\noindent\s+(.*?)(?=\\vspace|\\noindent|$)/s);
        if (senderMatch && senderMatch[1]) {
            const senderInfo = senderMatch[1].replace(/\\\\/g, '<br>');
            html += `<div class="letter-address">${senderInfo}</div>`;
        }

        // Extract date
        const dateMatch = content.match(/(?:May 16, 2025|\\today)/);
        if (dateMatch) {
            html += `<div class="letter-date">May 16, 2025</div>`;
        }

        // Extract recipient
        const recipientMatch = content.match(/\\noindent\s+Recipient([\s\S]*?)(?=\\vspace|\\noindent|$)/s);
        if (recipientMatch && recipientMatch[0]) {
            const recipientInfo = recipientMatch[0].replace(/\\noindent\s+/g, '').replace(/\\\\/g, '<br>');
            html += `<div class="letter-recipient">${recipientInfo}</div>`;
        }

        // Extract greeting
        const greetingMatch = content.match(/\\noindent\s+Dear(.*?)(?=\\vspace|$)/);
        if (greetingMatch && greetingMatch[0]) {
            html += `<div class="letter-greeting">${greetingMatch[0].replace(/\\noindent\s+/g, '')},</div>`;
        }

        // Extract paragraphs
        const bodyStart = content.indexOf('This is the first paragraph');
        const bodyEnd = content.indexOf('\\vspace', bodyStart);

        if (bodyStart > -1 && bodyEnd > -1) {
            const bodyContent = content.substring(bodyStart, bodyEnd);
            const paragraphs = bodyContent.split(/\n\s*\n/);

            html += '<div class="letter-body">';
            for (const para of paragraphs) {
                if (para.trim() !== '') {
                    html += `<p>${para.trim()}</p>`;
                }
            }
            html += '</div>';
        }

        // Extract closing
        const closingMatch = content.match(/\\noindent\s+Sincerely,/);
        if (closingMatch) {
            html += `<div class="letter-closing">Sincerely,</div>`;
        }

        // Extract signature
        const signatureMatch = content.match(/\\noindent\s+Your Name\s*$/m);
        if (signatureMatch) {
            html += `<div class="letter-signature">Your Name</div>`;
        }

        html += '</div>';
        return html;
    }

    // Update preview function
    function updatePreview() {
        try {
            showLoading();
            const latexCode = editor.getValue();

            // Update word count
            const words = latexCode.split(/\s+/).filter(word => word.length > 0).length;
            wordCount.textContent = `Words: ${words}`;

            // Parse LaTeX to HTML
            const html = parseLatexToHtml(latexCode);

            // Update preview content
            preview.innerHTML = html;

            // Render math with MathJax
            if (window.MathJax) {
                MathJax.typesetPromise([preview]).then(() => {
                    status.textContent = 'Preview updated';
                    hideError();
                    showSuccess('Preview updated');
                    hideLoading();
                }).catch(err => {
                    console.error('MathJax error:', err);
                    status.textContent = 'Error in math rendering';
                    showError(`MathJax error: ${err.message || 'Check your LaTeX syntax'}`);
                    hideLoading();
                });
            } else {
                hideLoading();
            }
        } catch (err) {
            console.error('Preview error:', err);
            status.textContent = 'Error generating preview';
            showError(`Preview error: ${err.message}`);
            hideLoading();
        }
    }

    // Error and success message handling
    function showError(message) {
        errorMessage.textContent = message;
        errorMessage.classList.add('visible');
        successMessage.classList.remove('visible');

        // Auto-hide after 5 seconds
        setTimeout(() => {
            hideError();
        }, 5000);
    }

    function hideError() {
        errorMessage.classList.remove('visible');
    }

    function showSuccess(message) {
        successMessage.textContent = message;
        successMessage.classList.add('visible');
        errorMessage.classList.remove('visible');

        // Auto-hide after 3 seconds
        setTimeout(() => {
            hideSuccess();
        }, 3000);
    }

    function hideSuccess() {
        successMessage.classList.remove('visible');
    }

    // Loading indicator
    function showLoading() {
        loadingIndicator.classList.add('visible');
    }

    function hideLoading() {
        loadingIndicator.classList.remove('visible');
    }

    // Keyboard shortcuts toggle
    function toggleKeyboardShortcuts() {
        keyboardShortcuts.classList.toggle('visible');
    }

    // Manual compile button
    document.getElementById('compile-btn').addEventListener('click', () => {
        clearTimeout(previewTimeout);
        status.textContent = 'Compiling...';
        updatePreview();
    });

    // Set up editor change event with debounce
    editor.on('change', () => {
        status.textContent = 'Editing...';
        clearTimeout(previewTimeout);
        previewTimeout = setTimeout(updatePreview, previewDelay);
    });

    // Help button
    document.getElementById('help-btn').addEventListener('click', toggleKeyboardShortcuts);

    // Initial preview update
    setTimeout(updatePreview, 500);

    // Template menu functionality
    const templatesBtn = document.getElementById('templates-btn');
    const templatesMenu = document.getElementById('templates-menu');
    const templateItems = document.querySelectorAll('.template-item');

    templatesBtn.addEventListener('click', () => {
        templatesMenu.classList.toggle('visible');
    });

    templateItems.forEach(item => {
        item.addEventListener('click', () => {
            const templateName = item.getAttribute('data-template');
            if (confirm('Change template? Unsaved changes will be lost.')) {
                editor.setValue(templates[templateName]);
                templatesMenu.classList.remove('visible');
                clearTimeout(previewTimeout);
                updatePreview();
            }
        });
    });

    // Close template menu when clicking outside
    document.addEventListener('click', (e) => {
        if (!templatesMenu.contains(e.target) && e.target !== templatesBtn) {
            templatesMenu.classList.remove('visible');
        }
    });

    // Button functionality
    document.getElementById('new-btn').addEventListener('click', () => {
        if (confirm('Create a new document? Unsaved changes will be lost.')) {
            editor.setValue(templates.article);
            clearTimeout(previewTimeout);
            updatePreview();
        }
    });

    document.getElementById('save-btn').addEventListener('click', () => {
        try {
            const content = editor.getValue();
            localStorage.setItem('latexeditor_content', content);

            // Get title for filename
            const titleMatch = content.match(/\\title\{(.*?)\}/);
            const title = titleMatch ? titleMatch[1].replace(/[^a-z0-9]/gi, '_').toLowerCase() : 'untitled';

            // Also offer download
            const blob = new Blob([content], {type: 'text/plain'});
            const a = document.createElement('a');
            a.href = URL.createObjectURL(blob);
            a.download = `${title}.tex`;
            a.click();

            status.textContent = 'Document saved';
            showSuccess('Document saved and downloaded');
        } catch (err) {
            showError(`Save error: ${err.message}`);
        }
    });

    document.getElementById('load-btn').addEventListener('click', () => {
        try {
            // First try localStorage
            const savedContent = localStorage.getItem('latexeditor_content');

            if (savedContent && confirm('Load saved document? Unsaved changes will be lost.')) {
                editor.setValue(savedContent);
                clearTimeout(previewTimeout);
                updatePreview();
                status.textContent = 'Document loaded';
                showSuccess('Document loaded from local storage');
            } else {
                // File upload
                const input = document.createElement('input');
                input.type = 'file';
                input.accept = '.tex';

                input.onchange = e => {
                    const file = e.target.files[0];
                    if (file) {
                        const reader = new FileReader();
                        reader.onload = function (e) {
                            editor.setValue(e.target.result);
                            clearTimeout(previewTimeout);
                            updatePreview();
                            status.textContent = `Loaded ${file.name}`;
                            showSuccess(`Loaded ${file.name}`);
                        };
                        reader.readAsText(file);
                    }
                };

                input.click();
            }
        } catch (err) {
            showError(`Load error: ${err.message}`);
        }
    });

    document.getElementById('export-btn').addEventListener('click', () => {
        try {
            const content = editor.getValue();
            const titleMatch = content.match(/\\title\{(.*?)\}/);
            const title = titleMatch ? titleMatch[1].replace(/[^a-z0-9]/gi, '_').toLowerCase() : 'untitled';

            const blob = new Blob([content], {type: 'text/plain'});
            const a = document.createElement('a');
            a.href = URL.createObjectURL(blob);
            a.download = `${title}.tex`;
            a.click();

            status.textContent = 'Document exported';
            showSuccess('Document exported as .tex file');
        } catch (err) {
            showError(`Export error: ${err.message}`);
        }
    });

    // Toolbar buttons
    document.querySelectorAll('.toolbar button').forEach(button => {
        button.addEventListener('click', () => {
            const insertText = button.getAttribute('data-insert');
            const cursorOffset = parseInt(button.getAttribute('data-cursor-offset') || '0');

            const cursor = editor.getCursor();
            editor.replaceRange(insertText, cursor);

            // Position cursor at specified offset or inside braces if present
            if (cursorOffset > 0) {
                editor.setCursor({line: cursor.line, ch: cursor.ch + cursorOffset});
            } else if (insertText.includes('{}')) {
                const bracePos = insertText.indexOf('{}');
                editor.setCursor({line: cursor.line, ch: cursor.ch + bracePos + 1});
            } else if (insertText.includes('\n')) {
                // Count newlines to position cursor
                const newlineCount = insertText.split('\n').length - 1;
                const newlinePos = insertText.lastIndexOf('\n');
                if (newlinePos !== -1 && newlinePos !== insertText.length - 1) {
                    // Position after the last newline
                    editor.setCursor({line: cursor.line + newlineCount, ch: 2});
                } else {
                    // Position at the first newline
                    editor.setCursor({line: cursor.line + 1, ch: 2});
                }
            }
            editor.focus();
        });
    });

    // Keyboard shortcuts
    document.addEventListener('keydown', (e) => {
        // Ctrl/Cmd + S to save
        if ((e.ctrlKey || e.metaKey) && e.key === 's') {
            e.preventDefault();
            document.getElementById('save-btn').click();
        }

        // Ctrl/Cmd + Enter to compile
        if ((e.ctrlKey || e.metaKey) && e.key === 'Enter') {
            e.preventDefault();
            document.getElementById('compile-btn').click();
        }

        // Ctrl/Cmd + N for new document
        if ((e.ctrlKey || e.metaKey) && e.key === 'n') {
            e.preventDefault();
            document.getElementById('new-btn').click();
        }

        // Ctrl/Cmd + O to open/load document
        if ((e.ctrlKey || e.metaKey) && e.key === 'o') {
            e.preventDefault();
            document.getElementById('load-btn').click();
        }

        // Ctrl/Cmd + E to export document
        if ((e.ctrlKey || e.metaKey) && e.key === 'e') {
            e.preventDefault();
            document.getElementById('export-btn').click();
        }

        // Ctrl/Cmd + T for templates
        if ((e.ctrlKey || e.metaKey) && e.key === 't') {
            e.preventDefault();
            document.getElementById('templates-btn').click();
        }

        // F1 for help
        if (e.key === 'F1') {
            e.preventDefault();
            toggleKeyboardShortcuts();
        }

        // Escape to close popups
        if (e.key === 'Escape') {
            templatesMenu.classList.remove('visible');
            keyboardShortcuts.classList.remove('visible');
            hideError();
            hideSuccess();
        }
    });

    // Auto-save every 30 seconds
    let autoSaveInterval = setInterval(() => {
        const content = editor.getValue();
        if (content.trim() !== '') {
            localStorage.setItem('latexeditor_autosave', content);
            status.textContent = 'Auto-saved';
            setTimeout(() => {
                status.textContent = 'Ready';
            }, 1000);
        }
    }, 30000);

    // Check for auto-saved content on load
    (() => {
        try {
            const autosaved = localStorage.getItem('latexeditor_autosave');
            if (autosaved && confirm('Restore auto-saved content?')) {
                editor.setValue(autosaved);
                setTimeout(updatePreview, 300);
            } else {
                setTimeout(updatePreview, 300);
            }
        } catch (err) {
            console.error('Auto-save recovery error:', err);
        }
    })();

    // Ensure editor gets focus after page load
    setTimeout(() => {
        editor.focus();
    }, 800);
</script>
</body>
</html>