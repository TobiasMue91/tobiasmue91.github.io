<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="description" content="Free online image resizer with batch processing, format conversion, rotation, and ZIP download. Supports JPEG, PNG, WebP, and GIF with transparency control.">
    <meta name="keywords" content="image resizer, batch image resize, online image tool, convert image format, resize photos, compress images, PNG, JPEG, WebP, GIF">
    <meta name="author" content="Claude Opus 4.6 prompted by Tobias Müller">
    <meta name="robots" content="index, follow">
    <link rel="canonical" href="https://www.gptgames.dev/tools/image_resizer.html">
    <meta property="og:type" content="website">
    <meta property="og:title" content="Image Resizer — Batch Resize, Convert & Download">
    <meta property="og:description" content="Free online image resizer with batch processing, format conversion, rotation, and ZIP download. Supports JPEG, PNG, WebP, and GIF.">
    <meta property="og:url" content="https://www.gptgames.dev/tools/image_resizer.html">
    <meta property="og:image" content="https://www.gptgames.dev/screenshots/screenshot_106.webp">
    <meta property="og:image:width" content="1200">
    <meta property="og:image:height" content="630">
    <meta property="og:site_name" content="GPTGames">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Image Resizer — Batch Resize, Convert & Download">
    <meta name="twitter:description" content="Free online image resizer with batch processing, format conversion, rotation, and ZIP download. Supports JPEG, PNG, WebP, and GIF.">
    <meta name="twitter:image" content="https://www.gptgames.dev/screenshots/screenshot_106.webp">
    <title>Image Resizer</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css">
    <script src="https://cdn.jsdelivr.net/npm/jszip@3.10.1/dist/jszip.min.js"></script>
    <style>
        *, *::before, *::after {
            box-sizing: border-box;
            margin: 0;
            padding: 0
        }

        :root {
            --primary: #2563eb;
            --primary-hover: #1d4ed8;
            --surface: #fff;
            --bg: #f1f5f9;
            --bg-alt: #e9edf3;
            --text: #0f172a;
            --text-muted: #64748b;
            --border: #e2e8f0;
            --success: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
            --radius: 6px;
            --shadow: 0 1px 3px rgba(0, 0, 0, .08);
            --shadow-lg: 0 4px 12px rgba(0, 0, 0, .1);
            --sidebar-w: 380px;
            --checker1: #e8ecf0;
            --checker2: #fff
        }

        @media (prefers-color-scheme: dark) {
            :root {
                --primary: #3b82f6;
                --primary-hover: #60a5fa;
                --surface: #1e293b;
                --bg: #0f172a;
                --bg-alt: #1a2536;
                --text: #e2e8f0;
                --text-muted: #94a3b8;
                --border: #334155;
                --success: #34d399;
                --warning: #fbbf24;
                --danger: #f87171;
                --shadow: 0 1px 3px rgba(0, 0, 0, .3);
                --shadow-lg: 0 4px 12px rgba(0, 0, 0, .4);
                --checker1: #1a2536;
                --checker2: #233044
            }
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--bg);
            color: var(--text);
            line-height: 1.5;
            min-height: 100vh
        }

        .app {
            display: flex;
            flex-direction: column;
            min-height: 100vh
        }

        header {
            background: var(--surface);
            border-bottom: 1px solid var(--border);
            padding: 12px 24px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            position: sticky;
            top: 0;
            z-index: 50;
            gap: 12px;
            flex-wrap: wrap
        }

        header h1 {
            font-size: 1.1rem;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 8px;
            white-space: nowrap
        }

        header h1 i {
            color: var(--primary);
            font-size: 1.2rem
        }

        .header-right {
            display: flex;
            align-items: center;
            gap: 12px
        }

        .header-right .hint {
            font-size: .75rem;
            color: var(--text-muted)
        }

        .mode-toggle {
            display: flex;
            background: var(--bg);
            border-radius: var(--radius);
            padding: 3px;
            gap: 2px
        }

        .mode-btn {
            padding: 5px 14px;
            font-size: .78rem;
            font-weight: 600;
            border: none;
            background: transparent;
            border-radius: 4px;
            cursor: pointer;
            color: var(--text-muted);
            transition: all .15s
        }

        .mode-btn.active {
            background: var(--surface);
            color: var(--text);
            box-shadow: var(--shadow)
        }

        main {
            display: flex;
            flex: 1;
            overflow: hidden
        }

        .sidebar {
            width: var(--sidebar-w);
            min-width: var(--sidebar-w);
            background: var(--surface);
            border-right: 1px solid var(--border);
            overflow-y: auto;
            padding: 16px
        }

        .preview-area {
            flex: 1;
            display: flex;
            flex-direction: column;
            padding: 16px;
            overflow: hidden;
            min-width: 0
        }

        .section {
            margin-bottom: 8px;
            border: 1px solid var(--border);
            border-radius: var(--radius);
            overflow: hidden
        }

        .section-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 10px 14px;
            cursor: pointer;
            font-size: .8rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: .03em;
            color: var(--text-muted);
            user-select: none;
            background: var(--surface);
            transition: background .15s
        }

        .section-header:hover {
            background: var(--bg)
        }

        .section-header i.chevron {
            transition: transform .2s;
            font-size: .7rem
        }

        .section.collapsed .section-body {
            display: none
        }

        .section.collapsed .chevron {
            transform: rotate(-90deg)
        }

        .section-body {
            padding: 14px;
            border-top: 1px solid var(--border)
        }

        .drop-zone {
            border: 2px dashed var(--border);
            border-radius: var(--radius);
            padding: 28px 16px;
            text-align: center;
            cursor: pointer;
            transition: border-color .2s, background .2s
        }

        .drop-zone:hover, .drop-zone.dragover {
            border-color: var(--primary);
            background: rgba(37, 99, 235, .04)
        }

        .drop-zone i {
            font-size: 2rem;
            color: var(--text-muted);
            display: block;
            margin-bottom: 6px
        }

        .drop-zone p {
            font-size: .85rem;
            color: var(--text-muted);
            margin: 4px 0
        }

        .drop-zone .browse {
            color: var(--primary);
            font-weight: 600;
            text-decoration: underline;
            cursor: pointer
        }

        .url-row {
            display: flex;
            gap: 6px;
            margin-top: 10px
        }

        .url-row input {
            flex: 1
        }

        .img-info {
            font-size: .75rem;
            color: var(--text-muted);
            margin-top: 8px;
            padding: 8px;
            background: var(--bg);
            border-radius: var(--radius)
        }

        input[type=text], input[type=number], select {
            width: 100%;
            height: 36px;
            padding: 0 10px;
            border: 1px solid var(--border);
            border-radius: var(--radius);
            font-size: .85rem;
            background: var(--surface);
            color: var(--text);
            outline: none;
            transition: border-color .15s
        }

        input:focus, select:focus {
            border-color: var(--primary)
        }

        input[type=number] {
            -moz-appearance: textfield
        }

        input[type=number]::-webkit-outer-spin-button, input[type=number]::-webkit-inner-spin-button {
            -webkit-appearance: none
        }

        select {
            cursor: pointer;
            appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath fill='%2364748b' d='M6 8L1 3h10z'/%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 10px center;
            padding-right: 28px
        }

        label {
            display: block;
            font-size: .78rem;
            font-weight: 600;
            color: var(--text-muted);
            margin-bottom: 4px;
            text-transform: uppercase;
            letter-spacing: .02em
        }

        .dim-row {
            display: flex;
            gap: 8px;
            align-items: end;
            margin-bottom: 10px
        }

        .dim-row .field {
            flex: 1
        }

        .dim-row .lock {
            width: 36px;
            height: 36px;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 1px solid var(--border);
            border-radius: var(--radius);
            cursor: pointer;
            color: var(--text-muted);
            transition: all .15s;
            flex-shrink: 0;
            background: var(--surface)
        }

        .dim-row .lock.active {
            color: var(--primary);
            border-color: var(--primary);
            background: rgba(37, 99, 235, .06)
        }

        .dim-row .lock:hover {
            border-color: var(--primary)
        }

        .presets {
            display: flex;
            flex-wrap: wrap;
            gap: 4px;
            margin-bottom: 12px
        }

        .preset-btn {
            padding: 4px 10px;
            font-size: .72rem;
            font-weight: 600;
            border: 1px solid var(--border);
            border-radius: 100px;
            background: var(--surface);
            color: var(--text-muted);
            cursor: pointer;
            transition: all .15s;
            white-space: nowrap
        }

        .preset-btn:hover {
            border-color: var(--primary);
            color: var(--primary)
        }

        input[type=range] {
            -webkit-appearance: none;
            width: 100%;
            height: 4px;
            border-radius: 2px;
            background: var(--border);
            outline: none;
            margin: 8px 0
        }

        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 16px;
            height: 16px;
            border-radius: 50%;
            background: var(--primary);
            cursor: pointer;
            border: 2px solid var(--surface);
            box-shadow: var(--shadow)
        }

        input[type=range]::-moz-range-thumb {
            width: 16px;
            height: 16px;
            border-radius: 50%;
            background: var(--primary);
            cursor: pointer;
            border: 2px solid var(--surface);
            box-shadow: var(--shadow)
        }

        .range-row {
            display: flex;
            align-items: center;
            gap: 10px
        }

        .range-row input[type=range] {
            flex: 1
        }

        .range-row span {
            font-size: .8rem;
            font-weight: 600;
            min-width: 38px;
            text-align: right;
            color: var(--text-muted)
        }

        .transform-row {
            display: flex;
            gap: 6px
        }

        .transform-row button {
            flex: 1;
            height: 36px;
            border: 1px solid var(--border);
            border-radius: var(--radius);
            background: var(--surface);
            cursor: pointer;
            font-size: .9rem;
            color: var(--text-muted);
            transition: all .15s;
            display: flex;
            align-items: center;
            justify-content: center
        }

        .transform-row button:hover {
            border-color: var(--primary);
            color: var(--primary)
        }

        .fit-row {
            margin-top: 10px
        }

        .fit-options {
            display: flex;
            gap: 4px
        }

        .fit-opt {
            flex: 1;
            padding: 6px;
            text-align: center;
            font-size: .72rem;
            font-weight: 600;
            border: 1px solid var(--border);
            border-radius: var(--radius);
            background: var(--surface);
            cursor: pointer;
            color: var(--text-muted);
            transition: all .15s
        }

        .fit-opt.active {
            border-color: var(--primary);
            color: var(--primary);
            background: rgba(37, 99, 235, .06)
        }

        .fit-opt:hover {
            border-color: var(--primary)
        }

        .transparency-section {
            margin-top: 10px;
            padding-top: 10px;
            border-top: 1px solid var(--border)
        }

        .bg-color-row {
            display: flex;
            gap: 8px;
            align-items: center;
            margin-top: 6px;
            flex-wrap: wrap
        }

        .bg-color-row input[type=color] {
            width: 36px;
            height: 36px;
            padding: 2px;
            border: 1px solid var(--border);
            border-radius: var(--radius);
            cursor: pointer;
            background: var(--surface)
        }

        .bg-color-row input[type=text] {
            width: 80px
        }

        .switch {
            position: relative;
            display: inline-flex;
            align-items: center;
            gap: 6px;
            cursor: pointer;
            font-size: .78rem;
            color: var(--text-muted)
        }

        .switch input {
            display: none
        }

        .switch .track {
            width: 32px;
            height: 18px;
            border-radius: 9px;
            background: var(--border);
            position: relative;
            transition: background .15s
        }

        .switch input:checked + .track {
            background: var(--primary)
        }

        .switch .track::after {
            content: '';
            position: absolute;
            width: 14px;
            height: 14px;
            border-radius: 50%;
            background: #fff;
            top: 2px;
            left: 2px;
            transition: transform .15s;
            box-shadow: 0 1px 2px rgba(0, 0, 0, .15)
        }

        .switch input:checked + .track::after {
            transform: translateX(14px)
        }

        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
            height: 36px;
            padding: 0 16px;
            border: none;
            border-radius: var(--radius);
            font-size: .85rem;
            font-weight: 600;
            cursor: pointer;
            transition: all .15s;
            text-decoration: none;
            color: inherit
        }

        .btn-primary {
            background: var(--primary);
            color: #fff
        }

        .btn-primary:hover {
            background: var(--primary-hover)
        }

        .btn-success {
            background: var(--success);
            color: #fff
        }

        .btn-success:hover {
            opacity: .9
        }

        .btn-outline {
            background: var(--surface);
            color: var(--text-muted);
            border: 1px solid var(--border)
        }

        .btn-outline:hover {
            border-color: var(--primary);
            color: var(--primary)
        }

        .btn-danger {
            background: var(--danger);
            color: #fff
        }

        .btn-block {
            width: 100%
        }

        .actions-row {
            display: flex;
            gap: 8px;
            margin-top: 12px
        }

        .actions-row .btn {
            flex: 1
        }

        .preview-tabs {
            display: flex;
            gap: 2px;
            margin-bottom: 12px;
            background: var(--bg);
            border-radius: var(--radius);
            padding: 3px
        }

        .preview-tab {
            flex: 1;
            padding: 7px 12px;
            text-align: center;
            font-size: .78rem;
            font-weight: 600;
            border: none;
            background: transparent;
            border-radius: 4px;
            cursor: pointer;
            color: var(--text-muted);
            transition: all .15s
        }

        .preview-tab.active {
            background: var(--surface);
            color: var(--text);
            box-shadow: var(--shadow)
        }

        .preview-tab:hover:not(.active) {
            color: var(--text)
        }

        .checker-bg {
            background-color: var(--checker2);
            background-image: linear-gradient(45deg, var(--checker1) 25%, transparent 25%), linear-gradient(-45deg, var(--checker1) 25%, transparent 25%), linear-gradient(45deg, transparent 75%, var(--checker1) 75%), linear-gradient(-45deg, transparent 75%, var(--checker1) 75%);
            background-size: 16px 16px;
            background-position: 0 0, 0 8px, 8px -8px, -8px 0
        }

        .preview-box {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: var(--radius);
            position: relative;
            overflow: hidden;
            min-height: 300px
        }

        .preview-box img {
            max-width: 100%;
            max-height: 100%;
            object-fit: contain;
            display: block
        }

        .preview-box .empty {
            text-align: center;
            color: var(--text-muted);
            padding: 40px
        }

        .preview-box .empty i {
            font-size: 3rem;
            display: block;
            margin-bottom: 8px;
            opacity: .4
        }

        .preview-box .empty p {
            font-size: .85rem
        }

        .preview-info {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-top: 10px;
            padding: 10px 14px;
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: var(--radius);
            font-size: .8rem;
            flex-wrap: wrap;
            gap: 8px
        }

        .preview-info .dims {
            font-weight: 600
        }

        .preview-info .size {
            color: var(--text-muted)
        }

        .preview-info .savings {
            color: var(--success);
            font-weight: 600
        }

        .download-bar {
            margin-top: 10px
        }

        /* Compare */
        .compare-container {
            position: absolute;
            inset: 0;
            cursor: col-resize;
            user-select: none;
            overflow: hidden
        }

        .compare-container img {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            max-width: 100%;
            max-height: 100%;
            object-fit: contain;
            pointer-events: none
        }

        .compare-container .cmp-overlay {
            position: absolute;
            top: 0;
            left: 0;
            bottom: 0;
            overflow: hidden
        }

        .compare-container .cmp-overlay img {
            position: absolute;
            top: 50%;
            left: 0;
            transform: translateY(-50%);
            max-height: 100%;
            object-fit: contain;
            pointer-events: none
        }

        .compare-divider {
            position: absolute;
            top: 0;
            bottom: 0;
            width: 2px;
            background: var(--primary);
            pointer-events: none;
            z-index: 5;
            transform: translateX(-1px)
        }

        .compare-handle {
            position: absolute;
            top: 50%;
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: var(--primary);
            border: 2px solid #fff;
            box-shadow: var(--shadow-lg);
            z-index: 6;
            display: flex;
            align-items: center;
            justify-content: center;
            pointer-events: none;
            transform: translate(-50%, -50%)
        }

        .compare-handle i {
            color: #fff;
            font-size: .7rem
        }

        .cmp-labels {
            position: absolute;
            top: 10px;
            left: 0;
            right: 0;
            display: flex;
            justify-content: space-between;
            padding: 0 12px;
            pointer-events: none;
            z-index: 4
        }

        .cmp-labels span {
            background: rgba(0, 0, 0, .6);
            color: #fff;
            padding: 2px 10px;
            border-radius: 100px;
            font-size: .7rem;
            font-weight: 600
        }

        /* Batch */
        .batch-grid {
            flex: 1;
            overflow-y: auto;
            display: grid;
            grid-template-columns:repeat(auto-fill, minmax(180px, 1fr));
            gap: 12px;
            padding: 4px;
            align-content: start
        }

        .batch-card {
            border: 1px solid var(--border);
            border-radius: var(--radius);
            overflow: hidden;
            background: var(--surface);
            position: relative;
            transition: box-shadow .15s
        }

        .batch-card:hover {
            box-shadow: var(--shadow-lg)
        }

        .batch-thumb {
            width: 100%;
            aspect-ratio: 1;
            object-fit: cover;
            display: block;
            background: var(--bg)
        }

        .batch-info {
            padding: 8px;
            font-size: .72rem;
            color: var(--text-muted)
        }

        .batch-info .name {
            font-weight: 600;
            color: var(--text);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            margin-bottom: 2px
        }

        .batch-status {
            position: absolute;
            top: 6px;
            right: 6px;
            padding: 2px 8px;
            border-radius: 100px;
            font-size: .65rem;
            font-weight: 700;
            text-transform: uppercase
        }

        .status-pending {
            background: var(--bg);
            color: var(--text-muted)
        }

        .status-processing {
            background: var(--warning);
            color: #000
        }

        .status-done {
            background: var(--success);
            color: #fff
        }

        .status-error {
            background: var(--danger);
            color: #fff
        }

        .batch-remove {
            position: absolute;
            top: 6px;
            left: 6px;
            width: 22px;
            height: 22px;
            border-radius: 50%;
            background: rgba(0, 0, 0, .5);
            color: #fff;
            border: none;
            cursor: pointer;
            font-size: .65rem;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            transition: opacity .15s
        }

        .batch-card:hover .batch-remove {
            opacity: 1
        }

        .batch-actions {
            display: flex;
            gap: 8px;
            margin-top: 12px;
            flex-wrap: wrap
        }

        .batch-actions .btn {
            flex: 1;
            min-width: 120px
        }

        .batch-counter {
            font-size: .8rem;
            color: var(--text-muted);
            margin-bottom: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center
        }

        .progress-ring {
            width: 100%;
            height: 4px;
            background: var(--border);
            border-radius: 2px;
            margin-top: 8px;
            overflow: hidden
        }

        .progress-ring-fill {
            height: 100%;
            background: var(--primary);
            transition: width .3s;
            width: 0
        }

        /* Toast */
        .toast-container {
            position: fixed;
            top: 16px;
            right: 16px;
            z-index: 1000;
            display: flex;
            flex-direction: column;
            gap: 8px;
            pointer-events: none
        }

        .toast {
            padding: 10px 16px;
            border-radius: var(--radius);
            font-size: .83rem;
            font-weight: 500;
            box-shadow: var(--shadow-lg);
            animation: toastIn .25s ease;
            max-width: 340px;
            pointer-events: auto
        }

        .toast-error {
            background: var(--danger);
            color: #fff
        }

        .toast-warning {
            background: var(--warning);
            color: #000
        }

        .toast-success {
            background: var(--success);
            color: #fff
        }

        .toast-info {
            background: var(--text);
            color: var(--bg)
        }

        @keyframes toastIn {
            from {
                opacity: 0;
                transform: translateY(-8px)
            }
            to {
                opacity: 1;
                transform: translateY(0)
            }
        }

        @keyframes toastOut {
            from {
                opacity: 1
            }
            to {
                opacity: 0;
                transform: translateY(-8px)
            }
        }

        .dim-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 4px
        }

        .pct-toggle {
            font-size: .7rem;
            color: var(--primary);
            cursor: pointer;
            font-weight: 600;
            border: 1px solid var(--primary);
            border-radius: 100px;
            padding: 1px 8px;
            background: transparent;
            transition: all .15s
        }

        .pct-toggle.active {
            background: var(--primary);
            color: #fff
        }

        @media (max-width: 840px) {
            main {
                flex-direction: column
            }

            .sidebar {
                width: 100%;
                min-width: 0;
                border-right: none;
                border-bottom: 1px solid var(--border);
                max-height: 50vh;
                overflow-y: auto
            }

            .preview-area {
                min-height: 400px
            }

            .batch-grid {
                grid-template-columns:repeat(auto-fill, minmax(140px, 1fr))
            }
        }
    </style>
</head>
<body>
<div class="app">
    <header>
        <h1><i class="bi bi-aspect-ratio"></i> Image Resizer</h1>
        <div class="header-right">
            <div class="mode-toggle">
                <button class="mode-btn active" data-mode="single" onclick="setMode('single')">Single</button>
                <button class="mode-btn" data-mode="batch" onclick="setMode('batch')">Batch</button>
            </div>
            <span class="hint"><i class="bi bi-keyboard"></i> Ctrl+V to paste</span>
        </div>
    </header>
    <main>
        <div class="sidebar">
            <div class="section" id="sec-upload">
                <div class="section-header" onclick="toggleSection('sec-upload')"><span><i class="bi bi-upload"></i>&ensp;Input</span><i
                        class="bi bi-chevron-down chevron"></i></div>
                <div class="section-body">
                    <div class="drop-zone" id="drop-zone"><i class="bi bi-image"></i>
                        <p>Drop image here or <span class="browse" id="browse-btn">browse</span></p>
                        <p style="font-size:.72rem;opacity:.6" id="upload-hint">PNG, JPG, WebP, GIF</p></div>
                    <input type="file" id="file-input" accept="image/*" hidden>
                    <div class="url-row" id="url-row"><input type="text" id="url-input"
                                                             placeholder="Paste image URL...">
                        <button class="btn btn-outline" id="load-url-btn" style="flex-shrink:0"><i
                                class="bi bi-link-45deg"></i></button>
                    </div>
                    <div id="img-info" class="img-info" style="display:none"></div>
                </div>
            </div>
            <div class="section" id="sec-dims">
                <div class="section-header" onclick="toggleSection('sec-dims')"><span><i class="bi bi-rulers"></i>&ensp;Dimensions</span><i
                        class="bi bi-chevron-down chevron"></i></div>
                <div class="section-body">
                    <div class="presets" id="presets"></div>
                    <div class="dim-row">
                        <div class="field">
                            <div class="dim-header"><label for="w-input">Width</label>
                                <button class="pct-toggle" id="w-pct" onclick="togglePct('w')">%</button>
                            </div>
                            <input type="number" id="w-input" min="1" placeholder="—"></div>
                        <div class="lock active" id="lock-btn" title="Lock aspect ratio"><i class="bi bi-lock-fill"></i>
                        </div>
                        <div class="field">
                            <div class="dim-header"><label for="h-input">Height</label>
                                <button class="pct-toggle" id="h-pct" onclick="togglePct('h')">%</button>
                            </div>
                            <input type="number" id="h-input" min="1" placeholder="—"></div>
                    </div>
                    <div class="fit-row" id="fit-row" style="display:none"><label>Fit Mode</label>
                        <div class="fit-options">
                            <div class="fit-opt active" data-fit="stretch" onclick="setFit('stretch')">Stretch</div>
                            <div class="fit-opt" data-fit="crop" onclick="setFit('crop')">Crop</div>
                            <div class="fit-opt" data-fit="letterbox" onclick="setFit('letterbox')">Pad</div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="section" id="sec-transform">
                <div class="section-header" onclick="toggleSection('sec-transform')"><span><i
                        class="bi bi-arrow-repeat"></i>&ensp;Transform</span><i class="bi bi-chevron-down chevron"></i>
                </div>
                <div class="section-body">
                    <div class="transform-row">
                        <button onclick="doRotate(-90)" title="Rotate left"><i class="bi bi-arrow-counterclockwise"></i>
                        </button>
                        <button onclick="doRotate(90)" title="Rotate right"><i class="bi bi-arrow-clockwise"></i>
                        </button>
                        <button onclick="doFlip('h')" title="Flip horizontal"><i class="bi bi-symmetry-vertical"></i>
                        </button>
                        <button onclick="doFlip('v')" title="Flip vertical"><i class="bi bi-symmetry-horizontal"></i>
                        </button>
                    </div>
                </div>
            </div>
            <div class="section" id="sec-output">
                <div class="section-header" onclick="toggleSection('sec-output')"><span><i
                        class="bi bi-file-earmark-image"></i>&ensp;Output</span><i
                        class="bi bi-chevron-down chevron"></i></div>
                <div class="section-body">
                    <div style="display:flex;gap:8px;margin-bottom:10px">
                        <div style="flex:1"><label for="fmt-select">Format</label><select id="fmt-select">
                            <option value="jpeg">JPEG</option>
                            <option value="png">PNG</option>
                            <option value="webp">WebP</option>
                            <option value="gif">GIF</option>
                        </select></div>
                        <div style="flex:1" id="quality-wrap"><label>Quality</label>
                            <div class="range-row"><input type="range" id="quality-input" min="1" max="100"
                                                          value="90"><span id="quality-val">90%</span></div>
                        </div>
                    </div>
                    <div id="transparency-section" class="transparency-section" style="display:none">
                        <label>Background</label>
                        <select id="bg-mode" style="margin-bottom:8px">
                            <option value="preserve">Preserve transparency</option>
                            <option value="transparent">Force transparent</option>
                            <option value="color">Custom color</option>
                        </select>
                        <div id="bg-color-row" class="bg-color-row" style="display:none"><input type="color"
                                                                                                id="bg-color"
                                                                                                value="#ffffff"><input
                                type="text" id="bg-color-hex" value="#ffffff" style="width:80px"><label class="switch"
                                                                                                        style="margin:0"><input
                                type="checkbox" id="bg-alpha-check"><span class="track"></span> Opacity</label></div>
                        <div id="bg-alpha-row" style="display:none;margin-top:6px">
                            <div class="range-row"><input type="range" id="bg-alpha" min="0" max="100" value="100"><span
                                    id="bg-alpha-val">100%</span></div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="actions-row">
                <button class="btn btn-outline btn-block" onclick="resetForm()"><i
                        class="bi bi-arrow-counterclockwise"></i> Reset
                </button>
            </div>
        </div>
        <!-- Single mode preview -->
        <div class="preview-area" id="single-view">
            <div class="preview-tabs">
                <button class="preview-tab active" data-tab="resized" onclick="setTab('resized')">Resized</button>
                <button class="preview-tab" data-tab="original" onclick="setTab('original')">Original</button>
                <button class="preview-tab" data-tab="compare" onclick="setTab('compare')">Compare</button>
            </div>
            <div class="preview-box checker-bg" id="preview-box">
                <div class="empty" id="empty-state"><i class="bi bi-image"></i>
                    <p>Upload an image to get started</p></div>
                <img id="prev-original" style="display:none" alt="Original">
                <img id="prev-resized" style="display:none" alt="Resized">
                <div class="compare-container" id="compare-view" style="display:none">
                    <img id="cmp-base" alt="Original">
                    <div class="cmp-overlay" id="cmp-overlay"><img id="cmp-top" alt="Resized"></div>
                    <div class="compare-divider" id="cmp-divider"></div>
                    <div class="compare-handle" id="cmp-handle"><i class="bi bi-arrows-expand"></i></div>
                    <div class="cmp-labels"><span>Original</span><span>Resized</span></div>
                </div>
            </div>
            <div id="preview-info" class="preview-info" style="display:none">
                <span class="dims" id="info-dims">—</span>
                <span class="size" id="info-size">—</span>
                <span class="savings" id="info-savings"></span>
            </div>
            <div class="download-bar" id="download-bar" style="display:none">
                <a id="download-btn" class="btn btn-success btn-block" download="resized_image"><i
                        class="bi bi-download"></i> Download</a>
            </div>
        </div>
        <!-- Batch mode view -->
        <div class="preview-area" id="batch-view" style="display:none">
            <div class="batch-counter"><span id="batch-count">0 images</span>
                <button class="btn btn-outline" onclick="clearBatch()"
                        style="height:28px;padding:0 10px;font-size:.75rem"><i class="bi bi-trash"></i> Clear all
                </button>
            </div>
            <div class="batch-grid" id="batch-grid"></div>
            <div class="progress-ring" id="batch-progress" style="display:none">
                <div class="progress-ring-fill" id="batch-progress-fill"></div>
            </div>
            <div class="batch-actions">
                <button class="btn btn-primary" onclick="processAll()" id="process-all-btn"><i
                        class="bi bi-play-fill"></i> Process All
                </button>
                <button class="btn btn-success" onclick="downloadAllZip()" id="download-zip-btn" disabled><i
                        class="bi bi-file-earmark-zip"></i> Download ZIP
                </button>
            </div>
        </div>
    </main>
</div>
<div class="toast-container" id="toast-container"></div>
<script>
    (function () {
        const $ = id => document.getElementById(id);
        const MAX_DIM = 4000, MAX_FILE = 10 * 1024 * 1024, MAX_BATCH = 50;
        const presetData = [
            {l: '1:1', w: 1080, h: 1080}, {l: '16:9 HD', w: 1920, h: 1080}, {l: '9:16', w: 1080, h: 1920},
            {l: '4:3', w: 1600, h: 1200}, {l: 'YouTube', w: 1280, h: 720}, {l: 'Twitter/X', w: 1200, h: 675},
            {l: 'FB Cover', w: 820, h: 312}, {l: 'Icon', w: 512, h: 512}
        ];
        const state = {
            img: null, origW: 0, origH: 0, loaded: false, processing: false,
            rotation: 0, flipH: false, flipV: false, hasAlpha: false,
            locked: true, fitMode: 'stretch', wPct: false, hPct: false,
            tab: 'resized', resultDataUrl: null, origDataUrl: null,
            mode: 'single'
        };
        const batch = {items: [], processing: false};
        let resizeTimer = null;
// Presets
        const presetsEl = $('presets');
        presetData.forEach(p => {
            const b = document.createElement('button');
            b.className = 'preset-btn';
            b.textContent = p.l;
            b.title = p.w + '×' + p.h;
            b.onclick = () => {
                if (state.mode === 'single' && !state.loaded) return;
                state.wPct = false;
                state.hPct = false;
                $('w-pct').classList.remove('active');
                $('h-pct').classList.remove('active');
                $('w-input').value = p.w;
                $('h-input').value = p.h;
                if (state.locked) {
                    state.locked = false;
                    updateLockUI()
                }
                if (state.mode === 'single') updateResize();
            };
            presetsEl.appendChild(b);
        });
// WebP
        const supportsWebP = (() => {
            const c = document.createElement('canvas');
            return c.getContext && c.getContext('2d') ? c.toDataURL('image/webp').startsWith('data:image/webp') : false
        })();
        if (!supportsWebP) {
            const o = Array.from($('fmt-select').options).find(x => x.value === 'webp');
            if (o) {
                o.disabled = true;
                o.text = 'WebP (unsupported)'
            }
        }

// Toast
        function toast(msg, type = 'info', dur = 4000) {
            const t = document.createElement('div');
            t.className = 'toast toast-' + type;
            t.textContent = msg;
            $('toast-container').appendChild(t);
            setTimeout(() => {
                t.style.animation = 'toastOut .25s ease forwards';
                setTimeout(() => t.remove(), 250)
            }, dur);
        }

// Section toggle
        window.toggleSection = id => document.getElementById(id).classList.toggle('collapsed');

// Helpers
        function fmtBytes(b) {
            if (!b) return '0 B';
            const k = 1024, s = ['B', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(b) / Math.log(k));
            return parseFloat((b / Math.pow(k, i)).toFixed(1)) + ' ' + s[i]
        }

        function supportsAlpha(f) {
            return ['png', 'webp', 'gif'].includes(f)
        }

        function effectiveW() {
            return Math.abs(state.rotation % 180) === 90 ? state.origH : state.origW
        }

        function effectiveH() {
            return Math.abs(state.rotation % 180) === 90 ? state.origW : state.origH
        }

// Mode
        window.setMode = mode => {
            state.mode = mode;
            document.querySelectorAll('.mode-btn').forEach(el => el.classList.toggle('active', el.dataset.mode === mode));
            $('single-view').style.display = mode === 'single' ? 'flex' : 'none';
            $('batch-view').style.display = mode === 'batch' ? 'flex' : 'none';
// Adjust upload hint and file input
            if (mode === 'batch') {
                $('file-input').multiple = true;
                $('upload-hint').textContent = 'Select or drop multiple images';
                $('url-row').style.display = 'none';
            } else {
                $('file-input').multiple = false;
                $('upload-hint').textContent = 'PNG, JPG, WebP, GIF';
                $('url-row').style.display = 'flex';
            }
        };

// Lock
        function updateLockUI() {
            const el = $('lock-btn');
            el.classList.toggle('active', state.locked);
            el.innerHTML = state.locked ? '<i class="bi bi-lock-fill"></i>' : '<i class="bi bi-unlock"></i>';
            $('fit-row').style.display = state.locked ? 'none' : 'block';
        }

        $('lock-btn').onclick = () => {
            state.locked = !state.locked;
            updateLockUI();
            if (state.loaded) updateResize()
        };
        updateLockUI();
// Pct
        window.togglePct = axis => {
            if (axis === 'w') {
                state.wPct = !state.wPct;
                $('w-pct').classList.toggle('active', state.wPct)
            } else {
                state.hPct = !state.hPct;
                $('h-pct').classList.toggle('active', state.hPct)
            }
            if (state.loaded) resetDims();
        };
// Fit
        window.setFit = mode => {
            state.fitMode = mode;
            document.querySelectorAll('.fit-opt').forEach(el => el.classList.toggle('active', el.dataset.fit === mode));
            if (state.loaded) updateResize();
        };
// Tab
        window.setTab = tab => {
            state.tab = tab;
            document.querySelectorAll('.preview-tab').forEach(el => el.classList.toggle('active', el.dataset.tab === tab));
            $('prev-original').style.display = (tab === 'original' && state.loaded) ? 'block' : 'none';
            $('prev-resized').style.display = (tab === 'resized' && state.loaded) ? 'block' : 'none';
            $('compare-view').style.display = (tab === 'compare' && state.loaded) ? 'block' : 'none';
            if (tab === 'compare' && state.loaded) setComparePos(50);
            updateInfoBar();
        };
// Upload
        $('browse-btn').onclick = () => $('file-input').click();
        $('drop-zone').onclick = e => {
            if (e.target.id !== 'browse-btn') $('file-input').click()
        };
        $('file-input').onchange = () => {
            const files = $('file-input').files;
            if (!files.length) return;
            if (state.mode === 'batch') {
                addBatchFiles(files);
            } else {
                handleFile(files[0]);
            }
        };
        $('drop-zone').ondragover = e => {
            e.preventDefault();
            $('drop-zone').classList.add('dragover')
        };
        $('drop-zone').ondragleave = () => $('drop-zone').classList.remove('dragover');
        $('drop-zone').ondrop = e => {
            e.preventDefault();
            $('drop-zone').classList.remove('dragover');
            if (!e.dataTransfer.files.length) return;
            if (state.mode === 'batch') addBatchFiles(e.dataTransfer.files);
            else handleFile(e.dataTransfer.files[0]);
        };
        document.addEventListener('paste', e => {
            const items = e.clipboardData?.items;
            if (!items) return;
            for (let item of items) {
                if (item.type.startsWith('image/')) {
                    e.preventDefault();
                    const f = item.getAsFile();
                    if (state.mode === 'batch') addBatchFiles([f]);
                    else handleFile(f);
                    return;
                }
            }
        });
        $('load-url-btn').onclick = () => {
            const url = $('url-input').value.trim();
            if (!url) {
                toast('Enter an image URL', 'warning');
                return
            }
            try {
                new URL(url)
            } catch {
                toast('Invalid URL', 'error');
                return
            }
            loadFromURL(url);
        };
        $('url-input').onkeydown = e => {
            if (e.key === 'Enter') $('load-url-btn').click()
        };

// Single image load
        function handleFile(file) {
            if (!file.type.match('image.*')) {
                toast('Not a valid image file', 'error');
                return
            }
            if (file.size > MAX_FILE) toast('Large file — may be slow', 'warning');
            const r = new FileReader();
            r.onload = e => loadImage(e.target.result, file.name, file.size);
            r.onerror = () => toast('Error reading file', 'error');
            r.readAsDataURL(file);
        }

        function loadFromURL(url) {
            const img = new Image();
            const timeout = setTimeout(() => toast('Load timed out', 'error'), 20000);
            img.onload = function () {
                clearTimeout(timeout);
                try {
                    const c = document.createElement('canvas');
                    c.width = img.width;
                    c.height = img.height;
                    c.getContext('2d').drawImage(img, 0, 0);
                    loadImage(c.toDataURL('image/png'), url.split('/').pop() || 'image', null);
                    c.width = 1;
                    c.height = 1;
                } catch {
                    toast('CORS error. Download and upload directly.', 'error')
                }
            };
            img.onerror = () => {
                clearTimeout(timeout);
                toast('Failed to load image', 'error')
            };
            img.crossOrigin = 'anonymous';
            img.src = url;
        }

        function loadImage(src, filename, fileSize) {
            if (state.processing) return;
            state.processing = true;
            const img = new Image();
            img.onload = function () {
                state.processing = false;
                if (img.width <= 0 || img.height <= 0) {
                    toast('Invalid image', 'error');
                    return
                }
                state.img = img;
                state.origW = img.width;
                state.origH = img.height;
                state.loaded = true;
                state.rotation = 0;
                state.flipH = false;
                state.flipV = false;
                try {
                    const c = document.createElement('canvas');
                    c.width = img.width;
                    c.height = img.height;
                    const ctx = c.getContext('2d');
                    ctx.drawImage(img, 0, 0);
                    const d = ctx.getImageData(0, 0, c.width, c.height).data;
                    state.hasAlpha = false;
                    for (let i = 3; i < d.length; i += 4) {
                        if (d[i] < 255) {
                            state.hasAlpha = true;
                            break
                        }
                    }
                    c.width = 1;
                    c.height = 1;
                } catch {
                    state.hasAlpha = false
                }
                $('img-info').style.display = 'block';
                $('img-info').innerHTML = `<strong>${filename}</strong> — ${state.origW}×${state.origH} · ${fileSize ? fmtBytes(fileSize) : 'URL'}${state.hasAlpha ? ' · Transparent' : ''}`;
                updateOrigPreview();
                resetDims();
                updateTransparencyUI();
                $('empty-state').style.display = 'none';
                setTab('resized');
            };
            img.onerror = () => {
                state.processing = false;
                toast('Error loading image', 'error')
            };
            img.src = src;
        }

        function resetDims() {
            $('w-input').value = state.wPct ? 100 : effectiveW();
            $('h-input').value = state.hPct ? 100 : effectiveH();
            updateResize();
        }

        function updateOrigPreview() {
            if (!state.img) return;
            const c = document.createElement('canvas'), ctx = c.getContext('2d');
            const sw = state.img.width, sh = state.img.height;
            if (state.rotation % 180 === 0) {
                c.width = sw;
                c.height = sh
            } else {
                c.width = sh;
                c.height = sw
            }
            ctx.clearRect(0, 0, c.width, c.height);
            ctx.save();
            ctx.translate(c.width / 2, c.height / 2);
            ctx.rotate(state.rotation * Math.PI / 180);
            ctx.scale(state.flipH ? -1 : 1, state.flipV ? -1 : 1);
            ctx.drawImage(state.img, -sw / 2, -sh / 2);
            ctx.restore();
            state.origDataUrl = c.toDataURL('image/png');
            $('prev-original').src = state.origDataUrl;
            $('cmp-base').src = state.origDataUrl;
            c.width = 1;
            c.height = 1;
        }

// Dims input
        $('w-input').oninput = () => {
            if (!state.loaded) return;
            let v = parseInt($('w-input').value) || 0;
            if (v > MAX_DIM) {
                $('w-input').value = MAX_DIM;
                v = MAX_DIM
            }
            if (state.locked && v > 0) {
                const ew = effectiveW(), eh = effectiveH();
                const rw = state.wPct ? Math.round(ew * v / 100) : v;
                $('h-input').value = state.hPct ? Math.round(Math.round(rw * eh / ew) / eh * 100) : Math.round(rw * eh / ew);
            }
            debounceResize();
        };
        $('h-input').oninput = () => {
            if (!state.loaded) return;
            let v = parseInt($('h-input').value) || 0;
            if (v > MAX_DIM) {
                $('h-input').value = MAX_DIM;
                v = MAX_DIM
            }
            if (state.locked && v > 0) {
                const ew = effectiveW(), eh = effectiveH();
                const rh = state.hPct ? Math.round(eh * v / 100) : v;
                $('w-input').value = state.wPct ? Math.round(Math.round(rh * ew / eh) / ew * 100) : Math.round(rh * ew / eh);
            }
            debounceResize();
        };

        function debounceResize() {
            clearTimeout(resizeTimer);
            resizeTimer = setTimeout(updateResize, 300)
        }

// Transform
        window.doRotate = deg => {
            if (!state.loaded) return;
            state.rotation = ((state.rotation + deg) % 360 + 360) % 360;
            updateOrigPreview();
            resetDims()
        };
        window.doFlip = axis => {
            if (!state.loaded) return;
            if (axis === 'h') state.flipH = !state.flipH; else state.flipV = !state.flipV;
            updateOrigPreview();
            updateResize()
        };
// Format & quality
        $('fmt-select').onchange = () => {
            updateQualityVis();
            updateTransparencyUI();
            if (state.loaded) updateResize()
        };
        $('quality-input').oninput = () => {
            $('quality-val').textContent = $('quality-input').value + '%';
            debounceResize()
        };

        function updateQualityVis() {
            const f = $('fmt-select').value;
            $('quality-wrap').style.display = (f === 'jpeg' || f === 'webp') ? 'block' : 'none'
        }

        function updateTransparencyUI() {
            $('transparency-section').style.display = supportsAlpha($('fmt-select').value) ? 'block' : 'none';
            updateBgColorVis()
        }

        function updateBgColorVis() {
            $('bg-color-row').style.display = $('bg-mode').value === 'color' ? 'flex' : 'none';
            $('bg-alpha-row').style.display = $('bg-alpha-check').checked && $('bg-mode').value === 'color' ? 'block' : 'none';
        }

        $('bg-mode').onchange = () => {
            updateBgColorVis();
            if (state.loaded) updateResize()
        };
        $('bg-color').oninput = () => {
            $('bg-color-hex').value = $('bg-color').value;
            if (state.loaded) updateResize()
        };
        $('bg-color-hex').oninput = () => {
            if (/^#[0-9a-f]{6}$/i.test($('bg-color-hex').value)) {
                $('bg-color').value = $('bg-color-hex').value;
                if (state.loaded) updateResize()
            }
        };
        $('bg-alpha-check').onchange = () => {
            updateBgColorVis();
            if (state.loaded) updateResize()
        };
        $('bg-alpha').oninput = () => {
            $('bg-alpha-val').textContent = $('bg-alpha').value + '%';
            debounceResize()
        };

// Core resize (shared between single and batch)
        function getResizeSettings() {
            const wRaw = parseInt($('w-input').value) || 0, hRaw = parseInt($('h-input').value) || 0;
            return {
                wRaw,
                hRaw,
                fmt: $('fmt-select').value,
                quality: parseInt($('quality-input').value) / 100,
                fitMode: state.locked ? 'maintain' : state.fitMode,
                bgMode: $('bg-mode').value,
                bgColor: $('bg-color').value,
                bgAlphaCheck: $('bg-alpha-check').checked,
                bgAlpha: parseInt($('bg-alpha').value) / 100
            };
        }

        function resizeImageData(img, settings, rot, fH, fV, origW, origH) {
            const {wRaw, hRaw, fmt, quality, fitMode, bgMode, bgColor, bgAlphaCheck, bgAlpha} = settings;
            const ew = Math.abs(rot % 180) === 90 ? origH : origW;
            const eh = Math.abs(rot % 180) === 90 ? origW : origH;
            let tw = state.wPct ? Math.round(ew * wRaw / 100) : wRaw;
            let th = state.hPct ? Math.round(eh * hRaw / 100) : hRaw;
            if (state.locked) {
                if (tw && !th) th = Math.round(tw * eh / ew);
                else if (!tw && th) tw = Math.round(th * ew / eh);
                else if (tw) th = Math.round(tw * eh / ew);
            }
            tw = Math.max(1, Math.min(MAX_DIM, tw || ew));
            th = Math.max(1, Math.min(MAX_DIM, th || eh));
            let drawTW = tw, drawTH = th;
            if (Math.abs(rot % 180) === 90) [drawTW, drawTH] = [drawTH, drawTW];
            const c = document.createElement('canvas'), ctx = c.getContext('2d');
            c.width = drawTW;
            c.height = drawTH;
            const sa = supportsAlpha(fmt);
            if (sa && (bgMode === 'transparent' || bgMode === 'preserve')) ctx.clearRect(0, 0, c.width, c.height);
            else if (bgMode === 'color') {
                const r = parseInt(bgColor.slice(1, 3), 16), g = parseInt(bgColor.slice(3, 5), 16),
                    b = parseInt(bgColor.slice(5, 7), 16);
                const a = bgAlphaCheck ? bgAlpha : 1;
                ctx.fillStyle = sa ? `rgba(${r},${g},${b},${a})` : bgColor;
                ctx.fillRect(0, 0, c.width, c.height);
            } else if (!sa) {
                ctx.fillStyle = '#fff';
                ctx.fillRect(0, 0, c.width, c.height)
            }
            ctx.save();
            ctx.translate(c.width / 2, c.height / 2);
            ctx.rotate(rot * Math.PI / 180);
            ctx.scale(fH ? -1 : 1, fV ? -1 : 1);
            const srcRatio = img.width / img.height, tgtRatio = drawTW / drawTH;
            let dw, dh;
            if (fitMode === 'maintain' || fitMode === 'stretch') {
                dw = drawTW;
                dh = drawTH
            } else if (fitMode === 'crop') {
                if (srcRatio > tgtRatio) {
                    dh = drawTH;
                    dw = drawTH * srcRatio
                } else {
                    dw = drawTW;
                    dh = drawTW / srcRatio
                }
            } else {
                if (srcRatio > tgtRatio) {
                    dw = drawTW;
                    dh = drawTW / srcRatio
                } else {
                    dh = drawTH;
                    dw = drawTH * srcRatio
                }
            }
            ctx.drawImage(img, -dw / 2, -dh / 2, dw, dh);
            ctx.restore();
            const mime = fmt === 'jpeg' ? 'image/jpeg' : fmt === 'png' ? 'image/png' : fmt === 'webp' ? 'image/webp' : 'image/gif';
            const dataUrl = (fmt === 'jpeg' || fmt === 'webp') ? c.toDataURL(mime, quality) : c.toDataURL(mime);
            c.width = 1;
            c.height = 1;
            return {dataUrl, width: drawTW, height: drawTH, fmt};
        }

        function updateResize() {
            if (!state.loaded || state.processing) return;
            const settings = getResizeSettings();
            if (settings.wRaw <= 0 && settings.hRaw <= 0) return;
            state.processing = true;
            requestAnimationFrame(() => {
                try {
                    const result = resizeImageData(state.img, settings, state.rotation, state.flipH, state.flipV, state.origW, state.origH);
                    state.resultDataUrl = result.dataUrl;
                    $('prev-resized').src = result.dataUrl;
                    $('cmp-top').src = result.dataUrl;
                    $('download-btn').href = result.dataUrl;
                    $('download-btn').download = 'resized.' + result.fmt;
                    $('download-bar').style.display = 'block';
                    fetch(result.dataUrl).then(r => r.blob()).then(blob => {
                        $('info-dims').textContent = result.width + '×' + result.height;
                        $('info-size').textContent = fmtBytes(blob.size) + ' · ' + result.fmt.toUpperCase();
                        const origEst = state.img.src.length * 0.75;
                        $('info-savings').textContent = origEst > 0 && blob.size < origEst ? ((1 - blob.size / origEst) * 100).toFixed(0) + '% smaller' : '';
                        $('preview-info').style.display = 'flex';
                    }).catch(() => {
                    });
                    setTab(state.tab);
                } catch (e) {
                    toast('Resize error: ' + e.message, 'error')
                }
                state.processing = false;
            });
        }

        function updateInfoBar() {
            if (!state.loaded) {
                $('preview-info').style.display = 'none';
                return
            }
            if (state.tab === 'original') {
                $('info-dims').textContent = effectiveW() + '×' + effectiveH();
                $('info-size').textContent = 'Original';
                $('info-savings').textContent = '';
                $('preview-info').style.display = 'flex';
            }
        }

// ===== COMPARISON SLIDER =====
        let cmpDragging = false;

        function setComparePos(pct) {
            pct = Math.max(0, Math.min(100, pct));
            $('cmp-overlay').style.width = pct + '%';
            $('cmp-divider').style.left = pct + '%';
            $('cmp-handle').style.left = pct + '%';
        }

        function cmpPointerHandler(clientX) {
            const rect = $('compare-view').getBoundingClientRect();
            if (rect.width === 0) return;
            setComparePos(((clientX - rect.left) / rect.width) * 100);
        }

        $('compare-view').addEventListener('mousedown', e => {
            cmpDragging = true;
            cmpPointerHandler(e.clientX);
            e.preventDefault()
        });
        document.addEventListener('mousemove', e => {
            if (cmpDragging) cmpPointerHandler(e.clientX)
        });
        document.addEventListener('mouseup', () => cmpDragging = false);
        $('compare-view').addEventListener('touchstart', e => {
            cmpDragging = true;
            cmpPointerHandler(e.touches[0].clientX);
            e.preventDefault()
        }, {passive: false});
        document.addEventListener('touchmove', e => {
            if (cmpDragging) cmpPointerHandler(e.touches[0].clientX)
        }, {passive: true});
        document.addEventListener('touchend', () => cmpDragging = false);

// ===== BATCH PROCESSING =====
        function addBatchFiles(files) {
            const arr = Array.from(files).filter(f => f.type.match('image.*'));
            if (!arr.length) {
                toast('No valid images selected', 'warning');
                return
            }
            if (batch.items.length + arr.length > MAX_BATCH) {
                toast(`Max ${MAX_BATCH} images allowed`, 'warning');
                arr.length = MAX_BATCH - batch.items.length
            }
            arr.forEach(file => {
                const id = 'b_' + Date.now() + '_' + Math.random().toString(36).slice(2, 7);
                const item = {
                    id,
                    file,
                    name: file.name,
                    size: file.size,
                    status: 'pending',
                    thumbUrl: null,
                    resultUrl: null,
                    img: null
                };
                batch.items.push(item);
                const reader = new FileReader();
                reader.onload = e => {
                    item.thumbUrl = e.target.result;
                    const img = new Image();
                    img.onload = () => {
                        item.img = img;
                        item.origW = img.width;
                        item.origH = img.height;
                        renderBatchCard(item)
                    };
                    img.src = e.target.result;
                };
                reader.readAsDataURL(file);
            });
            updateBatchUI();
        }

        function renderBatchCard(item) {
            let card = document.getElementById(item.id);
            if (!card) {
                card = document.createElement('div');
                card.className = 'batch-card';
                card.id = item.id;
                $('batch-grid').appendChild(card);
            }
            const statusClass = {
                pending: 'status-pending',
                processing: 'status-processing',
                done: 'status-done',
                error: 'status-error'
            }[item.status] || 'status-pending';
            card.innerHTML = `<img class="batch-thumb" src="${item.thumbUrl || ''}" alt="${item.name}">
<span class="batch-status ${statusClass}">${item.status}</span>
<button class="batch-remove" onclick="removeBatchItem('${item.id}')" title="Remove">✕</button>
<div class="batch-info"><div class="name" title="${item.name}">${item.name}</div>
${item.origW ? item.origW + '×' + item.origH + ' · ' : ''}${fmtBytes(item.size)}${item.status === 'done' ? '<br><a href="' + item.resultUrl + '" download="resized_' + item.name + '" style="color:var(--primary);font-weight:600">Download</a>' : ''}</div>`;
        }

        window.removeBatchItem = id => {
            batch.items = batch.items.filter(x => x.id !== id);
            const el = document.getElementById(id);
            if (el) el.remove();
            updateBatchUI();
        };
        window.clearBatch = () => {
            batch.items = [];
            $('batch-grid').innerHTML = '';
            updateBatchUI();
        };

        function updateBatchUI() {
            const n = batch.items.length;
            const done = batch.items.filter(x => x.status === 'done').length;
            $('batch-count').textContent = n + ' image' + (n !== 1 ? 's' : '') + (done > 0 ? ' · ' + done + ' processed' : '');
            $('download-zip-btn').disabled = done === 0;
        }

        window.processAll = async () => {
            if (batch.processing) {
                toast('Already processing', 'warning');
                return
            }
            const pending = batch.items.filter(x => x.status !== 'done');
            if (!pending.length) {
                toast('Nothing to process', 'info');
                return
            }
            const settings = getResizeSettings();
            if (settings.wRaw <= 0 && settings.hRaw <= 0) {
                toast('Set target dimensions first', 'warning');
                return
            }
            batch.processing = true;
            $('process-all-btn').disabled = true;
            $('batch-progress').style.display = 'block';
            let done = 0;
            for (const item of pending) {
                item.status = 'processing';
                renderBatchCard(item);
                try {
                    await new Promise(res => setTimeout(res, 10));
                    const result = resizeImageData(item.img, settings, 0, false, false, item.origW, item.origH);
                    item.resultUrl = result.dataUrl;
                    item.status = 'done';
                } catch (e) {
                    item.status = 'error';
                    toast(`Error processing ${item.name}`, 'error');
                }
                done++;
                $('batch-progress-fill').style.width = ((done / pending.length) * 100) + '%';
                renderBatchCard(item);
                updateBatchUI();
            }
            batch.processing = false;
            $('process-all-btn').disabled = false;
            $('batch-progress').style.display = 'none';
            $('batch-progress-fill').style.width = '0';
            toast(`Processed ${done} image${done !== 1 ? 's' : ''}`, 'success');
        };
        window.downloadAllZip = async () => {
            const doneItems = batch.items.filter(x => x.status === 'done' && x.resultUrl);
            if (!doneItems.length) {
                toast('No processed images', 'warning');
                return
            }
            if (typeof JSZip === 'undefined') {
                toast('JSZip not loaded', 'error');
                return
            }
            $('download-zip-btn').disabled = true;
            $('download-zip-btn').innerHTML = '<span class="bi bi-hourglass-split"></span> Creating ZIP...';
            try {
                const zip = new JSZip();
                const fmt = $('fmt-select').value;
                for (const item of doneItems) {
                    const resp = await fetch(item.resultUrl);
                    const blob = await resp.blob();
                    const ext = fmt;
                    const name = item.name.replace(/\.[^.]+$/, '') + '_resized.' + ext;
                    zip.file(name, blob);
                }
                const content = await zip.generateAsync({type: 'blob'});
                const url = URL.createObjectURL(content);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'resized_images.zip';
                document.body.appendChild(a);
                a.click();
                a.remove();
                URL.revokeObjectURL(url);
                toast('ZIP downloaded', 'success');
            } catch (e) {
                toast('ZIP creation failed: ' + e.message, 'error')
            }
            $('download-zip-btn').disabled = false;
            $('download-zip-btn').innerHTML = '<i class="bi bi-file-earmark-zip"></i> Download ZIP';
        };
// Reset
        window.resetForm = () => {
            if (state.processing) return;
            if (state.mode === 'single') {
                if (state.loaded) {
                    state.rotation = 0;
                    state.flipH = false;
                    state.flipV = false;
                    updateOrigPreview();
                    resetDims()
                } else {
                    $('w-input').value = '';
                    $('h-input').value = '';
                    $('img-info').style.display = 'none';
                    $('preview-info').style.display = 'none';
                    $('download-bar').style.display = 'none';
                    $('empty-state').style.display = '';
                    $('prev-original').style.display = 'none';
                    $('prev-resized').style.display = 'none';
                    $('compare-view').style.display = 'none';
                    state.img = null;
                    state.loaded = false;
                }
            } else {
                clearBatch();
            }
        };
        updateQualityVis();
    })();
</script>
<script src="../logo.js"></script>
</body>
</html>