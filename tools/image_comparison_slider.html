<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Advanced Image Comparison Slider</title>
    <link rel="icon"
          href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üñºÔ∏è</text></svg>">
    <style>
        :root {
            --primary: #0891b2;
            --primary-dark: #0e7490;
            --dark: #334155;
            --light: #f8fafc;
            --gray: #e2e8f0;
            --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            --radius: 8px;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            background-color: var(--light);
            color: var(--dark);
            line-height: 1.5;
        }

        .container {
            max-width: 1000px;
            margin: 20px auto;
            padding: 20px;
            background-color: #fff;
            box-shadow: var(--shadow);
            border-radius: var(--radius);
        }

        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 10px;
        }

        h1 {
            color: var(--primary);
            margin: 0;
        }

        .mode-selector {
            display: flex;
            gap: 8px;
        }

        .mode-option {
            padding: 6px 12px;
            background: white;
            border: 1px solid var(--gray);
            border-radius: var(--radius);
            cursor: pointer;
            font-size: 14px;
            transition: all 0.2s;
        }

        .mode-option:hover {
            border-color: var(--primary);
        }

        .mode-option.active {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }

        .upload-container {
            display: flex;
            justify-content: space-between;
            margin-bottom: 20px;
            gap: 15px;
        }

        .upload-box {
            flex: 1;
            border: 2px dashed var(--gray);
            border-radius: var(--radius);
            padding: 15px;
            text-align: center;
            transition: all 0.2s;
            position: relative;
        }

        .upload-box:hover {
            border-color: var(--primary);
        }

        .upload-box.has-image {
            border-style: solid;
            border-color: var(--primary);
        }

        .upload-box label {
            display: block;
            cursor: pointer;
            font-weight: 500;
        }

        .upload-box input {
            display: none;
        }

        .preview-container {
            margin-top: 10px;
            position: relative;
            height: 100px;
        }

        .preview {
            max-height: 100px;
            max-width: 100%;
            display: none;
            border-radius: 4px;
            margin: 0 auto;
        }

        .tools {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        button {
            background: white;
            color: var(--dark);
            border: 1px solid var(--gray);
            padding: 8px 16px;
            border-radius: var(--radius);
            cursor: pointer;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 5px;
            transition: all 0.2s;
        }

        button:hover:not(:disabled) {
            border-color: var(--primary);
            color: var(--primary);
        }

        button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        button.primary {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }

        button.primary:hover:not(:disabled) {
            background: var(--primary-dark);
            color: white;
        }

        .slider-container {
            position: relative;
            overflow: hidden;
            width: 100%;
            height: 500px;
            border-radius: var(--radius);
            background-color: #f1f5f9;
            background-image: linear-gradient(45deg, #e2e8f0 25%, transparent 25%, transparent 75%, #e2e8f0 75%),
            linear-gradient(45deg, #e2e8f0 25%, transparent 25%, transparent 75%, #e2e8f0 75%);
            background-size: 20px 20px;
            background-position: 0 0, 10px 10px;
        }

        .image-wrapper {
            width: 100%;
            height: 100%;
            position: relative;
            overflow: hidden;
        }

        .image-wrapper img {
            position: absolute;
            top: 0;
            left: 0;
            height: 100%;
            object-fit: cover;
            transform-origin: center;
        }

        .mask {
            position: absolute;
            top: 0;
            left: 0;
            width: 50%;
            height: 100%;
            overflow: hidden;
        }

        .mask img {
            position: absolute;
            top: 0;
            right: 0;
        }

        /* Core slider - preserved exactly as original */
        .slider {
            position: absolute;
            top: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 10px;
            height: 100%;
            background-color: var(--primary);
            cursor: ew-resize;
        }

        /* Slider enhancement - only visual */
        .slider::before {
            content: "";
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 32px;
            height: 32px;
            background: var(--primary);
            border-radius: 50%;
            box-shadow: 0 0 0 4px rgba(255, 255, 255, 0.7);
        }

        .slider::after {
            content: "‚óÄ ‚ñ∂";
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: white;
            font-size: 12px;
        }

        /* Vertical slider */
        .slider.vertical {
            top: 50%;
            left: 0;
            transform: translateY(-50%);
            width: 100%;
            height: 10px;
            cursor: ns-resize;
        }

        .slider.vertical::after {
            content: "‚ñ≤ ‚ñº";
        }

        .mask.vertical {
            width: 100%;
            height: 50%;
        }

        .mask.vertical img {
            top: auto;
            bottom: 0;
            right: 0;
        }

        /* Diagonal slider */
        .mask.diagonal {
            width: 100%;
            height: 100%;
            overflow: hidden;
            clip-path: polygon(0 0, 50% 50%, 0 100%);
        }

        .slider.diagonal {
            transform: rotate(45deg);
            transform-origin: top left;
            width: 10px;
            height: 141%; /* sqrt(2) * 100% */
            top: 0;
            left: 0;
            cursor: nwse-resize;
        }

        /* Labels and info */
        .image-label {
            position: absolute;
            bottom: 10px;
            padding: 6px 12px;
            background: rgba(0, 0, 0, 0.5);
            color: white;
            border-radius: 4px;
            font-size: 13px;
            z-index: 10;
        }

        .label-left {
            left: 10px;
        }

        .label-right {
            right: 10px;
        }

        /* Editing tools */
        .editing-panel {
            display: none;
            background: white;
            margin-top: 20px;
            padding: 15px;
            border-radius: var(--radius);
            box-shadow: var(--shadow);
        }

        .editing-panel.active {
            display: block;
        }

        .panel-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .panel-title {
            font-weight: 600;
            font-size: 16px;
        }

        .panel-tabs {
            display: flex;
            gap: 2px;
            margin-bottom: 15px;
            background: var(--gray);
            border-radius: var(--radius);
            padding: 3px;
        }

        .panel-tab {
            padding: 8px 16px;
            font-size: 14px;
            border-radius: 4px;
            cursor: pointer;
        }

        .panel-tab.active {
            background: white;
            font-weight: 500;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .control-group {
            margin-bottom: 15px;
        }

        .control-row {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
        }

        .control-label {
            width: 120px;
            font-size: 14px;
        }

        .range-control {
            flex: 1;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        input[type="range"] {
            flex: 1;
            height: 6px;
            -webkit-appearance: none;
            appearance: none;
            background: var(--gray);
            border-radius: 3px;
            outline: none;
        }

        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 16px;
            height: 16px;
            border-radius: 50%;
            background: var(--primary);
            cursor: pointer;
        }

        input[type="range"]::-moz-range-thumb {
            width: 16px;
            height: 16px;
            border-radius: 50%;
            background: var(--primary);
            cursor: pointer;
            border: none;
        }

        .range-value {
            width: 40px;
            text-align: center;
            font-size: 14px;
        }

        .reset-btn {
            font-size: 12px;
            padding: 4px 8px;
        }

        /* Image controls */
        .image-controls {
            position: absolute;
            bottom: 50px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 5px;
            z-index: 10;
            background: rgba(0, 0, 0, 0.6);
            padding: 6px;
            border-radius: 20px;
        }

        .image-control-btn {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            border: none;
            background: rgba(255, 255, 255, 0.2);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            padding: 0;
        }

        .image-control-btn:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        /* Grid overlay */
        .grid-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 20;
            display: none;
        }

        .grid-overlay.active {
            display: block;
        }

        .grid-line {
            position: absolute;
            background: rgba(255, 255, 255, 0.5);
        }

        .grid-line-v {
            width: 1px;
            height: 100%;
            top: 0;
        }

        .grid-line-h {
            width: 100%;
            height: 1px;
            left: 0;
        }

        /* Zoom indicator */
        .zoom-indicator {
            position: absolute;
            top: 10px;
            left: 10px;
            background: rgba(0, 0, 0, 0.5);
            color: white;
            padding: 6px 12px;
            border-radius: 4px;
            font-size: 13px;
            z-index: 10;
        }

        /* KeyboardInfo */
        .keyboard-info {
            display: none;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 20px;
            border-radius: var(--radius);
            z-index: 100;
            max-width: 500px;
            box-shadow: var(--shadow);
        }

        .keyboard-info.active {
            display: block;
        }

        .keyboard-info h3 {
            margin-bottom: 15px;
            text-align: center;
        }

        .keyboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 10px;
        }

        .key-combo {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 8px;
        }

        .key {
            display: inline-block;
            padding: 2px 8px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 4px;
            font-family: monospace;
            text-align: center;
            min-width: 20px;
        }

        .key-desc {
            font-size: 14px;
        }

        .close-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            background: none;
            border: none;
            color: white;
            font-size: 18px;
            cursor: pointer;
        }

        /* Fullscreen */
        .fullscreen-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            z-index: 1000;
            display: none;
        }

        .fullscreen-container.active {
            display: block;
        }

        .fullscreen-container .slider-container {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 90%;
            height: 90%;
            border-radius: 0;
        }

        .fullscreen-close {
            position: absolute;
            top: 20px;
            right: 20px;
            width: 40px;
            height: 40px;
            background: rgba(0, 0, 0, 0.5);
            border: none;
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            z-index: 1001;
        }

        /* Snapshot export */
        .snapshot-preview {
            max-width: 100%;
            max-height: 300px;
            margin-top: 10px;
            border-radius: var(--radius);
            display: none;
        }

        .snapshot-preview.active {
            display: block;
        }

        /* Animation */
        @keyframes fadeIn {
            0% {
                opacity: 0;
            }
            100% {
                opacity: 1;
            }
        }

        .fade-in {
            animation: fadeIn 0.3s ease-in-out;
        }

        /* Overlay animation */
        .overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            z-index: 1000;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s;
        }

        .overlay.active {
            opacity: 1;
            pointer-events: auto;
        }

        .overlay-content {
            background: white;
            border-radius: var(--radius);
            padding: 30px;
            max-width: 90%;
            max-height: 90%;
            overflow: auto;
            position: relative;
        }

        .loading-indicator {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(255, 255, 255, 0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 30;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s;
        }

        .loading-indicator.active {
            opacity: 1;
            pointer-events: auto;
        }

        .spinner {
            width: 40px;
            height: 40px;
            border: 3px solid var(--gray);
            border-top-color: var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }
            100% {
                transform: rotate(360deg);
            }
        }

        @media (max-width: 768px) {
            .upload-container {
                flex-direction: column;
            }

            .tools {
                flex-wrap: wrap;
            }

            header {
                flex-direction: column;
                align-items: flex-start;
            }

            .slider-container {
                height: 400px;
            }

            .editing-panel .control-row {
                flex-direction: column;
                align-items: flex-start;
            }

            .editing-panel .control-label {
                width: 100%;
                margin-bottom: 5px;
            }
        }
    </style>
</head>
<body>
<div class="container">
    <header>
        <h1>Advanced Image Comparison</h1>
        <div class="mode-selector">
            <div class="mode-option active" data-mode="horizontal">Horizontal</div>
            <div class="mode-option" data-mode="vertical">Vertical</div>
            <div class="mode-option" data-mode="diagonal">Diagonal</div>
            <div class="mode-option" data-mode="opacity">Opacity</div>
        </div>
    </header>

    <div class="upload-container">
        <div class="upload-box" id="upload-box-1">
            <label for="uploadImage1">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4"></path>
                    <path d="M17 8l-5-5-5 5"></path>
                    <path d="M12 3v12"></path>
                </svg>
                <div>Upload Left Image</div>
            </label>
            <input type="file" id="uploadImage1" accept="image/*">
            <div class="preview-container">
                <img id="preview1" class="preview" alt="Preview">
            </div>
        </div>
        <div class="upload-box" id="upload-box-2">
            <label for="uploadImage2">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4"></path>
                    <path d="M17 8l-5-5-5 5"></path>
                    <path d="M12 3v12"></path>
                </svg>
                <div>Upload Right Image</div>
            </label>
            <input type="file" id="uploadImage2" accept="image/*">
            <div class="preview-container">
                <img id="preview2" class="preview" alt="Preview">
            </div>
        </div>
    </div>

    <div class="tools">
        <button id="swapBtn" disabled>
            <svg viewBox="0 0 24 24" width="16" height="16" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M7 16V4m0 0L3 8m4-4l4 4m6-3v12m0 0l4-4m-4 4l-4-4"></path>
            </svg>
            Swap
        </button>
        <button id="resetBtn" disabled>
            <svg viewBox="0 0 24 24" width="16" height="16" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M3 12a9 9 0 1 0 18 0 9 9 0 0 0-18 0z"></path>
                <path d="M12 8v4l2 2"></path>
            </svg>
            Reset
        </button>
        <button id="zoomInBtn" disabled>
            <svg viewBox="0 0 24 24" width="16" height="16" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="11" cy="11" r="8"></circle>
                <path d="M21 21l-4.35-4.35"></path>
                <path d="M11 8v6"></path>
                <path d="M8 11h6"></path>
            </svg>
            Zoom In
        </button>
        <button id="zoomOutBtn" disabled>
            <svg viewBox="0 0 24 24" width="16" height="16" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="11" cy="11" r="8"></circle>
                <path d="M21 21l-4.35-4.35"></path>
                <path d="M8 11h6"></path>
            </svg>
            Zoom Out
        </button>
        <button id="gridBtn" disabled>
            <svg viewBox="0 0 24 24" width="16" height="16" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M3 3h18v18H3z"></path>
                <path d="M3 9h18"></path>
                <path d="M3 15h18"></path>
                <path d="M9 3v18"></path>
                <path d="M15 3v18"></path>
            </svg>
            Grid
        </button>
        <button id="editBtn" disabled>
            <svg viewBox="0 0 24 24" width="16" height="16" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M12 20h9"></path>
                <path d="M16.5 3.5a2.12 2.12 0 0 1 3 3L7 19l-4 1 1-4L16.5 3.5z"></path>
            </svg>
            Edit
        </button>
        <button id="fullscreenBtn" disabled>
            <svg viewBox="0 0 24 24" width="16" height="16" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M8 3v3a2 2 0 0 1-2 2H3m18 0h-3a2 2 0 0 1-2-2V3m0 18v-3a2 2 0 0 1 2-2h3M3 16h3a2 2 0 0 1 2 2v3"></path>
            </svg>
            Fullscreen
        </button>
        <button id="snapshotBtn" disabled>
            <svg viewBox="0 0 24 24" width="16" height="16" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z"></path>
                <circle cx="12" cy="13" r="4"></circle>
            </svg>
            Snapshot
        </button>
        <button id="helpBtn">
            <svg viewBox="0 0 24 24" width="16" height="16" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="12" cy="12" r="10"></circle>
                <path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"></path>
                <path d="M12 17h.01"></path>
            </svg>
            Help
        </button>
    </div>

    <div class="slider-container">
        <div class="image-wrapper">
            <img id="image1"
                 src="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üñºÔ∏è</text></svg>"
                 alt="Image 1">
            <div class="mask">
                <img id="image2"
                     src="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üñºÔ∏è</text></svg>"
                     alt="Image 2">
            </div>
            <div class="image-label label-left">Left Image</div>
            <div class="image-label label-right">Right Image</div>
        </div>
        <div class="slider"></div>
        <div class="zoom-indicator">Zoom: 100%</div>
        <div class="image-controls">
            <button class="image-control-btn" id="panResetBtn" title="Reset Pan">
                <svg viewBox="0 0 24 24" width="16" height="16" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M12 2v4M12 18v4M4.93 4.93l2.83 2.83M16.24 16.24l2.83 2.83M2 12h4M18 12h4M4.93 19.07l2.83-2.83M16.24 7.76l2.83-2.83"></path>
                </svg>
            </button>
            <button class="image-control-btn" id="zoomResetBtn" title="Reset Zoom">
                <svg viewBox="0 0 24 24" width="16" height="16" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="12" cy="12" r="10"></circle>
                    <path d="M8 12h8"></path>
                    <path d="M12 8v8"></path>
                </svg>
            </button>
        </div>
        <div class="grid-overlay" id="gridOverlay"></div>
        <div class="loading-indicator" id="loadingIndicator">
            <div class="spinner"></div>
        </div>
    </div>

    <div class="editing-panel" id="editingPanel">
        <div class="panel-header">
            <div class="panel-title">Image Adjustment</div>
            <button class="reset-btn" id="resetAllAdjustments">Reset All</button>
        </div>

        <div class="panel-tabs">
            <div class="panel-tab active" data-tab="left-image">Left Image</div>
            <div class="panel-tab" data-tab="right-image">Right Image</div>
        </div>

        <div class="tab-content active" id="left-image">
            <div class="control-group">
                <div class="control-row">
                    <div class="control-label">Brightness</div>
                    <div class="range-control">
                        <input type="range" min="-100" max="100" value="0" id="brightness1">
                        <div class="range-value" id="brightnessValue1">0</div>
                        <button class="reset-btn" data-control="brightness1">‚Ü∫</button>
                    </div>
                </div>
                <div class="control-row">
                    <div class="control-label">Contrast</div>
                    <div class="range-control">
                        <input type="range" min="-100" max="100" value="0" id="contrast1">
                        <div class="range-value" id="contrastValue1">0</div>
                        <button class="reset-btn" data-control="contrast1">‚Ü∫</button>
                    </div>
                </div>
                <div class="control-row">
                    <div class="control-label">Saturation</div>
                    <div class="range-control">
                        <input type="range" min="-100" max="100" value="0" id="saturation1">
                        <div class="range-value" id="saturationValue1">0</div>
                        <button class="reset-btn" data-control="saturation1">‚Ü∫</button>
                    </div>
                </div>
                <div class="control-row">
                    <div class="control-label">Hue Rotation</div>
                    <div class="range-control">
                        <input type="range" min="0" max="360" value="0" id="hue1">
                        <div class="range-value" id="hueValue1">0¬∞</div>
                        <button class="reset-btn" data-control="hue1">‚Ü∫</button>
                    </div>
                </div>
            </div>
        </div>

        <div class="tab-content" id="right-image">
            <div class="control-group">
                <div class="control-row">
                    <div class="control-label">Brightness</div>
                    <div class="range-control">
                        <input type="range" min="-100" max="100" value="0" id="brightness2">
                        <div class="range-value" id="brightnessValue2">0</div>
                        <button class="reset-btn" data-control="brightness2">‚Ü∫</button>
                    </div>
                </div>
                <div class="control-row">
                    <div class="control-label">Contrast</div>
                    <div class="range-control">
                        <input type="range" min="-100" max="100" value="0" id="contrast2">
                        <div class="range-value" id="contrastValue2">0</div>
                        <button class="reset-btn" data-control="contrast2">‚Ü∫</button>
                    </div>
                </div>
                <div class="control-row">
                    <div class="control-label">Saturation</div>
                    <div class="range-control">
                        <input type="range" min="-100" max="100" value="0" id="saturation2">
                        <div class="range-value" id="saturationValue2">0</div>
                        <button class="reset-btn" data-control="saturation2">‚Ü∫</button>
                    </div>
                </div>
                <div class="control-row">
                    <div class="control-label">Hue Rotation</div>
                    <div class="range-control">
                        <input type="range" min="0" max="360" value="0" id="hue2">
                        <div class="range-value" id="hueValue2">0¬∞</div>
                        <button class="reset-btn" data-control="hue2">‚Ü∫</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Fullscreen Container -->
<div class="fullscreen-container" id="fullscreenContainer">
    <button class="fullscreen-close" id="fullscreenClose">
        <svg viewBox="0 0 24 24" width="16" height="16" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M18 6L6 18"></path>
            <path d="M6 6l12 12"></path>
        </svg>
    </button>
    <div class="slider-container">
        <div class="image-wrapper">
            <img id="fs-image1" alt="Image 1">
            <div class="mask">
                <img id="fs-image2" alt="Image 2">
            </div>
            <div class="image-label label-left">Left Image</div>
            <div class="image-label label-right">Right Image</div>
        </div>
        <div class="slider"></div>
    </div>
</div>

<!-- Keyboard Shortcuts Help -->
<div class="keyboard-info" id="keyboardInfo">
    <button class="close-btn" id="closeKeyboardInfo">√ó</button>
    <h3>Keyboard Shortcuts</h3>
    <div class="keyboard-grid">
        <div class="key-combo">
            <span class="key">‚Üê</span>
            <span class="key">‚Üí</span>
            <span class="key-desc">Move slider</span>
        </div>
        <div class="key-combo">
            <span class="key">‚Üë</span>
            <span class="key">‚Üì</span>
            <span class="key-desc">Move vertical slider</span>
        </div>
        <div class="key-combo">
            <span class="key">+</span>
            <span class="key">-</span>
            <span class="key-desc">Zoom in/out</span>
        </div>
        <div class="key-combo">
            <span class="key">R</span>
            <span class="key-desc">Reset slider position</span>
        </div>
        <div class="key-combo">
            <span class="key">S</span>
            <span class="key-desc">Swap images</span>
        </div>
        <div class="key-combo">
            <span class="key">G</span>
            <span class="key-desc">Toggle grid</span>
        </div>
        <div class="key-combo">
            <span class="key">F</span>
            <span class="key-desc">Toggle fullscreen</span>
        </div>
        <div class="key-combo">
            <span class="key">E</span>
            <span class="key-desc">Toggle edit panel</span>
        </div>
        <div class="key-combo">
            <span class="key">C</span>
            <span class="key-desc">Take snapshot</span>
        </div>
        <div class="key-combo">
            <span class="key">1-4</span>
            <span class="key-desc">Switch comparison modes</span>
        </div>
        <div class="key-combo">
            <span class="key">Esc</span>
            <span class="key-desc">Close dialogs</span>
        </div>
        <div class="key-combo">
            <span class="key">?</span>
            <span class="key-desc">Show/hide this help</span>
        </div>
    </div>
</div>

<!-- Snapshot Dialog -->
<div class="overlay" id="snapshotOverlay">
    <div class="overlay-content">
        <button class="close-btn" id="closeSnapshotOverlay">√ó</button>
        <h3>Comparison Snapshot</h3>
        <p>Right-click the image below to save it:</p>
        <img id="snapshotPreview" class="snapshot-preview active" alt="Snapshot">
        <div style="margin-top: 15px; text-align: center;">
            <button id="downloadSnapshotBtn" class="primary">Download</button>
        </div>
    </div>
</div>

<script>
    // ----- CORE ORIGINAL SLIDER FUNCTIONALITY - DO NOT MODIFY THIS SECTION -----
    const uploadImage1 = document.getElementById('uploadImage1');
    const uploadImage2 = document.getElementById('uploadImage2');
    const image1 = document.getElementById('image1');
    const image2 = document.getElementById('image2');
    const slider = document.querySelector('.slider');
    const mask = document.querySelector('.mask');
    let isDragging = false;

    uploadImage1.addEventListener('change', (e) => {
        const file = e.target.files[0];
        const reader = new FileReader();
        reader.onloadend = () => {
            image1.src = reader.result;
        };
        if (file) {
            reader.readAsDataURL(file);
        }
    });

    uploadImage2.addEventListener('change', (e) => {
        const file = e.target.files[0];
        const reader = new FileReader();
        reader.onloadend = () => {
            image2.src = reader.result;
        };
        if (file) {
            reader.readAsDataURL(file);
        }
    });

    function updateMaskWidth(clientX) {
        const rect = slider.parentElement.getBoundingClientRect();
        const xPos = Math.max(0, Math.min(clientX - rect.left, rect.width));
        mask.style.width = `${xPos}px`;
        slider.style.left = `${xPos}px`;
    }

    slider.addEventListener('mousedown', (e) => {
        isDragging = true;
    });

    document.addEventListener('mousemove', (e) => {
        if (!isDragging) return;
        e.preventDefault();
        updateMaskWidth(e.clientX);
    });

    document.addEventListener('mouseup', () => {
        isDragging = false;
    });

    slider.addEventListener('touchstart', (e) => {
        isDragging = true;
    });

    document.addEventListener('touchmove', (e) => {
        if (!isDragging) return;
        e.preventDefault();
        updateMaskWidth(e.touches[0].clientX);
    });

    document.addEventListener('touchend', () => {
        isDragging = false;
    });
    // ----- END CORE ORIGINAL SLIDER FUNCTIONALITY -----

    // ----- ENHANCEMENTS & NEW FEATURES -----

    // Additional elements
    const preview1 = document.getElementById('preview1');
    const preview2 = document.getElementById('preview2');
    const uploadBox1 = document.getElementById('upload-box-1');
    const uploadBox2 = document.getElementById('upload-box-2');
    const swapBtn = document.getElementById('swapBtn');
    const resetBtn = document.getElementById('resetBtn');
    const labelLeft = document.querySelector('.label-left');
    const labelRight = document.querySelector('.label-right');
    const zoomInBtn = document.getElementById('zoomInBtn');
    const zoomOutBtn = document.getElementById('zoomOutBtn');
    const gridBtn = document.getElementById('gridBtn');
    const editBtn = document.getElementById('editBtn');
    const fullscreenBtn = document.getElementById('fullscreenBtn');
    const helpBtn = document.getElementById('helpBtn');
    const snapshotBtn = document.getElementById('snapshotBtn');
    const gridOverlay = document.getElementById('gridOverlay');
    const zoomIndicator = document.querySelector('.zoom-indicator');
    const keyboardInfo = document.getElementById('keyboardInfo');
    const closeKeyboardInfo = document.getElementById('closeKeyboardInfo');
    const loadingIndicator = document.getElementById('loadingIndicator');
    const modeOptions = document.querySelectorAll('.mode-option');
    const panResetBtn = document.getElementById('panResetBtn');
    const zoomResetBtn = document.getElementById('zoomResetBtn');
    const editingPanel = document.getElementById('editingPanel');
    const panelTabs = document.querySelectorAll('.panel-tab');
    const tabContents = document.querySelectorAll('.tab-content');
    const resetAllAdjustments = document.getElementById('resetAllAdjustments');
    const controlResetBtns = document.querySelectorAll('.reset-btn[data-control]');
    const fullscreenContainer = document.getElementById('fullscreenContainer');
    const fullscreenClose = document.getElementById('fullscreenClose');
    const fsImage1 = document.getElementById('fs-image1');
    const fsImage2 = document.getElementById('fs-image2');
    const snapshotOverlay = document.getElementById('snapshotOverlay');
    const closeSnapshotOverlay = document.getElementById('closeSnapshotOverlay');
    const snapshotPreview = document.getElementById('snapshotPreview');
    const downloadSnapshotBtn = document.getElementById('downloadSnapshotBtn');

    // State tracking
    const state = {
        imagesLoaded: [false, false],
        zoom: 1,
        pan: {x: 0, y: 0},
        isPanning: false,
        panStart: {x: 0, y: 0},
        mode: 'horizontal',
        gridActive: false,
        editingActive: false,
        fullscreenActive: false,
        adjustments: {
            image1: {
                brightness: 0,
                contrast: 0,
                saturation: 0,
                hue: 0
            },
            image2: {
                brightness: 0,
                contrast: 0,
                saturation: 0,
                hue: 0
            }
        }
    };

    // Better image upload with previews and validation
    uploadImage1.addEventListener('change', (e) => {
        handleImageUpload(e, 0);
    });

    uploadImage2.addEventListener('change', (e) => {
        handleImageUpload(e, 1);
    });

    function handleImageUpload(e, index) {
        const file = e.target.files[0];
        if (!file) return;

        // Validate file type
        const validTypes = ['image/jpeg', 'image/png', 'image/gif', 'image/webp', 'image/svg+xml'];
        if (!validTypes.includes(file.type)) {
            alert('Please upload a valid image file (JPEG, PNG, GIF, WEBP, SVG)');
            return;
        }

        loadingIndicator.classList.add('active');

        const reader = new FileReader();
        reader.onload = function (event) {
            const img = new Image();
            img.src = event.target.result;

            img.onload = function () {
                // Update preview
                if (index === 0) {
                    preview1.src = event.target.result;
                    preview1.style.display = 'block';
                    uploadBox1.classList.add('has-image');

                    // When the main image loads, also update fullscreen image
                    fsImage1.src = event.target.result;
                } else {
                    preview2.src = event.target.result;
                    preview2.style.display = 'block';
                    uploadBox2.classList.add('has-image');

                    // When the main image loads, also update fullscreen image
                    fsImage2.src = event.target.result;
                }

                // Update label
                const fileName = file.name.split('.')[0];
                const shortName = fileName.length > 12 ? fileName.substring(0, 12) + '...' : fileName;

                if (index === 0) {
                    labelLeft.textContent = shortName;
                } else {
                    labelRight.textContent = shortName;
                }

                // Update state
                state.imagesLoaded[index] = true;
                enableDisableControls();

                loadingIndicator.classList.remove('active');
            };

            img.onerror = function () {
                alert('Failed to load image');
                loadingIndicator.classList.remove('active');
            };
        };

        reader.onerror = function () {
            alert('Error reading file');
            loadingIndicator.classList.remove('active');
        };

        reader.readAsDataURL(file);
    }

    // Enable/disable controls based on image load state
    function enableDisableControls() {
        const bothLoaded = state.imagesLoaded[0] && state.imagesLoaded[1];
        swapBtn.disabled = !bothLoaded;
        resetBtn.disabled = !bothLoaded;
        zoomInBtn.disabled = !bothLoaded;
        zoomOutBtn.disabled = !bothLoaded;
        gridBtn.disabled = !bothLoaded;
        editBtn.disabled = !bothLoaded;
        fullscreenBtn.disabled = !bothLoaded;
        snapshotBtn.disabled = !bothLoaded;
    }

    // Handle comparison modes
    modeOptions.forEach(option => {
        option.addEventListener('click', () => {
            // Remove active class from all options
            modeOptions.forEach(opt => opt.classList.remove('active'));

            // Add active class to clicked option
            option.classList.add('active');

            // Update state
            state.mode = option.dataset.mode;

            // Apply changes based on mode
            applyComparisonMode();
        });
    });

    function applyComparisonMode() {
        // Remove all mode-specific classes
        slider.classList.remove('vertical', 'diagonal');
        mask.classList.remove('vertical', 'diagonal');

        // Reset image opacity
        image1.style.opacity = '1';
        image2.style.opacity = '1';
        fsImage1.style.opacity = '1';
        fsImage2.style.opacity = '1';

        switch (state.mode) {
            case 'horizontal':
                // Default state
                resetSliderPosition();
                break;
            case 'vertical':
                slider.classList.add('vertical');
                mask.classList.add('vertical');
                resetSliderPosition();
                break;
            case 'diagonal':
                slider.classList.add('diagonal');
                mask.classList.add('diagonal');
                resetSliderPosition();
                break;
            case 'opacity':
                // Modify the mask to show the entire image and make image2 semi-transparent
                mask.style.width = '100%';
                mask.style.height = '100%';
                image2.style.opacity = '0.5';
                fsImage2.style.opacity = '0.5';
                break;
        }
    }

    // Add vertical slider functionality
    function updateMaskHeight(clientY) {
        const rect = slider.parentElement.getBoundingClientRect();
        const yPos = Math.max(0, Math.min(clientY - rect.top, rect.height));
        mask.style.height = `${yPos}px`;
        slider.style.top = `${yPos}px`;
    }

    // Update the original mousemove event handler
    document.addEventListener('mousemove', (e) => {
        if (!isDragging) return;
        e.preventDefault();

        if (state.mode === 'horizontal' || state.mode === 'diagonal') {
            updateMaskWidth(e.clientX);
        } else if (state.mode === 'vertical') {
            updateMaskHeight(e.clientY);
        }
        // Opacity mode doesn't need slider movement
    });

    // Update touchmove as well
    document.addEventListener('touchmove', (e) => {
        if (!isDragging) return;
        e.preventDefault();

        if (state.mode === 'horizontal' || state.mode === 'diagonal') {
            updateMaskWidth(e.touches[0].clientX);
        } else if (state.mode === 'vertical') {
            updateMaskHeight(e.touches[0].clientY);
        }
    });

    // Swap images functionality
    swapBtn.addEventListener('click', () => {
        if (!state.imagesLoaded[0] || !state.imagesLoaded[1]) return;

        // Swap main images
        [image1.src, image2.src] = [image2.src, image1.src];
        [fsImage1.src, fsImage2.src] = [fsImage2.src, fsImage1.src];

        // Swap previews
        [preview1.src, preview2.src] = [preview2.src, preview1.src];

        // Swap labels
        [labelLeft.textContent, labelRight.textContent] = [labelRight.textContent, labelLeft.textContent];

        // Swap adjustments
        [state.adjustments.image1, state.adjustments.image2] =
            [state.adjustments.image2, state.adjustments.image1];

        // Reapply adjustments
        applyImageAdjustments();
        updateAdjustmentControls();
    });

    // Reset slider position
    function resetSliderPosition() {
        const container = slider.parentElement;
        const rect = container.getBoundingClientRect();

        if (state.mode === 'horizontal' || state.mode === 'diagonal') {
            updateMaskWidth(rect.left + rect.width / 2);
        } else if (state.mode === 'vertical') {
            updateMaskHeight(rect.top + rect.height / 2);
        }
    }

    resetBtn.addEventListener('click', resetSliderPosition);

    // Zoom and pan functionality
    zoomInBtn.addEventListener('click', () => {
        changeZoom(0.1);
    });

    zoomOutBtn.addEventListener('click', () => {
        changeZoom(-0.1);
    });

    function changeZoom(delta) {
        state.zoom = Math.max(1, Math.min(5, state.zoom + delta));
        applyZoomAndPan();
        updateZoomIndicator();
    }

    function applyZoomAndPan() {
        const transform = `scale(${state.zoom}) translate(${state.pan.x / state.zoom}px, ${state.pan.y / state.zoom}px)`;
        image1.style.transform = transform;
        image2.style.transform = transform;
        fsImage1.style.transform = transform;
        fsImage2.style.transform = transform;
    }

    function updateZoomIndicator() {
        zoomIndicator.textContent = `Zoom: ${Math.round(state.zoom * 100)}%`;
    }

    // Add image panning with middle mouse button
    const imageWrapper = document.querySelector('.image-wrapper');

    imageWrapper.addEventListener('mousedown', (e) => {
        // Only pan with middle mouse button (button code 1) or when zoomed in
        if (e.button !== 1 && state.zoom <= 1) return;

        // Prevent starting pan on the slider
        if (e.target === slider) return;

        e.preventDefault();
        state.isPanning = true;
        state.panStart.x = e.clientX;
        state.panStart.y = e.clientY;
    });

    document.addEventListener('mousemove', (e) => {
        if (!state.isPanning) return;
        e.preventDefault();

        const deltaX = e.clientX - state.panStart.x;
        const deltaY = e.clientY - state.panStart.y;

        state.pan.x += deltaX;
        state.pan.y += deltaY;

        state.panStart.x = e.clientX;
        state.panStart.y = e.clientY;

        applyZoomAndPan();
    });

    document.addEventListener('mouseup', () => {
        state.isPanning = false;
    });

    // Reset pan position
    panResetBtn.addEventListener('click', () => {
        state.pan = {x: 0, y: 0};
        applyZoomAndPan();
    });

    // Reset zoom
    zoomResetBtn.addEventListener('click', () => {
        state.zoom = 1;
        applyZoomAndPan();
        updateZoomIndicator();
    });

    // Grid overlay
    gridBtn.addEventListener('click', () => {
        state.gridActive = !state.gridActive;
        toggleGrid();
    });

    function toggleGrid() {
        if (state.gridActive) {
            // Create grid lines
            gridOverlay.innerHTML = '';
            gridOverlay.classList.add('active');

            // Create vertical lines
            for (let i = 1; i < 3; i++) {
                const line = document.createElement('div');
                line.className = 'grid-line grid-line-v';
                line.style.left = `${(i * 100) / 3}%`;
                gridOverlay.appendChild(line);
            }

            // Create horizontal lines
            for (let i = 1; i < 3; i++) {
                const line = document.createElement('div');
                line.className = 'grid-line grid-line-h';
                line.style.top = `${(i * 100) / 3}%`;
                gridOverlay.appendChild(line);
            }
        } else {
            gridOverlay.classList.remove('active');
        }
    }

    // Edit panel
    editBtn.addEventListener('click', () => {
        state.editingActive = !state.editingActive;
        editingPanel.classList.toggle('active', state.editingActive);
    });

    // Tab switching
    panelTabs.forEach(tab => {
        tab.addEventListener('click', () => {
            // Remove active class from all tabs and contents
            panelTabs.forEach(t => t.classList.remove('active'));
            tabContents.forEach(c => c.classList.remove('active'));

            // Add active class to clicked tab and corresponding content
            tab.classList.add('active');
            document.getElementById(tab.dataset.tab).classList.add('active');
        });
    });

    // Image adjustment controls
    const adjustmentControls = {
        brightness1: document.getElementById('brightness1'),
        contrast1: document.getElementById('contrast1'),
        saturation1: document.getElementById('saturation1'),
        hue1: document.getElementById('hue1'),
        brightness2: document.getElementById('brightness2'),
        contrast2: document.getElementById('contrast2'),
        saturation2: document.getElementById('saturation2'),
        hue2: document.getElementById('hue2')
    };

    const adjustmentValues = {
        brightnessValue1: document.getElementById('brightnessValue1'),
        contrastValue1: document.getElementById('contrastValue1'),
        saturationValue1: document.getElementById('saturationValue1'),
        hueValue1: document.getElementById('hueValue1'),
        brightnessValue2: document.getElementById('brightnessValue2'),
        contrastValue2: document.getElementById('contrastValue2'),
        saturationValue2: document.getElementById('saturationValue2'),
        hueValue2: document.getElementById('hueValue2')
    };

    // Set up event listeners for all adjustment controls
    adjustmentControls.brightness1.addEventListener('input', updateAdjustment);
    adjustmentControls.contrast1.addEventListener('input', updateAdjustment);
    adjustmentControls.saturation1.addEventListener('input', updateAdjustment);
    adjustmentControls.hue1.addEventListener('input', updateAdjustment);
    adjustmentControls.brightness2.addEventListener('input', updateAdjustment);
    adjustmentControls.contrast2.addEventListener('input', updateAdjustment);
    adjustmentControls.saturation2.addEventListener('input', updateAdjustment);
    adjustmentControls.hue2.addEventListener('input', updateAdjustment);

    function updateAdjustment(e) {
        const control = e.target;
        const value = control.value;
        const id = control.id;

        // Update state
        if (id.startsWith('brightness')) {
            const imageIndex = id.endsWith('1') ? 'image1' : 'image2';
            state.adjustments[imageIndex].brightness = parseInt(value, 10);
        } else if (id.startsWith('contrast')) {
            const imageIndex = id.endsWith('1') ? 'image1' : 'image2';
            state.adjustments[imageIndex].contrast = parseInt(value, 10);
        } else if (id.startsWith('saturation')) {
            const imageIndex = id.endsWith('1') ? 'image1' : 'image2';
            state.adjustments[imageIndex].saturation = parseInt(value, 10);
        } else if (id.startsWith('hue')) {
            const imageIndex = id.endsWith('1') ? 'image1' : 'image2';
            state.adjustments[imageIndex].hue = parseInt(value, 10);
        }

        // Update display value
        const valueElement = id.endsWith('1') ?
            adjustmentValues[id + 'Value1'] :
            adjustmentValues[id + 'Value2'];

        if (id.startsWith('hue')) {
            valueElement.textContent = `${value}¬∞`;
        } else {
            valueElement.textContent = value;
        }

        // Apply adjustments
        applyImageAdjustments();
    }

    // Apply all image adjustments
    function applyImageAdjustments() {
        // Image 1
        const adj1 = state.adjustments.image1;
        const filters1 = `
        brightness(${100 + adj1.brightness}%)
        contrast(${100 + adj1.contrast}%)
        saturate(${100 + adj1.saturation}%)
        hue-rotate(${adj1.hue}deg)
      `;
        image1.style.filter = filters1;
        fsImage1.style.filter = filters1;

        // Image 2
        const adj2 = state.adjustments.image2;
        const filters2 = `
        brightness(${100 + adj2.brightness}%)
        contrast(${100 + adj2.contrast}%)
        saturate(${100 + adj2.saturation}%)
        hue-rotate(${adj2.hue}deg)
      `;
        image2.style.filter = filters2;
        fsImage2.style.filter = filters2;
    }

    // Reset individual adjustment
    controlResetBtns.forEach(btn => {
        btn.addEventListener('click', () => {
            const controlId = btn.dataset.control;
            const control = document.getElementById(controlId);

            if (controlId.startsWith('brightness')) {
                control.value = 0;
                const imageIndex = controlId.endsWith('1') ? 'image1' : 'image2';
                state.adjustments[imageIndex].brightness = 0;
                const valueElement = controlId.endsWith('1') ?
                    adjustmentValues.brightnessValue1 :
                    adjustmentValues.brightnessValue2;
                valueElement.textContent = '0';
            } else if (controlId.startsWith('contrast')) {
                control.value = 0;
                const imageIndex = controlId.endsWith('1') ? 'image1' : 'image2';
                state.adjustments[imageIndex].contrast = 0;
                const valueElement = controlId.endsWith('1') ?
                    adjustmentValues.contrastValue1 :
                    adjustmentValues.contrastValue2;
                valueElement.textContent = '0';
            } else if (controlId.startsWith('saturation')) {
                control.value = 0;
                const imageIndex = controlId.endsWith('1') ? 'image1' : 'image2';
                state.adjustments[imageIndex].saturation = 0;
                const valueElement = controlId.endsWith('1') ?
                    adjustmentValues.saturationValue1 :
                    adjustmentValues.saturationValue2;
                valueElement.textContent = '0';
            } else if (controlId.startsWith('hue')) {
                control.value = 0;
                const imageIndex = controlId.endsWith('1') ? 'image1' : 'image2';
                state.adjustments[imageIndex].hue = 0;
                const valueElement = controlId.endsWith('1') ?
                    adjustmentValues.hueValue1 :
                    adjustmentValues.hueValue2;
                valueElement.textContent = '0¬∞';
            }

            applyImageAdjustments();
        });
    });

    // Reset all adjustments
    resetAllAdjustments.addEventListener('click', () => {
        // Reset all values
        state.adjustments = {
            image1: {
                brightness: 0,
                contrast: 0,
                saturation: 0,
                hue: 0
            },
            image2: {
                brightness: 0,
                contrast: 0,
                saturation: 0,
                hue: 0
            }
        };

        // Update controls
        updateAdjustmentControls();

        // Apply reset
        applyImageAdjustments();
    });

    // Update adjustment controls to match state
    function updateAdjustmentControls() {
        // Image 1
        adjustmentControls.brightness1.value = state.adjustments.image1.brightness;
        adjustmentControls.contrast1.value = state.adjustments.image1.contrast;
        adjustmentControls.saturation1.value = state.adjustments.image1.saturation;
        adjustmentControls.hue1.value = state.adjustments.image1.hue;

        adjustmentValues.brightnessValue1.textContent = state.adjustments.image1.brightness;
        adjustmentValues.contrastValue1.textContent = state.adjustments.image1.contrast;
        adjustmentValues.saturationValue1.textContent = state.adjustments.image1.saturation;
        adjustmentValues.hueValue1.textContent = state.adjustments.image1.hue + '¬∞';

        // Image 2
        adjustmentControls.brightness2.value = state.adjustments.image2.brightness;
        adjustmentControls.contrast2.value = state.adjustments.image2.contrast;
        adjustmentControls.saturation2.value = state.adjustments.image2.saturation;
        adjustmentControls.hue2.value = state.adjustments.image2.hue;

        adjustmentValues.brightnessValue2.textContent = state.adjustments.image2.brightness;
        adjustmentValues.contrastValue2.textContent = state.adjustments.image2.contrast;
        adjustmentValues.saturationValue2.textContent = state.adjustments.image2.saturation;
        adjustmentValues.hueValue2.textContent = state.adjustments.image2.hue + '¬∞';
    }

    // Fullscreen mode
    fullscreenBtn.addEventListener('click', toggleFullscreen);
    fullscreenClose.addEventListener('click', toggleFullscreen);

    function toggleFullscreen() {
        state.fullscreenActive = !state.fullscreenActive;
        fullscreenContainer.classList.toggle('active', state.fullscreenActive);

        if (state.fullscreenActive) {
            document.body.style.overflow = 'hidden';

            // Copy slider position to fullscreen
            const fsSlider = fullscreenContainer.querySelector('.slider');
            const fsMask = fullscreenContainer.querySelector('.mask');

            fsSlider.className = slider.className;
            fsMask.className = mask.className;

            if (state.mode === 'horizontal' || state.mode === 'diagonal') {
                const maskWidth = getComputedStyle(mask).width;
                fsMask.style.width = maskWidth;
                fsSlider.style.left = slider.style.left;
            } else if (state.mode === 'vertical') {
                const maskHeight = getComputedStyle(mask).height;
                fsMask.style.height = maskHeight;
                fsSlider.style.top = slider.style.top;
            }
        } else {
            document.body.style.overflow = '';
        }
    }

    // Keyboard shortcuts
    document.addEventListener('keydown', (e) => {
        // Skip if in an input field
        if (e.target.tagName === 'INPUT' || e.target.tagName === 'TEXTAREA') {
            return;
        }

        const key = e.key.toLowerCase();

        // Handle number keys for comparison modes
        if ('1234'.includes(key) && !e.ctrlKey && !e.altKey && !e.metaKey) {
            e.preventDefault();
            const modeIndex = parseInt(key, 10) - 1;
            if (modeOptions[modeIndex]) {
                modeOptions.forEach(opt => opt.classList.remove('active'));
                modeOptions[modeIndex].classList.add('active');
                state.mode = modeOptions[modeIndex].dataset.mode;
                applyComparisonMode();
            }
            return;
        }

        switch (key) {
            case 'arrowleft':
                if (state.mode === 'horizontal' || state.mode === 'diagonal') {
                    e.preventDefault();
                    const rect = slider.parentElement.getBoundingClientRect();
                    const currentWidth = parseFloat(mask.style.width) || rect.width / 2;
                    updateMaskWidth(rect.left + currentWidth - 10);
                }
                break;
            case 'arrowright':
                if (state.mode === 'horizontal' || state.mode === 'diagonal') {
                    e.preventDefault();
                    const rect = slider.parentElement.getBoundingClientRect();
                    const currentWidth = parseFloat(mask.style.width) || rect.width / 2;
                    updateMaskWidth(rect.left + currentWidth + 10);
                }
                break;
            case 'arrowup':
                if (state.mode === 'vertical') {
                    e.preventDefault();
                    const rect = slider.parentElement.getBoundingClientRect();
                    const currentHeight = parseFloat(mask.style.height) || rect.height / 2;
                    updateMaskHeight(rect.top + currentHeight - 10);
                }
                break;
            case 'arrowdown':
                if (state.mode === 'vertical') {
                    e.preventDefault();
                    const rect = slider.parentElement.getBoundingClientRect();
                    const currentHeight = parseFloat(mask.style.height) || rect.height / 2;
                    updateMaskHeight(rect.top + currentHeight + 10);
                }
                break;
            case '=':
            case '+':
                if (state.imagesLoaded[0] && state.imagesLoaded[1]) {
                    e.preventDefault();
                    changeZoom(0.1);
                }
                break;
            case '-':
                if (state.imagesLoaded[0] && state.imagesLoaded[1]) {
                    e.preventDefault();
                    changeZoom(-0.1);
                }
                break;
            case 'r':
                if (state.imagesLoaded[0] && state.imagesLoaded[1]) {
                    e.preventDefault();
                    resetSliderPosition();
                }
                break;
            case 'z':
                if (state.imagesLoaded[0] && state.imagesLoaded[1]) {
                    e.preventDefault();
                    state.zoom = 1;
                    state.pan = {x: 0, y: 0};
                    applyZoomAndPan();
                    updateZoomIndicator();
                }
                break;
            case 's':
                if (state.imagesLoaded[0] && state.imagesLoaded[1]) {
                    e.preventDefault();
                    swapBtn.click();
                }
                break;
            case 'g':
                if (state.imagesLoaded[0] && state.imagesLoaded[1]) {
                    e.preventDefault();
                    gridBtn.click();
                }
                break;
            case 'f':
                if (state.imagesLoaded[0] && state.imagesLoaded[1]) {
                    e.preventDefault();
                    toggleFullscreen();
                }
                break;
            case 'e':
                if (state.imagesLoaded[0] && state.imagesLoaded[1]) {
                    e.preventDefault();
                    editBtn.click();
                }
                break;
            case 'c':
                if (state.imagesLoaded[0] && state.imagesLoaded[1]) {
                    e.preventDefault();
                    takeSnapshot();
                }
                break;
            case 'escape':
                // Close any open dialogs
                if (state.fullscreenActive) {
                    toggleFullscreen();
                } else if (keyboardInfo.classList.contains('active')) {
                    keyboardInfo.classList.remove('active');
                } else if (snapshotOverlay.classList.contains('active')) {
                    snapshotOverlay.classList.remove('active');
                }
                break;
            case '?':
            case '/':
                if (e.shiftKey || key === '?') {
                    e.preventDefault();
                    toggleKeyboardHelp();
                }
                break;
        }
    });

    // Help dialog
    helpBtn.addEventListener('click', toggleKeyboardHelp);
    closeKeyboardInfo.addEventListener('click', toggleKeyboardHelp);

    function toggleKeyboardHelp() {
        keyboardInfo.classList.toggle('active');
    }

    // Snapshot functionality
    snapshotBtn.addEventListener('click', takeSnapshot);
    closeSnapshotOverlay.addEventListener('click', () => {
        snapshotOverlay.classList.remove('active');
    });

    function takeSnapshot() {
        if (!state.imagesLoaded[0] || !state.imagesLoaded[1]) return;

        const container = document.querySelector('.slider-container');

        // Create canvas
        const canvas = document.createElement('canvas');
        const ctx = canvas.getContext('2d');

        canvas.width = container.offsetWidth;
        canvas.height = container.offsetHeight;

        // Draw background
        ctx.fillStyle = '#f1f5f9';
        ctx.fillRect(0, 0, canvas.width, canvas.height);

        // We're using html2canvas to capture the view exactly as it appears
        // For a simpler approach, we'll simulate the basic functionality here

        // Draw current state
        html2canvas(container, {
            removeContainer: true,
            backgroundColor: null
        }).then(function (canvas) {
            const imageURL = canvas.toDataURL('image/png');
            snapshotPreview.src = imageURL;
            snapshotOverlay.classList.add('active');

            // Set up download button
            downloadSnapshotBtn.onclick = function () {
                const link = document.createElement('a');
                link.download = 'image-comparison.png';
                link.href = imageURL;
                link.click();
            };
        }).catch(function (error) {
            alert('Failed to create snapshot: ' + error);
        });
    }

    // Global html2canvas mock (since we can't include external libraries)
    function html2canvas(element, options) {
        return new Promise((resolve, reject) => {
            try {
                // Create canvas
                const canvas = document.createElement('canvas');
                const ctx = canvas.getContext('2d');

                canvas.width = element.offsetWidth;
                canvas.height = element.offsetHeight;

                // Draw background
                ctx.fillStyle = '#f1f5f9';
                ctx.fillRect(0, 0, canvas.width, canvas.height);

                // Simple rendering - this is a mock implementation
                // In a real implementation, html2canvas would accurately render the DOM
                const img1 = document.getElementById('image1');
                const img2 = document.getElementById('image2');

                // Draw base image
                if (img1.complete && img1.naturalWidth) {
                    drawImageProp(ctx, img1, 0, 0, canvas.width, canvas.height);
                }

                // Draw mask area
                const maskWidth = parseFloat(mask.style.width) || canvas.width / 2;
                ctx.save();
                ctx.beginPath();

                if (state.mode === 'horizontal') {
                    ctx.rect(0, 0, maskWidth, canvas.height);
                } else if (state.mode === 'vertical') {
                    const maskHeight = parseFloat(mask.style.height) || canvas.height / 2;
                    ctx.rect(0, 0, canvas.width, maskHeight);
                } else if (state.mode === 'diagonal') {
                    ctx.moveTo(0, 0);
                    ctx.lineTo(maskWidth, maskWidth);
                    ctx.lineTo(0, canvas.height);
                    ctx.closePath();
                }

                ctx.clip();

                // Draw second image in mask area
                if (img2.complete && img2.naturalWidth) {
                    drawImageProp(ctx, img2, 0, 0, canvas.width, canvas.height);
                }

                ctx.restore();

                // Draw slider line
                ctx.strokeStyle = '#0891b2';
                ctx.lineWidth = 2;

                if (state.mode === 'horizontal') {
                    ctx.beginPath();
                    ctx.moveTo(maskWidth, 0);
                    ctx.lineTo(maskWidth, canvas.height);
                    ctx.stroke();

                    // Draw slider handle
                    ctx.fillStyle = '#0891b2';
                    ctx.beginPath();
                    ctx.arc(maskWidth, canvas.height / 2, 12, 0, Math.PI * 2);
                    ctx.fill();
                } else if (state.mode === 'vertical') {
                    const maskHeight = parseFloat(mask.style.height) || canvas.height / 2;
                    ctx.beginPath();
                    ctx.moveTo(0, maskHeight);
                    ctx.lineTo(canvas.width, maskHeight);
                    ctx.stroke();

                    // Draw slider handle
                    ctx.fillStyle = '#0891b2';
                    ctx.beginPath();
                    ctx.arc(canvas.width / 2, maskHeight, 12, 0, Math.PI * 2);
                    ctx.fill();
                } else if (state.mode === 'diagonal') {
                    ctx.beginPath();
                    ctx.moveTo(0, 0);
                    ctx.lineTo(maskWidth, maskWidth);
                    ctx.stroke();

                    // Draw slider handle
                    ctx.fillStyle = '#0891b2';
                    ctx.beginPath();
                    ctx.arc(maskWidth / 2, maskWidth / 2, 12, 0, Math.PI * 2);
                    ctx.fill();
                }

                resolve(canvas);
            } catch (error) {
                reject(error);
            }
        });
    }

    // Helper function to maintain aspect ratio when drawing images
    function drawImageProp(ctx, img, x, y, w, h) {
        const imgRatio = img.naturalWidth / img.naturalHeight;
        const canvasRatio = w / h;
        let sX, sY, sW, sH;

        if (canvasRatio > imgRatio) {
            sW = img.naturalWidth;
            sH = sW / canvasRatio;
            sX = 0;
            sY = (img.naturalHeight - sH) / 2;
        } else {
            sH = img.naturalHeight;
            sW = sH * canvasRatio;
            sY = 0;
            sX = (img.naturalWidth - sW) / 2;
        }

        ctx.drawImage(img, sX, sY, sW, sH, x, y, w, h);
    }

    // Initialize slider position
    window.addEventListener('load', () => {
        resetSliderPosition();
        updateZoomIndicator();
    });

    // Handle window resize
    window.addEventListener('resize', () => {
        resetSliderPosition();
    });
</script>
<script src="../logo.js"></script>
</body>
</html>