<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sports Plan Generator</title>
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
    <style>
        *, *::before, *::after {
            box-sizing: border-box;
            margin: 0;
            padding: 0
        }

        :root {
            --bg: #f8fafc;
            --bg-card: #ffffff;
            --bg-alt: #f1f5f9;
            --bg-elevated: #ffffff;
            --text: #0f172a;
            --text-muted: #64748b;
            --text-light: #94a3b8;
            --primary: #2563eb;
            --primary-hover: #1d4ed8;
            --primary-light: #eff6ff;
            --primary-muted: #3b82f6;
            --border: #e2e8f0;
            --border-light: #f1f5f9;
            --success: #059669;
            --success-light: #ecfdf5;
            --warning: #d97706;
            --warning-light: #fffbeb;
            --error: #dc2626;
            --error-light: #fef2f2;
            --radius: 12px;
            --radius-sm: 8px;
            --shadow-sm: 0 1px 2px rgb(0 0 0/.04);
            --shadow: 0 1px 3px rgb(0 0 0/.06), 0 1px 2px rgb(0 0 0/.04);
            --shadow-md: 0 4px 6px -1px rgb(0 0 0/.07), 0 2px 4px -2px rgb(0 0 0/.05);
            --shadow-lg: 0 10px 15px -3px rgb(0 0 0/.08), 0 4px 6px -4px rgb(0 0 0/.04)
        }

        @media (prefers-color-scheme: dark) {
            :root {
                --bg: #0a0f1a;
                --bg-card: #111827;
                --bg-alt: #1e293b;
                --bg-elevated: #1e293b;
                --text: #f1f5f9;
                --text-muted: #94a3b8;
                --text-light: #64748b;
                --border: #1e293b;
                --border-light: #1e293b;
                --primary-light: #1e3a5f;
                --success-light: #064e3b;
                --warning-light: #78350f;
                --error-light: #450a0a;
                --shadow-sm: 0 1px 2px rgb(0 0 0/.2);
                --shadow: 0 1px 3px rgb(0 0 0/.3);
                --shadow-md: 0 4px 6px rgb(0 0 0/.4);
                --shadow-lg: 0 10px 15px rgb(0 0 0/.5)
            }
        }

        body {
            font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: var(--bg);
            color: var(--text);
            line-height: 1.6;
            min-height: 100vh
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            padding: 40px 20px 60px
        }

        header {
            text-align: center;
            margin-bottom: 40px
        }

        header h1 {
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px
        }

        header h1 svg {
            color: var(--primary)
        }

        header p {
            color: var(--text-muted);
            font-size: .9rem
        }

        .card {
            background: var(--bg-card);
            border-radius: var(--radius);
            padding: 24px;
            margin-bottom: 16px;
            box-shadow: var(--shadow);
            border: 1px solid var(--border)
        }

        .card h2 {
            font-size: .875rem;
            font-weight: 600;
            margin-bottom: 18px;
            display: flex;
            align-items: center;
            gap: 8px;
            color: var(--text);
            text-transform: uppercase;
            letter-spacing: .5px
        }

        .card h2 svg {
            width: 18px;
            height: 18px;
            color: var(--primary)
        }

        .section-label {
            font-size: .7rem;
            font-weight: 600;
            color: var(--text-light);
            text-transform: uppercase;
            letter-spacing: .5px;
            margin-bottom: 10px
        }

        .presets {
            display: grid;
            grid-template-columns:repeat(auto-fit, minmax(180px, 1fr));
            gap: 10px;
            margin-bottom: 8px
        }

        .preset-btn {
            display: flex;
            flex-direction: column;
            align-items: flex-start;
            gap: 4px;
            padding: 14px 16px;
            border: 1px solid var(--border);
            border-radius: var(--radius-sm);
            background: var(--bg);
            cursor: pointer;
            transition: all .15s ease;
            text-align: left
        }

        .preset-btn:hover {
            border-color: var(--primary);
            background: var(--primary-light)
        }

        .preset-btn .preset-name {
            font-weight: 600;
            font-size: .875rem;
            color: var(--text)
        }

        .preset-btn .preset-desc {
            font-size: .75rem;
            color: var(--text-muted)
        }

        .form-grid {
            display: grid;
            grid-template-columns:repeat(auto-fit, minmax(180px, 1fr));
            gap: 16px
        }

        .form-group {
            display: flex;
            flex-direction: column;
            gap: 6px
        }

        .form-group.full {
            grid-column: 1/-1
        }

        .form-group label {
            font-size: .7rem;
            font-weight: 600;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: .4px
        }

        .form-group select, .form-group input, .form-group textarea {
            padding: 11px 14px;
            border: 1px solid var(--border);
            border-radius: var(--radius-sm);
            background: var(--bg);
            color: var(--text);
            font-size: .875rem;
            transition: border-color .15s, box-shadow .15s
        }

        .form-group select:focus, .form-group input:focus, .form-group textarea:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px var(--primary-light)
        }

        .form-group textarea {
            resize: vertical;
            min-height: 80px
        }

        .day-selector {
            display: flex;
            gap: 8px;
            flex-wrap: wrap
        }

        .day-btn {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 2px;
            width: 52px;
            padding: 10px 0;
            border-radius: var(--radius-sm);
            border: 1px solid var(--border);
            background: var(--bg);
            color: var(--text-muted);
            cursor: pointer;
            transition: all .15s
        }

        .day-btn .day-short {
            font-size: .8rem;
            font-weight: 600
        }

        .day-btn:hover {
            border-color: var(--primary);
            color: var(--text)
        }

        .day-btn.active {
            background: var(--primary);
            color: #fff;
            border-color: var(--primary)
        }

        .chips {
            display: flex;
            flex-wrap: wrap;
            gap: 8px
        }

        .chip {
            padding: 10px 14px;
            border-radius: var(--radius-sm);
            border: 1px solid var(--border);
            background: var(--bg);
            cursor: pointer;
            font-size: .8rem;
            font-weight: 500;
            transition: all .15s;
            user-select: none;
            display: flex;
            align-items: center;
            gap: 7px
        }

        .chip svg {
            width: 15px;
            height: 15px;
            opacity: .7
        }

        .chip:hover {
            border-color: var(--primary);
            background: var(--primary-light)
        }

        .chip.active {
            background: var(--primary);
            color: #fff;
            border-color: var(--primary)
        }

        .chip.active svg {
            opacity: 1
        }

        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            padding: 14px 28px;
            border: none;
            border-radius: var(--radius-sm);
            font-size: .9rem;
            font-weight: 600;
            cursor: pointer;
            transition: all .15s
        }

        .btn-primary {
            background: var(--primary);
            color: #fff;
            width: 100%;
            margin-top: 8px
        }

        .btn-primary:hover:not(:disabled) {
            background: var(--primary-hover)
        }

        .btn-primary:disabled {
            opacity: .5;
            cursor: not-allowed
        }

        .btn-icon {
            padding: 8px;
            background: var(--bg);
            border: 1px solid var(--border);
            border-radius: var(--radius-sm);
            color: var(--text-muted);
            cursor: pointer;
            transition: all .15s
        }

        .btn-icon:hover {
            border-color: var(--primary);
            color: var(--primary)
        }

        .btn-icon svg {
            width: 16px;
            height: 16px
        }

        .spinner {
            width: 18px;
            height: 18px;
            border: 2px solid rgba(255, 255, 255, .3);
            border-top-color: #fff;
            border-radius: 50%;
            animation: spin .6s linear infinite
        }

        @keyframes spin {
            to {
                transform: rotate(360deg)
            }
        }

        .loading-steps {
            display: none;
            text-align: center;
            padding: 24px 0
        }

        .loading-steps.visible {
            display: block
        }

        .loading-steps .step {
            font-size: .85rem;
            color: var(--text-muted);
            margin-bottom: 8px;
            opacity: .5;
            transition: opacity .3s
        }

        .loading-steps .step.active {
            opacity: 1;
            color: var(--primary);
            font-weight: 500
        }

        .loading-steps .step.done {
            opacity: .7;
            color: var(--success)
        }

        .results {
            display: none
        }

        .results.visible {
            display: block
        }

        .results-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 12px;
            margin-bottom: 20px
        }

        .results-header h2 {
            margin: 0;
            font-size: 1rem;
            display: flex;
            align-items: center;
            gap: 8px
        }

        .results-header h2 svg {
            color: var(--primary)
        }

        .results-actions {
            display: flex;
            gap: 6px
        }

        .summary-grid {
            display: grid;
            grid-template-columns:repeat(4, 1fr);
            gap: 12px;
            margin-bottom: 24px
        }

        .stat-card {
            background: var(--bg-alt);
            border-radius: var(--radius-sm);
            padding: 16px;
            text-align: center
        }

        .stat-value {
            font-size: 1.75rem;
            font-weight: 700;
            color: var(--primary);
            line-height: 1
        }

        .stat-label {
            font-size: .7rem;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: .4px;
            margin-top: 6px
        }

        .intensity-chart {
            background: var(--bg-alt);
            border-radius: var(--radius-sm);
            padding: 16px;
            margin-bottom: 24px
        }

        .intensity-chart h3 {
            font-size: .7rem;
            text-transform: uppercase;
            letter-spacing: .4px;
            color: var(--text-muted);
            margin-bottom: 12px
        }

        .chart-bars {
            display: flex;
            align-items: flex-end;
            gap: 8px;
            height: 60px
        }

        .chart-bar {
            flex: 1;
            border-radius: 4px 4px 0 0;
            position: relative;
            transition: all .3s;
            min-height: 4px
        }

        .chart-bar.rest {
            background: var(--border)
        }

        .chart-bar.low {
            background: #86efac
        }

        .chart-bar.moderate {
            background: #fde047
        }

        .chart-bar.high {
            background: #fb923c
        }

        .chart-bar.intense {
            background: #f87171
        }

        .chart-labels {
            display: flex;
            gap: 8px;
            margin-top: 8px
        }

        .chart-label {
            flex: 1;
            text-align: center;
            font-size: .7rem;
            color: var(--text-muted);
            font-weight: 500
        }

        .week-grid {
            display: grid;
            gap: 12px
        }

        .day-card {
            background: var(--bg-alt);
            border: 1px solid var(--border);
            border-radius: var(--radius-sm);
            overflow: hidden;
            transition: all .2s
        }

        .day-card.rest {
            opacity: .75
        }

        .day-card:hover {
            box-shadow: var(--shadow-md)
        }

        .day-header {
            padding: 14px 18px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
            gap: 12px
        }

        .day-header-left {
            display: flex;
            align-items: center;
            gap: 12px;
            flex: 1;
            min-width: 0
        }

        .day-icon {
            width: 36px;
            height: 36px;
            border-radius: var(--radius-sm);
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0
        }

        .day-icon svg {
            width: 18px;
            height: 18px
        }

        .day-icon.training {
            background: var(--success-light);
            color: var(--success)
        }

        .day-icon.rest {
            background: var(--warning-light);
            color: var(--warning)
        }

        .day-icon.active {
            background: var(--primary-light);
            color: var(--primary)
        }

        .day-info {
            min-width: 0
        }

        .day-name {
            font-weight: 700;
            font-size: .9rem
        }

        .day-title {
            color: var(--text-muted);
            font-size: .8rem;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis
        }

        .day-meta {
            display: flex;
            align-items: center;
            gap: 8px;
            flex-shrink: 0
        }

        .badge {
            font-size: .65rem;
            padding: 4px 10px;
            border-radius: 20px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: .3px
        }

        .badge-training {
            background: var(--success-light);
            color: var(--success)
        }

        .badge-rest {
            background: var(--warning-light);
            color: var(--warning)
        }

        .badge-active {
            background: var(--primary-light);
            color: var(--primary)
        }

        .day-actions {
            display: flex;
            gap: 4px;
            opacity: 0;
            transition: opacity .15s
        }

        .day-card:hover .day-actions {
            opacity: 1
        }

        .expand-icon {
            color: var(--text-light);
            transition: transform .2s
        }

        .day-card.expanded .expand-icon {
            transform: rotate(180deg)
        }

        .day-content {
            padding: 0 18px 18px;
            display: none;
            border-top: 1px solid var(--border)
        }

        .day-card.expanded .day-content {
            display: block;
            padding-top: 16px
        }

        .day-card.expanded {
            background: var(--bg-card)
        }

        .workout-details {
            font-size: .85rem;
            line-height: 1.8;
            color: var(--text-muted)
        }

        .workout-details strong {
            color: var(--text);
            font-weight: 600
        }

        .tip {
            font-size: .8rem;
            color: var(--text-muted);
            margin-top: 14px;
            padding: 12px 14px;
            background: var(--bg-alt);
            border-radius: var(--radius-sm);
            display: flex;
            align-items: flex-start;
            gap: 10px;
            border: 1px solid var(--border)
        }

        .tip svg {
            width: 16px;
            height: 16px;
            flex-shrink: 0;
            margin-top: 2px;
            color: var(--primary)
        }

        .history-section {
            margin-top: 8px;
            padding-top: 16px;
            border-top: 1px solid var(--border)
        }

        .history-section h3 {
            font-size: .7rem;
            text-transform: uppercase;
            letter-spacing: .4px;
            color: var(--text-muted);
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 6px
        }

        .history-list {
            display: flex;
            flex-direction: column;
            gap: 6px
        }

        .history-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 10px 12px;
            background: var(--bg);
            border-radius: var(--radius-sm);
            border: 1px solid var(--border);
            font-size: .8rem;
            cursor: pointer;
            transition: all .15s
        }

        .history-item:hover {
            border-color: var(--primary)
        }

        .history-item-info {
            display: flex;
            flex-direction: column;
            gap: 2px
        }

        .history-item-name {
            font-weight: 600;
            color: var(--text)
        }

        .history-item-meta {
            font-size: .7rem;
            color: var(--text-muted)
        }

        .history-item-actions {
            display: flex;
            gap: 4px
        }

        .history-empty {
            font-size: .8rem;
            color: var(--text-light);
            text-align: center;
            padding: 12px
        }

        .alert {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 14px 18px;
            border-radius: var(--radius-sm);
            font-size: .85rem;
            font-weight: 500;
            z-index: 1000;
            animation: slideIn .3s ease;
            display: flex;
            align-items: center;
            gap: 10px;
            box-shadow: var(--shadow-lg)
        }

        .alert.success {
            background: var(--success);
            color: #fff
        }

        .alert.error {
            background: var(--error);
            color: #fff
        }

        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0
            }
            to {
                transform: translateX(0);
                opacity: 1
            }
        }

        @media print {
            body {
                background: #fff
            }

            .container {
                padding: 0
            }

            header, .card:not(.results) {
                display: none
            }

            .results {
                display: block !important
            }

            .day-actions, .results-actions {
                display: none
            }

            .day-content {
                display: block !important
            }

            .day-card {
                break-inside: avoid
            }
        }

        @media (max-width: 640px) {
            .container {
                padding: 24px 16px
            }

            .presets {
                grid-template-columns:1fr 1fr
            }

            .summary-grid {
                grid-template-columns:repeat(2, 1fr)
            }

            .form-grid {
                grid-template-columns:1fr
            }

            .results-header {
                flex-direction: column;
                align-items: stretch
            }

            .results-actions {
                justify-content: flex-end
            }

            .day-actions {
                opacity: 1
            }
        }
    </style>
</head>
<body>
<div class="container">
    <header>
        <h1><i data-lucide="trophy"></i>Sports Plan Generator</h1>
        <p>Create a personalized weekly training plan tailored to your goals</p>
    </header>
    <div class="card">
        <h2><i data-lucide="zap"></i>Quick Start</h2>
        <div class="presets" id="presets">
            <button class="preset-btn" data-preset="beginner"><span class="preset-name">Beginner Friendly</span><span
                    class="preset-desc">3 days · Low intensity · Mixed</span></button>
            <button class="preset-btn" data-preset="weightloss"><span class="preset-name">Weight Loss</span><span
                    class="preset-desc">5 days · Cardio focus · High</span></button>
            <button class="preset-btn" data-preset="strength"><span class="preset-name">Strength Builder</span><span
                    class="preset-desc">4 days · Gym focused · Moderate</span></button>
            <button class="preset-btn" data-preset="athlete"><span class="preset-name">Balanced Athlete</span><span
                    class="preset-desc">5 days · Varied · High</span></button>
        </div>
        <div class="history-section" id="historySection" style="display:none">
            <h3><i data-lucide="clock"></i>Recent Plans</h3>
            <div class="history-list" id="historyList"></div>
        </div>
    </div>
    <div class="card">
        <h2><i data-lucide="user"></i>Profile</h2>
        <div class="form-grid">
            <div class="form-group"><label>Fitness Level</label><select id="fitnessLevel">
                <option value="beginner">Beginner</option>
                <option value="intermediate" selected>Intermediate</option>
                <option value="advanced">Advanced</option>
            </select></div>
            <div class="form-group"><label>Primary Goal</label><select id="goal">
                <option value="general fitness">General Fitness</option>
                <option value="weight loss">Weight Loss</option>
                <option value="muscle building">Muscle Building</option>
                <option value="endurance">Endurance</option>
                <option value="flexibility">Flexibility & Mobility</option>
                <option value="athletic performance">Athletic Performance</option>
            </select></div>
            <div class="form-group"><label>Age Range</label><select id="age">
                <option value="18-25">18-25</option>
                <option value="26-35" selected>26-35</option>
                <option value="36-45">36-45</option>
                <option value="46-55">46-55</option>
                <option value="55+">55+</option>
            </select></div>
            <div class="form-group"><label>Equipment Access</label><select id="equipment">
                <option value="no equipment (bodyweight only)">No Equipment (Bodyweight)</option>
                <option value="minimal (resistance bands, light dumbbells)">Minimal (Bands, Light Weights)</option>
                <option value="home gym (dumbbells, bench, pull-up bar)">Home Gym</option>
                <option value="full gym access" selected>Full Gym Access</option>
            </select></div>
        </div>
    </div>
    <div class="card">
        <h2><i data-lucide="calendar-days"></i>Schedule</h2>
        <div class="form-grid">
            <div class="form-group"><label>Training Days</label>
                <div class="day-selector" id="daySelector">
                    <button type="button" class="day-btn active" data-day="Mon"><span class="day-short">Mon</span>
                    </button>
                    <button type="button" class="day-btn active" data-day="Tue"><span class="day-short">Tue</span>
                    </button>
                    <button type="button" class="day-btn" data-day="Wed"><span class="day-short">Wed</span></button>
                    <button type="button" class="day-btn active" data-day="Thu"><span class="day-short">Thu</span>
                    </button>
                    <button type="button" class="day-btn" data-day="Fri"><span class="day-short">Fri</span></button>
                    <button type="button" class="day-btn active" data-day="Sat"><span class="day-short">Sat</span>
                    </button>
                    <button type="button" class="day-btn" data-day="Sun"><span class="day-short">Sun</span></button>
                </div>
            </div>
            <div class="form-group"><label>Session Duration</label><select id="duration">
                <option value="20-30 minutes">20-30 min</option>
                <option value="30-45 minutes">30-45 min</option>
                <option value="45-60 minutes" selected>45-60 min</option>
                <option value="60-90 minutes">60-90 min</option>
            </select></div>
            <div class="form-group"><label>Time Preference</label><select id="timePreference">
                <option value="flexible">Flexible</option>
                <option value="morning (6-9am)">Morning (6-9am)</option>
                <option value="midday (11am-2pm)">Midday (11am-2pm)</option>
                <option value="afternoon (3-6pm)">Afternoon (3-6pm)</option>
                <option value="evening (6-9pm)">Evening (6-9pm)</option>
            </select></div>
            <div class="form-group"><label>Intensity</label><select id="intensity">
                <option value="low">Low – Recovery focused</option>
                <option value="moderate" selected>Moderate – Balanced</option>
                <option value="high">High – Push limits</option>
            </select></div>
        </div>
    </div>
    <div class="card">
        <h2><i data-lucide="flame"></i>Activities</h2>
        <div class="chips" id="activities">
            <div class="chip active" data-value="gym"><i data-lucide="dumbbell"></i>Gym</div>
            <div class="chip" data-value="running"><i data-lucide="footprints"></i>Running</div>
            <div class="chip" data-value="cycling"><i data-lucide="bike"></i>Cycling</div>
            <div class="chip" data-value="swimming"><i data-lucide="waves"></i>Swimming</div>
            <div class="chip" data-value="yoga"><i data-lucide="sunrise"></i>Yoga</div>
            <div class="chip" data-value="hiit"><i data-lucide="zap"></i>HIIT</div>
            <div class="chip" data-value="calisthenics"><i data-lucide="person-standing"></i>Calisthenics</div>
            <div class="chip" data-value="pilates"><i data-lucide="stretch-horizontal"></i>Pilates</div>
            <div class="chip" data-value="martial arts"><i data-lucide="swords"></i>Martial Arts</div>
            <div class="chip" data-value="team sports"><i data-lucide="users"></i>Team Sports</div>
        </div>
        <div class="tip"><i data-lucide="lightbulb"></i><span>Mix activities for balanced training. Combining strength and cardio improves overall fitness and recovery.</span>
        </div>
    </div>
    <div class="card">
        <h2><i data-lucide="message-square-text"></i>Notes</h2>
        <div class="form-group full"><label>Injuries, limitations, or special requests (optional)</label><textarea
                id="notes"
                placeholder="E.g., 'Recovering from knee injury', 'Focus on upper body', 'Training for a 10K'..."></textarea>
        </div>
    </div>
    <button class="btn btn-primary" id="generateBtn" onclick="generatePlan()"><i data-lucide="sparkles"></i>Generate
        Plan
    </button>
    <div class="loading-steps" id="loadingSteps">
        <div class="step" data-step="1">Analyzing your preferences...</div>
        <div class="step" data-step="2">Building workout structure...</div>
        <div class="step" data-step="3">Optimizing exercise selection...</div>
        <div class="step" data-step="4">Finalizing your plan...</div>
    </div>
    <div class="card results" id="results">
        <div class="results-header">
            <h2><i data-lucide="clipboard-check"></i>Your Weekly Plan</h2>
            <div class="results-actions">
                <button class="btn-icon" onclick="savePlan()" title="Save Plan"><i data-lucide="bookmark"></i></button>
                <button class="btn-icon" onclick="toggleAll()" title="Expand All"><i data-lucide="rows-3"></i></button>
                <button class="btn-icon" onclick="copyPlan()" title="Copy"><i data-lucide="copy"></i></button>
                <button class="btn-icon" onclick="downloadPlan()" title="Download"><i data-lucide="download"></i>
                </button>
            </div>
        </div>
        <div class="summary-grid" id="summary"></div>
        <div class="intensity-chart" id="intensityChart">
            <h3>Weekly Intensity</h3>
            <div class="chart-bars" id="chartBars"></div>
            <div class="chart-labels" id="chartLabels"></div>
        </div>
        <div class="week-grid" id="weekGrid"></div>
    </div>
</div>
<script>
    lucide.createIcons();
    let planData = null, currentPlan = null, allExpanded = false;
    const STORAGE_KEY = 'sportsPlanPrefs', HISTORY_KEY = 'sportsPlanHistory';
    const presets = {
        beginner: {
            fitnessLevel: 'beginner',
            goal: 'general fitness',
            intensity: 'low',
            duration: '30-45 minutes',
            days: ['Mon', 'Wed', 'Fri'],
            activities: ['gym', 'yoga']
        },
        weightloss: {
            fitnessLevel: 'intermediate',
            goal: 'weight loss',
            intensity: 'high',
            duration: '45-60 minutes',
            days: ['Mon', 'Tue', 'Wed', 'Fri', 'Sat'],
            activities: ['running', 'hiit', 'cycling']
        },
        strength: {
            fitnessLevel: 'intermediate',
            goal: 'muscle building',
            intensity: 'moderate',
            duration: '60-90 minutes',
            days: ['Mon', 'Tue', 'Thu', 'Fri'],
            activities: ['gym']
        },
        athlete: {
            fitnessLevel: 'advanced',
            goal: 'athletic performance',
            intensity: 'high',
            duration: '60-90 minutes',
            days: ['Mon', 'Tue', 'Wed', 'Fri', 'Sat'],
            activities: ['gym', 'running', 'hiit', 'swimming']
        }
    };

    function init() {
        document.querySelectorAll('.preset-btn').forEach(b => b.addEventListener('click', () => applyPreset(b.dataset.preset)));
        document.querySelectorAll('.chip').forEach(c => c.addEventListener('click', () => {
            c.classList.toggle('active');
            savePrefs()
        }));
        document.querySelectorAll('.day-btn').forEach(b => b.addEventListener('click', () => {
            b.classList.toggle('active');
            savePrefs()
        }));
        document.querySelectorAll('select,textarea').forEach(el => el.addEventListener('change', savePrefs));
        loadPrefs();
        renderHistory();
    }

    function applyPreset(name) {
        const p = presets[name];
        if (!p) return;
        document.getElementById('fitnessLevel').value = p.fitnessLevel;
        document.getElementById('goal').value = p.goal;
        document.getElementById('intensity').value = p.intensity;
        document.getElementById('duration').value = p.duration;
        document.querySelectorAll('.day-btn').forEach(b => b.classList.toggle('active', p.days.includes(b.dataset.day)));
        document.querySelectorAll('.chip').forEach(c => c.classList.toggle('active', p.activities.includes(c.dataset.value)));
        savePrefs();
        showAlert('Preset applied!', 'success');
    }

    function getSelectedActivities() {
        return [...document.querySelectorAll('.chip.active')].map(c => c.dataset.value)
    }

    function getSelectedDays() {
        return [...document.querySelectorAll('.day-btn.active')].map(b => b.dataset.day)
    }

    function showAlert(msg, type) {
        const a = document.createElement('div');
        a.className = `alert ${type}`;
        a.innerHTML = `<i data-lucide="${type === 'success' ? 'check-circle' : 'alert-circle'}"></i>${msg}`;
        document.body.appendChild(a);
        lucide.createIcons();
        setTimeout(() => a.remove(), 3000)
    }

    function savePrefs() {
        const prefs = {
            fitnessLevel: document.getElementById('fitnessLevel').value,
            goal: document.getElementById('goal').value,
            age: document.getElementById('age').value,
            equipment: document.getElementById('equipment').value,
            duration: document.getElementById('duration').value,
            timePreference: document.getElementById('timePreference').value,
            intensity: document.getElementById('intensity').value,
            activities: getSelectedActivities(),
            days: getSelectedDays(),
            notes: document.getElementById('notes').value
        };
        localStorage.setItem(STORAGE_KEY, JSON.stringify(prefs));
    }

    function loadPrefs() {
        const saved = localStorage.getItem(STORAGE_KEY);
        if (!saved) return;
        try {
            const p = JSON.parse(saved);
            ['fitnessLevel', 'goal', 'age', 'equipment', 'duration', 'timePreference', 'intensity'].forEach(k => {
                if (p[k]) document.getElementById(k).value = p[k]
            });
            if (p.notes) document.getElementById('notes').value = p.notes;
            if (p.activities) document.querySelectorAll('.chip').forEach(c => c.classList.toggle('active', p.activities.includes(c.dataset.value)));
            if (p.days) document.querySelectorAll('.day-btn').forEach(b => b.classList.toggle('active', p.days.includes(b.dataset.day)));
        } catch (e) {
        }
    }

    function setLoadingStep(n) {
        document.querySelectorAll('.loading-steps .step').forEach(s => {
            const sn = parseInt(s.dataset.step);
            s.classList.toggle('active', sn === n);
            s.classList.toggle('done', sn < n);
        });
    }

    async function generatePlan(regenerateDay = null) {
        const activities = getSelectedActivities(), days = getSelectedDays();
        if (activities.length === 0) {
            showAlert('Select at least one activity', 'error');
            return
        }
        if (days.length === 0) {
            showAlert('Select at least one training day', 'error');
            return
        }
        const btn = document.getElementById('generateBtn'), loading = document.getElementById('loadingSteps');
        btn.disabled = true;
        btn.innerHTML = '<span class="spinner"></span>Generating...';
        loading.classList.add('visible');
        setLoadingStep(1);
        const config = {
            fitnessLevel: document.getElementById('fitnessLevel').value,
            goal: document.getElementById('goal').value,
            age: document.getElementById('age').value,
            equipment: document.getElementById('equipment').value,
            duration: document.getElementById('duration').value,
            timePreference: document.getElementById('timePreference').value,
            intensity: document.getElementById('intensity').value,
            activities: activities.join(', '),
            preferredDays: days.join(', '),
            notes: document.getElementById('notes').value.trim()
        };
        let systemPrompt, userPrompt;
        if (regenerateDay && currentPlan) {
            systemPrompt = `You are an expert fitness coach. Regenerate ONLY the workout for ${regenerateDay}, keeping it consistent with the overall weekly plan context. Output ONLY valid JSON: {"day":"${regenerateDay}","type":"Training|Rest|Active Recovery","category":"Strength|Cardio|Flexibility|HIIT|Mixed|Rest","title":"Short title","duration":"number","intensity":"low|moderate|high|intense","details":"Detailed workout"}`;
            userPrompt = `Regenerate ${regenerateDay}'s workout. User profile: ${config.fitnessLevel} level, goal: ${config.goal}, equipment: ${config.equipment}, duration: ${config.duration}. Activities: ${config.activities}.${config.notes ? ' Notes: ' + config.notes : ''}`;
        } else {
            systemPrompt = `You are an expert fitness coach. Create a detailed weekly training plan. Output ONLY valid JSON: {"days":[{"day":"Monday","type":"Training|Rest|Active Recovery","category":"Strength|Cardio|Flexibility|HIIT|Mixed|Rest","title":"Short title","duration":"number (minutes only)","intensity":"low|moderate|high|intense","details":"Detailed workout with exercises, sets, reps. Use line breaks."},...]} for all 7 days. Be specific with exercises.`;
            userPrompt = `Create weekly plan: Level: ${config.fitnessLevel}, Goal: ${config.goal}, Age: ${config.age}, Equipment: ${config.equipment}, Duration: ${config.duration}, Time: ${config.timePreference}, Intensity: ${config.intensity}, Activities: ${config.activities}, Training days: ${config.preferredDays}${config.notes ? ', Notes: ' + config.notes : ''}. Schedule training on preferred days, rest on others. Include warm-up/cool-down.`;
        }
        setTimeout(() => setLoadingStep(2), 800);
        setTimeout(() => setLoadingStep(3), 1600);
        try {
            const response = await fetch('https://chatgpt.tobiasmue91.workers.dev/', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({
                    model: 'gpt-4o-mini',
                    max_tokens: 2500,
                    temperature: 0.7,
                    messages: [{role: 'system', content: systemPrompt}, {role: 'user', content: userPrompt}]
                })
            });
            if (!response.ok) throw new Error('API error');
            setLoadingStep(4);
            const data = await response.json();
            let content = data.choices[0].message.content.trim().replace(/```json\n?/g, '').replace(/```\n?/g, '');
            if (regenerateDay && currentPlan) {
                const newDay = JSON.parse(content);
                currentPlan.days = currentPlan.days.map(d => d.day === regenerateDay ? newDay : d);
            } else {
                currentPlan = JSON.parse(content)
            }
            renderPlan(currentPlan);
            planData = currentPlan.days.map(d => `${d.day} - ${d.title} (${d.type})\n${d.details}`).join('\n\n---\n\n');
            document.getElementById('results').classList.add('visible');
            document.getElementById('results').scrollIntoView({behavior: 'smooth', block: 'start'});
            showAlert(regenerateDay ? `${regenerateDay} regenerated!` : 'Plan generated!', 'success');
        } catch (e) {
            console.error(e);
            showAlert('Error generating plan. Try again.', 'error')
        } finally {
            btn.disabled = false;
            btn.innerHTML = '<i data-lucide="sparkles"></i>Generate Plan';
            loading.classList.remove('visible');
            lucide.createIcons()
        }
    }

    function renderPlan(plan) {
        const trainingDays = plan.days.filter(d => !d.type.toLowerCase().includes('rest'));
        const totalMin = plan.days.reduce((s, d) => d.type.toLowerCase().includes('rest') ? s : s + (parseInt(d.duration) || 0), 0);
        const categories = [...new Set(trainingDays.map(d => d.category))];
        document.getElementById('summary').innerHTML = `
<div class="stat-card"><div class="stat-value">${trainingDays.length}</div><div class="stat-label">Training Days</div></div>
<div class="stat-card"><div class="stat-value">${totalMin}</div><div class="stat-label">Total Minutes</div></div>
<div class="stat-card"><div class="stat-value">${7 - trainingDays.length}</div><div class="stat-label">Rest Days</div></div>
<div class="stat-card"><div class="stat-value">${categories.length}</div><div class="stat-label">Workout Types</div></div>`;
        const intensityLevels = {rest: 0, low: 1, moderate: 2, high: 3, intense: 4};
        const chartBars = document.getElementById('chartBars'), chartLabels = document.getElementById('chartLabels');
        chartBars.innerHTML = plan.days.map(d => {
            const isRest = d.type.toLowerCase().includes('rest');
            const level = isRest ? 'rest' : (d.intensity || 'moderate');
            const height = isRest ? 8 : {low: 25, moderate: 45, high: 70, intense: 90}[level] || 45;
            return `<div class="chart-bar ${level}" style="height:${height}%"></div>`;
        }).join('');
        chartLabels.innerHTML = plan.days.map(d => `<div class="chart-label">${d.day.slice(0, 3)}</div>`).join('');
        const grid = document.getElementById('weekGrid');
        grid.innerHTML = plan.days.map(d => {
            const isRest = d.type.toLowerCase().includes('rest');
            const isActive = d.type.toLowerCase().includes('active');
            const iconClass = isRest ? 'rest' : isActive ? 'active' : 'training';
            const badgeClass = isRest ? 'badge-rest' : isActive ? 'badge-active' : 'badge-training';
            return `<div class="day-card${isRest ? ' rest' : ''}" data-day="${d.day}">
<div class="day-header" onclick="this.parentElement.classList.toggle('expanded')">
<div class="day-header-left">
<div class="day-icon ${iconClass}"><i data-lucide="${isRest ? 'coffee' : 'dumbbell'}"></i></div>
<div class="day-info"><div class="day-name">${d.day}</div><div class="day-title">${d.title}</div></div>
</div>
<div class="day-meta">
<span class="badge ${badgeClass}">${d.duration ? d.duration + 'm' : d.type}</span>
<div class="day-actions">${!isRest ? `<button class="btn-icon" onclick="event.stopPropagation();regenerateDay('${d.day}')" title="Regenerate"><i data-lucide="refresh-cw"></i></button>` : ''}</div>
<i data-lucide="chevron-down" class="expand-icon"></i>
</div>
</div>
<div class="day-content"><div class="workout-details">${d.details.replace(/\n/g, '<br>').replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')}</div></div>
</div>`
        }).join('');
        lucide.createIcons();
    }

    function regenerateDay(day) {
        generatePlan(day)
    }

    function toggleAll() {
        allExpanded = !allExpanded;
        document.querySelectorAll('.day-card').forEach(c => c.classList.toggle('expanded', allExpanded))
    }

    function copyPlan() {
        if (!planData) {
            showAlert('No plan to copy', 'error');
            return
        }
        navigator.clipboard.writeText(planData).then(() => showAlert('Copied!', 'success')).catch(() => showAlert('Failed to copy', 'error'))
    }

    function downloadPlan() {
        if (!planData) return;
        const blob = new Blob([planData], {type: 'text/plain'});
        const a = document.createElement('a');
        a.href = URL.createObjectURL(blob);
        a.download = 'training-plan.txt';
        a.click();
        showAlert('Downloaded!', 'success')
    }

    function savePlan() {
        if (!currentPlan) return;
        let history = JSON.parse(localStorage.getItem(HISTORY_KEY) || '[]');
        const entry = {
            id: Date.now(),
            date: new Date().toLocaleDateString(),
            goal: document.getElementById('goal').value,
            days: getSelectedDays().length,
            plan: currentPlan
        };
        history.unshift(entry);
        history = history.slice(0, 5);
        localStorage.setItem(HISTORY_KEY, JSON.stringify(history));
        renderHistory();
        showAlert('Plan saved!', 'success');
    }

    function renderHistory() {
        const history = JSON.parse(localStorage.getItem(HISTORY_KEY) || '[]');
        const section = document.getElementById('historySection'), list = document.getElementById('historyList');
        if (history.length === 0) {
            section.style.display = 'none';
            return
        }
        section.style.display = 'block';
        list.innerHTML = history.map(h => `<div class="history-item" onclick="loadPlan(${h.id})">
<div class="history-item-info"><span class="history-item-name">${h.goal}</span><span class="history-item-meta">${h.date} · ${h.days} days</span></div>
<div class="history-item-actions"><button class="btn-icon" onclick="event.stopPropagation();deletePlan(${h.id})" title="Delete"><i data-lucide="trash-2"></i></button></div>
</div>`).join('');
        lucide.createIcons();
    }

    function loadPlan(id) {
        const history = JSON.parse(localStorage.getItem(HISTORY_KEY) || '[]');
        const entry = history.find(h => h.id === id);
        if (!entry) return;
        currentPlan = entry.plan;
        renderPlan(currentPlan);
        planData = currentPlan.days.map(d => `${d.day} - ${d.title}\n${d.details}`).join('\n\n---\n\n');
        document.getElementById('results').classList.add('visible');
        document.getElementById('results').scrollIntoView({behavior: 'smooth'});
        showAlert('Plan loaded!', 'success');
    }

    function deletePlan(id) {
        let history = JSON.parse(localStorage.getItem(HISTORY_KEY) || '[]');
        history = history.filter(h => h.id !== id);
        localStorage.setItem(HISTORY_KEY, JSON.stringify(history));
        renderHistory();
        showAlert('Deleted', 'success');
    }

    init();
</script>
<script src="../logo.js"></script>
</body>
</html>