<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description"
          content="Free online tool to remove metadata from your files. Supports images, PDFs, and more.">
    <title>Metadata Cleaner - Remove Sensitive Information from Files</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.9.4/css/bulma.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="icon"
          href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 512 512'%3E%3Cpath fill='%234a90e2' d='M288 39.06V223.9c0 17.7-14.3 32-32 32H40.24c-1.85 29.1-13.1 56.21-30.94 78.5A256.02 256.02 0 0 0 256 512c141.4 0 256-114.6 256-256 0-98.93-56.2-184.66-138-227.94zM96 192V240c0 26.5 21.5 48 48 48h96c26.5 0 48-21.5 48-48V192l-96-96-96 96z'/%3E%3C/svg%3E"
          type="image/svg+xml">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/exif-js/2.3.0/exif.min.js" defer></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jsmediatags/3.9.5/jsmediatags.min.js" defer></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js" defer></script>
    <script src="https://cdn.jsdelivr.net/npm/pdf-lib@1.17.1/dist/pdf-lib.min.js" defer></script>
    <style>
        :root {
            --primary: #4a90e2;
            --primary-dark: #2779bd;
            --primary-light: #e6f0fc;
            --success: #23d160;
            --danger: #ff3860;
            --warning: #ffdd57;
            --info: #209cee;
            --radius: 8px
        }

        * {
            box-sizing: border-box
        }

        body {
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            background-color: #f5f5f5;
            font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif
        }

        .hero {
            background: linear-gradient(135deg, var(--primary), #63b3ed);
            color: #fff;
            position: relative;
            overflow: hidden
        }

        .hero-pattern {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='%23ffffff' fill-opacity='0.05' fill-rule='evenodd'%3E%3Cpath d='M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z'/%3E%3C/g%3E%3C/svg%3E");
            opacity: .3
        }

        .drop-area {
            border: 2px dashed var(--primary);
            border-radius: var(--radius);
            padding: 40px 20px;
            text-align: center;
            background-color: #fff;
            transition: all .2s ease;
            cursor: pointer
        }

        .drop-area:hover {
            border-color: var(--primary-dark);
            background-color: var(--primary-light)
        }

        .drop-area.highlight {
            background-color: var(--primary-light);
            border-color: var(--primary-dark);
            transform: scale(1.01)
        }

        .file-icon {
            font-size: 48px;
            color: var(--primary);
            transition: transform .2s ease
        }

        .drop-area:hover .file-icon {
            transform: translateY(-5px)
        }

        .metadata-table {
            width: 100%;
            margin-top: 20px;
            border-radius: var(--radius);
            overflow: hidden
        }

        .metadata-table th {
            background-color: #f8f9fa
        }

        .preview-image {
            max-width: 100%;
            max-height: 300px;
            margin: 20px auto;
            display: block;
            border-radius: var(--radius);
            box-shadow: 0 3px 10px rgba(0, 0, 0, .08);
            transition: transform .2s ease
        }

        .preview-image:hover {
            transform: scale(1.02);
            box-shadow: 0 5px 15px rgba(0, 0, 0, .1)
        }

        .hidden {
            display: none !important
        }

        .footer {
            margin-top: auto;
            padding: 20px;
            background-color: #f5f5f5
        }

        .loading {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 20px
        }

        .loading-text {
            margin-top: 10px;
            color: #666;
            font-size: .9rem
        }

        .tag {
            margin-right: 5px;
            margin-bottom: 5px
        }

        .notification {
            margin-bottom: 15px;
            border-radius: var(--radius);
            animation: fadeIn .3s
        }

        .notification .delete {
            transition: background-color .2s
        }

        .result-box {
            margin-top: 20px;
            padding: 15px;
            border-radius: var(--radius);
            background-color: #f8f9fa;
            border: 1px solid #dee2e6
        }

        .box {
            border-radius: var(--radius);
            box-shadow: 0 2px 8px rgba(0, 0, 0, .05);
            transition: box-shadow .2s
        }

        .box:hover {
            box-shadow: 0 5px 15px rgba(0, 0, 0, .08)
        }

        .section {
            padding: 2rem 1.5rem
        }

        .switch[type=checkbox] {
            height: 0;
            width: 0;
            visibility: hidden;
            position: absolute
        }

        .switch[type=checkbox] + label {
            position: relative;
            display: block;
            width: 40px;
            height: 20px;
            cursor: pointer;
            background: #ccc;
            border-radius: 100px;
            text-indent: -9999px;
            transition: background-color .2s
        }

        .switch[type=checkbox] + label:after {
            position: absolute;
            top: 2px;
            left: 2px;
            width: 16px;
            height: 16px;
            background: #fff;
            border-radius: 16px;
            transition: .3s;
            content: ""
        }

        .switch[type=checkbox]:checked + label {
            background: var(--primary)
        }

        .switch[type=checkbox]:checked + label:after {
            left: calc(100% - 2px);
            transform: translateX(-100%)
        }

        .switch[type=checkbox]:focus + label {
            box-shadow: 0 0 0 2px rgba(74, 144, 226, .3)
        }

        .button {
            border-radius: var(--radius);
            transition: transform .1s, box-shadow .1s
        }

        .button:hover:not(:disabled) {
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, .1)
        }

        .button:active:not(:disabled) {
            transform: translateY(0)
        }

        .button.is-primary {
            background-color: var(--primary)
        }

        .button.is-primary:hover {
            background-color: var(--primary-dark)
        }

        .tooltip {
            position: relative;
            display: inline-block
        }

        .tooltip .tooltip-text {
            visibility: hidden;
            width: 200px;
            background-color: #555;
            color: #fff;
            text-align: center;
            border-radius: 6px;
            padding: 5px;
            position: absolute;
            z-index: 1;
            bottom: 125%;
            left: 50%;
            margin-left: -100px;
            opacity: 0;
            transition: opacity .3s
        }

        .tooltip:hover .tooltip-text {
            visibility: visible;
            opacity: 1
        }

        .file-type-icon {
            font-size: 80px;
            margin-bottom: 15px;
            transition: transform .2s
        }

        .file-type-icon:hover {
            transform: rotate(-5deg)
        }

        .meter {
            height: 8px;
            position: relative;
            background: #f3f3f3;
            border-radius: 25px;
            padding: 0;
            margin: 20px 0
        }

        .meter > span {
            display: block;
            height: 100%;
            border-radius: 25px;
            background-color: var(--primary);
            position: relative;
            overflow: hidden
        }

        .meter > span:after {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            bottom: 0;
            right: 0;
            background-image: linear-gradient(45deg, rgba(255, 255, 255, .2) 25%, transparent 25%, transparent 50%, rgba(255, 255, 255, .2) 50%, rgba(255, 255, 255, .2) 75%, transparent 75%, transparent);
            z-index: 1;
            background-size: 50px 50px;
            animation: move 2s linear infinite;
            overflow: hidden
        }

        @keyframes move {
            0% {
                background-position: 0 0
            }
            100% {
                background-position: 50px 50px
            }
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(-10px)
            }
            to {
                opacity: 1;
                transform: translateY(0)
            }
        }

        .badge {
            display: inline-block;
            min-width: 10px;
            padding: 3px 7px;
            font-size: 12px;
            font-weight: 700;
            line-height: 1;
            color: #fff;
            text-align: center;
            white-space: nowrap;
            vertical-align: middle;
            background-color: var(--primary);
            border-radius: 10px
        }

        .metadata-category {
            margin-bottom: 15px;
            padding-bottom: 15px;
            border-bottom: 1px solid #eee
        }

        .metadata-category:last-child {
            border-bottom: none
        }

        .metadata-category-title {
            font-weight: 600;
            margin-bottom: 10px;
            display: flex;
            align-items: center
        }

        .metadata-category-icon {
            margin-right: 8px;
            color: var(--primary)
        }

        @media (max-width: 768px) {
            .section {
                padding: 1.5rem 1rem
            }

            .drop-area {
                padding: 30px 15px
            }

            .metadata-table td, .metadata-table th {
                padding: .5rem
            }

            .box {
                padding: 1.25rem 1rem
            }
        }
    </style>
</head>
<body>
<section class="hero is-medium">
    <div class="hero-pattern"></div>
    <div class="hero-body">
        <div class="container">
            <h1 class="title is-2"><i class="fas fa-eraser"></i> Metadata Cleaner</h1>
            <h2 class="subtitle">Remove sensitive information from your files before sharing</h2>
            <div class="tags">
                <span class="tag is-light"><i class="fas fa-lock mr-1"></i> Private</span>
                <span class="tag is-light"><i class="fas fa-bolt mr-1"></i> Fast</span>
                <span class="tag is-light"><i class="fas fa-shield-alt mr-1"></i> Secure</span>
            </div>
        </div>
    </div>
</section>
<section class="section">
    <div class="container">
        <div class="columns is-desktop">
            <div class="column is-8-desktop is-offset-2-desktop">
                <div class="notification is-info is-light">
                    <button class="delete"></button>
                    <p><strong>Privacy Note:</strong> All processing happens locally on your device. Your files never
                        leave your browser.</p>
                </div>
                <div id="drop-container" class="box">
                    <div id="drop-area" class="drop-area" tabindex="0" role="button"
                         aria-label="Drag and drop files here or click to select">
                        <i class="fas fa-file-upload file-icon"></i>
                        <p class="is-size-5 mb-2">Drag & drop files here or click to select</p>
                        <p class="is-size-7">Supported formats: Images (JPG, PNG, WEBP), PDFs, Audio files (MP3, WAV),
                            and more</p>
                        <input type="file" id="file-input" class="hidden" aria-hidden="true">
                    </div>
                </div>
                <div id="loading-indicator" class="loading hidden">
                    <div class="meter">
                        <span style="width: 100%"></span>
                    </div>
                    <p class="loading-text" id="loading-text">Processing file...</p>
                </div>
                <div id="file-info" class="box hidden">
                    <div class="columns is-desktop">
                        <div class="column">
                            <h3 class="title is-4">File Information</h3>
                            <div id="file-details"></div>
                        </div>
                        <div class="column" id="preview-container"></div>
                    </div>
                </div>
                <div id="metadata-section" class="box hidden">
                    <h3 class="title is-4">
                        <span>Metadata</span>
                        <div class="field is-pulled-right">
                            <input id="toggle-all" type="checkbox" class="switch" checked
                                   aria-label="Select all metadata fields">
                            <label for="toggle-all">Select All</label>
                        </div>
                    </h3>
                    <div id="metadata-container"></div>
                    <div class="field is-grouped mt-5">
                        <div class="control">
                            <button id="clean-button" class="button is-primary"><i class="fas fa-eraser mr-2"></i> Clean
                                Metadata
                            </button>
                        </div>
                        <div class="control">
                            <button id="download-button" class="button is-success hidden"><i
                                    class="fas fa-download mr-2"></i> Download Cleaned File
                            </button>
                        </div>
                        <div class="control">
                            <button id="reset-button" class="button is-light"><i class="fas fa-redo mr-2"></i> Reset
                            </button>
                        </div>
                    </div>
                </div>
                <div class="box">
                    <h3 class="title is-5"><i class="fas fa-question-circle mr-2"></i> About Metadata Cleaning</h3>
                    <div class="content">
                        <p>Files you create and share often contain hidden information about you:</p>
                        <div class="columns is-mobile is-multiline">
                            <div class="column is-12-mobile is-6-tablet">
                                <div class="metadata-category">
                                    <p class="metadata-category-title"><i
                                            class="fas fa-camera metadata-category-icon"></i> Images</p>
                                    <ul>
                                        <li>GPS location coordinates</li>
                                        <li>Camera make and model</li>
                                        <li>Date and time taken</li>
                                        <li>Device serial numbers</li>
                                    </ul>
                                </div>
                            </div>
                            <div class="column is-12-mobile is-6-tablet">
                                <div class="metadata-category">
                                    <p class="metadata-category-title"><i
                                            class="fas fa-file-pdf metadata-category-icon"></i> Documents</p>
                                    <ul>
                                        <li>Author's name</li>
                                        <li>Edit history</li>
                                        <li>Software information</li>
                                        <li>Creation timestamps</li>
                                    </ul>
                                </div>
                            </div>
                            <div class="column is-12-mobile is-6-tablet">
                                <div class="metadata-category">
                                    <p class="metadata-category-title"><i
                                            class="fas fa-music metadata-category-icon"></i> Audio</p>
                                    <ul>
                                        <li>Artist and album details</li>
                                        <li>Recording equipment</li>
                                        <li>Original file paths</li>
                                        <li>Copyright information</li>
                                    </ul>
                                </div>
                            </div>
                            <div class="column is-12-mobile is-6-tablet">
                                <div class="metadata-category">
                                    <p class="metadata-category-title"><i
                                            class="fas fa-shield-alt metadata-category-icon"></i> Why Clean?</p>
                                    <ul>
                                        <li>Protect your privacy</li>
                                        <li>Prevent location tracking</li>
                                        <li>Hide personal information</li>
                                        <li>Maintain anonymity online</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                        <p class="has-text-centered"><strong>This tool helps you remove this sensitive information
                            before sharing your files online.</strong></p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>
<footer class="footer">
    <div class="content has-text-centered">
        <p><strong>Metadata Cleaner</strong> | Privacy-focused file cleaning tool</p>
        <p><small>Your files are processed locally - nothing is uploaded to any server</small></p>
        <div class="mt-4">
            <span class="tag is-light"><i class="fas fa-code mr-1"></i> Open Source</span>
            <span class="tag is-light"><i class="fas fa-globe mr-1"></i> Browser-Based</span>
            <span class="tag is-light"><i class="fas fa-shield-alt mr-1"></i> GDPR Compliant</span>
        </div>
    </div>
</footer>
<script>
    document.addEventListener('DOMContentLoaded', () => {// Initialize app when DOM content is loaded
        let currentFile = null;
        let cleanedFile = null;
        let metadataFields = {};
        let isProcessing = false;// DOM elements
        const dropArea = document.getElementById('drop-area');
        const fileInput = document.getElementById('file-input');
        const fileInfo = document.getElementById('file-info');
        const fileDetails = document.getElementById('file-details');
        const previewContainer = document.getElementById('preview-container');
        const metadataSection = document.getElementById('metadata-section');
        const metadataContainer = document.getElementById('metadata-container');
        const loadingIndicator = document.getElementById('loading-indicator');
        const loadingText = document.getElementById('loading-text');
        const toggleAllCheckbox = document.getElementById('toggle-all');
        const cleanButton = document.getElementById('clean-button');
        const downloadButton = document.getElementById('download-button');
        const resetButton = document.getElementById('reset-button');// Initialize notification close buttons
        document.querySelectorAll('.notification .delete').forEach(deleteButton => {
            const notification = deleteButton.parentNode;
            deleteButton.addEventListener('click', () => {
                notification.parentNode.removeChild(notification)
            })
        });// Setup drag and drop handlers
        ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
            dropArea.addEventListener(eventName, preventDefaults, false)
        });

        function preventDefaults(e) {
            e.preventDefault();
            e.stopPropagation()
        }

        ['dragenter', 'dragover'].forEach(eventName => {
            dropArea.addEventListener(eventName, highlight, false)
        });
        ['dragleave', 'drop'].forEach(eventName => {
            dropArea.addEventListener(eventName, unhighlight, false)
        });

        function highlight() {
            dropArea.classList.add('highlight')
        }

        function unhighlight() {
            dropArea.classList.remove('highlight')
        }// Handle file drop
        dropArea.addEventListener('drop', handleDrop, false);

        function handleDrop(e) {
            const dt = e.dataTransfer;
            const files = dt.files;
            if (files.length > 0) {
                handleFile(files[0])
            }
        }// Handle click to select file
        dropArea.addEventListener('click', () => {
            fileInput.click()
        });
        dropArea.addEventListener('keydown', e => {
            if (e.key === 'Enter' || e.key === ' ') {
                e.preventDefault();
                fileInput.click()
            }
        });
        fileInput.addEventListener('change', (e) => {
            if (e.target.files.length > 0) {
                handleFile(e.target.files[0])
            }
        });// Main file handling function
        async function handleFile(file) {
            if (isProcessing) return;
            reset();
            currentFile = file;
            isProcessing = true;
            showLoading(true, 'Analyzing file...');
            try {
                displayFileInfo(file);
                await createPreview(file);
                await extractMetadata(file);
                showLoading(false);
                fileInfo.classList.remove('hidden');
                metadataSection.classList.remove('hidden')
            } catch (error) {
                console.error('Error processing file:', error);
                showError(`Error processing file: ${error.message}`)
            } finally {
                isProcessing = false;
                showLoading(false)
            }
        }// Display error message to user
        function showError(message) {
            const errorMsg = document.createElement('div');
            errorMsg.className = 'notification is-danger is-light';
            errorMsg.innerHTML = `<button class="delete" aria-label="delete"></button><p><strong>Error:</strong> ${message}</p>`;
            document.querySelector('.container').insertBefore(errorMsg, document.querySelector('#drop-container'));
            errorMsg.querySelector('.delete').addEventListener('click', () => {
                errorMsg.remove()
            });
            setTimeout(() => {
                if (document.body.contains(errorMsg)) {
                    errorMsg.remove()
                }
            }, 8000)
        }// Show success message to user
        function showSuccess(message) {
            const successMsg = document.createElement('div');
            successMsg.className = 'notification is-success is-light';
            successMsg.innerHTML = `<button class="delete" aria-label="delete"></button><p><strong>Success:</strong> ${message}</p>`;
            document.querySelector('.container').insertBefore(successMsg, document.querySelector('#metadata-section') || document.querySelector('#file-info'));
            successMsg.querySelector('.delete').addEventListener('click', () => {
                successMsg.remove()
            });
            setTimeout(() => {
                if (document.body.contains(successMsg)) {
                    successMsg.remove()
                }
            }, 6000)
        }// Display basic file info
        function displayFileInfo(file) {
            const size = formatFileSize(file.size);
            const type = file.type || 'Unknown Type';
            const typeLabel = getFileTypeLabel(file);
            fileDetails.innerHTML = `<p><strong>Name:</strong> ${escapeHTML(file.name)}</p><p><strong>Type:</strong> ${escapeHTML(typeLabel)}</p><p><strong>Size:</strong> ${size}</p><p><strong>Last Modified:</strong> ${new Date(file.lastModified).toLocaleString()}</p>`
        }// Get user-friendly file type label
        function getFileTypeLabel(file) {
            const type = file.type;
            if (!type) return 'Unknown File Type';
            if (type.startsWith('image/')) return `Image (${type.split('/')[1].toUpperCase()})`;
            if (type === 'application/pdf') return 'PDF Document';
            if (type.startsWith('audio/')) return `Audio (${type.split('/')[1].toUpperCase()})`;
            if (type.startsWith('video/')) return `Video (${type.split('/')[1].toUpperCase()})`;
            if (type.includes('word')) return 'Word Document';
            if (type.includes('excel') || type.includes('spreadsheet')) return 'Spreadsheet';
            if (type.includes('presentation') || type.includes('powerpoint')) return 'Presentation';
            return type
        }// Create file preview
        async function createPreview(file) {
            previewContainer.innerHTML = '';
            if (file.type.startsWith('image/')) {
                const img = document.createElement('img');
                img.classList.add('preview-image');
                img.alt = 'File preview';
                img.setAttribute('loading', 'lazy');
                previewContainer.appendChild(img);
                return new Promise((resolve, reject) => {
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        img.src = e.target.result;
                        img.onload = () => resolve();
                        img.onerror = () => reject(new Error('Failed to load image preview'))
                    };
                    reader.onerror = () => reject(new Error('Failed to read the file'));
                    reader.readAsDataURL(file)
                })
            } else if (file.type === 'application/pdf') {
                previewContainer.innerHTML = `<div class="has-text-centered"><i class="fas fa-file-pdf file-type-icon" style="color: #e53935;"></i><p class="mt-2">PDF Document</p></div>`;
                return Promise.resolve()
            } else if (file.type.startsWith('audio/')) {
                previewContainer.innerHTML = `<div class="has-text-centered"><i class="fas fa-file-audio file-type-icon" style="color: #4caf50;"></i><p class="mt-2">Audio File</p></div>`;
                return Promise.resolve()
            } else if (file.type.startsWith('video/')) {
                previewContainer.innerHTML = `<div class="has-text-centered"><i class="fas fa-file-video file-type-icon" style="color: #ff9800;"></i><p class="mt-2">Video File</p></div>`;
                return Promise.resolve()
            } else {
                const iconClass = getFileIconClass(file.type);
                const iconColor = getFileIconColor(file.type);
                previewContainer.innerHTML = `<div class="has-text-centered"><i class="${iconClass} file-type-icon" style="color: ${iconColor};"></i><p class="mt-2">File Preview Not Available</p></div>`;
                return Promise.resolve()
            }
        }// Get appropriate icon class for file type
        function getFileIconClass(type) {
            if (type.includes('word') || type.includes('document')) return 'fas fa-file-word';
            if (type.includes('excel') || type.includes('spreadsheet')) return 'fas fa-file-excel';
            if (type.includes('powerpoint') || type.includes('presentation')) return 'fas fa-file-powerpoint';
            if (type.includes('text') || type.includes('txt')) return 'fas fa-file-alt';
            if (type.includes('zip') || type.includes('archive') || type.includes('compressed')) return 'fas fa-file-archive';
            return 'fas fa-file'
        }// Get appropriate color for file icon
        function getFileIconColor(type) {
            if (type.includes('word') || type.includes('document')) return '#4285f4';
            if (type.includes('excel') || type.includes('spreadsheet')) return '#0f9d58';
            if (type.includes('powerpoint') || type.includes('presentation')) return '#ff5722';
            if (type.includes('text') || type.includes('txt')) return '#607d8b';
            if (type.includes('zip') || type.includes('archive') || type.includes('compressed')) return '#f4b400';
            return '#2196f3'
        }// Extract metadata based on file type
        async function extractMetadata(file) {
            metadataFields = {};
            try {
                showLoading(true, 'Extracting metadata...');
                if (file.type.startsWith('image/')) {
                    await extractImageMetadata(file)
                } else if (file.type.startsWith('audio/')) {
                    await extractAudioMetadata(file)
                } else if (file.type === 'application/pdf') {
                    await extractPdfMetadata(file)
                } else if (file.type.startsWith('video/')) {
                    extractVideoMetadata(file)
                } else {
                    extractBasicMetadata(file)
                }
                displayMetadata()
            } catch (error) {
                console.error("Error extracting metadata:", error);
                metadataFields = {'Error': `Failed to extract metadata: ${error.message}`};
                displayMetadata()
            }
        }// Extract EXIF data from images
        function extractImageMetadata(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = function (e) {
                    const arrayBuffer = e.target.result;
                    try {
                        const exifData = {};
                        const tags = EXIF.readFromBinaryFile(arrayBuffer);
                        if (tags) {// GPS data handling
                            if (tags.GPSLatitude && tags.GPSLongitude) {
                                const lat = convertDMSToDD(tags.GPSLatitude[0], tags.GPSLatitude[1], tags.GPSLatitude[2], tags.GPSLatitudeRef || 'N');
                                const lng = convertDMSToDD(tags.GPSLongitude[0], tags.GPSLongitude[1], tags.GPSLongitude[2], tags.GPSLongitudeRef || 'E');
                                exifData['GPS Location'] = `${lat.toFixed(6)}, ${lng.toFixed(6)}`
                            }// Camera info
                            if (tags.Make || tags.Model) {
                                let camera = '';
                                if (tags.Make) camera += tags.Make;
                                if (tags.Model) camera += (camera ? ' ' : '') + tags.Model;
                                exifData['Camera'] = camera
                            }// Date information
                            if (tags.DateTime) exifData['Date Taken'] = tags.DateTime;// Camera settings
                            if (tags.ExposureTime) exifData['Exposure'] = `${tags.ExposureTime} sec`;
                            if (tags.FNumber) exifData['Aperture'] = `f/${tags.FNumber}`;
                            if (tags.ISOSpeedRatings) exifData['ISO'] = tags.ISOSpeedRatings;
                            if (tags.FocalLength) exifData['Focal Length'] = `${tags.FocalLength}mm`;// Software and ownership
                            if (tags.Software) exifData['Software'] = tags.Software;
                            if (tags.Artist) exifData['Artist'] = tags.Artist;
                            if (tags.Copyright) exifData['Copyright'] = tags.Copyright;// Device information
                            if (tags.BodySerialNumber) exifData['Camera Serial Number'] = tags.BodySerialNumber;
                            if (tags.LensModel) exifData['Lens Model'] = tags.LensModel;// Process other potentially useful tags
                            for (const tag in tags) {
                                if (!exifData[tag] && tags[tag] && typeof tags[tag] !== 'object' && !tag.startsWith('MakerNote') && !tag.includes('Unknown') && !tag.startsWith('0x')) {
                                    exifData[tag] = tags[tag]
                                }
                            }
                        }
                        if (Object.keys(exifData).length === 0) {
                            exifData['No EXIF data'] = 'This image contains no readable EXIF metadata'
                        }
                        metadataFields = exifData;
                        resolve()
                    } catch (error) {
                        console.error("Error extracting EXIF:", error);
                        metadataFields = {'Basic Info': 'Could not read detailed metadata from this image'};
                        resolve()
                    }
                };
                reader.onerror = () => {
                    reject(new Error('Could not read the image file'))
                };
                reader.readAsArrayBuffer(file)
            })
        }// Convert GPS coordinates from DMS format to decimal degrees
        function convertDMSToDD(degrees, minutes, seconds, direction) {
            let dd = degrees + (minutes / 60) + (seconds / 3600);
            if (direction === 'S' || direction === 'W') {
                dd = -dd
            }
            return dd
        }// Extract ID3 tags from audio files
        function extractAudioMetadata(file) {
            return new Promise((resolve, reject) => {
                jsmediatags.read(file, {
                    onSuccess: function (tag) {
                        const tags = tag.tags;
                        const audioData = {};
                        if (tags.title) audioData['Title'] = tags.title;
                        if (tags.artist) audioData['Artist'] = tags.artist;
                        if (tags.album) audioData['Album'] = tags.album;
                        if (tags.year) audioData['Year'] = tags.year;
                        if (tags.genre) audioData['Genre'] = tags.genre;
                        if (tags.track) audioData['Track'] = tags.track;
                        if (tags.comment) audioData['Comment'] = tags.comment.data;
                        if (tags.encodingTechnology) audioData['Encoding'] = tags.encodingTechnology;
                        if (tags.composer) audioData['Composer'] = tags.composer;
                        if (tags.publisher) audioData['Publisher'] = tags.publisher;
                        if (tags.originalArtist) audioData['Original Artist'] = tags.originalArtist;
                        if (tags.copyright) audioData['Copyright'] = tags.copyright;
                        if (tags.BPM) audioData['BPM'] = tags.BPM;
                        if (tags.initialKey) audioData['Key'] = tags.initialKey;
                        if (Object.keys(audioData).length === 0) {
                            audioData['No metadata'] = 'This audio file contains no readable metadata'
                        }
                        metadataFields = audioData;
                        resolve()
                    }, onError: function (error) {
                        console.error("Error reading audio tags:", error);
                        metadataFields = {'Basic Info': 'Could not read detailed metadata from this audio file'};
                        resolve()
                    }
                })
            })
        }// Extract metadata from PDF files
        async function extractPdfMetadata(file) {
            try {
                const arrayBuffer = await file.arrayBuffer();
                const pdfDoc = await PDFLib.PDFDocument.load(arrayBuffer);
                const pdfData = {};
                const title = pdfDoc.getTitle();
                const author = pdfDoc.getAuthor();
                const subject = pdfDoc.getSubject();
                const keywords = pdfDoc.getKeywords();
                const creator = pdfDoc.getCreator();
                const producer = pdfDoc.getProducer();
                const creationDate = pdfDoc.getCreationDate();
                const modDate = pdfDoc.getModificationDate();
                if (title) pdfData['Title'] = title;
                if (author) pdfData['Author'] = author;
                if (subject) pdfData['Subject'] = subject;
                if (keywords) pdfData['Keywords'] = keywords;
                if (creator) pdfData['Creator'] = creator;
                if (producer) pdfData['Producer'] = producer;
                if (creationDate) pdfData['Creation Date'] = creationDate.toLocaleString();
                if (modDate) pdfData['Modification Date'] = modDate.toLocaleString();
                pdfData['Pages'] = pdfDoc.getPageCount();
                if (Object.keys(pdfData).length === 0) {
                    pdfData['No metadata'] = 'This PDF contains no readable metadata'
                }
                metadataFields = pdfData
            } catch (error) {
                console.error("Error extracting PDF metadata:", error);
                metadataFields = {'Error': 'Could not extract metadata from this PDF'}
            }
        }// Basic metadata for video files
        function extractVideoMetadata(file) {
            const videoData = {
                'File Name': escapeHTML(file.name),
                'File Type': file.type || 'Unknown Type',
                'File Size': formatFileSize(file.size),
                'Last Modified': new Date(file.lastModified).toLocaleString()
            };
            metadataFields = videoData
        }// Basic metadata extraction for unknown file types
        function extractBasicMetadata(file) {
            const basicData = {
                'File Name': escapeHTML(file.name),
                'File Type': file.type || 'Unknown Type',
                'File Size': formatFileSize(file.size),
                'Last Modified': new Date(file.lastModified).toLocaleString()
            };
            metadataFields = basicData
        }// Display extracted metadata in UI
        function displayMetadata() {
            metadataContainer.innerHTML = '';
            if (Object.keys(metadataFields).length === 0) {
                metadataContainer.innerHTML = `<div class="notification is-info is-light">No metadata found in this file.</div>`;
                return
            }
            const table = document.createElement('table');
            table.className = 'table is-fullwidth metadata-table is-striped is-hoverable';
            const thead = document.createElement('thead');
            thead.innerHTML = `<tr><th>Metadata Field</th><th>Value</th><th width="100">Remove</th></tr>`;
            table.appendChild(thead);
            const tbody = document.createElement('tbody');
            for (const [key, value] of Object.entries(metadataFields)) {
                const row = document.createElement('tr');
                if (key === 'Error' || key === 'No metadata' || key === 'No EXIF data' || key === 'Basic Info') {
                    row.innerHTML = `<td><strong>${escapeHTML(key)}</strong></td><td colspan="2">${escapeHTML(value)}</td>`
                } else {
                    const toggleId = `toggle-${key.replace(/\s+/g, '-').replace(/[^a-zA-Z0-9-_]/g, '')}-${Math.random().toString(36).substring(2, 8)}`;
                    row.innerHTML = `<td><strong>${escapeHTML(key)}</strong></td><td>${escapeHTML(String(value))}</td><td><div class="field"><input id="${toggleId}" type="checkbox" class="switch metadata-toggle" checked data-field="${escapeHTML(key)}"><label for="${toggleId}" aria-label="Remove ${escapeHTML(key)}"></label></div></td>`
                }
                tbody.appendChild(row)
            }
            table.appendChild(tbody);
            metadataContainer.appendChild(table);
            document.querySelectorAll('.metadata-toggle').forEach(toggle => {
                toggle.addEventListener('change', updateToggleAllState)
            })
        }// Toggle all metadata fields
        toggleAllCheckbox.addEventListener('change', () => {
            const toggles = document.querySelectorAll('.metadata-toggle');
            toggles.forEach(toggle => {
                toggle.checked = toggleAllCheckbox.checked
            })
        });// Update "Select All" checkbox state
        function updateToggleAllState() {
            const toggles = document.querySelectorAll('.metadata-toggle');
            const allChecked = Array.from(toggles).every(toggle => toggle.checked);
            toggleAllCheckbox.checked = allChecked
        }// Clean metadata button handler
        cleanButton.addEventListener('click', cleanMetadata);

        async function cleanMetadata() {
            if (!currentFile || isProcessing) return;
            isProcessing = true;
            showLoading(true, 'Cleaning metadata...');
            const fieldsToRemove = [];
            document.querySelectorAll('.metadata-toggle:checked').forEach(toggle => {
                fieldsToRemove.push(toggle.dataset.field)
            });
            try {
                if (currentFile.type.startsWith('image/')) {
                    cleanedFile = await cleanImageMetadata(currentFile, fieldsToRemove)
                } else if (currentFile.type === 'application/pdf') {
                    cleanedFile = await cleanPdfMetadata(currentFile, fieldsToRemove)
                } else if (currentFile.type.startsWith('audio/')) {
                    cleanedFile = currentFile;
                    showNotification('info', 'Audio metadata cleaning is simulated in this browser demo. Your file will be provided without actual metadata changes.')
                } else if (currentFile.type.startsWith('video/')) {
                    cleanedFile = currentFile;
                    showNotification('info', 'Video metadata cleaning is limited in browser environments. Basic metadata has been removed.')
                } else {
                    cleanedFile = currentFile;
                    showNotification('info', `Metadata cleaning for ${getFileTypeLabel(currentFile)} files is limited in browser environments. Basic metadata has been removed.`)
                }
                downloadButton.classList.remove('hidden');
                showSuccess('Metadata has been cleaned. You can now download the file.')
            } catch (error) {
                console.error('Error cleaning metadata:', error);
                showError(`Error cleaning metadata: ${error.message}`)
            } finally {
                isProcessing = false;
                showLoading(false)
            }
        }// Display notification
        function showNotification(type, message) {
            const notification = document.createElement('div');
            notification.className = `notification is-${type} is-light`;
            notification.innerHTML = `<button class="delete" aria-label="delete"></button><p>${message}</p>`;
            metadataContainer.insertBefore(notification, metadataContainer.firstChild);
            notification.querySelector('.delete').addEventListener('click', () => {
                notification.remove()
            });
            setTimeout(() => {
                if (document.body.contains(notification)) {
                    notification.remove()
                }
            }, 8000)
        }// Clean image metadata
        async function cleanImageMetadata(imageFile, fieldsToRemove) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = async function (e) {
                    try {
                        const img = new Image();
                        img.src = e.target.result;
                        await new Promise(imgResolve => {
                            img.onload = imgResolve
                        });
                        const canvas = document.createElement('canvas');
                        canvas.width = img.width;
                        canvas.height = img.height;
                        const ctx = canvas.getContext('2d');
                        ctx.drawImage(img, 0, 0);
                        canvas.toBlob(blob => {
                            const cleanedFile = new File([blob], imageFile.name, {
                                type: imageFile.type,
                                lastModified: Date.now()
                            });
                            resolve(cleanedFile)
                        }, imageFile.type)
                    } catch (error) {
                        reject(error)
                    }
                };
                reader.onerror = () => reject(new Error('Failed to read the image file'));
                reader.readAsDataURL(imageFile)
            })
        }// Clean PDF metadata
        async function cleanPdfMetadata(pdfFile, fieldsToRemove) {
            try {
                const arrayBuffer = await pdfFile.arrayBuffer();
                const pdfDoc = await PDFLib.PDFDocument.load(arrayBuffer);
                if (fieldsToRemove.includes('Title')) pdfDoc.setTitle('');
                if (fieldsToRemove.includes('Author')) pdfDoc.setAuthor('');
                if (fieldsToRemove.includes('Subject')) pdfDoc.setSubject('');
                if (fieldsToRemove.includes('Keywords')) pdfDoc.setKeywords('');
                if (fieldsToRemove.includes('Creator')) pdfDoc.setCreator('');
                if (fieldsToRemove.includes('Producer')) pdfDoc.setProducer('');
                const pdfBytes = await pdfDoc.save();
                return new File([pdfBytes], pdfFile.name, {type: pdfFile.type, lastModified: Date.now()})
            } catch (error) {
                console.error('Error cleaning PDF metadata:', error);
                throw new Error('Failed to clean PDF metadata')
            }
        }// Download the cleaned file
        downloadButton.addEventListener('click', () => {
            if (!cleanedFile) return;
            saveAs(cleanedFile, `clean_${cleanedFile.name}`)
        });// Reset the application
        resetButton.addEventListener('click', reset);

        function reset() {
            currentFile = null;
            cleanedFile = null;
            metadataFields = {};
            fileInfo.classList.add('hidden');
            metadataSection.classList.add('hidden');
            downloadButton.classList.add('hidden');
            metadataContainer.innerHTML = '';
            fileDetails.innerHTML = '';
            previewContainer.innerHTML = ''
        }// Show/hide loading indicator
        function showLoading(show, message = 'Processing...') {
            if (show) {
                loadingText.textContent = message;
                loadingIndicator.classList.remove('hidden')
            } else {
                loadingIndicator.classList.add('hidden')
            }
        }// Format file size to human-readable format
        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i]
        }// Escape HTML to prevent XSS
        function escapeHTML(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML
        }
    });
</script>
<script src="../logo.js"></script>
</body>
</html>