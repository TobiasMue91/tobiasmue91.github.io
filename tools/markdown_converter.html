<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="MarkPro - A professional markdown editor that converts markdown to HTML in real-time with syntax highlighting.">
  <title>MarkPro | Modern Markdown Converter</title>
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>✍️</text></svg>">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/themes/prism.min.css">
  <style>
    :root {
      --primary: #4361ee;
      --primary-hover: #3a56d4;
      --primary-light: rgba(67, 97, 238, 0.1);
      --secondary: #e9ecef;
      --success: #2ecc71;
      --error: #e74c3c;
      --text: #212529;
      --text-light: #6c757d;
      --bg: #ffffff;
      --bg-secondary: #f8f9fa;
      --border: #dee2e6;
      --shadow: rgba(0, 0, 0, 0.05);
      --shadow-dark: rgba(0, 0, 0, 0.1);
      --radius: 8px;
      --font: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
      --transition: all 0.2s ease;
      --editor-font: 'SF Mono', Consolas, 'Liberation Mono', Menlo, monospace;
      --focus-ring: 0 0 0 3px var(--primary-light);
    }
    .dark-theme {
      --primary: #4cc9f0;
      --primary-hover: #3db8dd;
      --primary-light: rgba(76, 201, 240, 0.15);
      --secondary: #343a40;
      --text: #f8f9fa;
      --text-light: #ced4da;
      --bg: #1a1d20;
      --bg-secondary: #2a2e33;
      --border: #495057;
      --shadow: rgba(0, 0, 0, 0.2);
      --shadow-dark: rgba(0, 0, 0, 0.3);
    }
    * {box-sizing: border-box; margin: 0; padding: 0;}
    body {font-family: var(--font); color: var(--text); background-color: var(--bg); line-height: 1.6; transition: background-color 0.3s ease, color 0.3s ease;}
    .container {width: 100%; max-width: 1200px; margin: 0 auto; padding: 0 1.5rem;}
    header {padding: 1.5rem 0; border-bottom: 1px solid var(--border); background-color: var(--bg); position: sticky; top: 0; z-index: 100; transition: var(--transition); box-shadow: 0 1px 2px var(--shadow);}
    .header-content {display: flex; justify-content: space-between; align-items: center;}
    .app-title {font-size: 1.5rem; font-weight: 700; color: var(--text); user-select: none;}
    .app-title span {color: var(--primary); transition: var(--transition);}
    .app-title-icon {margin-right: 0.5rem; transform: translateY(2px);}
    .header-actions {display: flex; gap: 1rem; align-items: center;}
    main {padding: 2rem 0;}
    .editor-container {display: flex; gap: 1.5rem; margin-bottom: 1.5rem; flex-direction: column;}
    @media (min-width: 768px) {.editor-container {flex-direction: row;}}
    .editor-panel {flex: 1; display: flex; flex-direction: column; min-width: 0;}
    .panel-header {display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.75rem;}
    .panel-title {font-size: 1rem; font-weight: 600; color: var(--text); display: flex; align-items: center; gap: 0.5rem;}
    .panel-actions {display: flex; gap: 0.5rem; align-items: center;}
    .word-count {font-size: 0.875rem; color: var(--text-light); padding: 0.25rem 0.5rem; border-radius: var(--radius); background-color: var(--bg-secondary); transition: var(--transition);}
    .editor {flex: 1; min-height: 400px; border: 1px solid var(--border); border-radius: var(--radius); padding: 1rem; font-family: var(--editor-font); font-size: 0.9375rem; line-height: 1.6; color: var(--text); background-color: var(--bg-secondary); resize: vertical; outline: none; transition: border-color 0.2s ease, box-shadow 0.2s ease, background-color 0.3s ease, color 0.3s ease;}
    .editor:focus {border-color: var(--primary); box-shadow: var(--focus-ring);}
    .preview {flex: 1; min-height: 400px; border: 1px solid var(--border); border-radius: var(--radius); padding: 1rem; background-color: var(--bg-secondary); overflow: auto; transition: var(--transition);}
    .btn {display: inline-flex; align-items: center; justify-content: center; gap: 0.5rem; padding: 0.5rem 1rem; font-size: 0.875rem; font-weight: 500; border-radius: var(--radius); cursor: pointer; border: none; transition: all 0.2s ease; color: var(--text); background-color: var(--secondary); user-select: none;}
    .btn-icon {padding: 0.5rem;}
    .btn-primary {color: white; background-color: var(--primary);}
    .btn-primary:hover, .btn-primary:focus {background-color: var(--primary-hover);}
    .btn:hover, .btn:focus {background-color: var(--border); outline: none;}
    .btn:focus {box-shadow: var(--focus-ring);}
    .btn svg {width: 1rem; height: 1rem;}
    .toolbar {display: flex; flex-wrap: wrap; gap: 0.5rem; margin-bottom: 0.75rem; background-color: var(--bg-secondary); padding: 0.5rem; border-radius: var(--radius); border: 1px solid var(--border); transition: var(--transition);}
    .toolbar-btn {padding: 0.375rem 0.5rem; font-size: 0.875rem; background-color: var(--bg); border: 1px solid var(--border); border-radius: calc(var(--radius) - 2px); cursor: pointer; display: inline-flex; align-items: center; justify-content: center; gap: 0.25rem; color: var(--text); transition: all 0.15s ease; min-width: 2rem; position: relative;}
    .toolbar-btn:hover {background-color: var(--border);}
    .toolbar-btn svg {width: 0.875rem; height: 0.875rem;}
    .toolbar-btn[data-tooltip]:hover::after {content: attr(data-tooltip); position: absolute; bottom: calc(100% + 5px); left: 50%; transform: translateX(-50%); background-color: var(--text); color: white; padding: 0.25rem 0.5rem; border-radius: 4px; font-size: 0.75rem; white-space: nowrap; z-index: 10;}
    .toolbar-btn[data-tooltip]:hover::before {content: ''; position: absolute; bottom: 100%; left: 50%; transform: translateX(-50%); border: 5px solid transparent; border-top-color: var(--text); z-index: 10;}
    .toolbar-btn[data-tooltip][data-shortcut]:hover::after {content: attr(data-tooltip) " (" attr(data-shortcut) ")";}
    .toolbar-separator {width: 1px; height: 1.5rem; background-color: var(--border); margin: 0 0.25rem;}
    .toast {position: fixed; bottom: 1.5rem; right: 1.5rem; padding: 0.75rem 1rem; background-color: var(--primary); color: white; border-radius: var(--radius); font-size: 0.875rem; font-weight: 500; box-shadow: 0 4px 12px var(--shadow-dark); display: flex; align-items: center; gap: 0.5rem; transform: translateY(150%); transition: transform 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275); z-index: 1000; max-width: 350px;}
    .toast.show {transform: translateY(0);}
    .toast.success {background-color: var(--success);}
    .toast.error {background-color: var(--error);}
    .toast-icon {flex-shrink: 0;}
    .toast-message {flex-grow: 1;}
    .toast-close {background: none; border: none; color: white; cursor: pointer; padding: 0.25rem; display: flex; align-items: center; justify-content: center; opacity: 0.7; transition: opacity 0.15s ease;}
    .toast-close:hover {opacity: 1;}
    .panel {position: fixed; top: 0; right: 0; width: 100%; max-width: 350px; height: 100vh; background-color: var(--bg); border-left: 1px solid var(--border); box-shadow: -4px 0 12px var(--shadow); overflow-y: auto; transform: translateX(100%); transition: transform 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275); z-index: 1000; padding: 1.5rem; display: flex; flex-direction: column;}
    .panel.show {transform: translateX(0);}
    .panel-header-title {display: flex; align-items: center; justify-content: space-between; margin-bottom: 1.5rem;}
    .panel-header-title h3 {font-size: 1.25rem; font-weight: 600; color: var(--text);}
    .panel-close {background: none; border: none; cursor: pointer; color: var(--text-light); padding: 0.5rem; display: flex; align-items: center; justify-content: center; border-radius: 50%; transition: all 0.15s ease;}
    .panel-close:hover {background-color: var(--bg-secondary); color: var(--text);}
    .panel-section {margin-bottom: 1.5rem;}
    .panel-section h4 {margin-bottom: 0.75rem; font-size: 1rem; color: var(--primary); font-weight: 600;}
    .cheatsheet-item {display: flex; margin-bottom: 0.75rem; padding-bottom: 0.75rem; border-bottom: 1px solid var(--border);}
    .cheatsheet-syntax {flex: 0 0 40%; font-family: var(--editor-font); font-size: 0.875rem; color: var(--text); background-color: var(--bg-secondary); padding: 0.25rem 0.5rem; border-radius: 4px; user-select: all;}
    .cheatsheet-description {flex: 1; padding-left: 0.75rem; font-size: 0.875rem;}
    .settings-option {display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.75rem; padding-bottom: 0.75rem; border-bottom: 1px solid var(--border);}
    .settings-label {font-size: 0.9375rem; display: flex; flex-direction: column;}
    .settings-description {font-size: 0.8125rem; color: var(--text-light); margin-top: 0.25rem;}
    .theme-toggle {width: 3.5rem; height: 1.75rem; padding: 0.25rem; background-color: var(--bg-secondary); border-radius: 999px; position: relative; cursor: pointer; transition: var(--transition); border: 1px solid var(--border); display: flex; align-items: center;}
    .theme-toggle-thumb {position: absolute; height: 1.25rem; width: 1.25rem; border-radius: 50%; background-color: white; box-shadow: 0 1px 2px var(--shadow-dark); transition: transform 0.25s cubic-bezier(0.175, 0.885, 0.32, 1.275); left: 0.25rem; display: flex; align-items: center; justify-content: center;}
    .theme-toggle.active .theme-toggle-thumb {transform: translateX(1.75rem);}
    .theme-icon {color: var(--text-light); font-size: 0.75rem;}
    .sun-icon {display: block;}
    .moon-icon {display: none;}
    .theme-toggle.active .sun-icon {display: none;}
    .theme-toggle.active .moon-icon {display: block;}
    .toggle-switch {position: relative; display: inline-block; width: 3rem; height: 1.5rem;}
    .toggle-switch input {opacity: 0; width: 0; height: 0;}
    .toggle-slider {position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: var(--bg-secondary); border: 1px solid var(--border); transition: .3s; border-radius: 999px;}
    .toggle-slider:before {position: absolute; content: ""; height: 1.125rem; width: 1.125rem; left: 0.125rem; bottom: 0.125rem; background-color: var(--primary); transition: .3s; border-radius: 50%;}
    input:checked + .toggle-slider {background-color: var(--primary-light);}
    input:focus + .toggle-slider {box-shadow: var(--focus-ring);}
    input:checked + .toggle-slider:before {transform: translateX(1.5rem);}
    .preview h1, .preview h2, .preview h3, .preview h4, .preview h5, .preview h6 {margin-top: 1.5rem; margin-bottom: 0.75rem; line-height: 1.3; color: var(--text);}
    .preview h1 {font-size: 1.75rem; border-bottom: 1px solid var(--border); padding-bottom: 0.5rem;}
    .preview h2 {font-size: 1.5rem; border-bottom: 1px solid var(--border); padding-bottom: 0.5rem;}
    .preview h3 {font-size: 1.25rem;}
    .preview p {margin-bottom: 1rem;}
    .preview ul, .preview ol {margin-bottom: 1rem; padding-left: 2rem;}
    .preview li {margin-bottom: 0.25rem;}
    .preview blockquote {padding: 0.5rem 1rem; margin: 0 0 1rem 0; border-left: 4px solid var(--primary); background-color: var(--primary-light); border-radius: 0 var(--radius) var(--radius) 0;}
    .preview code {font-family: var(--editor-font); padding: 0.2rem 0.4rem; font-size: 0.875rem; background-color: rgba(0, 0, 0, 0.05); border-radius: 3px;}
    .preview pre {margin-bottom: 1rem; padding: 1rem; background-color: var(--bg); border-radius: var(--radius); overflow-x: auto; border: 1px solid var(--border);}
    .preview pre code {background-color: transparent; padding: 0;}
    .preview img {max-width: 100%; height: auto; border-radius: var(--radius); margin: 1rem 0;}
    .preview a {color: var(--primary); text-decoration: none;}
    .preview a:hover {text-decoration: underline;}
    .preview hr {height: 1px; background-color: var(--border); border: none; margin: 2rem 0;}
    .preview table {width: 100%; border-collapse: collapse; margin-bottom: 1rem; overflow: auto; display: block;}
    .preview table th, .preview table td {padding: 0.5rem 0.75rem; border: 1px solid var(--border);}
    .preview table th {background-color: var(--primary-light); font-weight: 600;}
    .footer {padding: 1.5rem 0; text-align: center; font-size: 0.875rem; color: var(--text-light); border-top: 1px solid var(--border); margin-top: 2rem; transition: var(--transition);}
    .keyboard-shortcut {display: inline-flex; align-items: center; gap: 0.25rem; font-size: 0.75rem; color: var(--text-light);}
    .key {display: inline-block; padding: 0.125rem 0.375rem; background-color: var(--bg-secondary); border: 1px solid var(--border); border-radius: 3px; font-family: var(--editor-font); font-size: 0.75rem; line-height: 1;}
    .dark-theme .preview code {background-color: rgba(255, 255, 255, 0.05);}
    .dark-theme .preview pre {background-color: var(--bg-secondary);}
    .dark-theme .preview table th {background-color: rgba(76, 201, 240, 0.1);}
    @media (max-width: 767px) {.editor-container {flex-direction: column;} .editor, .preview {min-height: 300px;} .panel-header {flex-direction: column; align-items: flex-start; gap: 0.5rem;} .panel-actions {width: 100%; justify-content: space-between;} .toolbar {overflow-x: auto;}}
    .sr-only {position: absolute; width: 1px; height: 1px; padding: 0; margin: -1px; overflow: hidden; clip: rect(0, 0, 0, 0); white-space: nowrap; border-width: 0;}
  </style>
</head>
<body>
<header>
  <div class="container">
    <div class="header-content">
      <div class="app-title">
        <svg class="app-title-icon" width="24" height="24" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2" fill="none" aria-hidden="true">
          <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
          <path d="M18.5 2.5a2.12 2.12 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
        </svg>
        Mark<span>Pro</span>
      </div>
      <div class="header-actions">
        <button id="settings-btn" class="btn" aria-label="Settings" title="Settings">
          <svg viewBox="0 0 24 24" width="18" height="18" stroke="currentColor" stroke-width="2" fill="none" aria-hidden="true">
            <path d="M12 15a3 3 0 1 0 0-6 3 3 0 0 0 0 6Z"></path>
            <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1Z"></path>
          </svg>
        </button>
        <button id="cheatsheet-btn" class="btn" aria-label="Markdown Cheatsheet" title="Markdown Cheatsheet">
          <svg viewBox="0 0 24 24" width="18" height="18" stroke="currentColor" stroke-width="2" fill="none" aria-hidden="true">
            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
            <path d="M14 2v6h6"></path>
            <path d="M16 13H8"></path>
            <path d="M16 17H8"></path>
            <path d="M10 9H8"></path>
          </svg>
        </button>
        <div id="theme-toggle" class="theme-toggle" role="switch" aria-checked="false" tabindex="0" aria-label="Toggle dark mode">
          <div class="theme-toggle-thumb">
            <svg class="sun-icon theme-icon" width="14" height="14" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2" fill="none" aria-hidden="true">
              <circle cx="12" cy="12" r="5"></circle>
              <line x1="12" y1="1" x2="12" y2="3"></line>
              <line x1="12" y1="21" x2="12" y2="23"></line>
              <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
              <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
              <line x1="1" y1="12" x2="3" y2="12"></line>
              <line x1="21" y1="12" x2="23" y2="12"></line>
              <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
              <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
            </svg>
            <svg class="moon-icon theme-icon" width="14" height="14" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2" fill="none" aria-hidden="true">
              <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
            </svg>
          </div>
        </div>
      </div>
    </div>
  </div>
</header>

<main>
  <div class="container">
    <div class="editor-container">
      <div class="editor-panel">
        <div class="panel-header">
          <div class="panel-title">
            <svg viewBox="0 0 24 24" width="18" height="18" stroke="currentColor" stroke-width="2" fill="none" aria-hidden="true">
              <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
              <path d="M18.5 2.5a2.12 2.12 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
            </svg>
            Markdown
            <span id="wordCount" class="word-count">0 words</span>
          </div>
          <div class="panel-actions">
            <button id="update-btn" class="btn" aria-label="Update Preview" title="Update Preview (Ctrl+Shift+S)">
              <svg viewBox="0 0 24 24" width="18" height="18" stroke="currentColor" stroke-width="2" fill="none" aria-hidden="true">
                <path d="M23 4v6h-6"></path>
                <path d="M1 20v-6h6"></path>
                <path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"></path>
              </svg>
              Update
            </button>
            <button id="clear-btn" class="btn" aria-label="Clear Editor" title="Clear Editor">
              <svg viewBox="0 0 24 24" width="18" height="18" stroke="currentColor" stroke-width="2" fill="none" aria-hidden="true">
                <path d="M3 6h18"></path>
                <path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"></path>
                <path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"></path>
              </svg>
              Clear
            </button>
          </div>
        </div>
        <div class="toolbar" role="toolbar" aria-label="Markdown formatting tools">
          <button class="toolbar-btn" data-action="heading" data-tooltip="Heading" data-shortcut="Ctrl+H">
            <svg viewBox="0 0 24 24" width="14" height="14" stroke="currentColor" stroke-width="2" fill="none" aria-hidden="true">
              <path d="M6 12h12"></path>
              <path d="M6 4v16"></path>
              <path d="M18 4v16"></path>
            </svg>
          </button>
          <button class="toolbar-btn" data-action="heading2" data-tooltip="Subheading">
            <svg viewBox="0 0 24 24" width="14" height="14" stroke="currentColor" stroke-width="2" fill="none" aria-hidden="true">
              <polyline points="6 9 6 15"></polyline>
              <polyline points="10 9 10 15"></polyline>
              <line x1="6" y1="12" x2="10" y2="12"></line>
              <polyline points="14 9 17 9 17 12 14 12 14 15 17 15"></polyline>
            </svg>
          </button>
          <div class="toolbar-separator" role="separator"></div>
          <button class="toolbar-btn" data-action="bold" data-tooltip="Bold" data-shortcut="Ctrl+B">
            <svg viewBox="0 0 24 24" width="14" height="14" stroke="currentColor" stroke-width="2" fill="none" aria-hidden="true">
              <path d="M6 4h8a4 4 0 0 1 4 4 4 4 0 0 1-4 4H6z"></path>
              <path d="M6 12h9a4 4 0 0 1 4 4 4 4 0 0 1-4 4H6z"></path>
            </svg>
          </button>
          <button class="toolbar-btn" data-action="italic" data-tooltip="Italic" data-shortcut="Ctrl+I">
            <svg viewBox="0 0 24 24" width="14" height="14" stroke="currentColor" stroke-width="2" fill="none" aria-hidden="true">
              <line x1="19" y1="4" x2="10" y2="4"></line>
              <line x1="14" y1="20" x2="5" y2="20"></line>
              <line x1="15" y1="4" x2="9" y2="20"></line>
            </svg>
          </button>
          <button class="toolbar-btn" data-action="link" data-tooltip="Link" data-shortcut="Ctrl+K">
            <svg viewBox="0 0 24 24" width="14" height="14" stroke="currentColor" stroke-width="2" fill="none" aria-hidden="true">
              <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path>
              <path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path>
            </svg>
          </button>
          <div class="toolbar-separator" role="separator"></div>
          <button class="toolbar-btn" data-action="list" data-tooltip="Bulleted List">
            <svg viewBox="0 0 24 24" width="14" height="14" stroke="currentColor" stroke-width="2" fill="none" aria-hidden="true">
              <line x1="8" y1="6" x2="21" y2="6"></line>
              <line x1="8" y1="12" x2="21" y2="12"></line>
              <line x1="8" y1="18" x2="21" y2="18"></line>
              <line x1="3" y1="6" x2="3.01" y2="6"></line>
              <line x1="3" y1="12" x2="3.01" y2="12"></line>
              <line x1="3" y1="18" x2="3.01" y2="18"></line>
            </svg>
          </button>
          <button class="toolbar-btn" data-action="ordered-list" data-tooltip="Numbered List">
            <svg viewBox="0 0 24 24" width="14" height="14" stroke="currentColor" stroke-width="2" fill="none" aria-hidden="true">
              <line x1="10" y1="6" x2="21" y2="6"></line>
              <line x1="10" y1="12" x2="21" y2="12"></line>
              <line x1="10" y1="18" x2="21" y2="18"></line>
              <path d="M4 6h1v4"></path>
              <path d="M4 10h2"></path>
              <path d="M6 18H4c0-1 2-2 2-3s-1-1.5-2-1"></path>
            </svg>
          </button>
          <button class="toolbar-btn" data-action="quote" data-tooltip="Blockquote">
            <svg viewBox="0 0 24 24" width="14" height="14" stroke="currentColor" stroke-width="2" fill="none" aria-hidden="true">
              <path d="M10 11h-4a1 1 0 0 1-1-1v-3a1 1 0 0 1 1-1h3a1 1 0 0 1 1 1v6c0 2.667-1.333 4.333-4 5"></path>
              <path d="M19 11h-4a1 1 0 0 1-1-1v-3a1 1 0 0 1 1-1h3a1 1 0 0 1 1 1v6c0 2.667-1.333 4.333-4 5"></path>
            </svg>
          </button>
          <div class="toolbar-separator" role="separator"></div>
          <button class="toolbar-btn" data-action="code" data-tooltip="Code Block">
            <svg viewBox="0 0 24 24" width="14" height="14" stroke="currentColor" stroke-width="2" fill="none" aria-hidden="true">
              <polyline points="16 18 22 12 16 6"></polyline>
              <polyline points="8 6 2 12 8 18"></polyline>
            </svg>
          </button>
          <button class="toolbar-btn" data-action="image" data-tooltip="Image">
            <svg viewBox="0 0 24 24" width="14" height="14" stroke="currentColor" stroke-width="2" fill="none" aria-hidden="true">
              <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
              <circle cx="8.5" cy="8.5" r="1.5"></circle>
              <polyline points="21 15 16 10 5 21"></polyline>
            </svg>
          </button>
          <button class="toolbar-btn" data-action="table" data-tooltip="Table">
            <svg viewBox="0 0 24 24" width="14" height="14" stroke="currentColor" stroke-width="2" fill="none" aria-hidden="true">
              <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
              <line x1="3" y1="9" x2="21" y2="9"></line>
              <line x1="3" y1="15" x2="21" y2="15"></line>
              <line x1="9" y1="3" x2="9" y2="21"></line>
              <line x1="15" y1="3" x2="15" y2="21"></line>
            </svg>
          </button>
        </div>
        <textarea id="markdown-input" class="editor" placeholder="Start typing your markdown here..." aria-label="Markdown editor"></textarea>
      </div>

      <div class="editor-panel">
        <div class="panel-header">
          <div class="panel-title">
            <svg viewBox="0 0 24 24" width="18" height="18" stroke="currentColor" stroke-width="2" fill="none" aria-hidden="true">
              <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
              <circle cx="12" cy="12" r="3"></circle>
            </svg>
            Preview
          </div>
          <div class="panel-actions">
            <button id="copy-html-btn" class="btn" aria-label="Copy HTML" title="Copy HTML">
              <svg viewBox="0 0 24 24" width="18" height="18" stroke="currentColor" stroke-width="2" fill="none" aria-hidden="true">
                <path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2"></path>
                <rect x="8" y="2" width="8" height="4" rx="1" ry="1"></rect>
              </svg>
              Copy HTML
            </button>
            <button id="toggle-view-btn" class="btn" aria-label="Toggle Raw HTML" title="Toggle Raw HTML">
              <svg viewBox="0 0 24 24" width="18" height="18" stroke="currentColor" stroke-width="2" fill="none" aria-hidden="true">
                <path d="M16 18l6-6-6-6"></path>
                <path d="M8 6l-6 6 6 6"></path>
              </svg>
              Raw HTML
            </button>
          </div>
        </div>
        <div id="html-output" class="preview" aria-live="polite" aria-label="HTML preview"></div>
      </div>
    </div>
  </div>
</main>

<div id="toast" class="toast" role="alert">
  <div class="toast-icon">
    <svg width="18" height="18" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2" fill="none" aria-hidden="true">
      <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path>
      <polyline points="22 4 12 14.01 9 11.01"></polyline>
    </svg>
  </div>
  <div class="toast-message"></div>
  <button class="toast-close" aria-label="Close notification">
    <svg width="14" height="14" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2" fill="none" aria-hidden="true">
      <line x1="18" y1="6" x2="6" y2="18"></line>
      <line x1="6" y1="6" x2="18" y2="18"></line>
    </svg>
  </button>
</div>

<div id="cheatsheet" class="panel" role="dialog" aria-labelledby="cheatsheet-title" aria-hidden="true">
  <div class="panel-header-title">
    <h3 id="cheatsheet-title">Markdown Cheatsheet</h3>
    <button id="cheatsheet-close" class="panel-close" aria-label="Close cheatsheet">
      <svg viewBox="0 0 24 24" width="20" height="20" stroke="currentColor" stroke-width="2" fill="none" aria-hidden="true">
        <line x1="18" y1="6" x2="6" y2="18"></line>
        <line x1="6" y1="6" x2="18" y2="18"></line>
      </svg>
    </button>
  </div>

  <div class="panel-section">
    <h4>Headers</h4>
    <div class="cheatsheet-item">
      <div class="cheatsheet-syntax"># Heading 1</div>
      <div class="cheatsheet-description">Largest heading</div>
    </div>
    <div class="cheatsheet-item">
      <div class="cheatsheet-syntax">## Heading 2</div>
      <div class="cheatsheet-description">Second largest heading</div>
    </div>
    <div class="cheatsheet-item">
      <div class="cheatsheet-syntax">### Heading 3</div>
      <div class="cheatsheet-description">Third largest heading</div>
    </div>
  </div>

  <div class="panel-section">
    <h4>Emphasis</h4>
    <div class="cheatsheet-item">
      <div class="cheatsheet-syntax">*italic* or _italic_</div>
      <div class="cheatsheet-description">Italic text</div>
    </div>
    <div class="cheatsheet-item">
      <div class="cheatsheet-syntax">**bold** or __bold__</div>
      <div class="cheatsheet-description">Bold text</div>
    </div>
    <div class="cheatsheet-item">
      <div class="cheatsheet-syntax">~~strikethrough~~</div>
      <div class="cheatsheet-description">Strikethrough text</div>
    </div>
  </div>

  <div class="panel-section">
    <h4>Lists</h4>
    <div class="cheatsheet-item">
      <div class="cheatsheet-syntax">1. First item<br>2. Second item</div>
      <div class="cheatsheet-description">Ordered list</div>
    </div>
    <div class="cheatsheet-item">
      <div class="cheatsheet-syntax">* Item<br>* Another item</div>
      <div class="cheatsheet-description">Unordered list with *</div>
    </div>
  </div>

  <div class="panel-section">
    <h4>Links & Images</h4>
    <div class="cheatsheet-item">
      <div class="cheatsheet-syntax">[Link text](URL)</div>
      <div class="cheatsheet-description">Hyperlink</div>
    </div>
    <div class="cheatsheet-item">
      <div class="cheatsheet-syntax">![Alt text](image-url)</div>
      <div class="cheatsheet-description">Image</div>
    </div>
  </div>

  <div class="panel-section">
    <h4>Code</h4>
    <div class="cheatsheet-item">
      <div class="cheatsheet-syntax">`inline code`</div>
      <div class="cheatsheet-description">Inline code</div>
    </div>
    <div class="cheatsheet-item">
      <div class="cheatsheet-syntax">```<br>code block<br>```</div>
      <div class="cheatsheet-description">Code block</div>
    </div>
    <div class="cheatsheet-item">
      <div class="cheatsheet-syntax">```javascript<br>// JS code<br>```</div>
      <div class="cheatsheet-description">Syntax highlighted code</div>
    </div>
  </div>

  <div class="panel-section">
    <h4>Other</h4>
    <div class="cheatsheet-item">
      <div class="cheatsheet-syntax">> Blockquote</div>
      <div class="cheatsheet-description">Blockquote</div>
    </div>
    <div class="cheatsheet-item">
      <div class="cheatsheet-syntax">--- or ***</div>
      <div class="cheatsheet-description">Horizontal rule</div>
    </div>
    <div class="cheatsheet-item">
      <div class="cheatsheet-syntax">| Header | Header |<br>| ------ | ------ |<br>| Cell   | Cell   |</div>
      <div class="cheatsheet-description">Table</div>
    </div>
  </div>
</div>

<div id="settings-panel" class="panel" role="dialog" aria-labelledby="settings-title" aria-hidden="true">
  <div class="panel-header-title">
    <h3 id="settings-title">Settings</h3>
    <button id="settings-close" class="panel-close" aria-label="Close settings">
      <svg viewBox="0 0 24 24" width="20" height="20" stroke="currentColor" stroke-width="2" fill="none" aria-hidden="true">
        <line x1="18" y1="6" x2="6" y2="18"></line>
        <line x1="6" y1="6" x2="18" y2="18"></line>
      </svg>
    </button>
  </div>

  <div class="panel-section">
    <h4>Appearance</h4>
    <div class="settings-option">
      <div class="settings-label">
        Dark Mode
        <div class="settings-description">Switch between light and dark theme</div>
      </div>
      <div class="settings-control">
        <div id="settings-theme-toggle" class="theme-toggle" role="switch" aria-checked="false" tabindex="0">
          <div class="theme-toggle-thumb">
            <svg class="sun-icon theme-icon" width="14" height="14" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2" fill="none" aria-hidden="true">
              <circle cx="12" cy="12" r="5"></circle>
              <line x1="12" y1="1" x2="12" y2="3"></line>
              <line x1="12" y1="21" x2="12" y2="23"></line>
              <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
              <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
              <line x1="1" y1="12" x2="3" y2="12"></line>
              <line x1="21" y1="12" x2="23" y2="12"></line>
              <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
              <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
            </svg>
            <svg class="moon-icon theme-icon" width="14" height="14" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2" fill="none" aria-hidden="true">
              <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
            </svg>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="panel-section">
    <h4>Editor</h4>
    <div class="settings-option">
      <div class="settings-label">
        Auto-save Content
        <div class="settings-description">Save content to local storage automatically</div>
      </div>
      <div class="settings-control">
        <label class="toggle-switch">
          <input type="checkbox" id="autosave-toggle" checked>
          <span class="toggle-slider"></span>
          <span class="sr-only">Auto-save content</span>
        </label>
      </div>
    </div>
    <div class="settings-option">
      <div class="settings-label">
        Real-time Preview
        <div class="settings-description">Update preview as you type</div>
      </div>
      <div class="settings-control">
        <label class="toggle-switch">
          <input type="checkbox" id="realtime-toggle" checked>
          <span class="toggle-slider"></span>
          <span class="sr-only">Real-time preview</span>
        </label>
      </div>
    </div>
  </div>

  <div class="panel-section">
    <h4>Markdown Options</h4>
    <div class="settings-option">
      <div class="settings-label">
        Convert Line Breaks
        <div class="settings-description">Treat newlines as paragraph breaks</div>
      </div>
      <div class="settings-control">
        <label class="toggle-switch">
          <input type="checkbox" id="linebreaks-toggle">
          <span class="toggle-slider"></span>
          <span class="sr-only">Convert line breaks</span>
        </label>
      </div>
    </div>
    <div class="settings-option">
      <div class="settings-label">
        Sanitize HTML
        <div class="settings-description">Remove potentially dangerous HTML</div>
      </div>
      <div class="settings-control">
        <label class="toggle-switch">
          <input type="checkbox" id="sanitize-toggle" checked>
          <span class="toggle-slider"></span>
          <span class="sr-only">Sanitize HTML</span>
        </label>
      </div>
    </div>
  </div>

  <div class="panel-section">
    <h4>Keyboard Shortcuts</h4>
    <div class="settings-option">
      <div class="keyboard-shortcut"><span class="key">Ctrl</span> + <span class="key">B</span> Bold</div>
    </div>
    <div class="settings-option">
      <div class="keyboard-shortcut"><span class="key">Ctrl</span> + <span class="key">I</span> Italic</div>
    </div>
    <div class="settings-option">
      <div class="keyboard-shortcut"><span class="key">Ctrl</span> + <span class="key">K</span> Link</div>
    </div>
    <div class="settings-option">
      <div class="keyboard-shortcut"><span class="key">Ctrl</span> + <span class="key">H</span> Heading</div>
    </div>
    <div class="settings-option">
      <div class="keyboard-shortcut"><span class="key">Ctrl</span> + <span class="key">Shift</span> + <span class="key">S</span> Update Preview</div>
    </div>
  </div>
</div>

<footer class="footer">
  <div class="container">
    <p>MarkPro • Professional Markdown Editor • <span id="current-year"></span></p>
  </div>
</footer>

<script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/prism.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-javascript.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-css.min.js"></script>
<script>
  // DOM Elements
  const markdownInput = document.getElementById('markdown-input');
  const htmlOutput = document.getElementById('html-output');
  const wordCount = document.getElementById('wordCount');
  const copyHtmlBtn = document.getElementById('copy-html-btn');
  const toggleViewBtn = document.getElementById('toggle-view-btn');
  const clearBtn = document.getElementById('clear-btn');
  const updateBtn = document.getElementById('update-btn');
  const themeToggle = document.getElementById('theme-toggle');
  const settingsThemeToggle = document.getElementById('settings-theme-toggle');
  const cheatsheetBtn = document.getElementById('cheatsheet-btn');
  const cheatsheet = document.getElementById('cheatsheet');
  const cheatsheetClose = document.getElementById('cheatsheet-close');
  const settingsBtn = document.getElementById('settings-btn');
  const settingsPanel = document.getElementById('settings-panel');
  const settingsClose = document.getElementById('settings-close');
  const toast = document.getElementById('toast');
  const toastMessage = document.querySelector('.toast-message');
  const toastClose = document.querySelector('.toast-close');
  const autosaveToggle = document.getElementById('autosave-toggle');
  const realtimeToggle = document.getElementById('realtime-toggle');
  const linebreaksToggle = document.getElementById('linebreaks-toggle');
  const sanitizeToggle = document.getElementById('sanitize-toggle');
  const currentYear = document.getElementById('current-year');
  const toolbarButtons = document.querySelectorAll('.toolbar-btn');

  // State
  let isHtmlView = false;
  let htmlText = '';
  const defaultText = `# Welcome to MarkPro

A sleek, modern **Markdown editor** with real-time preview.

## Features

* Real-time preview with syntax highlighting
* Dark mode support
* Markdown toolbar for quick formatting
* Keyboard shortcuts
* HTML export options
* Local autosave

## Try it out!

1. Write some markdown in the editor
2. See it rendered in real-time in the preview
3. Use the toolbar buttons for common formatting
4. Toggle between preview and raw HTML

---

> "Good design is as little design as possible." – Dieter Rams

![Markdown Logo](https://markdown-here.com/img/icon256.png)

\`\`\`js
// Example code
function greet(name) {
  return \`Hello, \${name}!\`;
}
\`\`\``;

  // Settings
  const settings = {
    autosave: true,
    realtime: true,
    breaks: false,
    sanitize: true,
    theme: 'light' // Default to light theme
  };

  // Initialize
  function init() {
    // Set the current year in the footer
    currentYear.textContent = new Date().getFullYear();

    // Load user settings and content
    loadSettings();
    loadContent();

    // Configure marked and update the preview
    initializeMarked();
    updatePreview();
    updateWordCount();

    // Event listeners
    markdownInput.addEventListener('input', handleInput);
    copyHtmlBtn.addEventListener('click', copyHtml);
    toggleViewBtn.addEventListener('click', toggleView);
    clearBtn.addEventListener('click', clearContent);
    updateBtn.addEventListener('click', forceUpdatePreview);

    // Theme toggle handlers with improved functionality
    themeToggle.addEventListener('click', toggleTheme);
    themeToggle.addEventListener('keydown', function(e) {
      if (e.key === 'Enter' || e.key === ' ') {
        e.preventDefault();
        toggleTheme();
      }
    });
    settingsThemeToggle.addEventListener('click', toggleTheme);
    settingsThemeToggle.addEventListener('keydown', function(e) {
      if (e.key === 'Enter' || e.key === ' ') {
        e.preventDefault();
        toggleTheme();
      }
    });

    cheatsheetBtn.addEventListener('click', toggleCheatsheet);
    cheatsheetClose.addEventListener('click', toggleCheatsheet);
    settingsBtn.addEventListener('click', toggleSettings);
    settingsClose.addEventListener('click', toggleSettings);
    autosaveToggle.addEventListener('change', () => toggleSetting('autosave', autosaveToggle.checked));
    realtimeToggle.addEventListener('change', () => toggleSetting('realtime', realtimeToggle.checked));
    linebreaksToggle.addEventListener('change', () => toggleSetting('breaks', linebreaksToggle.checked));
    sanitizeToggle.addEventListener('change', () => toggleSetting('sanitize', sanitizeToggle.checked));
    toastClose.addEventListener('click', hideToast);

    // Toolbar buttons
    toolbarButtons.forEach(btn => {
      btn.addEventListener('click', () => {
        handleToolbarAction(btn.dataset.action);
      });
    });

    // Apply theme after loading
    applyTheme();
  }

  // Configure marked options
  function initializeMarked() {
    marked.setOptions({
      breaks: settings.breaks,
      sanitize: settings.sanitize,
      highlight: function(code, lang) {
        if (lang && Prism.languages[lang]) {
          return Prism.highlight(code, Prism.languages[lang], lang);
        }
        return code;
      },
      langPrefix: 'language-',
      gfm: true
    });
  }

  // Handle input in the markdown editor
  function handleInput() {
    if (settings.autosave) {
      localStorage.setItem('markpro-content', markdownInput.value);
    }

    if (settings.realtime) {
      updatePreview();
    }

    updateWordCount();
  }

  // Update the preview panel
  function updatePreview() {
    try {
      const markdownText = markdownInput.value;
      htmlText = marked.parse(markdownText);

      if (!isHtmlView) {
        htmlOutput.innerHTML = htmlText;
      } else {
        htmlOutput.textContent = htmlText;
      }
    } catch (error) {
      console.error('Error updating preview:', error);
      showToast('Error updating preview. Please check your markdown syntax.', 'error');
    }
  }

  // Force update preview (for manual update button)
  function forceUpdatePreview() {
    updatePreview();
    showToast('Preview updated', 'success');
  }

  // Toggle between rendered HTML and raw HTML
  function toggleView() {
    isHtmlView = !isHtmlView;

    if (isHtmlView) {
      htmlOutput.textContent = htmlText;
      toggleViewBtn.innerHTML = `
          <svg viewBox="0 0 24 24" width="18" height="18" stroke="currentColor" stroke-width="2" fill="none" aria-hidden="true">
            <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
            <circle cx="12" cy="12" r="3"></circle>
          </svg>
          HTML Preview
        `;
    } else {
      htmlOutput.innerHTML = htmlText;
      toggleViewBtn.innerHTML = `
          <svg viewBox="0 0 24 24" width="18" height="18" stroke="currentColor" stroke-width="2" fill="none" aria-hidden="true">
            <path d="M16 18l6-6-6-6"></path>
            <path d="M8 6l-6 6 6 6"></path>
          </svg>
          Raw HTML
        `;
    }
  }

  // Copy HTML to clipboard
  function copyHtml() {
    navigator.clipboard.writeText(htmlText)
            .then(() => {
              showToast('HTML copied to clipboard!', 'success');
            })
            .catch(err => {
              showToast('Failed to copy HTML', 'error');
              console.error('Copy failed:', err);
            });
  }

  // Clear editor content
  function clearContent() {
    if (confirm('Are you sure you want to clear all content?')) {
      markdownInput.value = '';
      updatePreview();
      updateWordCount();
      if (settings.autosave) {
        localStorage.removeItem('markpro-content');
      }
      showToast('Content cleared', 'success');
    }
  }

  // Update word count
  function updateWordCount() {
    const text = markdownInput.value.trim();
    const wordCount = text ? text.split(/\s+/).length : 0;
    const charCount = text ? text.length : 0;
    document.getElementById('wordCount').textContent = `${wordCount} word${wordCount !== 1 ? 's' : ''} • ${charCount} char${charCount !== 1 ? 's' : ''}`;
  }

  // Load content from localStorage
  function loadContent() {
    const savedContent = localStorage.getItem('markpro-content');
    if (savedContent) {
      markdownInput.value = savedContent;
    } else {
      markdownInput.value = defaultText;
    }
  }

  // Load settings from localStorage
  function loadSettings() {
    const savedSettings = localStorage.getItem('markpro-settings');
    if (savedSettings) {
      try {
        const parsedSettings = JSON.parse(savedSettings);
        Object.assign(settings, parsedSettings);

        // Update form controls to match saved settings
        autosaveToggle.checked = settings.autosave;
        realtimeToggle.checked = settings.realtime;
        linebreaksToggle.checked = settings.breaks;
        sanitizeToggle.checked = settings.sanitize;
      } catch (error) {
        console.error('Error loading settings:', error);
        localStorage.removeItem('markpro-settings');
      }
    }
  }

  // Save settings to localStorage
  function saveSettings() {
    localStorage.setItem('markpro-settings', JSON.stringify(settings));
    initializeMarked();
    if (settings.realtime) {
      updatePreview();
    }
  }

  // Toggle a setting
  function toggleSetting(settingName, isActive) {
    settings[settingName] = isActive;
    saveSettings();

    // Show confirmation toast
    const settingLabel = settingName.charAt(0).toUpperCase() + settingName.slice(1).replace(/([A-Z])/g, ' $1');
    showToast(`${settingLabel} ${isActive ? 'enabled' : 'disabled'}`, 'success');
  }

  // Show toast notification
  function showToast(message, type = '') {
    toastMessage.textContent = message;
    toast.className = `toast ${type} show`;

    // Automatically hide after 3 seconds
    setTimeout(() => {
      hideToast();
    }, 3000);
  }

  // Hide toast notification
  function hideToast() {
    toast.className = toast.className.replace('show', '');
  }

  // Toggle dark mode with fixed implementation
  function toggleTheme() {
    settings.theme = settings.theme === 'dark' ? 'light' : 'dark';
    applyTheme();
    saveSettings();
    showToast(`${settings.theme === 'dark' ? 'Dark' : 'Light'} mode enabled`, 'success');
  }

  // Apply theme - completely rewritten to fix the issue
  function applyTheme() {
    // Clear any existing theme classes
    document.body.classList.remove('dark-theme');

    // Apply the appropriate theme class
    if (settings.theme === 'dark') {
      document.body.classList.add('dark-theme');
      themeToggle.classList.add('active');
      themeToggle.setAttribute('aria-checked', 'true');
      settingsThemeToggle.classList.add('active');
      settingsThemeToggle.setAttribute('aria-checked', 'true');
    } else {
      themeToggle.classList.remove('active');
      themeToggle.setAttribute('aria-checked', 'false');
      settingsThemeToggle.classList.remove('active');
      settingsThemeToggle.setAttribute('aria-checked', 'false');
    }
  }

  // Toggle cheatsheet panel
  function toggleCheatsheet() {
    if (settingsPanel.classList.contains('show')) {
      toggleSettings();
    }

    const isVisible = cheatsheet.classList.toggle('show');
    cheatsheet.setAttribute('aria-hidden', !isVisible);
  }

  // Toggle settings panel
  function toggleSettings() {
    if (cheatsheet.classList.contains('show')) {
      toggleCheatsheet();
    }

    const isVisible = settingsPanel.classList.toggle('show');
    settingsPanel.setAttribute('aria-hidden', !isVisible);
  }

  // Handle toolbar actions
  function handleToolbarAction(action) {
    const start = markdownInput.selectionStart;
    const end = markdownInput.selectionEnd;
    const selectedText = markdownInput.value.substring(start, end);
    const beforeText = markdownInput.value.substring(0, start);
    const afterText = markdownInput.value.substring(end);

    let insertText = '';
    let cursorOffset = 0;

    switch(action) {
      case 'heading':
        insertText = selectedText ? `# ${selectedText}` : '# Heading';
        cursorOffset = selectedText ? 0 : 0;
        break;
      case 'heading2':
        insertText = selectedText ? `## ${selectedText}` : '## Subheading';
        cursorOffset = selectedText ? 0 : 0;
        break;
      case 'bold':
        insertText = selectedText ? `**${selectedText}**` : '**bold text**';
        cursorOffset = selectedText ? 0 : 2;
        break;
      case 'italic':
        insertText = selectedText ? `*${selectedText}*` : '*italic text*';
        cursorOffset = selectedText ? 0 : 1;
        break;
      case 'link':
        insertText = selectedText ? `[${selectedText}](url)` : '[link text](url)';
        cursorOffset = selectedText ? 1 : 1;
        break;
      case 'image':
        insertText = '![alt text](image-url)';
        cursorOffset = 2;
        break;
      case 'list':
        insertText = '\n* Item 1\n* Item 2\n* Item 3';
        cursorOffset = 3;
        break;
      case 'ordered-list':
        insertText = '\n1. Item 1\n2. Item 2\n3. Item 3';
        cursorOffset = 3;
        break;
      case 'code':
        insertText = selectedText ? `\`\`\`\n${selectedText}\n\`\`\`` : '```\ncode here\n```';
        cursorOffset = selectedText ? 0 : 4;
        break;
      case 'quote':
        insertText = selectedText ? `> ${selectedText}` : '> Blockquote';
        cursorOffset = selectedText ? 0 : 2;
        break;
      case 'table':
        insertText = '\n| Header | Header |\n| ------ | ------ |\n| Cell   | Cell   |';
        cursorOffset = 2;
        break;
    }

    markdownInput.value = beforeText + insertText + afterText;
    markdownInput.focus();

    // Set cursor position after insertion
    if (selectedText) {
      markdownInput.setSelectionRange(start + insertText.length, start + insertText.length);
    } else {
      const newCursorPos = start + insertText.length - cursorOffset;
      markdownInput.setSelectionRange(newCursorPos, newCursorPos);
    }

    handleInput();
  }

  // Keyboard shortcuts
  document.addEventListener('keydown', function(event) {
    // Don't trigger shortcuts when user is typing in an input field
    if (event.target.tagName === 'INPUT' && event.target.type === 'text') return;

    if (event.ctrlKey || event.metaKey) {
      switch (event.key.toLowerCase()) {
        case 'b':
          if (!event.shiftKey) {
            event.preventDefault();
            handleToolbarAction('bold');
          }
          break;
        case 'i':
          event.preventDefault();
          handleToolbarAction('italic');
          break;
        case 'k':
          event.preventDefault();
          handleToolbarAction('link');
          break;
        case 'h':
          event.preventDefault();
          handleToolbarAction('heading');
          break;
        case 's':
          if (event.shiftKey) {
            event.preventDefault();
            forceUpdatePreview();
          }
          break;
      }
    }
  });

  // Escape key to close panels
  document.addEventListener('keydown', function(event) {
    if (event.key === 'Escape') {
      if (cheatsheet.classList.contains('show')) {
        toggleCheatsheet();
      }
      if (settingsPanel.classList.contains('show')) {
        toggleSettings();
      }
      if (toast.classList.contains('show')) {
        hideToast();
      }
    }
  });

  // Initialize the app when the DOM is ready
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', init);
  } else {
    init();
  }
</script>
<script src="../logo.js"></script>
</body>
</html>