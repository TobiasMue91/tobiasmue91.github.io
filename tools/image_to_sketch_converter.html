<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sketch Studio - Image to Sketch Converter</title>
    <style>
        :root {
            --primary-color: #3b82f6;
            --primary-hover: #2563eb;
            --primary-light: rgba(59, 130, 246, 0.1);
            --bg-color: #f8fafc;
            --card-bg: #ffffff;
            --text-color: #1e293b;
            --text-muted: #64748b;
            --border-color: #e2e8f0;
            --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
            --radius: 0.5rem;
            --radius-sm: 0.25rem;
            --transition: all 0.2s ease;
            --tooltip-bg: #334155;
            --tooltip-color: #f8fafc;
            --success-color: #10b981;
            --error-color: #ef4444;
            --warning-color: #f59e0b;
        }
        [data-theme="dark"] {
            --primary-color: #4f46e5;
            --primary-hover: #6366f1;
            --primary-light: rgba(79, 70, 229, 0.1);
            --bg-color: #1e293b;
            --card-bg: #0f172a;
            --text-color: #f1f5f9;
            --text-muted: #94a3b8;
            --border-color: #334155;
            --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.3), 0 2px 4px -1px rgba(0, 0, 0, 0.2);
            --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.2);
            --tooltip-bg: #f8fafc;
            --tooltip-color: #1e293b;
        }
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            line-height: 1.5;
            transition: var(--transition);
            min-height: 100vh;
            padding: 1.5rem;
        }
        header {
            max-width: 1200px;
            margin: 0 auto 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 1rem;
        }
        .logo-container {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }
        .logo {
            color: var(--primary-color);
            font-size: 1.75rem;
        }
        h1 {
            font-size: 1.75rem;
            font-weight: 700;
        }
        .header-actions {
            display: flex;
            gap: 1rem;
            align-items: center;
        }
        .theme-toggle {
            background: none;
            border: none;
            color: var(--text-color);
            font-size: 1.5rem;
            cursor: pointer;
            transition: var(--transition);
            padding: 0.25rem;
            border-radius: var(--radius-sm);
            position: relative;
        }
        .theme-toggle:hover {
            background-color: var(--primary-light);
            color: var(--primary-color);
        }
        .theme-toggle:focus {
            outline: 2px solid var(--primary-color);
            outline-offset: 2px;
        }
        .tooltip {
            position: relative;
        }
        .tooltip:hover::after {
            content: attr(data-tooltip);
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            white-space: nowrap;
            background-color: var(--tooltip-bg);
            color: var(--tooltip-color);
            padding: 0.25rem 0.5rem;
            border-radius: var(--radius-sm);
            font-size: 0.75rem;
            margin-bottom: 0.5rem;
            z-index: 10;
            box-shadow: var(--shadow-sm);
        }
        main {
            max-width: 1200px;
            margin: 0 auto;
        }
        .app-container {
            display: grid;
            grid-template-columns: 1fr;
            gap: 1.5rem;
        }
        @media (min-width: 768px) {
            .app-container {
                grid-template-columns: 300px 1fr;
            }
        }
        .controls {
            background-color: var(--card-bg);
            border-radius: var(--radius);
            padding: 1.5rem;
            box-shadow: var(--shadow);
            height: fit-content;
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
        }
        .control-group {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
        }
        .control-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .control-header .info-icon {
            color: var(--text-muted);
            cursor: help;
            font-size: 0.875rem;
        }
        .control-label {
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        .slider-container {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }
        .slider-row {
            display: flex;
            align-items: center;
            gap: 1rem;
        }
        input[type="range"] {
            flex: 1;
            -webkit-appearance: none;
            appearance: none;
            height: 0.5rem;
            background: var(--border-color);
            border-radius: 0.25rem;
            transition: var(--transition);
        }
        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 1rem;
            height: 1rem;
            border-radius: 50%;
            background: var(--primary-color);
            cursor: pointer;
            transition: var(--transition);
        }
        input[type="range"]:focus {
            outline: none;
        }
        input[type="range"]::-webkit-slider-thumb:hover {
            background: var(--primary-hover);
            transform: scale(1.2);
        }
        input[type="range"]::-moz-range-thumb {
            width: 1rem;
            height: 1rem;
            border-radius: 50%;
            background: var(--primary-color);
            cursor: pointer;
            transition: var(--transition);
            border: none;
        }
        input[type="range"]::-moz-range-thumb:hover {
            background: var(--primary-hover);
            transform: scale(1.2);
        }
        .slider-value {
            width: 2.5rem;
            text-align: center;
            font-variant-numeric: tabular-nums;
        }
        .file-input-container {
            position: relative;
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
        }
        .file-drop-area {
            border: 2px dashed var(--border-color);
            border-radius: var(--radius);
            padding: 2rem 1rem;
            text-align: center;
            cursor: pointer;
            transition: var(--transition);
        }
        .file-drop-area.drag-over {
            border-color: var(--primary-color);
            background-color: var(--primary-light);
        }
        .file-drop-area p {
            margin-top: 0.5rem;
            color: var(--text-muted);
            font-size: 0.875rem;
        }
        .file-icon {
            font-size: 2rem;
            color: var(--text-muted);
        }
        input[type="file"] {
            position: absolute;
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
            opacity: 0;
            cursor: pointer;
        }
        .style-options {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 0.5rem;
        }
        .style-option {
            border: 1px solid var(--border-color);
            border-radius: var(--radius);
            padding: 0.75rem 0.5rem;
            display: flex;
            flex-direction: column;
            align-items: center;
            cursor: pointer;
            transition: var(--transition);
        }
        .style-option.active {
            border-color: var(--primary-color);
            background-color: var(--primary-light);
        }
        .style-option:hover:not(.active) {
            border-color: var(--primary-color);
        }
        .style-option:focus {
            outline: 2px solid var(--primary-color);
            outline-offset: 2px;
        }
        .style-icon {
            font-size: 1.5rem;
            margin-bottom: 0.5rem;
            color: var(--text-color);
        }
        .style-option.active .style-icon {
            color: var(--primary-color);
        }
        .style-name {
            font-size: 0.75rem;
            text-align: center;
        }
        .advanced-options-toggle {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            background: none;
            border: none;
            color: var(--text-color);
            font-size: 0.875rem;
            cursor: pointer;
            padding: 0.5rem;
            border-radius: var(--radius-sm);
            transition: var(--transition);
            width: 100%;
            text-align: left;
        }
        .advanced-options-toggle:hover {
            background-color: var(--primary-light);
        }
        .advanced-options-toggle .icon {
            transition: var(--transition);
        }
        .advanced-options-toggle[aria-expanded="true"] .icon {
            transform: rotate(180deg);
        }
        .advanced-options {
            display: none;
            padding-top: 0.5rem;
        }
        .advanced-options.visible {
            display: block;
        }
        button {
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: var(--radius);
            padding: 0.75rem 1rem;
            font-weight: 500;
            cursor: pointer;
            transition: var(--transition);
            width: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 0.5rem;
        }
        button:disabled {
            opacity: 0.7;
            cursor: not-allowed;
        }
        button:not(:disabled):hover {
            background-color: var(--primary-hover);
        }
        button:focus {
            outline: 2px solid var(--primary-color);
            outline-offset: 2px;
        }
        .btn-secondary {
            background-color: transparent;
            color: var(--text-color);
            border: 1px solid var(--border-color);
        }
        .btn-secondary:not(:disabled):hover {
            background-color: var(--primary-light);
            color: var(--primary-color);
            border-color: var(--primary-color);
        }
        .image-container {
            display: grid;
            grid-template-columns: 1fr;
            gap: 1.5rem;
        }
        @media (min-width: 992px) {
            .image-container {
                grid-template-columns: repeat(2, 1fr);
            }
        }
        .image-panel {
            background-color: var(--card-bg);
            border-radius: var(--radius);
            padding: 1rem;
            box-shadow: var(--shadow);
            display: flex;
            flex-direction: column;
            position: relative;
        }
        .panel-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
            padding-bottom: 0.5rem;
            border-bottom: 1px solid var(--border-color);
        }
        .panel-title {
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        .panel-body {
            flex: 1;
            display: flex;
            justify-content: center;
            align-items: center;
            background-color: rgba(0, 0, 0, 0.025);
            border-radius: var(--radius);
            padding: 1rem;
            min-height: 300px;
            position: relative;
            overflow: hidden;
        }
        [data-theme="dark"] .panel-body {
            background-color: rgba(255, 255, 255, 0.025);
        }
        .no-image {
            color: var(--text-muted);
            text-align: center;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 0.75rem;
        }
        .image-preview {
            max-width: 100%;
            max-height: 100%;
            object-fit: contain;
        }
        .panel-footer {
            margin-top: 1rem;
            display: flex;
            gap: 0.5rem;
        }
        .btn-sm {
            padding: 0.5rem 0.75rem;
            font-size: 0.875rem;
            width: auto;
        }
        .loading-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            gap: 1rem;
            color: white;
            border-radius: var(--radius);
            display: none;
            z-index: 5;
        }
        .loading-overlay.active {
            display: flex;
        }
        .spinner {
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top: 3px solid white;
            width: 2rem;
            height: 2rem;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .loading-text {
            font-size: 0.875rem;
        }
        .notification {
            position: fixed;
            bottom: 1.5rem;
            right: 1.5rem;
            background-color: var(--card-bg);
            color: var(--text-color);
            padding: 1rem;
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            display: flex;
            align-items: center;
            gap: 0.75rem;
            max-width: 24rem;
            transform: translateY(200%);
            transition: transform 0.3s ease;
            z-index: 100;
        }
        .notification.show {
            transform: translateY(0);
        }
        .notification.success {
            border-left: 4px solid var(--success-color);
        }
        .notification.error {
            border-left: 4px solid var(--error-color);
        }
        .notification.warning {
            border-left: 4px solid var(--warning-color);
        }
        .notification-icon {
            font-size: 1.5rem;
        }
        .notification.success .notification-icon {
            color: var(--success-color);
        }
        .notification.error .notification-icon {
            color: var(--error-color);
        }
        .notification.warning .notification-icon {
            color: var(--warning-color);
        }
        .notification-content {
            flex: 1;
        }
        .notification-title {
            font-weight: 600;
            margin-bottom: 0.25rem;
        }
        .notification-message {
            font-size: 0.875rem;
        }
        .notification-close {
            background: none;
            border: none;
            color: var(--text-muted);
            cursor: pointer;
            padding: 0.25rem;
            width: auto;
        }
        .notification-close:hover {
            color: var(--text-color);
        }
        .divider {
            height: 1px;
            background-color: var(--border-color);
            margin: 0.25rem 0 0.75rem;
        }
        .info-text {
            font-size: 0.75rem;
            color: var(--text-muted);
            line-height: 1.4;
        }
        footer {
            max-width: 1200px;
            margin: 2rem auto 0;
            text-align: center;
            color: var(--text-muted);
            font-size: 0.875rem;
            padding-top: 1.5rem;
            border-top: 1px solid var(--border-color);
        }
        /* Additional styles for improved sketch styles */
        .sketch-filter-options {
            display: flex;
            gap: 0.5rem;
            margin-top: 0.5rem;
        }
        .sketch-filter {
            flex: 1;
            padding: 0.25rem 0.5rem;
            font-size: 0.75rem;
            background-color: transparent;
            border: 1px solid var(--border-color);
            border-radius: var(--radius-sm);
            text-align: center;
            cursor: pointer;
            transition: var(--transition);
        }
        .sketch-filter.active {
            background-color: var(--primary-light);
            border-color: var(--primary-color);
            color: var(--primary-color);
        }
        .sketch-filter:hover:not(.active) {
            border-color: var(--primary-color);
        }
        .separator {
            height: 1px;
            background-color: var(--border-color);
            margin: 0.5rem 0;
        }
        /* Image comparison slider */
        .comparison-container {
            position: relative;
            width: 100%;
            height: 100%;
            overflow: hidden;
        }
        .comparison-before,
        .comparison-after {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
        }
        .comparison-before {
            z-index: 1;
            width: 50%;
        }
        .comparison-after {
            z-index: 0;
        }
        .comparison-slider {
            position: absolute;
            z-index: 3;
            width: 4px;
            height: 100%;
            background-color: var(--primary-color);
            left: 50%;
            transform: translateX(-50%);
            cursor: ew-resize;
        }
        .comparison-slider::before,
        .comparison-slider::after {
            content: "";
            position: absolute;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background-color: var(--primary-color);
            top: 50%;
            transform: translate(-50%, -50%);
            box-shadow: var(--shadow);
        }
        .comparison-slider::before {
            left: 0;
        }
        .comparison-slider::after {
            left: 100%;
        }
        .comparison-label {
            position: absolute;
            background-color: var(--primary-color);
            color: white;
            padding: 0.25rem 0.5rem;
            border-radius: var(--radius-sm);
            font-size: 0.75rem;
            top: 1rem;
            transform: translateX(-50%);
            z-index: 4;
        }
        .comparison-label.label-before {
            left: 25%;
        }
        .comparison-label.label-after {
            left: 75%;
        }
        /* Image zoom controls */
        .zoom-controls {
            position: absolute;
            bottom: 1rem;
            right: 1rem;
            display: flex;
            gap: 0.5rem;
            z-index: 5;
        }
        .zoom-btn {
            background-color: var(--card-bg);
            color: var(--text-color);
            border: 1px solid var(--border-color);
            width: 2rem;
            height: 2rem;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            transition: var(--transition);
            box-shadow: var(--shadow-sm);
        }
        .zoom-btn:hover {
            background-color: var(--primary-light);
            color: var(--primary-color);
            border-color: var(--primary-color);
        }
        .zoom-btn svg {
            flex-shrink: 0;
        }
    </style>
</head>
<body>
<header>
    <div class="logo-container">
        <div class="logo">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 20h9"></path><path d="M16.5 3.5a2.121 2.121 0 0 1 3 3L7 19l-4 1 1-4L16.5 3.5z"></path></svg>
        </div>
        <h1>Sketch Studio</h1>
    </div>
    <div class="header-actions">
        <button id="theme-toggle" class="theme-toggle tooltip" data-tooltip="Toggle dark mode" aria-label="Toggle dark mode">
            <svg id="theme-icon" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path></svg>
        </button>
    </div>
</header>

<main>
    <div class="app-container">
        <div class="controls">
            <div class="control-group">
                <div class="control-header">
                    <label class="control-label" for="image-input">Upload Image</label>
                    <span class="info-icon tooltip" data-tooltip="JPG, PNG or GIF up to 10MB">
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="16" x2="12" y2="12"></line><line x1="12" y1="8" x2="12.01" y2="8"></line></svg>
            </span>
                </div>
                <div class="file-input-container">
                    <div id="drop-area" class="file-drop-area">
                        <div class="file-icon">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect><circle cx="8.5" cy="8.5" r="1.5"></circle><polyline points="21 15 16 10 5 21"></polyline></svg>
                        </div>
                        <div>Drag & drop or click to browse</div>
                        <p>JPG, PNG, GIF up to 10MB</p>
                    </div>
                    <input type="file" id="image-input" accept="image/*">
                </div>
            </div>

            <div class="control-group">
                <label class="control-label">Sketch Style</label>
                <div class="style-options">
                    <div class="style-option active" data-style="outline" tabindex="0">
                        <div class="style-icon">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 19l7-7 3 3-7 7-3-3z"></path><path d="M18 13l-1.5-7.5L2 2l3.5 14.5L13 18l5-5z"></path><path d="M2 2l7.586 7.586"></path><circle cx="11" cy="11" r="2"></circle></svg>
                        </div>
                        <div class="style-name">Outline</div>
                    </div>
                    <div class="style-option" data-style="pencil" tabindex="0">
                        <div class="style-icon">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 20h9"></path><path d="M16.5 3.5a2.121 2.121 0 0 1 3 3L7 19l-4 1 1-4L16.5 3.5z"></path></svg>
                        </div>
                        <div class="style-name">Pencil</div>
                    </div>
                    <div class="style-option" data-style="hatching" tabindex="0">
                        <div class="style-icon">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="18" x2="21" y2="18"></line></svg>
                        </div>
                        <div class="style-name">Hatching</div>
                    </div>
                    <div class="style-option" data-style="charcoal" tabindex="0">
                        <div class="style-icon">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 2l4 4"></path><path d="M17 11l.01-.01"></path><path d="M7 21l4-4"></path><path d="M3 7l4 4"></path><path d="M13 7l-4 4"></path></svg>
                        </div>
                        <div class="style-name">Charcoal</div>
                    </div>
                </div>

                <div id="sketch-filter-container" class="sketch-filter-options" style="display: none;">
                    <div class="sketch-filter active" data-filter="none">None</div>
                    <div class="sketch-filter" data-filter="aged">Aged</div>
                    <div class="sketch-filter" data-filter="textured">Textured</div>
                </div>
            </div>

            <div class="control-group">
                <div class="control-header">
                    <label class="control-label" for="stroke-range">Stroke Intensity</label>
                    <span class="info-icon tooltip" data-tooltip="Controls how dark the sketch lines appear">
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="16" x2="12" y2="12"></line><line x1="12" y1="8" x2="12.01" y2="8"></line></svg>
            </span>
                </div>
                <div class="slider-container">
                    <div class="slider-row">
                        <input type="range" id="stroke-range" min="0" max="100" value="80" class="form-range">
                        <span id="stroke-value" class="slider-value">80</span>
                    </div>
                </div>
            </div>

            <div class="control-group">
                <div class="control-header">
                    <label class="control-label" for="contrast-range">Contrast</label>
                    <span class="info-icon tooltip" data-tooltip="Adjusts the contrast between light and dark areas">
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="16" x2="12" y2="12"></line><line x1="12" y1="8" x2="12.01" y2="8"></line></svg>
            </span>
                </div>
                <div class="slider-container">
                    <div class="slider-row">
                        <input type="range" id="contrast-range" min="0" max="200" value="100" class="form-range">
                        <span id="contrast-value" class="slider-value">100</span>
                    </div>
                </div>
            </div>

            <button id="advanced-toggle" class="advanced-options-toggle" aria-expanded="false">
                <svg class="icon" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="6 9 12 15 18 9"></polyline></svg>
                Advanced Options
            </button>

            <div id="advanced-options" class="advanced-options">
                <div class="control-group">
                    <div class="control-header">
                        <label class="control-label" for="detail-range">Edge Detection</label>
                        <span class="info-icon tooltip" data-tooltip="Higher values detect more details and finer edges">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="16" x2="12" y2="12"></line><line x1="12" y1="8" x2="12.01" y2="8"></line></svg>
              </span>
                    </div>
                    <div class="slider-container">
                        <div class="slider-row">
                            <input type="range" id="detail-range" min="0" max="100" value="50" class="form-range">
                            <span id="detail-value" class="slider-value">50</span>
                        </div>
                    </div>
                </div>

                <div class="control-group">
                    <div class="control-header">
                        <label class="control-label" for="noise-range">Texture</label>
                        <span class="info-icon tooltip" data-tooltip="Adds randomness to simulate sketch texture">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="16" x2="12" y2="12"></line><line x1="12" y1="8" x2="12.01" y2="8"></line></svg>
              </span>
                    </div>
                    <div class="slider-container">
                        <div class="slider-row">
                            <input type="range" id="noise-range" min="0" max="100" value="20" class="form-range">
                            <span id="noise-value" class="slider-value">20</span>
                        </div>
                    </div>
                </div>

                <div class="control-group">
                    <div class="control-header">
                        <label class="control-label" for="smoothing-range">Smoothing</label>
                        <span class="info-icon tooltip" data-tooltip="Reduces noise and smooths out the sketch lines">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="16" x2="12" y2="12"></line><line x1="12" y1="8" x2="12.01" y2="8"></line></svg>
              </span>
                    </div>
                    <div class="slider-container">
                        <div class="slider-row">
                            <input type="range" id="smoothing-range" min="0" max="100" value="30" class="form-range">
                            <span id="smoothing-value" class="slider-value">30</span>
                        </div>
                    </div>
                </div>

                <div class="divider"></div>
                <p class="info-text">These advanced settings give you more control over the sketch quality and appearance. Experiment with different combinations for unique results.</p>
            </div>

            <div class="control-group">
                <button id="convert-btn" disabled>
                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 20h9"></path><path d="M16.5 3.5a2.121 2.121 0 0 1 3 3L7 19l-4 1 1-4L16.5 3.5z"></path></svg>
                    Convert to Sketch
                </button>
            </div>

            <div class="control-group">
                <button id="reset-btn" class="btn-secondary" disabled>
                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 2v6h6"></path><path d="M21 12A9 9 0 0 0 6 5.3L3 8"></path><path d="M21 22v-6h-6"></path><path d="M3 12a9 9 0 0 0 15 6.7l3-2.7"></path></svg>
                    Reset
                </button>
            </div>
        </div>

        <div class="image-container">
            <div class="image-panel">
                <div class="panel-header">
                    <div class="panel-title">
                        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect><circle cx="8.5" cy="8.5" r="1.5"></circle><polyline points="21 15 16 10 5 21"></polyline></svg>
                        Original Image
                    </div>
                </div>
                <div class="panel-body" id="original-container">
                    <div class="no-image" id="no-original">
                        <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect><circle cx="8.5" cy="8.5" r="1.5"></circle><polyline points="21 15 16 10 5 21"></polyline></svg>
                        <p>No image uploaded</p>
                    </div>
                    <img id="original-image" class="image-preview" style="display: none;">
                    <div class="zoom-controls">
                        <button id="zoom-out-btn" class="zoom-btn" disabled>
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line><line x1="8" y1="11" x2="14" y2="11"></line></svg>
                        </button>
                        <button id="zoom-reset-btn" class="zoom-btn" disabled>
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line></svg>
                        </button>
                        <button id="zoom-in-btn" class="zoom-btn" disabled>
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line><line x1="11" y1="8" x2="11" y2="14"></line><line x1="8" y1="11" x2="14" y2="11"></line></svg>
                        </button>
                    </div>
                </div>
            </div>

            <div class="image-panel">
                <div class="panel-header">
                    <div class="panel-title">
                        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 20h9"></path><path d="M16.5 3.5a2.121 2.121 0 0 1 3 3L7 19l-4 1 1-4L16.5 3.5z"></path></svg>
                        Sketch Result
                    </div>
                </div>
                <div class="panel-body" id="sketch-container">
                    <div class="no-image" id="no-sketch">
                        <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1" stroke-linecap="round" stroke-linejoin="round"><path d="M12 20h9"></path><path d="M16.5 3.5a2.121 2.121 0 0 1 3 3L7 19l-4 1 1-4L16.5 3.5z"></path></svg>
                        <p>Sketch will appear here</p>
                    </div>
                    <img id="sketch-image" class="image-preview" style="display: none;">
                    <div id="comparison-view" style="display: none; width: 100%; height: 100%;">
                        <div class="comparison-container">
                            <div class="comparison-before">
                                <img id="comparison-original" class="image-preview">
                            </div>
                            <div class="comparison-after">
                                <img id="comparison-sketch" class="image-preview">
                            </div>
                            <div class="comparison-slider" id="comparison-slider"></div>
                            <div class="comparison-label label-before">Original</div>
                            <div class="comparison-label label-after">Sketch</div>
                        </div>
                    </div>
                    <div class="loading-overlay" id="loading-overlay">
                        <div class="spinner"></div>
                        <div class="loading-text">Converting to sketch...</div>
                    </div>
                    <div class="zoom-controls">
                        <button id="zoom-out-sketch-btn" class="zoom-btn" disabled>
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line><line x1="8" y1="11" x2="14" y2="11"></line></svg>
                        </button>
                        <button id="zoom-reset-sketch-btn" class="zoom-btn" disabled>
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line></svg>
                        </button>
                        <button id="zoom-in-sketch-btn" class="zoom-btn" disabled>
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line><line x1="11" y1="8" x2="11" y2="14"></line><line x1="8" y1="11" x2="14" y2="11"></line></svg>
                        </button>
                    </div>
                </div>
                <div class="panel-footer">
                    <button id="download-btn" class="btn-sm" disabled>
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path><polyline points="7 10 12 15 17 10"></polyline><line x1="12" y1="15" x2="12" y2="3"></line></svg>
                        Download
                    </button>
                    <button id="copy-btn" class="btn-sm" disabled>
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path></svg>
                        Copy
                    </button>
                </div>
            </div>
        </div>
    </div>
</main>

<div id="notification" class="notification">
    <div class="notification-icon">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path><polyline points="22 4 12 14.01 9 11.01"></polyline></svg>
    </div>
    <div class="notification-content">
        <div class="notification-title" id="notification-title">Success</div>
        <div class="notification-message" id="notification-message">Operation completed successfully.</div>
    </div>
    <button class="notification-close" id="notification-close">
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
    </button>
</div>

<footer>
    <p>Sketch Studio - All processing happens locally in your browser</p>
</footer>

<script>
    // Web Worker for image processing
    const workerCode = `
      self.onmessage = function(e) {
        const {
          imageData,
          strokeIntensity,
          contrast,
          style,
          detailLevel,
          noiseLevel,
          smoothingLevel,
          filter
        } = e.data;

        // Create a copy of the image data
        const processedData = new Uint8ClampedArray(imageData.data);
        const width = imageData.width;
        const height = imageData.height;

        // Convert to grayscale
        for (let i = 0; i < processedData.length; i += 4) {
          const r = processedData[i];
          const g = processedData[i + 1];
          const b = processedData[i + 2];

          // Grayscale using luminance method
          const gray = 0.299 * r + 0.587 * g + 0.114 * b;
          processedData[i] = processedData[i + 1] = processedData[i + 2] = gray;
        }

        // Apply smoothing (Gaussian blur approximation)
        if (smoothingLevel > 0) {
          const tempData = new Uint8ClampedArray(processedData);
          const smoothRadius = Math.max(1, Math.floor(smoothingLevel / 20));

          for (let y = 0; y < height; y++) {
            for (let x = 0; x < width; x++) {
              let r = 0, g = 0, b = 0, count = 0;

              for (let ky = -smoothRadius; ky <= smoothRadius; ky++) {
                const py = y + ky;
                if (py < 0 || py >= height) continue;

                for (let kx = -smoothRadius; kx <= smoothRadius; kx++) {
                  const px = x + kx;
                  if (px < 0 || px >= width) continue;

                  const idx = (py * width + px) * 4;
                  r += tempData[idx];
                  g += tempData[idx + 1];
                  b += tempData[idx + 2];
                  count++;
                }
              }

              const idx = (y * width + x) * 4;
              processedData[idx] = r / count;
              processedData[idx + 1] = g / count;
              processedData[idx + 2] = b / count;
            }
          }
        }

        // Apply edge detection
        const edgeData = new Uint8ClampedArray(processedData.length);

        // Adjust detection sensitivity based on detail level (higher detail = more sensitivity)
        const detailFactor = 1 + (detailLevel / 50); // 0-100 maps to 1-3

        // Style-specific parameters
        let edgeThreshold = 30 * (1 - strokeIntensity / 100); // Inverted so higher intensity = lower threshold
        let maxMagnitude = 255;

        // Different edge detection approaches based on style
        switch (style) {
          case 'outline':
            // Standard Sobel edge detection
            for (let y = 1; y < height - 1; y++) {
              for (let x = 1; x < width - 1; x++) {
                const idx = (y * width + x) * 4;

                // Sobel operators
                const gx =
                  -1 * processedData[((y-1) * width + (x-1)) * 4] +
                  -2 * processedData[((y) * width + (x-1)) * 4] +
                  -1 * processedData[((y+1) * width + (x-1)) * 4] +
                  1 * processedData[((y-1) * width + (x+1)) * 4] +
                  2 * processedData[((y) * width + (x+1)) * 4] +
                  1 * processedData[((y+1) * width + (x+1)) * 4];

                const gy =
                  -1 * processedData[((y-1) * width + (x-1)) * 4] +
                  -2 * processedData[((y-1) * width + (x)) * 4] +
                  -1 * processedData[((y-1) * width + (x+1)) * 4] +
                  1 * processedData[((y+1) * width + (x-1)) * 4] +
                  2 * processedData[((y+1) * width + (x)) * 4] +
                  1 * processedData[((y+1) * width + (x+1)) * 4];

                // Gradient magnitude with detail factor
                let magnitude = Math.sqrt(gx * gx + gy * gy) * detailFactor;

                // Apply threshold (makes edges crisper)
                magnitude = magnitude < edgeThreshold ? 0 : magnitude;

                // Adjust contrast
                magnitude = magnitude * (contrast / 100);

                // Invert for sketch effect (white lines on black background)
                let sketchValue = 255 - Math.min(255, magnitude);

                // Add noise based on noise level
                if (noiseLevel > 0) {
                  const noise = (Math.random() - 0.5) * noiseLevel;
                  sketchValue = Math.max(0, Math.min(255, sketchValue + noise));
                }

                edgeData[idx] = edgeData[idx + 1] = edgeData[idx + 2] = sketchValue;
                edgeData[idx + 3] = 255; // Alpha
              }
            }
            break;

          case 'pencil':
            // Pencil style uses a combination of edges and texturing
            for (let y = 1; y < height - 1; y++) {
              for (let x = 1; x < width - 1; x++) {
                const idx = (y * width + x) * 4;

                // Sobel operators for edge detection
                const gx =
                  -1 * processedData[((y-1) * width + (x-1)) * 4] +
                  -2 * processedData[((y) * width + (x-1)) * 4] +
                  -1 * processedData[((y+1) * width + (x-1)) * 4] +
                  1 * processedData[((y-1) * width + (x+1)) * 4] +
                  2 * processedData[((y) * width + (x+1)) * 4] +
                  1 * processedData[((y+1) * width + (x+1)) * 4];

                const gy =
                  -1 * processedData[((y-1) * width + (x-1)) * 4] +
                  -2 * processedData[((y-1) * width + (x)) * 4] +
                  -1 * processedData[((y-1) * width + (x+1)) * 4] +
                  1 * processedData[((y+1) * width + (x-1)) * 4] +
                  2 * processedData[((y+1) * width + (x)) * 4] +
                  1 * processedData[((y+1) * width + (x+1)) * 4];

                // Calculate gradient magnitude with detail factor
                let magnitude = Math.sqrt(gx * gx + gy * gy) * detailFactor;

                // Apply threshold and contrast
                magnitude = magnitude < edgeThreshold ? 0 : magnitude;
                magnitude = magnitude * (contrast / 100);

                // Get original pixel brightness (inverted)
                const brightness = 255 - processedData[idx];

                // Blend edge detection with original brightness for pencil effect
                const blendFactor = 0.7; // How much to blend in the original image
                let sketchValue = 255 - (magnitude * (1 - blendFactor) + brightness * blendFactor);

                // Add directional texture for pencil effect
                const angle = Math.atan2(gy, gx);
                const strokeNoise = Math.sin(angle * 10) * 15 * (noiseLevel / 100);

                sketchValue = Math.max(0, Math.min(255, sketchValue + strokeNoise));

                edgeData[idx] = edgeData[idx + 1] = edgeData[idx + 2] = sketchValue;
                edgeData[idx + 3] = 255; // Alpha
              }
            }
            break;

          case 'hatching':
            // Hatching style uses directional lines based on brightness
            for (let y = 0; y < height; y++) {
              for (let x = 0; x < width; x++) {
                const idx = (y * width + x) * 4;

                // Get pixel brightness (0-255)
                const brightness = processedData[idx];

                // Calculate how many layers of hatching to apply based on brightness
                // Darker areas get more hatching layers
                const normalizedBrightness = brightness / 255;
                let hatchValue = 255; // Start with white

                // Apply hatching patterns based on brightness
                // Each pattern is conditionally applied to create layered hatching effect

                // First layer of hatching (diagonal lines /)
                if (normalizedBrightness < 0.8) {
                  if ((x + y) % 8 < 2 * (strokeIntensity / 100)) {
                    hatchValue = 200;
                  }
                }

                // Second layer of hatching (diagonal lines \)
                if (normalizedBrightness < 0.6) {
                  if ((x - y + width) % 8 < 2 * (strokeIntensity / 100)) {
                    hatchValue = 160;
                  }
                }

                // Third layer of hatching (horizontal lines -)
                if (normalizedBrightness < 0.4) {
                  if (y % 4 < 1 * (strokeIntensity / 100)) {
                    hatchValue = 120;
                  }
                }

                // Fourth layer of hatching (vertical lines |)
                if (normalizedBrightness < 0.2) {
                  if (x % 4 < 1 * (strokeIntensity / 100)) {
                    hatchValue = 80;
                  }
                }

                // Add noise for texture
                const noise = ((Math.random() - 0.5) * noiseLevel) / 2;
                hatchValue = Math.max(0, Math.min(255, hatchValue + noise));

                // Apply contrast adjustment
                hatchValue = 255 - ((255 - hatchValue) * (contrast / 100));

                edgeData[idx] = edgeData[idx + 1] = edgeData[idx + 2] = hatchValue;
                edgeData[idx + 3] = 255; // Alpha
              }
            }
            break;

          case 'charcoal':
            // Charcoal style uses soft edges with a more organic, smudged look
            // First, perform edge detection
            for (let y = 1; y < height - 1; y++) {
              for (let x = 1; x < width - 1; x++) {
                const idx = (y * width + x) * 4;

                // Modified Sobel operators for softer edges
                const gx =
                  -1 * processedData[((y-1) * width + (x-1)) * 4] +
                  -1 * processedData[((y) * width + (x-1)) * 4] +
                  -1 * processedData[((y+1) * width + (x-1)) * 4] +
                  1 * processedData[((y-1) * width + (x+1)) * 4] +
                  1 * processedData[((y) * width + (x+1)) * 4] +
                  1 * processedData[((y+1) * width + (x+1)) * 4];

                const gy =
                  -1 * processedData[((y-1) * width + (x-1)) * 4] +
                  -1 * processedData[((y-1) * width + (x)) * 4] +
                  -1 * processedData[((y-1) * width + (x+1)) * 4] +
                  1 * processedData[((y+1) * width + (x-1)) * 4] +
                  1 * processedData[((y+1) * width + (x)) * 4] +
                  1 * processedData[((y+1) * width + (x+1)) * 4];

                // Calculate gradient magnitude with detail factor
                let magnitude = Math.sqrt(gx * gx + gy * gy) * detailFactor;

                // Get original pixel brightness
                const brightness = processedData[idx];

                // Charcoal effect combines edges with tonal values
                let charcoalValue = (brightness * 0.6) + (magnitude * 0.4);

                // Enhance contrast for the charcoal effect
                charcoalValue = 255 - ((255 - charcoalValue) * (contrast / 100));

                // Add grainy texture
                const grainAmount = 30 * (noiseLevel / 100);
                const grain = (Math.random() - 0.5) * grainAmount;

                // Darken based on stroke intensity
                const darkening = (100 - strokeIntensity) * 1.5;

                charcoalValue = Math.max(0, Math.min(255, charcoalValue + grain - darkening));

                edgeData[idx] = edgeData[idx + 1] = edgeData[idx + 2] = charcoalValue;
                edgeData[idx + 3] = 255; // Alpha
              }
            }
            break;
        }

        // Apply post-processing filters
        if (filter !== 'none') {
          switch (filter) {
            case 'aged':
              // Add sepia-like tone and subtle texture for aged paper effect
              for (let i = 0; i < edgeData.length; i += 4) {
                // Sepia tone
                const r = edgeData[i];
                const g = edgeData[i + 1];
                const b = edgeData[i + 2];

                // Convert to sepia tone
                edgeData[i] = Math.min(255, r * 0.95 + 20);  // Slightly more red
                edgeData[i + 1] = Math.min(255, g * 0.85 + 10); // Slightly less green
                edgeData[i + 2] = Math.min(255, b * 0.7);     // Less blue

                // Add random paper texture
                const paperTexture = Math.random() * 10 - 5;
                edgeData[i] = Math.max(0, Math.min(255, edgeData[i] + paperTexture));
                edgeData[i + 1] = Math.max(0, Math.min(255, edgeData[i + 1] + paperTexture));
                edgeData[i + 2] = Math.max(0, Math.min(255, edgeData[i + 2] + paperTexture));
              }
              break;

            case 'textured':
              // Add canvas-like texture
              for (let y = 0; y < height; y++) {
                for (let x = 0; x < width; x++) {
                  const idx = (y * width + x) * 4;

                  // Create texture pattern
                  const patternX = x % 4;
                  const patternY = y % 4;
                  let textureFactor = 0;

                  // Simple canvas-like texture pattern
                  if ((patternX === 0 && patternY === 0) ||
                      (patternX === 2 && patternY === 2)) {
                    textureFactor = -5;
                  } else if ((patternX === 1 && patternY === 1) ||
                           (patternX === 3 && patternY === 3)) {
                    textureFactor = 5;
                  }

                  // Apply texture to color channels
                  edgeData[idx] = Math.max(0, Math.min(255, edgeData[idx] + textureFactor));
                  edgeData[idx + 1] = Math.max(0, Math.min(255, edgeData[idx + 1] + textureFactor));
                  edgeData[idx + 2] = Math.max(0, Math.min(255, edgeData[idx + 2] + textureFactor));
                }
              }
              break;
          }
        }

        self.postMessage({
          processedData: edgeData,
          width: width,
          height: height
        });
      };
    `;

    // Create a blob URL for the worker
    const blob = new Blob([workerCode], {type: 'application/javascript'});
    const workerURL = URL.createObjectURL(blob);
    let worker = null;

    // DOM elements
    const themeToggle = document.getElementById('theme-toggle');
    const themeIcon = document.getElementById('theme-icon');
    const imageInput = document.getElementById('image-input');
    const dropArea = document.getElementById('drop-area');
    const strokeRange = document.getElementById('stroke-range');
    const strokeValue = document.getElementById('stroke-value');
    const detailRange = document.getElementById('detail-range');
    const detailValue = document.getElementById('detail-value');
    const contrastRange = document.getElementById('contrast-range');
    const contrastValue = document.getElementById('contrast-value');
    const noiseRange = document.getElementById('noise-range');
    const noiseValue = document.getElementById('noise-value');
    const smoothingRange = document.getElementById('smoothing-range');
    const smoothingValue = document.getElementById('smoothing-value');
    const convertBtn = document.getElementById('convert-btn');
    const resetBtn = document.getElementById('reset-btn');
    const originalImage = document.getElementById('original-image');
    const sketchImage = document.getElementById('sketch-image');
    const noOriginal = document.getElementById('no-original');
    const noSketch = document.getElementById('no-sketch');
    const loadingOverlay = document.getElementById('loading-overlay');
    const downloadBtn = document.getElementById('download-btn');
    const copyBtn = document.getElementById('copy-btn');
    const styleOptions = document.querySelectorAll('.style-option');
    const advancedToggle = document.getElementById('advanced-toggle');
    const advancedOptions = document.getElementById('advanced-options');
    const notification = document.getElementById('notification');
    const notificationTitle = document.getElementById('notification-title');
    const notificationMessage = document.getElementById('notification-message');
    const notificationClose = document.getElementById('notification-close');
    const comparisonView = document.getElementById('comparison-view');
    const comparisonOriginal = document.getElementById('comparison-original');
    const comparisonSketch = document.getElementById('comparison-sketch');
    const comparisonSlider = document.getElementById('comparison-slider');
    const sketchFilterContainer = document.getElementById('sketch-filter-container');
    const sketchFilters = document.querySelectorAll('.sketch-filter');
    const zoomInBtn = document.getElementById('zoom-in-btn');
    const zoomOutBtn = document.getElementById('zoom-out-btn');
    const zoomResetBtn = document.getElementById('zoom-reset-btn');
    const zoomInSketchBtn = document.getElementById('zoom-in-sketch-btn');
    const zoomOutSketchBtn = document.getElementById('zoom-out-sketch-btn');
    const zoomResetSketchBtn = document.getElementById('zoom-reset-sketch-btn');

    // State variables
    let currentFile = null;
    let currentSketch = null;
    let currentStyle = 'outline';
    let currentFilter = 'none';
    let isComparing = false;
    let zoomLevel = 1;
    let zoomLevelSketch = 1;

    // Theme toggle
    themeToggle.addEventListener('click', () => {
        const isDarkMode = document.body.getAttribute('data-theme') === 'dark';
        if (isDarkMode) {
            document.body.removeAttribute('data-theme');
            themeIcon.innerHTML = '<path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>';
        } else {
            document.body.setAttribute('data-theme', 'dark');
            themeIcon.innerHTML = '<circle cx="12" cy="12" r="5"></circle><line x1="12" y1="1" x2="12" y2="3"></line><line x1="12" y1="21" x2="12" y2="23"></line><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line><line x1="1" y1="12" x2="3" y2="12"></line><line x1="21" y1="12" x2="23" y2="12"></line><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>';
        }
    });

    // Check for user preferred color scheme
    if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.setAttribute('data-theme', 'dark');
        themeIcon.innerHTML = '<circle cx="12" cy="12" r="5"></circle><line x1="12" y1="1" x2="12" y2="3"></line><line x1="12" y1="21" x2="12" y2="23"></line><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line><line x1="1" y1="12" x2="3" y2="12"></line><line x1="21" y1="12" x2="23" y2="12"></line><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>';
    }

    // Advanced options toggle
    advancedToggle.addEventListener('click', () => {
        const isExpanded = advancedToggle.getAttribute('aria-expanded') === 'true';
        advancedToggle.setAttribute('aria-expanded', !isExpanded);
        if (isExpanded) {
            advancedOptions.classList.remove('visible');
        } else {
            advancedOptions.classList.add('visible');
        }
    });

    // Slider updates
    strokeRange.addEventListener('input', () => {
        strokeValue.textContent = strokeRange.value;
    });

    detailRange.addEventListener('input', () => {
        detailValue.textContent = detailRange.value;
    });

    contrastRange.addEventListener('input', () => {
        contrastValue.textContent = contrastRange.value;
    });

    noiseRange.addEventListener('input', () => {
        noiseValue.textContent = noiseRange.value;
    });

    smoothingRange.addEventListener('input', () => {
        smoothingValue.textContent = smoothingRange.value;
    });

    // Style option selection
    styleOptions.forEach(option => {
        option.addEventListener('click', () => {
            styleOptions.forEach(opt => opt.classList.remove('active'));
            option.classList.add('active');
            currentStyle = option.getAttribute('data-style');

            // Show or hide filter options based on style
            if (currentStyle === 'outline' || currentStyle === 'pencil') {
                sketchFilterContainer.style.display = 'flex';
            } else {
                sketchFilterContainer.style.display = 'none';
            }
        });

        // Keyboard accessibility
        option.addEventListener('keydown', (e) => {
            if (e.key === 'Enter' || e.key === ' ') {
                e.preventDefault();
                option.click();
            }
        });
    });

    // Filter option selection
    sketchFilters.forEach(filter => {
        filter.addEventListener('click', () => {
            sketchFilters.forEach(f => f.classList.remove('active'));
            filter.classList.add('active');
            currentFilter = filter.getAttribute('data-filter');
        });
    });

    // File drop handling
    dropArea.addEventListener('dragover', (e) => {
        e.preventDefault();
        dropArea.classList.add('drag-over');
    });

    dropArea.addEventListener('dragleave', () => {
        dropArea.classList.remove('drag-over');
    });

    dropArea.addEventListener('drop', (e) => {
        e.preventDefault();
        dropArea.classList.remove('drag-over');
        if (e.dataTransfer.files.length) {
            handleFile(e.dataTransfer.files[0]);
        }
    });

    // File input change
    imageInput.addEventListener('change', () => {
        if (imageInput.files.length) {
            handleFile(imageInput.files[0]);
        }
    });

    // Notification handling
    function showNotification(type, title, message) {
        notification.className = 'notification show ' + type;
        notificationTitle.textContent = title;
        notificationMessage.textContent = message;

        // Change icon based on type
        const iconContainer = notification.querySelector('.notification-icon');
        let iconSvg = '';

        switch (type) {
            case 'success':
                iconSvg = '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path><polyline points="22 4 12 14.01 9 11.01"></polyline></svg>';
                break;
            case 'error':
                iconSvg = '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><line x1="15" y1="9" x2="9" y2="15"></line><line x1="9" y1="9" x2="15" y2="15"></line></svg>';
                break;
            case 'warning':
                iconSvg = '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"></path><line x1="12" y1="9" x2="12" y2="13"></line><line x1="12" y1="17" x2="12.01" y2="17"></line></svg>';
                break;
        }

        iconContainer.innerHTML = iconSvg;

        // Auto hide after 5 seconds
        setTimeout(() => {
            notification.classList.remove('show');
        }, 5000);
    }

    notificationClose.addEventListener('click', () => {
        notification.classList.remove('show');
    });

    // Handle file selection
    function handleFile(file) {
        if (!file.type.match('image.*')) {
            showNotification('error', 'Invalid File', 'Please select an image file (JPG, PNG, or GIF).');
            return;
        }

        if (file.size > 10 * 1024 * 1024) { // 10MB
            showNotification('error', 'File Too Large', 'Please select an image under 10MB.');
            return;
        }

        currentFile = file;
        convertBtn.disabled = false;

        const reader = new FileReader();
        reader.onload = (e) => {
            originalImage.src = e.target.result;
            originalImage.style.display = 'block';
            noOriginal.style.display = 'none';

            // Enable zoom controls
            zoomInBtn.disabled = false;
            zoomOutBtn.disabled = false;
            zoomResetBtn.disabled = false;

            // Reset sketch view
            sketchImage.style.display = 'none';
            noSketch.style.display = 'block';
            resetBtn.disabled = true;
            downloadBtn.disabled = true;
            copyBtn.disabled = true;
            comparisonView.style.display = 'none';

            // Disable sketch zoom controls
            zoomInSketchBtn.disabled = true;
            zoomOutSketchBtn.disabled = true;
            zoomResetSketchBtn.disabled = true;

            // Reset zoom levels
            zoomLevel = 1;
            zoomLevelSketch = 1;
            applyZoom(originalImage, zoomLevel);

            showNotification('success', 'Image Loaded', 'Image loaded successfully. Click "Convert to Sketch" to process it.');
        };
        reader.readAsDataURL(file);
    }

    // Zoom functionality
    function applyZoom(imgElement, level) {
        imgElement.style.transform = `scale(${level})`;
    }

    zoomInBtn.addEventListener('click', () => {
        zoomLevel = Math.min(5, zoomLevel + 0.25);
        applyZoom(originalImage, zoomLevel);
    });

    zoomOutBtn.addEventListener('click', () => {
        zoomLevel = Math.max(0.5, zoomLevel - 0.25);
        applyZoom(originalImage, zoomLevel);
    });

    zoomResetBtn.addEventListener('click', () => {
        zoomLevel = 1;
        applyZoom(originalImage, zoomLevel);
    });

    zoomInSketchBtn.addEventListener('click', () => {
        zoomLevelSketch = Math.min(5, zoomLevelSketch + 0.25);
        applyZoom(sketchImage, zoomLevelSketch);
    });

    zoomOutSketchBtn.addEventListener('click', () => {
        zoomLevelSketch = Math.max(0.5, zoomLevelSketch - 0.25);
        applyZoom(sketchImage, zoomLevelSketch);
    });

    zoomResetSketchBtn.addEventListener('click', () => {
        zoomLevelSketch = 1;
        applyZoom(sketchImage, zoomLevelSketch);
    });

    // Convert button click
    convertBtn.addEventListener('click', () => {
        if (!currentFile) return;

        // Show loading overlay
        loadingOverlay.classList.add('active');

        // Create or recreate the worker
        if (worker) {
            worker.terminate();
        }
        worker = new Worker(workerURL);

        // Create a temporary image to get dimensions
        const img = new Image();
        img.onload = () => {
            // Create a canvas to extract image data
            const canvas = document.createElement('canvas');

            // Limit dimensions for performance
            let width = img.width;
            let height = img.height;
            const maxDimension = 1200;

            if (width > height && width > maxDimension) {
                height = Math.round(height * maxDimension / width);
                width = maxDimension;
            } else if (height > maxDimension) {
                width = Math.round(width * maxDimension / height);
                height = maxDimension;
            }

            canvas.width = width;
            canvas.height = height;

            const ctx = canvas.getContext('2d');
            ctx.drawImage(img, 0, 0, width, height);

            const imageData = ctx.getImageData(0, 0, width, height);

            // Process the image in the worker
            worker.postMessage({
                imageData: imageData,
                strokeIntensity: parseInt(strokeRange.value),
                contrast: parseInt(contrastRange.value),
                detailLevel: parseInt(detailRange.value),
                noiseLevel: parseInt(noiseRange.value),
                smoothingLevel: parseInt(smoothingRange.value),
                style: currentStyle,
                filter: currentFilter
            });

            // Handle the processed data from the worker
            worker.onmessage = (e) => {
                const { processedData, width, height } = e.data;

                // Create a new ImageData and canvas to display the result
                const processedImageData = new ImageData(
                    processedData,
                    width,
                    height
                );

                // Create a canvas to convert the processed data to an image
                const resultCanvas = document.createElement('canvas');
                resultCanvas.width = width;
                resultCanvas.height = height;

                const resultCtx = resultCanvas.getContext('2d');
                resultCtx.putImageData(processedImageData, 0, 0);

                // Update the sketch image
                sketchImage.src = resultCanvas.toDataURL('image/png');
                sketchImage.style.display = 'block';
                noSketch.style.display = 'none';

                // Save the current sketch
                currentSketch = sketchImage.src;

                // Enable buttons
                downloadBtn.disabled = false;
                copyBtn.disabled = false;
                resetBtn.disabled = false;

                // Enable zoom controls for sketch
                zoomInSketchBtn.disabled = false;
                zoomOutSketchBtn.disabled = false;
                zoomResetSketchBtn.disabled = false;

                // Hide loading overlay
                loadingOverlay.classList.remove('active');

                // Show success notification
                showNotification('success', 'Sketch Created', 'Your sketch has been created successfully!');
            };

            // Handle errors
            worker.onerror = (e) => {
                loadingOverlay.classList.remove('active');
                showNotification('error', 'Processing Error', 'An error occurred while processing your image. Please try again.');
                console.error('Worker error:', e);
            };
        };

        img.onerror = () => {
            loadingOverlay.classList.remove('active');
            showNotification('error', 'Image Error', 'Failed to load the image. Please try another file.');
        };

        img.src = originalImage.src;
    });

    // Download button click
    downloadBtn.addEventListener('click', () => {
        if (!currentSketch) return;

        const link = document.createElement('a');
        link.download = `sketch-${currentStyle}-${new Date().getTime()}.png`;
        link.href = currentSketch;
        link.click();

        showNotification('success', 'Download Started', 'Your sketch is being downloaded.');
    });

    // Copy button click
    copyBtn.addEventListener('click', () => {
        if (!currentSketch) return;

        // Create a temporary canvas to get blob data
        const tempImg = new Image();
        tempImg.onload = async () => {
            const canvas = document.createElement('canvas');
            canvas.width = tempImg.width;
            canvas.height = tempImg.height;
            const ctx = canvas.getContext('2d');
            ctx.drawImage(tempImg, 0, 0);

            try {
                // Get the blob from canvas
                const blob = await new Promise(resolve => canvas.toBlob(resolve, 'image/png'));

                // Copy to clipboard using Clipboard API
                if (navigator.clipboard && navigator.clipboard.write) {
                    const item = new ClipboardItem({ 'image/png': blob });
                    await navigator.clipboard.write([item]);
                    showNotification('success', 'Copied to Clipboard', 'Sketch copied to clipboard successfully.');
                } else {
                    throw new Error('Clipboard API not supported');
                }
            } catch (err) {
                console.error('Failed to copy:', err);
                showNotification('error', 'Copy Failed', 'Your browser does not support clipboard image copying.');
            }
        };
        tempImg.src = currentSketch;
    });

    // Reset button click
    resetBtn.addEventListener('click', () => {
        // Reset controls
        strokeRange.value = 80;
        strokeValue.textContent = 80;

        contrastRange.value = 100;
        contrastValue.textContent = 100;

        detailRange.value = 50;
        detailValue.textContent = 50;

        noiseRange.value = 20;
        noiseValue.textContent = 20;

        smoothingRange.value = 30;
        smoothingValue.textContent = 30;

        // Reset style and filter
        styleOptions.forEach(opt => opt.classList.remove('active'));
        styleOptions[0].classList.add('active');
        currentStyle = 'outline';

        sketchFilters.forEach(f => f.classList.remove('active'));
        sketchFilters[0].classList.add('active');
        currentFilter = 'none';

        // Reset sketch view
        sketchImage.style.display = 'none';
        noSketch.style.display = 'block';
        resetBtn.disabled = true;
        downloadBtn.disabled = true;
        copyBtn.disabled = true;
        comparisonView.style.display = 'none';
        isComparing = false;

        // Disable sketch zoom controls
        zoomInSketchBtn.disabled = true;
        zoomOutSketchBtn.disabled = true;
        zoomResetSketchBtn.disabled = true;

        // Reset zoom levels
        zoomLevelSketch = 1;
        applyZoom(sketchImage, zoomLevelSketch);

        // Show sketch filter container based on style
        sketchFilterContainer.style.display = 'flex';

        showNotification('info', 'Reset Completed', 'All settings have been reset to default values.');
    });

    // Keyboard accessibility
    document.addEventListener('keydown', (e) => {
        // ESC key closes any modals or comparison views
        if (e.key === 'Escape') {
            if (isComparing) {
                isComparing = false;
                sketchImage.style.display = 'block';
                comparisonView.style.display = 'none';
            }

            notification.classList.remove('show');
        }
    });

    // Initialize default state
    window.addEventListener('load', () => {
        // Initialize advanced options as hidden
        advancedOptions.classList.remove('visible');
        advancedToggle.setAttribute('aria-expanded', 'false');

        // Disable buttons until image is loaded
        convertBtn.disabled = true;
        resetBtn.disabled = true;
        downloadBtn.disabled = true;
        copyBtn.disabled = true;

        // Disable zoom controls
        zoomInBtn.disabled = true;
        zoomOutBtn.disabled = true;
        zoomResetBtn.disabled = true;
        zoomInSketchBtn.disabled = true;
        zoomOutSketchBtn.disabled = true;
        zoomResetSketchBtn.disabled = true;
    });
</script>
<script src="../logo.js"></script>
</body>
</html>