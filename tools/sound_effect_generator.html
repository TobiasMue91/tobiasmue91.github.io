<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description"
          content="Create retro game sounds, UI effects, and more with this free online Sound Effect Generator. Features oscillator controls, ADSR envelope, filters, distortion, and WAV export.">
    <meta name="keywords"
          content="sound effect generator, sfx maker, game sounds, retro sounds, audio synthesizer, web audio, wav export, free sound effects, UI sounds, 8-bit sounds">
    <meta name="author" content="Claude Opus 4.5 prompted by Tobias MÃ¼ller">
    <meta name="robots" content="index, follow">
    <link rel="canonical" href="https://www.gptgames.dev/tools/sound_effect_generator.html">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://www.gptgames.dev/tools/sound_effect_generator.html">
    <meta property="og:title" content="Sound Effect Generator - Create Retro Game & UI Sounds">
    <meta property="og:description"
          content="Create retro game sounds, UI effects, and more with this free online Sound Effect Generator.">
    <meta property="og:image" content="https://www.gptgames.dev/screenshots/screenshot_235.webp">
    <meta property="og:image:width" content="1200">
    <meta property="og:image:height" content="630">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="theme-color" content="#6366f1">
    <title>Sound Effect Generator</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box
        }

        :root {
            --bg: #08080f;
            --card: #101018;
            --card-alt: #14141f;
            --accent: #6366f1;
            --accent-hover: #818cf8;
            --cyan: #22d3ee;
            --text: #f1f5f9;
            --text-sec: #94a3b8;
            --muted: #64748b;
            --border: #1e1e2e;
            --border-light: #2a2a3e;
            --success: #22c55e;
            --warning: #eab308;
            --danger: #ef4444
        }

        html {
            font-size: 14px
        }

        body {
            font-family: 'Inter', system-ui, sans-serif;
            background: var(--bg);
            color: var(--text);
            min-height: 100vh;
            line-height: 1.5
        }

        .app {
            max-width: 1280px;
            margin: 0 auto;
            padding: 24px 20px
        }

        header {
            text-align: center;
            padding: 16px 0 28px
        }

        .logo {
            display: inline-flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 8px
        }

        .logo-icon {
            width: 40px;
            height: 40px;
            background: var(--accent);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center
        }

        .logo-icon svg {
            width: 24px;
            height: 24px;
            color: #fff
        }

        header h1 {
            font-size: 1.5rem;
            font-weight: 700;
            letter-spacing: -0.02em
        }

        header p {
            color: var(--muted);
            font-size: 0.85rem;
            margin-top: 2px
        }

        .layout {
            display: grid;
            grid-template-columns:240px 1fr;
            gap: 20px;
            align-items: start
        }

        .sidebar {
            display: flex;
            flex-direction: column;
            gap: 12px;
            position: sticky;
            top: 20px
        }

        .main-content {
            display: flex;
            flex-direction: column;
            gap: 16px
        }

        .card {
            background: var(--card);
            border: 1px solid var(--border);
            border-radius: 14px;
            overflow: hidden
        }

        .card-header {
            padding: 14px 16px 12px;
            border-bottom: 1px solid var(--border);
            display: flex;
            align-items: center;
            gap: 8px
        }

        .card-header svg {
            width: 16px;
            height: 16px;
            color: var(--accent);
            flex-shrink: 0
        }

        .card-title {
            font-size: 0.7rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.08em;
            color: var(--text-sec)
        }

        .card-body {
            padding: 14px 16px 16px
        }

        .preset-grid {
            display: flex;
            flex-direction: column;
            gap: 6px
        }

        .preset-btn {
            width: 100%;
            background: var(--card-alt);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 10px 12px;
            color: var(--text);
            font-size: 0.8rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.15s;
            text-align: left;
            display: flex;
            align-items: center;
            gap: 10px
        }

        .preset-btn svg {
            width: 16px;
            height: 16px;
            flex-shrink: 0;
            color: var(--muted);
            transition: color 0.15s
        }

        .preset-btn span {
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap
        }

        .preset-btn:hover {
            border-color: var(--accent);
            background: #1a1a28
        }

        .preset-btn:hover svg {
            color: var(--accent)
        }

        .preset-btn.active {
            border-color: var(--accent);
            background: var(--accent);
            color: #fff
        }

        .preset-btn.active svg {
            color: #fff
        }

        .visualizer {
            position: relative;
            background: #0a0a12;
            border-radius: 14px;
            overflow: hidden
        }

        .visualizer-header {
            position: absolute;
            top: 12px;
            left: 14px;
            z-index: 2;
            display: flex;
            align-items: center;
            gap: 6px
        }

        .visualizer-label {
            font-size: 0.65rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.08em;
            color: var(--muted)
        }

        .visualizer-dot {
            width: 6px;
            height: 6px;
            border-radius: 50%;
            background: var(--muted);
            transition: background 0.2s
        }

        .visualizer-dot.active {
            background: var(--success);
            box-shadow: 0 0 8px var(--success)
        }

        #waveform {
            width: 100%;
            height: 140px;
            display: block
        }

        .controls-row {
            display: grid;
            grid-template-columns:repeat(2, 1fr);
            gap: 16px
        }

        .param-list {
            display: flex;
            flex-direction: column;
            gap: 14px
        }

        .param-item {
            display: flex;
            flex-direction: column;
            gap: 6px
        }

        .param-header {
            display: flex;
            justify-content: space-between;
            align-items: center
        }

        .param-left {
            display: flex;
            align-items: center;
            gap: 6px
        }

        .param-label {
            font-size: 0.75rem;
            font-weight: 500;
            color: var(--text-sec)
        }

        .param-value {
            font-size: 0.75rem;
            font-weight: 600;
            color: var(--cyan);
            font-variant-numeric: tabular-nums;
            min-width: 55px;
            text-align: right
        }

        .lock-btn {
            width: 18px;
            height: 18px;
            padding: 0;
            background: transparent;
            border: none;
            color: var(--muted);
            cursor: pointer;
            opacity: 0.4;
            transition: all 0.15s;
            display: flex;
            align-items: center;
            justify-content: center
        }

        .lock-btn:hover {
            opacity: 0.8
        }

        .lock-btn.locked {
            opacity: 1;
            color: var(--warning)
        }

        .lock-btn svg {
            width: 12px;
            height: 12px
        }

        input[type="range"] {
            width: 100%;
            height: 6px;
            -webkit-appearance: none;
            appearance: none;
            background: var(--border-light);
            border-radius: 3px;
            cursor: pointer;
            outline: none
        }

        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 16px;
            height: 16px;
            background: var(--accent);
            border-radius: 50%;
            cursor: pointer;
            transition: transform 0.1s, box-shadow 0.1s;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.3)
        }

        input[type="range"]::-webkit-slider-thumb:hover {
            transform: scale(1.15);
            box-shadow: 0 2px 10px rgba(99, 102, 241, 0.4)
        }

        input[type="range"]::-moz-range-thumb {
            width: 16px;
            height: 16px;
            background: var(--accent);
            border-radius: 50%;
            cursor: pointer;
            border: none
        }

        input[type="range"].locked {
            opacity: 0.5;
            pointer-events: none
        }

        .wave-type-row {
            display: flex;
            align-items: center;
            gap: 12px
        }

        .wave-type-label {
            font-size: 0.75rem;
            font-weight: 500;
            color: var(--text-sec);
            flex-shrink: 0
        }

        .wave-btns {
            display: flex;
            gap: 4px;
            flex: 1
        }

        .wave-btn {
            flex: 1;
            padding: 8px 6px;
            background: var(--card-alt);
            border: 1px solid var(--border);
            border-radius: 6px;
            color: var(--muted);
            font-size: 0.7rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.15s
        }

        .wave-btn:hover {
            border-color: var(--accent);
            color: var(--text)
        }

        .wave-btn.active {
            background: var(--accent);
            border-color: var(--accent);
            color: #fff
        }

        .filter-row {
            margin-top: 2px
        }

        .filter-btns {
            display: flex;
            gap: 4px
        }

        .filter-btn {
            flex: 1;
            padding: 7px 4px;
            background: var(--card-alt);
            border: 1px solid var(--border);
            border-radius: 5px;
            color: var(--muted);
            font-size: 0.65rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.15s;
            text-transform: uppercase
        }

        .filter-btn:hover {
            border-color: var(--accent);
            color: var(--text)
        }

        .filter-btn.active {
            background: var(--accent);
            border-color: var(--accent);
            color: #fff
        }

        .section-label {
            font-size: 0.65rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.08em;
            color: var(--muted);
            padding: 6px 0 2px
        }

        .adsr-viz {
            height: 50px;
            background: #0a0a12;
            border-radius: 8px;
            margin-bottom: 14px
        }

        #adsrCanvas {
            width: 100%;
            height: 100%;
            display: block
        }

        .actions-bar {
            display: flex;
            gap: 10px;
            flex-wrap: wrap
        }

        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            padding: 14px 20px;
            border-radius: 10px;
            font-size: 0.85rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.15s;
            border: none;
            white-space: nowrap
        }

        .btn svg {
            width: 18px;
            height: 18px;
            flex-shrink: 0
        }

        .btn-play {
            background: var(--accent);
            color: #fff;
            flex: 2;
            min-width: 140px
        }

        .btn-play:hover {
            background: var(--accent-hover);
            box-shadow: 0 4px 20px rgba(99, 102, 241, 0.3)
        }

        .btn-play:active {
            transform: scale(0.98)
        }

        .btn-secondary {
            background: var(--card-alt);
            color: var(--text);
            border: 1px solid var(--border);
            flex: 1;
            min-width: 90px
        }

        .btn-secondary:hover {
            border-color: var(--accent);
            background: #1a1a28
        }

        .btn-secondary:active {
            transform: scale(0.98)
        }

        .btn-download {
            background: var(--success);
            border: none;
            color: #fff
        }

        .btn-download:hover {
            background: #16a34a;
            box-shadow: 0 4px 20px rgba(34, 197, 94, 0.3)
        }

        .btn-save {
            background: var(--warning);
            color: #000
        }

        .btn-save:hover {
            background: #ca8a04
        }

        .keyboard-hint {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            padding: 10px;
            background: var(--card-alt);
            border-radius: 8px;
            margin-top: 4px;
            flex-wrap: wrap
        }

        .keyboard-hint span {
            font-size: 0.7rem;
            color: var(--muted)
        }

        .key {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            min-width: 24px;
            height: 22px;
            padding: 0 8px;
            background: var(--border-light);
            border-radius: 4px;
            font-size: 0.65rem;
            font-weight: 600;
            color: var(--text-sec);
            border: 1px solid var(--border)
        }

        .fav-list {
            display: flex;
            flex-direction: column;
            gap: 4px;
            max-height: 200px;
            overflow-y: auto
        }

        .fav-item {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 10px;
            background: var(--card-alt);
            border: 1px solid var(--border);
            border-radius: 6px;
            font-size: 0.75rem
        }

        .fav-item:hover {
            border-color: var(--border-light)
        }

        .fav-name {
            flex: 1;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            color: var(--text)
        }

        .fav-actions {
            display: flex;
            gap: 4px
        }

        .fav-btn {
            width: 24px;
            height: 24px;
            padding: 0;
            background: transparent;
            border: 1px solid var(--border);
            border-radius: 4px;
            color: var(--muted);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.15s
        }

        .fav-btn:hover {
            border-color: var(--accent);
            color: var(--accent)
        }

        .fav-btn.delete:hover {
            border-color: var(--danger);
            color: var(--danger)
        }

        .fav-btn svg {
            width: 12px;
            height: 12px
        }

        .fav-empty {
            font-size: 0.75rem;
            color: var(--muted);
            text-align: center;
            padding: 16px 0
        }

        .modal-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.7);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 100;
            opacity: 0;
            visibility: hidden;
            transition: all 0.2s
        }

        .modal-overlay.active {
            opacity: 1;
            visibility: visible
        }

        .modal {
            background: var(--card);
            border: 1px solid var(--border);
            border-radius: 14px;
            padding: 24px;
            width: 90%;
            max-width: 360px;
            transform: scale(0.95);
            transition: transform 0.2s
        }

        .modal-overlay.active .modal {
            transform: scale(1)
        }

        .modal h3 {
            font-size: 1rem;
            font-weight: 600;
            margin-bottom: 16px
        }

        .modal-input {
            width: 100%;
            padding: 12px 14px;
            background: var(--card-alt);
            border: 1px solid var(--border);
            border-radius: 8px;
            color: var(--text);
            font-size: 0.9rem;
            outline: none;
            margin-bottom: 16px
        }

        .modal-input:focus {
            border-color: var(--accent)
        }

        .modal-btns {
            display: flex;
            gap: 10px
        }

        .modal-btns .btn {
            flex: 1;
            padding: 12px
        }

        .toast {
            position: fixed;
            bottom: 24px;
            left: 50%;
            transform: translateX(-50%) translateY(100px);
            background: var(--card);
            border: 1px solid var(--border);
            border-radius: 10px;
            padding: 12px 20px;
            font-size: 0.85rem;
            opacity: 0;
            transition: all 0.3s;
            z-index: 101
        }

        .toast.show {
            transform: translateX(-50%) translateY(0);
            opacity: 1
        }

        .toast.success {
            border-color: var(--success);
            color: var(--success)
        }

        @media (max-width: 900px) {
            .layout {
                grid-template-columns:1fr
            }

            .sidebar {
                position: static;
                flex-direction: row;
                flex-wrap: wrap;
                gap: 10px
            }

            .sidebar .card {
                flex: 1;
                min-width: 200px
            }

            .controls-row {
                grid-template-columns:1fr
            }
        }

        @media (max-width: 600px) {
            .app {
                padding: 16px 12px
            }

            .actions-bar {
                flex-direction: column
            }

            .btn {
                width: 100%
            }

            .wave-btns {
                flex-wrap: wrap
            }

            .wave-btn {
                min-width: calc(50% - 2px)
            }
        }

        .loading {
            pointer-events: none;
            opacity: 0.7
        }
    </style>
</head>
<body>
<div class="app">
    <header>
        <div class="logo">
            <div class="logo-icon">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round"
                     stroke-linejoin="round">
                    <path d="M11 5L6 9H2v6h4l5 4V5z"/>
                    <path d="M15.54 8.46a5 5 0 0 1 0 7.07"/>
                    <path d="M19.07 4.93a10 10 0 0 1 0 14.14"/>
                </svg>
            </div>
            <h1>Sound Effect Generator</h1>
        </div>
        <p>Create retro game sounds, UI effects, and more</p>
    </header>
    <div class="layout">
        <aside class="sidebar">
            <div class="card">
                <div class="card-header">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <polygon points="10,8 16,12 10,16"/>
                        <circle cx="12" cy="12" r="10"/>
                    </svg>
                    <span class="card-title">Presets</span>
                </div>
                <div class="card-body">
                    <div class="preset-grid">
                        <button class="preset-btn" data-preset="coin">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <circle cx="12" cy="12" r="10"/>
                                <path d="M12 6v12M8 10h8M8 14h8"/>
                            </svg>
                            <span>Coin Pickup</span></button>
                        <button class="preset-btn" data-preset="jump">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M12 19V5M5 12l7-7 7 7"/>
                            </svg>
                            <span>Jump</span></button>
                        <button class="preset-btn" data-preset="laser">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M2 12h6M16 12h6M12 2v6M12 16v6"/>
                            </svg>
                            <span>Laser Beam</span></button>
                        <button class="preset-btn" data-preset="explosion">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <circle cx="12" cy="12" r="10"/>
                                <circle cx="12" cy="12" r="4"/>
                            </svg>
                            <span>Explosion</span></button>
                        <button class="preset-btn" data-preset="powerup">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <polygon points="13,2 3,14 12,14 11,22 21,10 12,10"/>
                            </svg>
                            <span>Power Up</span></button>
                        <button class="preset-btn" data-preset="hit">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M18 6L6 18M6 6l12 12"/>
                            </svg>
                            <span>Hit Damage</span></button>
                        <button class="preset-btn" data-preset="click">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M15 15l-2 5L9 9l11 4-5 2z"/>
                            </svg>
                            <span>Button Click</span></button>
                        <button class="preset-btn" data-preset="notification">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"/>
                                <path d="M13.73 21a2 2 0 0 1-3.46 0"/>
                            </svg>
                            <span>Notification</span></button>
                        <button class="preset-btn" data-preset="success">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M20 6L9 17l-5-5"/>
                            </svg>
                            <span>Success</span></button>
                        <button class="preset-btn" data-preset="error">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <circle cx="12" cy="12" r="10"/>
                                <path d="M12 8v4M12 16h.01"/>
                            </svg>
                            <span>Error</span></button>
                        <button class="preset-btn" data-preset="whoosh">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M5 12h14M12 5l7 7-7 7"/>
                            </svg>
                            <span>Whoosh</span></button>
                        <button class="preset-btn" data-preset="blip">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <circle cx="12" cy="12" r="3"/>
                            </svg>
                            <span>Blip</span></button>
                    </div>
                </div>
            </div>
            <div class="card">
                <div class="card-header">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M19 21l-7-5-7 5V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2z"/>
                    </svg>
                    <span class="card-title">Favorites</span>
                </div>
                <div class="card-body">
                    <div class="fav-list" id="favList">
                        <div class="fav-empty">No saved sounds yet</div>
                    </div>
                </div>
            </div>
        </aside>
        <main class="main-content">
            <div class="card visualizer">
                <div class="visualizer-header">
                    <div class="visualizer-dot" id="playIndicator"></div>
                    <span class="visualizer-label">Waveform</span>
                </div>
                <canvas id="waveform"></canvas>
            </div>
            <div class="controls-row">
                <div class="card">
                    <div class="card-header">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M2 12h4l3-9 4 18 3-9h4"/>
                        </svg>
                        <span class="card-title">Oscillator</span>
                    </div>
                    <div class="card-body">
                        <div class="param-list">
                            <div class="wave-type-row"><span class="wave-type-label">Wave</span>
                                <div class="wave-btns">
                                    <button class="wave-btn active" data-wave="sine">Sine</button>
                                    <button class="wave-btn" data-wave="square">Square</button>
                                    <button class="wave-btn" data-wave="sawtooth">Saw</button>
                                    <button class="wave-btn" data-wave="triangle">Tri</button>
                                    <button class="wave-btn" data-wave="noise">Noise</button>
                                </div>
                            </div>
                            <div class="param-item">
                                <div class="param-header">
                                    <div class="param-left"><span class="param-label">Frequency</span>
                                        <button class="lock-btn" data-param="frequency" title="Lock parameter">
                                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                <rect x="3" y="11" width="18" height="11" rx="2"/>
                                                <path d="M7 11V7a5 5 0 0 1 10 0v4"/>
                                            </svg>
                                        </button>
                                    </div>
                                    <span class="param-value" id="frequencyVal">440 Hz</span></div>
                                <input type="range" id="frequency" min="50" max="2000" value="440" data-default="440">
                            </div>
                            <div class="param-item">
                                <div class="param-header">
                                    <div class="param-left"><span class="param-label">Duration</span>
                                        <button class="lock-btn" data-param="duration" title="Lock parameter">
                                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                <rect x="3" y="11" width="18" height="11" rx="2"/>
                                                <path d="M7 11V7a5 5 0 0 1 10 0v4"/>
                                            </svg>
                                        </button>
                                    </div>
                                    <span class="param-value" id="durationVal">0.30s</span></div>
                                <input type="range" id="duration" min="0.05" max="2" step="0.01" value="0.3"
                                       data-default="0.3">
                            </div>
                            <div class="param-item">
                                <div class="param-header">
                                    <div class="param-left"><span class="param-label">Volume</span>
                                        <button class="lock-btn" data-param="volume" title="Lock parameter">
                                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                <rect x="3" y="11" width="18" height="11" rx="2"/>
                                                <path d="M7 11V7a5 5 0 0 1 10 0v4"/>
                                            </svg>
                                        </button>
                                    </div>
                                    <span class="param-value" id="volumeVal">50%</span></div>
                                <input type="range" id="volume" min="0" max="1" step="0.01" value="0.5"
                                       data-default="0.5">
                            </div>
                        </div>
                    </div>
                </div>
                <div class="card">
                    <div class="card-header">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M3 17l6-6 4 4 8-8"/>
                            <path d="M17 7h4v4"/>
                        </svg>
                        <span class="card-title">Envelope (ADSR)</span>
                    </div>
                    <div class="card-body">
                        <div class="adsr-viz">
                            <canvas id="adsrCanvas"></canvas>
                        </div>
                        <div class="param-list">
                            <div class="param-item">
                                <div class="param-header">
                                    <div class="param-left"><span class="param-label">Attack</span>
                                        <button class="lock-btn" data-param="attack" title="Lock parameter">
                                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                <rect x="3" y="11" width="18" height="11" rx="2"/>
                                                <path d="M7 11V7a5 5 0 0 1 10 0v4"/>
                                            </svg>
                                        </button>
                                    </div>
                                    <span class="param-value" id="attackVal">0.010s</span></div>
                                <input type="range" id="attack" min="0.001" max="0.5" step="0.001" value="0.01"
                                       data-default="0.01">
                            </div>
                            <div class="param-item">
                                <div class="param-header">
                                    <div class="param-left"><span class="param-label">Decay</span>
                                        <button class="lock-btn" data-param="decay" title="Lock parameter">
                                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                <rect x="3" y="11" width="18" height="11" rx="2"/>
                                                <path d="M7 11V7a5 5 0 0 1 10 0v4"/>
                                            </svg>
                                        </button>
                                    </div>
                                    <span class="param-value" id="decayVal">0.10s</span></div>
                                <input type="range" id="decay" min="0.01" max="1" step="0.01" value="0.1"
                                       data-default="0.1">
                            </div>
                            <div class="param-item">
                                <div class="param-header">
                                    <div class="param-left"><span class="param-label">Sustain</span>
                                        <button class="lock-btn" data-param="sustain" title="Lock parameter">
                                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                <rect x="3" y="11" width="18" height="11" rx="2"/>
                                                <path d="M7 11V7a5 5 0 0 1 10 0v4"/>
                                            </svg>
                                        </button>
                                    </div>
                                    <span class="param-value" id="sustainVal">50%</span></div>
                                <input type="range" id="sustain" min="0" max="1" step="0.01" value="0.5"
                                       data-default="0.5">
                            </div>
                            <div class="param-item">
                                <div class="param-header">
                                    <div class="param-left"><span class="param-label">Release</span>
                                        <button class="lock-btn" data-param="release" title="Lock parameter">
                                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                <rect x="3" y="11" width="18" height="11" rx="2"/>
                                                <path d="M7 11V7a5 5 0 0 1 10 0v4"/>
                                            </svg>
                                        </button>
                                    </div>
                                    <span class="param-value" id="releaseVal">0.20s</span></div>
                                <input type="range" id="release" min="0.01" max="1" step="0.01" value="0.2"
                                       data-default="0.2">
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="controls-row">
                <div class="card">
                    <div class="card-header">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M12 2v20M2 12c5-4 7 4 10 0s5 4 10 0"/>
                        </svg>
                        <span class="card-title">Modulation</span>
                    </div>
                    <div class="card-body">
                        <div class="param-list">
                            <div class="param-item">
                                <div class="param-header">
                                    <div class="param-left"><span class="param-label">Freq Slide</span>
                                        <button class="lock-btn" data-param="freqSlide" title="Lock parameter">
                                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                <rect x="3" y="11" width="18" height="11" rx="2"/>
                                                <path d="M7 11V7a5 5 0 0 1 10 0v4"/>
                                            </svg>
                                        </button>
                                    </div>
                                    <span class="param-value" id="freqSlideVal">0 Hz</span></div>
                                <input type="range" id="freqSlide" min="-1000" max="1000" value="0" data-default="0">
                            </div>
                            <div class="param-item">
                                <div class="param-header">
                                    <div class="param-left"><span class="param-label">Vibrato Speed</span>
                                        <button class="lock-btn" data-param="vibratoRate" title="Lock parameter">
                                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                <rect x="3" y="11" width="18" height="11" rx="2"/>
                                                <path d="M7 11V7a5 5 0 0 1 10 0v4"/>
                                            </svg>
                                        </button>
                                    </div>
                                    <span class="param-value" id="vibratoRateVal">0 Hz</span></div>
                                <input type="range" id="vibratoRate" min="0" max="30" step="0.5" value="0"
                                       data-default="0">
                            </div>
                            <div class="param-item">
                                <div class="param-header">
                                    <div class="param-left"><span class="param-label">Vibrato Depth</span>
                                        <button class="lock-btn" data-param="vibratoDepth" title="Lock parameter">
                                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                <rect x="3" y="11" width="18" height="11" rx="2"/>
                                                <path d="M7 11V7a5 5 0 0 1 10 0v4"/>
                                            </svg>
                                        </button>
                                    </div>
                                    <span class="param-value" id="vibratoDepthVal">0</span></div>
                                <input type="range" id="vibratoDepth" min="0" max="100" value="0" data-default="0">
                            </div>
                        </div>
                    </div>
                </div>
                <div class="card">
                    <div class="card-header">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="12" cy="12" r="10"/>
                            <path d="M12 6v6l4 2"/>
                        </svg>
                        <span class="card-title">Filter & Effects</span>
                    </div>
                    <div class="card-body">
                        <div class="param-list">
                            <div class="filter-row"><span class="section-label">Filter Type</span>
                                <div class="filter-btns">
                                    <button class="filter-btn active" data-filter="none">Off</button>
                                    <button class="filter-btn" data-filter="lowpass">Low</button>
                                    <button class="filter-btn" data-filter="highpass">High</button>
                                    <button class="filter-btn" data-filter="bandpass">Band</button>
                                </div>
                            </div>
                            <div class="param-item">
                                <div class="param-header">
                                    <div class="param-left"><span class="param-label">Cutoff</span>
                                        <button class="lock-btn" data-param="filterFreq" title="Lock parameter">
                                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                <rect x="3" y="11" width="18" height="11" rx="2"/>
                                                <path d="M7 11V7a5 5 0 0 1 10 0v4"/>
                                            </svg>
                                        </button>
                                    </div>
                                    <span class="param-value" id="filterFreqVal">2000 Hz</span></div>
                                <input type="range" id="filterFreq" min="100" max="8000" value="2000"
                                       data-default="2000">
                            </div>
                            <div class="param-item">
                                <div class="param-header">
                                    <div class="param-left"><span class="param-label">Resonance</span>
                                        <button class="lock-btn" data-param="filterQ" title="Lock parameter">
                                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                <rect x="3" y="11" width="18" height="11" rx="2"/>
                                                <path d="M7 11V7a5 5 0 0 1 10 0v4"/>
                                            </svg>
                                        </button>
                                    </div>
                                    <span class="param-value" id="filterQVal">1.0</span></div>
                                <input type="range" id="filterQ" min="0.1" max="20" step="0.1" value="1"
                                       data-default="1">
                            </div>
                            <div class="param-item">
                                <div class="param-header">
                                    <div class="param-left"><span class="param-label">Distortion</span>
                                        <button class="lock-btn" data-param="distortion" title="Lock parameter">
                                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                <rect x="3" y="11" width="18" height="11" rx="2"/>
                                                <path d="M7 11V7a5 5 0 0 1 10 0v4"/>
                                            </svg>
                                        </button>
                                    </div>
                                    <span class="param-value" id="distortionVal">0%</span></div>
                                <input type="range" id="distortion" min="0" max="100" value="0" data-default="0">
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="card">
                <div class="card-body">
                    <div class="actions-bar">
                        <button class="btn btn-play" id="playBtn">
                            <svg viewBox="0 0 24 24" fill="currentColor">
                                <path d="M8 5v14l11-7z"/>
                            </svg>
                            Play
                        </button>
                        <button class="btn btn-secondary" id="randomBtn">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M16 3h5v5M4 20L21 3M21 16v5h-5M15 15l6 6M4 4l5 5"/>
                            </svg>
                            Random
                        </button>
                        <button class="btn btn-secondary" id="undoBtn" disabled>
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/>
                                <path d="M3 3v5h5"/>
                            </svg>
                            Undo
                        </button>
                        <button class="btn btn-secondary btn-save" id="saveBtn">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M19 21l-7-5-7 5V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2z"/>
                            </svg>
                            Save
                        </button>
                        <button class="btn btn-secondary btn-download" id="downloadBtn">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                                <polyline points="7,10 12,15 17,10"/>
                                <line x1="12" y1="15" x2="12" y2="3"/>
                            </svg>
                            WAV
                        </button>
                    </div>
                    <div class="keyboard-hint">
                        <span>Press</span><span class="key">Space</span><span>play</span>
                        <span class="key">R</span><span>random</span>
                        <span class="key">Ctrl+Z</span><span>undo</span>
                    </div>
                </div>
            </div>
        </main>
    </div>
</div>
<div class="modal-overlay" id="saveModal">
    <div class="modal">
        <h3>Save Sound Effect</h3>
        <input type="text" class="modal-input" id="saveName" placeholder="Enter a name..." maxlength="32"
               autocomplete="off">
        <div class="modal-btns">
            <button class="btn btn-secondary" id="cancelSave">Cancel</button>
            <button class="btn btn-play" id="confirmSave">Save</button>
        </div>
    </div>
</div>
<div class="toast" id="toast"></div>
<script>
    const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    const canvas = document.getElementById('waveform');
    const ctx = canvas.getContext('2d');
    const adsrCanvas = document.getElementById('adsrCanvas');
    const adsrCtx = adsrCanvas.getContext('2d');
    const playIndicator = document.getElementById('playIndicator');
    let analyser, dataArray, animationId, isPlaying = false;
    const lockedParams = new Set();
    const history = [];
    const maxHistory = 20;
    const params = {
        waveType: 'sine',
        frequency: 440,
        duration: 0.3,
        volume: 0.5,
        attack: 0.01,
        decay: 0.1,
        sustain: 0.5,
        release: 0.2,
        freqSlide: 0,
        vibratoRate: 0,
        vibratoDepth: 0,
        filterType: 'none',
        filterFreq: 2000,
        filterQ: 1,
        distortion: 0
    };
    const defaults = {...params};
    const presets = {
        coin: {
            waveType: 'square',
            frequency: 987,
            duration: 0.15,
            volume: 0.4,
            attack: 0.001,
            decay: 0.05,
            sustain: 0.3,
            release: 0.1,
            freqSlide: 400,
            vibratoRate: 0,
            vibratoDepth: 0,
            filterType: 'none',
            filterFreq: 2000,
            filterQ: 1,
            distortion: 0
        },
        jump: {
            waveType: 'square',
            frequency: 280,
            duration: 0.22,
            volume: 0.4,
            attack: 0.001,
            decay: 0.1,
            sustain: 0.2,
            release: 0.1,
            freqSlide: 650,
            vibratoRate: 0,
            vibratoDepth: 0,
            filterType: 'lowpass',
            filterFreq: 3500,
            filterQ: 1,
            distortion: 0
        },
        laser: {
            waveType: 'sawtooth',
            frequency: 1600,
            duration: 0.18,
            volume: 0.35,
            attack: 0.001,
            decay: 0.08,
            sustain: 0.1,
            release: 0.08,
            freqSlide: -1000,
            vibratoRate: 0,
            vibratoDepth: 0,
            filterType: 'lowpass',
            filterFreq: 4500,
            filterQ: 3,
            distortion: 15
        },
        explosion: {
            waveType: 'noise',
            frequency: 100,
            duration: 0.9,
            volume: 0.6,
            attack: 0.001,
            decay: 0.25,
            sustain: 0.3,
            release: 0.5,
            freqSlide: -30,
            vibratoRate: 15,
            vibratoDepth: 20,
            filterType: 'lowpass',
            filterFreq: 800,
            filterQ: 1,
            distortion: 40
        },
        powerup: {
            waveType: 'sine',
            frequency: 350,
            duration: 0.55,
            volume: 0.4,
            attack: 0.01,
            decay: 0.1,
            sustain: 0.6,
            release: 0.2,
            freqSlide: 900,
            vibratoRate: 6,
            vibratoDepth: 12,
            filterType: 'none',
            filterFreq: 2000,
            filterQ: 1,
            distortion: 0
        },
        hit: {
            waveType: 'square',
            frequency: 160,
            duration: 0.12,
            volume: 0.5,
            attack: 0.001,
            decay: 0.06,
            sustain: 0.1,
            release: 0.04,
            freqSlide: -100,
            vibratoRate: 0,
            vibratoDepth: 0,
            filterType: 'lowpass',
            filterFreq: 700,
            filterQ: 4,
            distortion: 35
        },
        click: {
            waveType: 'sine',
            frequency: 1800,
            duration: 0.04,
            volume: 0.3,
            attack: 0.001,
            decay: 0.015,
            sustain: 0.1,
            release: 0.015,
            freqSlide: 0,
            vibratoRate: 0,
            vibratoDepth: 0,
            filterType: 'highpass',
            filterFreq: 1200,
            filterQ: 1,
            distortion: 0
        },
        notification: {
            waveType: 'sine',
            frequency: 880,
            duration: 0.35,
            volume: 0.35,
            attack: 0.01,
            decay: 0.1,
            sustain: 0.5,
            release: 0.15,
            freqSlide: 220,
            vibratoRate: 4,
            vibratoDepth: 8,
            filterType: 'none',
            filterFreq: 2000,
            filterQ: 1,
            distortion: 0
        },
        success: {
            waveType: 'sine',
            frequency: 523,
            duration: 0.45,
            volume: 0.35,
            attack: 0.01,
            decay: 0.1,
            sustain: 0.5,
            release: 0.2,
            freqSlide: 350,
            vibratoRate: 0,
            vibratoDepth: 0,
            filterType: 'none',
            filterFreq: 2000,
            filterQ: 1,
            distortion: 0
        },
        error: {
            waveType: 'square',
            frequency: 280,
            duration: 0.35,
            volume: 0.4,
            attack: 0.01,
            decay: 0.12,
            sustain: 0.35,
            release: 0.12,
            freqSlide: -140,
            vibratoRate: 12,
            vibratoDepth: 18,
            filterType: 'lowpass',
            filterFreq: 1200,
            filterQ: 2,
            distortion: 12
        },
        whoosh: {
            waveType: 'noise',
            frequency: 600,
            duration: 0.28,
            volume: 0.35,
            attack: 0.04,
            decay: 0.12,
            sustain: 0.15,
            release: 0.1,
            freqSlide: -400,
            vibratoRate: 0,
            vibratoDepth: 0,
            filterType: 'bandpass',
            filterFreq: 2000,
            filterQ: 3,
            distortion: 0
        },
        blip: {
            waveType: 'sine',
            frequency: 700,
            duration: 0.07,
            volume: 0.35,
            attack: 0.003,
            decay: 0.025,
            sustain: 0.2,
            release: 0.025,
            freqSlide: 0,
            vibratoRate: 0,
            vibratoDepth: 0,
            filterType: 'none',
            filterFreq: 2000,
            filterQ: 1,
            distortion: 0
        }
    };

    function resizeCanvas() {
        const r = canvas.getBoundingClientRect();
        canvas.width = r.width * devicePixelRatio;
        canvas.height = r.height * devicePixelRatio;
        ctx.scale(devicePixelRatio, devicePixelRatio);
        const ar = adsrCanvas.parentElement.getBoundingClientRect();
        adsrCanvas.width = ar.width * devicePixelRatio;
        adsrCanvas.height = ar.height * devicePixelRatio;
        adsrCtx.scale(devicePixelRatio, devicePixelRatio);
        drawIdleWaveform();
        drawADSR()
    }

    resizeCanvas();
    window.addEventListener('resize', resizeCanvas);

    function createNoiseBuffer(ctx, dur) {
        const sz = ctx.sampleRate * dur;
        const buf = ctx.createBuffer(1, sz, ctx.sampleRate);
        const out = buf.getChannelData(0);
        for (let i = 0; i < sz; i++) out[i] = Math.random() * 2 - 1;
        return buf
    }

    function makeDistortionCurve(amt) {
        const k = amt * 2, samples = 44100, curve = new Float32Array(samples), deg = Math.PI / 180;
        for (let i = 0; i < samples; i++) {
            const x = i * 2 / samples - 1;
            curve[i] = (3 + k) * x * 20 * deg / (Math.PI + k * Math.abs(x))
        }
        return curve
    }

    function createSound(context, startTime = 0, forExport = false) {
        const t = startTime || context.currentTime;
        const totalDur = params.duration + params.release + 0.1;
        let src;
        if (params.waveType === 'noise') {
            src = context.createBufferSource();
            src.buffer = createNoiseBuffer(context, totalDur)
        } else {
            src = context.createOscillator();
            src.type = params.waveType;
            src.frequency.setValueAtTime(params.frequency, t);
            src.frequency.linearRampToValueAtTime(Math.max(20, params.frequency + params.freqSlide), t + params.duration);
            if (params.vibratoRate > 0 && params.vibratoDepth > 0) {
                const vOsc = context.createOscillator(), vGain = context.createGain();
                vOsc.frequency.value = params.vibratoRate;
                vGain.gain.value = params.vibratoDepth;
                vOsc.connect(vGain);
                vGain.connect(src.frequency);
                vOsc.start(t);
                vOsc.stop(t + totalDur)
            }
        }
        const gain = context.createGain(), filter = context.createBiquadFilter(), dist = context.createWaveShaper();
        gain.gain.setValueAtTime(0, t);
        gain.gain.linearRampToValueAtTime(params.volume, t + params.attack);
        gain.gain.linearRampToValueAtTime(params.volume * params.sustain, t + params.attack + params.decay);
        gain.gain.setValueAtTime(params.volume * params.sustain, t + params.duration);
        gain.gain.linearRampToValueAtTime(0, t + params.duration + params.release);
        src.connect(gain);
        let last = gain;
        if (params.distortion > 0) {
            dist.curve = makeDistortionCurve(params.distortion);
            dist.oversample = '4x';
            last.connect(dist);
            last = dist
        }
        if (params.filterType !== 'none') {
            filter.type = params.filterType;
            filter.frequency.value = params.filterFreq;
            filter.Q.value = params.filterQ;
            last.connect(filter);
            last = filter
        }
        if (!forExport) {
            analyser = context.createAnalyser();
            analyser.fftSize = 2048;
            dataArray = new Uint8Array(analyser.frequencyBinCount);
            last.connect(analyser);
            analyser.connect(context.destination)
        } else {
            last.connect(context.destination)
        }
        src.start(t);
        src.stop(t + totalDur);
        return {src, gain, duration: totalDur}
    }

    function drawIdleWaveform() {
        const w = canvas.offsetWidth, h = canvas.offsetHeight;
        ctx.fillStyle = '#0a0a12';
        ctx.fillRect(0, 0, w, h);
        ctx.strokeStyle = '#1e1e2e';
        ctx.lineWidth = 1;
        ctx.beginPath();
        ctx.moveTo(0, h / 2);
        ctx.lineTo(w, h / 2);
        ctx.stroke()
    }

    function drawWaveform() {
        if (!analyser || !isPlaying) return;
        const w = canvas.offsetWidth, h = canvas.offsetHeight;
        ctx.fillStyle = '#0a0a12';
        ctx.fillRect(0, 0, w, h);
        analyser.getByteTimeDomainData(dataArray);
        ctx.lineWidth = 2;
        ctx.strokeStyle = '#6366f1';
        ctx.beginPath();
        const slice = w / dataArray.length;
        let x = 0;
        for (let i = 0; i < dataArray.length; i++) {
            const v = dataArray[i] / 128, y = (v * h) / 2;
            i === 0 ? ctx.moveTo(x, y) : ctx.lineTo(x, y);
            x += slice
        }
        ctx.lineTo(w, h / 2);
        ctx.stroke();
        ctx.strokeStyle = '#22d3ee';
        ctx.globalAlpha = 0.15;
        ctx.lineWidth = 4;
        ctx.stroke();
        ctx.globalAlpha = 1;
        animationId = requestAnimationFrame(drawWaveform)
    }

    function drawADSR() {
        const w = adsrCanvas.offsetWidth, h = adsrCanvas.offsetHeight, pad = 8;
        adsrCtx.fillStyle = '#0a0a12';
        adsrCtx.fillRect(0, 0, w, h);
        const total = params.attack + params.decay + 0.2 + params.release;
        const aX = pad + (params.attack / total) * (w - 2 * pad);
        const dX = aX + (params.decay / total) * (w - 2 * pad);
        const sX = dX + (0.2 / total) * (w - 2 * pad);
        const rX = sX + (params.release / total) * (w - 2 * pad);
        const top = pad, bot = h - pad, sY = top + (1 - params.sustain) * (bot - top);
        adsrCtx.strokeStyle = '#6366f1';
        adsrCtx.lineWidth = 2;
        adsrCtx.beginPath();
        adsrCtx.moveTo(pad, bot);
        adsrCtx.lineTo(aX, top);
        adsrCtx.lineTo(dX, sY);
        adsrCtx.lineTo(sX, sY);
        adsrCtx.lineTo(rX, bot);
        adsrCtx.stroke();
        adsrCtx.fillStyle = 'rgba(99,102,241,0.1)';
        adsrCtx.beginPath();
        adsrCtx.moveTo(pad, bot);
        adsrCtx.lineTo(aX, top);
        adsrCtx.lineTo(dX, sY);
        adsrCtx.lineTo(sX, sY);
        adsrCtx.lineTo(rX, bot);
        adsrCtx.closePath();
        adsrCtx.fill()
    }

    function playSound() {
        if (audioCtx.state === 'suspended') audioCtx.resume();
        cancelAnimationFrame(animationId);
        isPlaying = true;
        playIndicator.classList.add('active');
        const {duration} = createSound(audioCtx);
        drawWaveform();
        setTimeout(() => {
            isPlaying = false;
            playIndicator.classList.remove('active');
            cancelAnimationFrame(animationId);
            drawIdleWaveform()
        }, duration * 1000)
    }

    function saveToHistory() {
        history.push(JSON.stringify(params));
        if (history.length > maxHistory) history.shift();
        document.getElementById('undoBtn').disabled = history.length <= 1
    }

    function undo() {
        if (history.length <= 1) return;
        history.pop();
        const prev = JSON.parse(history[history.length - 1] || JSON.stringify(defaults));
        Object.assign(params, prev);
        updateUI();
        document.getElementById('undoBtn').disabled = history.length <= 1
    }

    function updateUI() {
        document.getElementById('frequencyVal').textContent = params.frequency + ' Hz';
        document.getElementById('durationVal').textContent = params.duration.toFixed(2) + 's';
        document.getElementById('volumeVal').textContent = Math.round(params.volume * 100) + '%';
        document.getElementById('attackVal').textContent = params.attack.toFixed(3) + 's';
        document.getElementById('decayVal').textContent = params.decay.toFixed(2) + 's';
        document.getElementById('sustainVal').textContent = Math.round(params.sustain * 100) + '%';
        document.getElementById('releaseVal').textContent = params.release.toFixed(2) + 's';
        document.getElementById('freqSlideVal').textContent = (params.freqSlide > 0 ? '+' : '') + params.freqSlide + ' Hz';
        document.getElementById('vibratoRateVal').textContent = params.vibratoRate + ' Hz';
        document.getElementById('vibratoDepthVal').textContent = params.vibratoDepth;
        document.getElementById('filterFreqVal').textContent = params.filterFreq + ' Hz';
        document.getElementById('filterQVal').textContent = params.filterQ.toFixed(1);
        document.getElementById('distortionVal').textContent = params.distortion + '%';
        ['frequency', 'duration', 'volume', 'attack', 'decay', 'sustain', 'release', 'freqSlide', 'vibratoRate', 'vibratoDepth', 'filterFreq', 'filterQ', 'distortion'].forEach(id => {
            const el = document.getElementById(id);
            el.value = params[id];
            el.classList.toggle('locked', lockedParams.has(id))
        });
        document.querySelectorAll('.wave-btn').forEach(b => b.classList.toggle('active', b.dataset.wave === params.waveType));
        document.querySelectorAll('.filter-btn').forEach(b => b.classList.toggle('active', b.dataset.filter === params.filterType));
        document.querySelectorAll('.lock-btn').forEach(b => b.classList.toggle('locked', lockedParams.has(b.dataset.param)));
        drawADSR()
    }

    function loadPreset(name) {
        const p = presets[name];
        if (!p) return;
        saveToHistory();
        Object.assign(params, p);
        updateUI();
        document.querySelectorAll('.preset-btn').forEach(b => b.classList.toggle('active', b.dataset.preset === name));
        playSound()
    }

    function randomize() {
        saveToHistory();
        const waves = ['sine', 'square', 'sawtooth', 'triangle', 'noise'];
        const filters = ['none', 'lowpass', 'highpass', 'bandpass'];
        if (!lockedParams.has('waveType')) params.waveType = waves[Math.floor(Math.random() * waves.length)];
        if (!lockedParams.has('frequency')) params.frequency = Math.floor(Math.random() * 1500) + 100;
        if (!lockedParams.has('duration')) params.duration = Math.round((Math.random() * 0.8 + 0.05) * 100) / 100;
        if (!lockedParams.has('volume')) params.volume = Math.round((Math.random() * 0.5 + 0.2) * 100) / 100;
        if (!lockedParams.has('attack')) params.attack = Math.round((Math.random() * 0.15 + 0.001) * 1000) / 1000;
        if (!lockedParams.has('decay')) params.decay = Math.round((Math.random() * 0.4 + 0.01) * 100) / 100;
        if (!lockedParams.has('sustain')) params.sustain = Math.round(Math.random() * 100) / 100;
        if (!lockedParams.has('release')) params.release = Math.round((Math.random() * 0.4 + 0.01) * 100) / 100;
        if (!lockedParams.has('freqSlide')) params.freqSlide = Math.floor(Math.random() * 1400) - 700;
        if (!lockedParams.has('vibratoRate')) params.vibratoRate = Math.random() > 0.5 ? Math.floor(Math.random() * 20) : 0;
        if (!lockedParams.has('vibratoDepth')) params.vibratoDepth = params.vibratoRate > 0 ? Math.floor(Math.random() * 40) : 0;
        if (!lockedParams.has('filterType')) params.filterType = filters[Math.floor(Math.random() * filters.length)];
        if (!lockedParams.has('filterFreq')) params.filterFreq = Math.floor(Math.random() * 5000) + 500;
        if (!lockedParams.has('filterQ')) params.filterQ = Math.round((Math.random() * 8 + 0.1) * 10) / 10;
        if (!lockedParams.has('distortion')) params.distortion = Math.random() > 0.6 ? Math.floor(Math.random() * 40) : 0;
        document.querySelectorAll('.preset-btn').forEach(b => b.classList.remove('active'));
        updateUI();
        playSound()
    }

    async function downloadWAV() {
        const btn = document.getElementById('downloadBtn');
        btn.classList.add('loading');
        try {
            const sr = 44100, dur = params.duration + params.release + 0.2;
            const offline = new OfflineAudioContext(1, Math.ceil(sr * dur), sr);
            createSound(offline, 0, true);
            const buf = await offline.startRendering();
            const wav = encodeWAV(buf);
            const blob = new Blob([wav], {type: 'audio/wav'});
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'sound-effect.wav';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url)
        } catch (e) {
            console.error(e)
        } finally {
            btn.classList.remove('loading')
        }
    }

    function encodeWAV(buf) {
        const nc = 1, sr = buf.sampleRate, fmt = 1, bd = 16, bps = bd / 8, ba = nc * bps, data = buf.getChannelData(0),
            samples = data.length, dataSize = samples * ba, bufSize = 44 + dataSize, ab = new ArrayBuffer(bufSize),
            v = new DataView(ab);
        const ws = (o, s) => {
            for (let i = 0; i < s.length; i++) v.setUint8(o + i, s.charCodeAt(i))
        };
        ws(0, 'RIFF');
        v.setUint32(4, 36 + dataSize, true);
        ws(8, 'WAVE');
        ws(12, 'fmt ');
        v.setUint32(16, 16, true);
        v.setUint16(20, fmt, true);
        v.setUint16(22, nc, true);
        v.setUint32(24, sr, true);
        v.setUint32(28, sr * ba, true);
        v.setUint16(32, ba, true);
        v.setUint16(34, bd, true);
        ws(36, 'data');
        v.setUint32(40, dataSize, true);
        let off = 44;
        for (let i = 0; i < samples; i++) {
            const s = Math.max(-1, Math.min(1, data[i]));
            v.setInt16(off, s < 0 ? s * 0x8000 : s * 0x7FFF, true);
            off += 2
        }
        return ab
    }

    function getFavorites() {
        try {
            return JSON.parse(localStorage.getItem('sfx_favorites') || '[]')
        } catch {
            return []
        }
    }

    function saveFavorites(favs) {
        localStorage.setItem('sfx_favorites', JSON.stringify(favs))
    }

    function renderFavorites() {
        const list = document.getElementById('favList');
        const favs = getFavorites();
        if (!favs.length) {
            list.innerHTML = '<div class="fav-empty">No saved sounds yet</div>';
            return
        }
        list.innerHTML = favs.map((f, i) => `<div class="fav-item"><span class="fav-name">${f.name}</span><div class="fav-actions"><button class="fav-btn" data-action="play" data-idx="${i}" title="Play"><svg viewBox="0 0 24 24" fill="currentColor"><path d="M8 5v14l11-7z"/></svg></button><button class="fav-btn" data-action="load" data-idx="${i}" title="Load"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="17,8 12,3 7,8"/><line x1="12" y1="3" x2="12" y2="15"/></svg></button><button class="fav-btn delete" data-action="delete" data-idx="${i}" title="Delete"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 6h18M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/></svg></button></div></div>`).join('')
    }

    function showToast(msg, type = '') {
        const t = document.getElementById('toast');
        t.textContent = msg;
        t.className = 'toast show' + (type ? ' ' + type : '');
        setTimeout(() => t.classList.remove('show'), 2000)
    }

    function openSaveModal() {
        document.getElementById('saveModal').classList.add('active');
        document.getElementById('saveName').value = '';
        document.getElementById('saveName').focus()
    }

    function closeSaveModal() {
        document.getElementById('saveModal').classList.remove('active')
    }

    function confirmSave() {
        const name = document.getElementById('saveName').value.trim();
        if (!name) {
            document.getElementById('saveName').focus();
            return
        }
        const favs = getFavorites();
        favs.unshift({name, params: {...params}, ts: Date.now()});
        if (favs.length > 50) favs.pop();
        saveFavorites(favs);
        renderFavorites();
        closeSaveModal();
        showToast('Sound saved!', 'success')
    }

    document.getElementById('favList').addEventListener('click', e => {
        const btn = e.target.closest('.fav-btn');
        if (!btn) return;
        const action = btn.dataset.action, idx = parseInt(btn.dataset.idx);
        const favs = getFavorites();
        if (action === 'play') {
            const saved = favs[idx];
            Object.assign(params, saved.params);
            updateUI();
            playSound()
        } else if (action === 'load') {
            saveToHistory();
            const saved = favs[idx];
            Object.assign(params, saved.params);
            updateUI();
            document.querySelectorAll('.preset-btn').forEach(b => b.classList.remove('active'));
            showToast('Loaded: ' + saved.name)
        } else if (action === 'delete') {
            favs.splice(idx, 1);
            saveFavorites(favs);
            renderFavorites();
            showToast('Deleted')
        }
    });
    document.querySelectorAll('.preset-btn').forEach(btn => btn.addEventListener('click', () => loadPreset(btn.dataset.preset)));
    document.querySelectorAll('.wave-btn').forEach(btn => btn.addEventListener('click', () => {
        saveToHistory();
        params.waveType = btn.dataset.wave;
        updateUI()
    }));
    document.querySelectorAll('.filter-btn').forEach(btn => btn.addEventListener('click', () => {
        saveToHistory();
        params.filterType = btn.dataset.filter;
        updateUI()
    }));
    document.querySelectorAll('.lock-btn').forEach(btn => btn.addEventListener('click', () => {
        const p = btn.dataset.param;
        lockedParams.has(p) ? lockedParams.delete(p) : lockedParams.add(p);
        updateUI()
    }));
    ['frequency', 'duration', 'volume', 'attack', 'decay', 'sustain', 'release', 'freqSlide', 'vibratoRate', 'vibratoDepth', 'filterFreq', 'filterQ', 'distortion'].forEach(id => {
        const el = document.getElementById(id);
        el.addEventListener('input', () => {
            params[id] = parseFloat(el.value);
            updateUI()
        });
        el.addEventListener('change', () => saveToHistory());
        el.addEventListener('dblclick', () => {
            params[id] = parseFloat(el.dataset.default);
            saveToHistory();
            updateUI()
        })
    });
    document.getElementById('playBtn').addEventListener('click', playSound);
    document.getElementById('randomBtn').addEventListener('click', randomize);
    document.getElementById('undoBtn').addEventListener('click', undo);
    document.getElementById('saveBtn').addEventListener('click', openSaveModal);
    document.getElementById('downloadBtn').addEventListener('click', downloadWAV);
    document.getElementById('cancelSave').addEventListener('click', closeSaveModal);
    document.getElementById('confirmSave').addEventListener('click', confirmSave);
    document.getElementById('saveName').addEventListener('keydown', e => {
        if (e.key === 'Enter') confirmSave();
        if (e.key === 'Escape') closeSaveModal()
    });
    document.getElementById('saveModal').addEventListener('click', e => {
        if (e.target.id === 'saveModal') closeSaveModal()
    });
    document.addEventListener('keydown', e => {
        if (e.target.tagName === 'INPUT' && e.target.type !== 'range') return;
        if (e.code === 'Space') {
            e.preventDefault();
            playSound()
        }
        if (e.code === 'KeyR' && !e.metaKey && !e.ctrlKey) {
            e.preventDefault();
            randomize()
        }
        if (e.code === 'KeyZ' && (e.metaKey || e.ctrlKey)) {
            e.preventDefault();
            undo()
        }
        if (e.code === 'KeyS' && (e.metaKey || e.ctrlKey)) {
            e.preventDefault();
            openSaveModal()
        }
    });
    saveToHistory();
    updateUI();
    renderFavorites();
    drawIdleWaveform();
</script>
<script src="../logo.js"></script>
</body>
</html>