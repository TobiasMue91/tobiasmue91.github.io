<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="description" content="Create beautiful, interactive family trees online. Free family tree builder with drag-and-drop interface, photo support, automatic layout, and export to PNG/JSON. Build and visualize your family history.">
    <meta name="keywords" content="family tree builder, genealogy tool, family tree maker, ancestry chart, family history, interactive family tree, genealogy software, family tree creator, pedigree chart">
    <meta name="author" content="Claude Sonnet 4.5 prompted by Tobias M√ºller">
    <meta name="robots" content="index, follow">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="canonical" href="https://www.gptgames.dev/tools/family_tree_builder.html">
    <meta property="og:title" content="Family Tree Builder - Interactive Online Genealogy Tool">
    <meta property="og:description" content="Create beautiful, interactive family trees online. Free family tree builder with drag-and-drop interface, photo support, automatic layout, and export to PNG/JSON. Build and visualize your family history.">
    <meta property="og:image" content="https://www.gptgames.dev/screenshots/screenshot_220.webp">
    <meta property="og:url" content="https://www.gptgames.dev/tools/family_tree_builder.html">
    <meta property="og:type" content="website">
    <meta property="og:site_name" content="GPT Games">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Family Tree Builder - Interactive Online Genealogy Tool">
    <meta name="twitter:description" content="Create beautiful, interactive family trees online. Free family tree builder with drag-and-drop interface, photo support, automatic layout, and export to PNG/JSON.">
    <meta name="twitter:image" content="https://www.gptgames.dev/screenshots/screenshot_220.webp">
    <meta name="theme-color" content="#3498db">
    <title>Family Tree Builder</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/cytoscape/3.26.0/cytoscape.min.js"></script>
    <style>
        *{margin:0;padding:0;box-sizing:border-box}
        :root{--bg:#f5f7fa;--surface:#ffffff;--text:#2c3e50;--text-secondary:#7f8c8d;--primary:#3498db;--secondary:#2ecc71;--danger:#e74c3c;--warning:#f39c12;--border:#dfe6e9;--shadow:rgba(0,0,0,0.1);--male:#3498db;--female:#e91e63;--other:#9b59b6;--accent:#8e44ad}
        @media(prefers-color-scheme:dark){:root{--bg:#1a1a2e;--surface:#16213e;--text:#eee;--text-secondary:#aaa;--border:#2a2a4e;--shadow:rgba(0,0,0,0.3)}}
        body{font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,Oxygen,Ubuntu,Cantarell,sans-serif;background:var(--bg);color:var(--text);overflow:hidden;height:100vh}
        #cy{width:100%;height:100vh;background:var(--bg)}
        .toolbar{position:fixed;top:20px;left:20px;background:var(--surface);padding:15px;border-radius:12px;box-shadow:0 4px 12px var(--shadow);display:flex;gap:8px;flex-wrap:wrap;max-width:calc(100vw - 40px);z-index:100;transition:transform 0.3s}
        .toolbar.collapsed{transform:translateY(-110%)}
        .toolbar-toggle{position:fixed;top:20px;left:20px;background:var(--surface);border:none;padding:12px;border-radius:12px;box-shadow:0 4px 12px var(--shadow);cursor:pointer;z-index:99;font-size:20px;display:none}
        .toolbar.collapsed + .toolbar-toggle{display:block}
        .btn{padding:10px 16px;border:none;border-radius:8px;background:var(--primary);color:#fff;cursor:pointer;font-size:14px;font-weight:500;transition:all 0.2s;display:inline-flex;align-items:center;gap:6px;white-space:nowrap}
        .btn:hover{transform:translateY(-2px);box-shadow:0 4px 8px var(--shadow)}
        .btn:active{transform:translateY(0)}
        .btn.secondary{background:var(--secondary)}
        .btn.danger{background:var(--danger)}
        .btn.warning{background:var(--warning)}
        .btn.outline{background:transparent;color:var(--primary);border:2px solid var(--primary)}
        .btn.icon{padding:10px;min-width:40px;justify-content:center}
        .btn:disabled{opacity:0.5;cursor:not-allowed;transform:none}
        .modal{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.5);z-index:1000;justify-content:center;align-items:center;animation:fadeIn 0.2s}
        .modal.active{display:flex}
        @keyframes fadeIn{from{opacity:0}to{opacity:1}}
        @keyframes slideUp{from{transform:translateY(20px);opacity:0}to{transform:translateY(0);opacity:1}}
        .modal-content{background:var(--surface);border-radius:16px;padding:30px;max-width:500px;width:90%;max-height:90vh;overflow-y:auto;box-shadow:0 10px 40px var(--shadow);animation:slideUp 0.3s}
        .modal-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:25px}
        .modal-header h2{font-size:24px;color:var(--text)}
        .close{font-size:28px;cursor:pointer;color:var(--text-secondary);background:none;border:none;transition:color 0.2s}
        .close:hover{color:var(--danger)}
        .form-group{margin-bottom:20px}
        .form-group label{display:block;margin-bottom:8px;font-weight:500;font-size:14px;color:var(--text)}
        .form-group input,.form-group select,.form-group textarea{width:100%;padding:12px;border:2px solid var(--border);border-radius:8px;font-size:14px;background:var(--surface);color:var(--text);transition:border 0.2s}
        .form-group input:focus,.form-group select:focus,.form-group textarea:focus{outline:none;border-color:var(--primary)}
        .form-group textarea{resize:vertical;min-height:80px;font-family:inherit}
        .form-group input[type="file"]{padding:8px}
        .photo-preview{width:100px;height:100px;object-fit:cover;border-radius:8px;margin-top:10px;display:none;border:2px solid var(--border)}
        .photo-preview.active{display:block}
        .btn-group{display:flex;gap:10px;margin-top:25px}
        .btn-group .btn{flex:1}
        .context-menu{position:fixed;background:var(--surface);border-radius:8px;box-shadow:0 4px 16px var(--shadow);padding:8px;display:none;z-index:1001;min-width:180px;animation:fadeIn 0.15s}
        .context-menu.active{display:block}
        .context-menu-item{padding:10px 16px;cursor:pointer;border-radius:4px;font-size:14px;transition:background 0.2s;color:var(--text);display:flex;align-items:center;gap:8px}
        .context-menu-item:hover{background:var(--border)}
        .context-menu-item.danger:hover{background:var(--danger);color:#fff}
        .context-menu hr{border:none;border-top:1px solid var(--border);margin:4px 0}
        .search-box{padding:10px 16px;border:2px solid var(--border);border-radius:8px;font-size:14px;background:var(--surface);color:var(--text);min-width:200px}
        .search-box:focus{outline:none;border-color:var(--primary)}
        .stats{position:fixed;bottom:20px;right:20px;background:var(--surface);padding:20px;border-radius:12px;box-shadow:0 4px 12px var(--shadow);font-size:14px;color:var(--text);min-width:200px}
        .stats-title{font-weight:600;margin-bottom:12px;color:var(--text);font-size:16px}
        .stats-item{display:flex;justify-content:space-between;padding:6px 0;border-bottom:1px solid var(--border)}
        .stats-item:last-child{border-bottom:none}
        .stats-label{color:var(--text-secondary)}
        .stats-value{font-weight:600;color:var(--primary)}
        .welcome{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);text-align:center;z-index:10;pointer-events:none;max-width:600px}
        .welcome h1{font-size:48px;color:var(--text);margin-bottom:10px;opacity:0.15;font-weight:700}
        .welcome p{font-size:18px;color:var(--text-secondary);opacity:0.15;margin-bottom:20px}
        .welcome .sample-btn{opacity:0.5;pointer-events:all;padding:12px 24px;background:var(--primary);color:#fff;border:none;border-radius:8px;cursor:pointer;font-size:16px;font-weight:500;transition:all 0.3s}
        .welcome .sample-btn:hover{opacity:1;transform:scale(1.05)}
        .toast{position:fixed;bottom:20px;left:50%;transform:translateX(-50%);background:var(--surface);color:var(--text);padding:16px 24px;border-radius:8px;box-shadow:0 4px 16px var(--shadow);z-index:2000;display:none;animation:slideUp 0.3s;max-width:90vw;border-left:4px solid var(--primary)}
        .toast.active{display:block}
        .toast.success{border-left-color:var(--secondary)}
        .toast.error{border-left-color:var(--danger)}
        .toast.warning{border-left-color:var(--warning)}
        .tooltip{position:fixed;background:var(--surface);color:var(--text);padding:12px 16px;border-radius:8px;box-shadow:0 4px 12px var(--shadow);z-index:999;display:none;max-width:300px;font-size:13px;pointer-events:none;border:1px solid var(--border)}
        .tooltip.active{display:block}
        .tooltip-name{font-weight:600;font-size:15px;margin-bottom:6px;color:var(--primary)}
        .tooltip-info{color:var(--text-secondary);margin:4px 0;display:flex;align-items:center;gap:6px}
        .help-content{line-height:1.8}
        .help-content h3{margin:20px 0 10px 0;color:var(--primary);font-size:18px}
        .help-content h3:first-child{margin-top:0}
        .help-content ul{margin:10px 0 10px 20px}
        .help-content li{margin:5px 0}
        .help-content kbd{background:var(--border);padding:2px 6px;border-radius:4px;font-family:monospace;font-size:12px}
        .shortcut{display:flex;justify-content:space-between;padding:8px;border-radius:4px;margin:4px 0}
        .shortcut:hover{background:var(--border)}
        @media(max-width:768px){.toolbar{flex-direction:column;gap:8px;padding:12px}.btn{width:100%;justify-content:center}.search-box{width:100%}.stats{bottom:10px;right:10px;padding:12px;min-width:150px;font-size:12px}.welcome h1{font-size:32px}.welcome p{font-size:14px}}
    </style>
</head>
<body>
<div class="toolbar" id="toolbar">
    <button class="btn" onclick="app.addRootPerson()" title="Add first person (or ancestor)">üë§ Add Root</button>
    <button class="btn secondary" onclick="app.addRelative('child')" title="Add child to selected person (C)">üë∂ Child</button>
    <button class="btn secondary" onclick="app.addRelative('spouse')" title="Add spouse to selected person (S)">üíë Spouse</button>
    <button class="btn secondary" onclick="app.addRelative('parent')" title="Add parent to selected person (P)">üë™ Parent</button>
    <button class="btn secondary" onclick="app.addRelative('sibling')" title="Add sibling to selected person">üë´ Sibling</button>
    <button class="btn outline" onclick="app.autoLayout()" title="Auto-arrange tree (L)">üîÑ Layout</button>
    <button class="btn outline" onclick="app.fitView()" title="Fit all to view (F)">üîç Fit</button>
    <input type="text" class="search-box" placeholder="üîé Search..." oninput="app.search(this.value)" title="Search by name or notes">
    <button class="btn outline" onclick="app.exportPNG()" title="Export as PNG image">üì∏ PNG</button>
    <button class="btn outline" onclick="app.exportJSON()" title="Export data as JSON">üíæ Save</button>
    <button class="btn outline" onclick="app.importJSON()" title="Import JSON file">üìÇ Load</button>
    <button class="btn outline" onclick="app.showHelp()" title="Show help (H)">‚ùì Help</button>
    <button class="btn icon outline" onclick="app.toggleToolbar()" title="Collapse toolbar">‚ñ≤</button>
    <button class="btn warning" onclick="app.undo()" id="undoBtn" disabled title="Undo last action (Ctrl+Z)">‚Ü∂</button>
    <button class="btn danger" onclick="app.clearTree()" title="Clear entire tree">üóëÔ∏è Clear</button>
</div>
<button class="toolbar-toggle" onclick="app.toggleToolbar()">‚ò∞</button>
<div id="cy"></div>
<div class="welcome" id="welcome">
    <h1>Family Tree Builder</h1>
    <p>Create and visualize your family history with an interactive, beautiful tree</p>
    <button class="sample-btn" onclick="app.loadSampleData()">üìö Load Sample Family</button>
    <p style="margin-top:15px;font-size:14px">or click "Add Root" to start from scratch</p>
</div>
<div class="stats" id="stats">
    <div class="stats-title">Tree Statistics</div>
    <div class="stats-item"><span class="stats-label">People:</span><span class="stats-value" id="statPeople">0</span></div>
    <div class="stats-item"><span class="stats-label">Generations:</span><span class="stats-value" id="statGen">0</span></div>
    <div class="stats-item"><span class="stats-label">Marriages:</span><span class="stats-value" id="statMarriage">0</span></div>
    <div class="stats-item"><span class="stats-label">Living:</span><span class="stats-value" id="statLiving">0</span></div>
</div>
<div class="modal" id="personModal">
    <div class="modal-content">
        <div class="modal-header">
            <h2 id="modalTitle">Add Person</h2>
            <button class="close" onclick="app.closeModal()" title="Close (Esc)">&times;</button>
        </div>
        <form id="personForm">
            <div class="form-group">
                <label>Full Name *</label>
                <input type="text" id="name" required placeholder="Enter full name" autocomplete="off">
            </div>
            <div class="form-group">
                <label>Gender</label>
                <select id="gender">
                    <option value="male">Male</option>
                    <option value="female">Female</option>
                    <option value="other">Other</option>
                </select>
            </div>
            <div class="form-group">
                <label>Birth Date</label>
                <input type="date" id="birth">
            </div>
            <div class="form-group">
                <label>Death Date <span style="color:var(--text-secondary);font-size:12px">(leave empty if living)</span></label>
                <input type="date" id="death">
            </div>
            <div class="form-group">
                <label>Photo</label>
                <input type="file" id="photo" accept="image/*" onchange="app.previewPhoto(this)">
                <img id="photoPreview" class="photo-preview" alt="Preview">
            </div>
            <div class="form-group">
                <label>Notes / Biography</label>
                <textarea id="notes" placeholder="Add personal notes, biography, or interesting facts..."></textarea>
            </div>
            <div class="btn-group">
                <button type="button" class="btn outline" onclick="app.closeModal()">Cancel</button>
                <button type="submit" class="btn">üíæ Save Person</button>
            </div>
        </form>
    </div>
</div>
<div class="modal" id="helpModal">
    <div class="modal-content">
        <div class="modal-header">
            <h2>Help & Keyboard Shortcuts</h2>
            <button class="close" onclick="app.closeHelpModal()">&times;</button>
        </div>
        <div class="help-content">
            <h3>Getting Started</h3>
            <ul>
                <li>Click <strong>"Add Root"</strong> to create your first person</li>
                <li><strong>Right-click</strong> any person to add relatives or edit details</li>
                <li><strong>Drag</strong> to pan, <strong>scroll</strong> to zoom</li>
                <li><strong>Click</strong> a person to select them</li>
                <li><strong>Hover</strong> over a person to see quick info</li>
            </ul>
            <h3>Keyboard Shortcuts</h3>
            <div class="shortcut"><span>Select person & press <kbd>C</kbd></span><span>Add Child</span></div>
            <div class="shortcut"><span>Select person & press <kbd>S</kbd></span><span>Add Spouse</span></div>
            <div class="shortcut"><span>Select person & press <kbd>P</kbd></span><span>Add Parent</span></div>
            <div class="shortcut"><span>Select person & press <kbd>E</kbd></span><span>Edit Person</span></div>
            <div class="shortcut"><span>Select person & press <kbd>Delete</kbd></span><span>Delete Person</span></div>
            <div class="shortcut"><span><kbd>Ctrl/Cmd + Z</kbd></span><span>Undo</span></div>
            <div class="shortcut"><span><kbd>L</kbd></span><span>Auto Layout</span></div>
            <div class="shortcut"><span><kbd>F</kbd></span><span>Fit View</span></div>
            <div class="shortcut"><span><kbd>H</kbd></span><span>Show Help</span></div>
            <div class="shortcut"><span><kbd>Esc</kbd></span><span>Close Modal/Deselect</span></div>
            <h3>Tips</h3>
            <ul>
                <li>Color coding: Blue = Male, Pink = Female, Purple = Other</li>
                <li>Solid lines = Parent-child relationships</li>
                <li>Dashed lines = Spouse/marriage relationships</li>
                <li>Age is calculated automatically from birth date</li>
                <li>All changes auto-save to your browser</li>
                <li>Export to PNG for sharing or printing</li>
                <li>Export to JSON for backup or transferring to another device</li>
            </ul>
        </div>
    </div>
</div>
<div class="context-menu" id="contextMenu">
    <div class="context-menu-item" onclick="app.editPerson()">‚úèÔ∏è Edit Details</div>
    <hr>
    <div class="context-menu-item" onclick="app.addRelative('child')">üë∂ Add Child</div>
    <div class="context-menu-item" onclick="app.addRelative('spouse')">üíë Add Spouse</div>
    <div class="context-menu-item" onclick="app.addRelative('parent')">üë™ Add Parent</div>
    <div class="context-menu-item" onclick="app.addRelative('sibling')">üë´ Add Sibling</div>
    <hr>
    <div class="context-menu-item danger" onclick="app.deletePerson()">üóëÔ∏è Delete Person</div>
</div>
<div class="tooltip" id="tooltip">
    <div class="tooltip-name"></div>
    <div class="tooltip-info"></div>
</div>
<div class="toast" id="toast"></div>
<input type="file" id="importFile" accept=".json" style="display:none" onchange="app.loadImportedFile(this)">
<script>
    const app={cy:null,selectedNode:null,editingNode:null,relationshipMode:null,undoStack:[],maxUndoSteps:10,tooltipTimeout:null,init(){this.cy=cytoscape({container:document.getElementById('cy'),style:[{selector:'node',style:{'background-color':'data(color)','label':'data(label)','text-valign':'center','text-halign':'center','width':120,'height':120,'font-size':13,'color':'#fff','text-wrap':'wrap','text-max-width':100,'shape':'roundrectangle','border-width':4,'border-color':'#fff','background-image':'data(photo)','background-fit':'cover','background-clip':'none','text-background-color':'rgba(0,0,0,0.4)','text-background-opacity':1,'text-background-shape':'roundrectangle','text-background-padding':'3px','font-weight':600,'transition-property':'border-color, border-width','transition-duration':'0.2s'}},{selector:'edge',style:{'width':3,'line-color':'#bdc3c7','target-arrow-color':'#bdc3c7','curve-style':'bezier','opacity':0.7}},{selector:'.parent-edge',style:{'target-arrow-shape':'triangle','line-style':'solid','width':3}},{selector:'.spouse-edge',style:{'line-style':'dashed','width':2}},{selector:'.highlighted',style:{'border-color':'#f39c12','border-width':6}},{selector:'.dimmed',style:{opacity:0.25}}],layout:{name:'preset'},minZoom:0.3,maxZoom:3});this.cy.on('tap','node',e=>this.selectNode(e.target));this.cy.on('cxttap','node',e=>this.showContextMenu(e));this.cy.on('tap',e=>{if(e.target===this.cy){this.deselectNode();this.hideContextMenu()}});this.cy.on('mouseover','node',e=>this.showTooltip(e));this.cy.on('mouseout','node',()=>this.hideTooltip());document.addEventListener('click',()=>this.hideContextMenu());document.getElementById('personForm').onsubmit=e=>{e.preventDefault();this.savePerson()};this.setupKeyboardShortcuts();this.loadFromStorage();if(this.cy.nodes().length===0){document.getElementById('welcome').style.display='block'}else{document.getElementById('welcome').style.display='none'}this.updateStats()},setupKeyboardShortcuts(){document.addEventListener('keydown',e=>{if(e.target.tagName==='INPUT'||e.target.tagName==='TEXTAREA')return;if(e.key==='Escape'){this.closeModal();this.closeHelpModal();this.deselectNode();this.hideContextMenu()}if(!this.selectedNode)return;if(e.key==='Delete'||e.key==='Backspace'){e.preventDefault();this.deletePerson()}if(e.key.toLowerCase()==='e'){e.preventDefault();this.editPerson()}if(e.key.toLowerCase()==='c'){e.preventDefault();this.addRelative('child')}if(e.key.toLowerCase()==='s'){e.preventDefault();this.addRelative('spouse')}if(e.key.toLowerCase()==='p'){e.preventDefault();this.addRelative('parent')}});document.addEventListener('keydown',e=>{if((e.ctrlKey||e.metaKey)&&e.key==='z'){e.preventDefault();this.undo()}if(e.key.toLowerCase()==='l'&&!e.ctrlKey&&!e.metaKey&&e.target.tagName!=='INPUT'){e.preventDefault();this.autoLayout()}if(e.key.toLowerCase()==='f'&&!e.ctrlKey&&!e.metaKey&&e.target.tagName!=='INPUT'){e.preventDefault();this.fitView()}if(e.key.toLowerCase()==='h'&&!e.ctrlKey&&!e.metaKey&&e.target.tagName!=='INPUT'){e.preventDefault();this.showHelp()}})},selectNode(node){if(this.selectedNode){this.selectedNode.removeClass('highlighted')}this.selectedNode=node;node.addClass('highlighted')},deselectNode(){if(this.selectedNode){this.selectedNode.removeClass('highlighted');this.selectedNode=null}},showContextMenu(e){e.preventDefault();this.selectNode(e.target);const menu=document.getElementById('contextMenu');const x=Math.min(e.renderedPosition.x,window.innerWidth-200);const y=Math.min(e.renderedPosition.y,window.innerHeight-250);menu.style.left=x+'px';menu.style.top=y+'px';menu.classList.add('active')},hideContextMenu(){document.getElementById('contextMenu').classList.remove('active')},showTooltip(e){clearTimeout(this.tooltipTimeout);this.tooltipTimeout=setTimeout(()=>{const data=e.target.data();const tooltip=document.getElementById('tooltip');const name=tooltip.querySelector('.tooltip-name');const info=tooltip.querySelector('.tooltip-info');name.textContent=data.name;let infoHTML='';if(data.birth){const age=this.calculateAge(data.birth,data.death);infoHTML+=`<div>üìÖ Born: ${this.formatDate(data.birth)}</div>`;if(data.death){infoHTML+=`<div>‚ö∞Ô∏è Died: ${this.formatDate(data.death)} (Age ${age})</div>`}else{infoHTML+=`<div>üéÇ Age: ${age}</div>`}}const children=this.cy.edges(`[source="${data.id}"]`).filter('.parent-edge').length;const spouses=this.cy.edges(`[source="${data.id}"], [target="${data.id}"]`).filter('.spouse-edge').length;if(children>0)infoHTML+=`<div>üë∂ Children: ${children}</div>`;if(spouses>0)infoHTML+=`<div>üíë Spouses: ${spouses}</div>`;if(data.notes)infoHTML+=`<div style="margin-top:8px;padding-top:8px;border-top:1px solid var(--border)">üìù ${data.notes.substring(0,100)}${data.notes.length>100?'...':''}</div>`;info.innerHTML=infoHTML;const x=Math.min(e.renderedPosition.x+20,window.innerWidth-320);const y=Math.min(e.renderedPosition.y+20,window.innerHeight-200);tooltip.style.left=x+'px';tooltip.style.top=y+'px';tooltip.classList.add('active')},500)},hideTooltip(){clearTimeout(this.tooltipTimeout);document.getElementById('tooltip').classList.remove('active')},calculateAge(birth,death){if(!birth)return'?';const start=new Date(birth);const end=death?new Date(death):new Date();const age=Math.floor((end-start)/(365.25*24*60*60*1000));return age>=0?age:'?'},formatDate(dateStr){if(!dateStr)return'';const d=new Date(dateStr);return d.toLocaleDateString('en-US',{year:'numeric',month:'short',day:'numeric'})},showToast(message,type='info'){const toast=document.getElementById('toast');toast.textContent=message;toast.className='toast active '+type;setTimeout(()=>toast.classList.remove('active'),3000)},openModal(title='Add Person'){document.getElementById('modalTitle').textContent=title;document.getElementById('personModal').classList.add('active');setTimeout(()=>document.getElementById('name').focus(),100)},closeModal(){document.getElementById('personModal').classList.remove('active');document.getElementById('personForm').reset();document.getElementById('photoPreview').classList.remove('active');this.editingNode=null},showHelp(){document.getElementById('helpModal').classList.add('active')},closeHelpModal(){document.getElementById('helpModal').classList.remove('active')},previewPhoto(input){const preview=document.getElementById('photoPreview');if(input.files&&input.files[0]){if(input.files[0].size>2*1024*1024){this.showToast('Photo too large. Please use an image under 2MB','warning');input.value='';return}const reader=new FileReader();reader.onload=e=>{preview.src=e.target.result;preview.classList.add('active')};reader.readAsDataURL(input.files[0])}},addRootPerson(){if(this.cy.nodes().length>0){this.showToast('Tree already has people. Select someone and add relatives.','warning');return}this.relationshipMode=null;this.openModal('Add First Person')},addRelative(type){if(!this.selectedNode){this.showToast('Please select a person first','warning');return}this.relationshipMode=type;const typeNames={child:'Child',spouse:'Spouse',parent:'Parent',sibling:'Sibling'};this.openModal(`Add ${typeNames[type]}`)},editPerson(){if(!this.selectedNode)return;this.editingNode=this.selectedNode;const data=this.selectedNode.data();document.getElementById('name').value=data.name||'';document.getElementById('gender').value=data.gender||'male';document.getElementById('birth').value=data.birth||'';document.getElementById('death').value=data.death||'';document.getElementById('notes').value=data.notes||'';if(data.photoData){document.getElementById('photoPreview').src=data.photoData;document.getElementById('photoPreview').classList.add('active')}this.openModal('Edit Person');this.hideContextMenu()},saveState(){const state=JSON.stringify({nodes:this.cy.nodes().map(n=>({data:n.data(),position:n.position()})),edges:this.cy.edges().map(e=>({data:e.data(),classes:e.classes()}))});this.undoStack.push(state);if(this.undoStack.length>this.maxUndoSteps){this.undoStack.shift()}document.getElementById('undoBtn').disabled=false},undo(){if(this.undoStack.length===0)return;const state=JSON.parse(this.undoStack.pop());this.cy.elements().remove();state.nodes.forEach(n=>this.cy.add({group:'nodes',data:n.data,position:n.position}));state.edges.forEach(e=>this.cy.add({group:'edges',data:e.data,classes:e.classes.join(' ')}));this.deselectNode();this.saveToStorage();this.updateStats();this.showToast('Undo successful','success');if(this.undoStack.length===0){document.getElementById('undoBtn').disabled=true}},savePerson(){const name=document.getElementById('name').value.trim();if(!name){this.showToast('Name is required','error');return}const gender=document.getElementById('gender').value;const birth=document.getElementById('birth').value;const death=document.getElementById('death').value;const notes=document.getElementById('notes').value.trim();if(birth&&death&&new Date(birth)>new Date(death)){this.showToast('Birth date cannot be after death date','error');return}const photoFile=document.getElementById('photo').files[0];const processData=photoData=>{const color=gender==='male'?'#3498db':gender==='female'?'#e91e63':'#9b59b6';const age=this.calculateAge(birth,death);let label=name;if(birth){label+=`\n${age!=='?'?age+' yrs':'Born '+birth.split('-')[0]}`}if(death){label+=` ‚ö∞Ô∏è`}if(this.editingNode){this.saveState();this.editingNode.data({name,gender,birth,death,notes,label,color,photoData:photoData||this.editingNode.data('photoData'),photo:photoData||this.editingNode.data('photo')});this.showToast('Person updated','success')}else{this.saveState();const id=Date.now().toString();const newNode=this.cy.add({group:'nodes',data:{id,name,gender,birth,death,notes,label,color,photoData,photo:photoData},position:{x:400,y:300}});if(this.relationshipMode&&this.selectedNode){const parentId=this.selectedNode.id();if(this.relationshipMode==='child'){this.cy.add({group:'edges',data:{source:parentId,target:id},classes:'parent-edge'})}else if(this.relationshipMode==='spouse'){this.cy.add({group:'edges',data:{source:parentId,target:id},classes:'spouse-edge'})}else if(this.relationshipMode==='parent'){this.cy.add({group:'edges',data:{source:id,target:parentId},classes:'parent-edge'})}else if(this.relationshipMode==='sibling'){const parentEdges=this.cy.edges(`[target="${parentId}"]`).filter('.parent-edge');if(parentEdges.length>0){const commonParent=parentEdges[0].source().id();this.cy.add({group:'edges',data:{source:commonParent,target:id},classes:'parent-edge'})}}}this.selectNode(newNode);setTimeout(()=>this.autoLayout(),100);this.showToast('Person added','success')}document.getElementById('welcome').style.display='none';this.saveToStorage();this.updateStats();this.closeModal()};if(photoFile){const reader=new FileReader();reader.onload=e=>processData(e.target.result);reader.readAsDataURL(photoFile)}else{processData(this.editingNode?this.editingNode.data('photoData'):null)}},deletePerson(){if(!this.selectedNode)return;const name=this.selectedNode.data('name');if(confirm(`Delete ${name} and all their connections?\n\nThis cannot be undone.`)){this.saveState();this.selectedNode.remove();this.selectedNode=null;this.saveToStorage();this.updateStats();this.showToast('Person deleted','success');if(this.cy.nodes().length===0){document.getElementById('welcome').style.display='block'}}this.hideContextMenu()},autoLayout(){if(this.cy.nodes().length===0)return;const roots=this.cy.nodes().filter(n=>n.indegree()===0);if(roots.length===0){this.showToast('Auto-layout works best with clear parent-child relationships','warning');return}const layout=this.cy.layout({name:'breadthfirst',directed:true,roots:roots,padding:80,spacingFactor:1.8,avoidOverlap:true,animate:true,animationDuration:500,fit:true});layout.run();this.showToast('Layout applied','success')},fitView(){if(this.cy.nodes().length===0)return;this.cy.fit(null,80);this.cy.center()},search(query){if(!query){this.cy.nodes().removeClass('dimmed highlighted');return}const q=query.toLowerCase();const matches=this.cy.nodes().filter(n=>n.data('name').toLowerCase().includes(q)||n.data('notes').toLowerCase().includes(q));this.cy.nodes().addClass('dimmed');matches.removeClass('dimmed').addClass('highlighted');if(matches.length>0){this.cy.animate({fit:{eles:matches,padding:100},duration:300})}},toggleToolbar(){document.getElementById('toolbar').classList.toggle('collapsed')},saveToStorage(){const data={nodes:this.cy.nodes().map(n=>({data:n.data(),position:n.position()})),edges:this.cy.edges().map(e=>({data:e.data(),classes:e.classes()}))};localStorage.setItem('familyTree',JSON.stringify(data))},loadFromStorage(){const saved=localStorage.getItem('familyTree');if(saved){try{const data=JSON.parse(saved);data.nodes.forEach(n=>this.cy.add({group:'nodes',data:n.data,position:n.position}));data.edges.forEach(e=>this.cy.add({group:'edges',data:e.data,classes:e.classes.join(' ')}));this.fitView()}catch(e){console.error('Error loading saved data',e)}}},exportJSON(){const data={nodes:this.cy.nodes().map(n=>({data:n.data(),position:n.position()})),edges:this.cy.edges().map(e=>({data:e.data(),classes:e.classes()})),exportDate:new Date().toISOString(),version:'1.0'};const blob=new Blob([JSON.stringify(data,null,2)],{type:'application/json'});const url=URL.createObjectURL(blob);const a=document.createElement('a');a.href=url;a.download='family-tree-'+new Date().toISOString().split('T')[0]+'.json';a.click();URL.revokeObjectURL(url);this.showToast('Family tree exported','success')},exportPNG(){if(this.cy.nodes().length===0){this.showToast('Nothing to export','warning');return}const png=this.cy.png({output:'blob',bg:'white',full:true,scale:2});const url=URL.createObjectURL(png);const a=document.createElement('a');a.href=url;a.download='family-tree-'+new Date().toISOString().split('T')[0]+'.png';a.click();URL.revokeObjectURL(url);this.showToast('Image exported','success')},importJSON(){document.getElementById('importFile').click()},loadImportedFile(input){if(!input.files||!input.files[0])return;const reader=new FileReader();reader.onload=e=>{try{const data=JSON.parse(e.target.result);if(this.cy.nodes().length>0&&!confirm('This will replace your current tree. Continue?')){return}this.saveState();this.cy.elements().remove();data.nodes.forEach(n=>this.cy.add({group:'nodes',data:n.data,position:n.position}));data.edges.forEach(e=>this.cy.add({group:'edges',data:e.data,classes:e.classes.join(' ')}));this.fitView();this.saveToStorage();this.updateStats();document.getElementById('welcome').style.display='none';this.showToast('Family tree loaded successfully','success')}catch(err){this.showToast('Invalid file format','error')}};reader.readAsText(input.files[0]);input.value=''},clearTree(){if(this.cy.nodes().length===0)return;if(confirm('Clear entire family tree?\n\nThis will delete all people and relationships.\nThis cannot be undone.')){this.saveState();this.cy.elements().remove();this.saveToStorage();this.updateStats();document.getElementById('welcome').style.display='block';this.showToast('Tree cleared','success')}},loadSampleData(){if(this.cy.nodes().length>0&&!confirm('This will replace your current tree. Continue?')){return}this.cy.elements().remove();const sample=[{id:'1',name:'Robert Smith',gender:'male',birth:'1920-03-15',death:'1995-08-20',notes:'Family patriarch, WWII veteran',x:400,y:100},{id:'2',name:'Mary Johnson',gender:'female',birth:'1922-07-22',death:'2010-12-05',notes:'Homemaker and community volunteer',x:600,y:100},{id:'3',name:'John Smith',gender:'male',birth:'1945-05-10',death:'',notes:'Engineer, loves woodworking',x:300,y:300},{id:'4',name:'Patricia Davis',gender:'female',birth:'1947-09-18',death:'',notes:'Teacher for 35 years',x:500,y:300},{id:'5',name:'Susan Smith',gender:'female',birth:'1950-11-30',death:'',notes:'Doctor, classical pianist',x:700,y:300},{id:'6',name:'Michael Brown',gender:'male',birth:'1948-02-14',death:'',notes:'Architect, marathon runner',x:900,y:300},{id:'7',name:'Jennifer Smith',gender:'female',birth:'1975-04-25',death:'',notes:'Software engineer at tech startup',x:200,y:500},{id:'8',name:'David Smith',gender:'male',birth:'1978-08-30',death:'',notes:'High school math teacher',x:400,y:500},{id:'9',name:'Emily Wilson',gender:'female',birth:'1980-12-10',death:'',notes:'Graphic designer, yoga instructor',x:600,y:500},{id:'10',name:'Sarah Brown',gender:'female',birth:'1976-06-15',death:'',notes:'Veterinarian, animal rescue advocate',x:800,y:500},{id:'11',name:'Christopher Brown',gender:'male',birth:'1979-03-20',death:'',notes:'Chef and restaurant owner',x:1000,y:500}];sample.forEach(p=>{this.cy.add({group:'nodes',data:{id:p.id,name:p.name,gender:p.gender,birth:p.birth,death:p.death,notes:p.notes,color:p.gender==='male'?'#3498db':p.gender==='female'?'#e91e63':'#9b59b6',label:p.name+'\n'+(p.birth?this.calculateAge(p.birth,p.death)+' yrs':'')+(p.death?' ‚ö∞Ô∏è':'')},position:{x:p.x,y:p.y}})});const edges=[['1','3'],['1','5'],['2','3'],['2','5'],['3','7'],['3','8'],['4','7'],['4','8'],['5','10'],['5','11'],['6','10'],['6','11'],['3','4','spouse'],['5','6','spouse'],['8','9','spouse']];edges.forEach(e=>{this.cy.add({group:'edges',data:{source:e[0],target:e[1]},classes:e[2]==='spouse'?'spouse-edge':'parent-edge'})});document.getElementById('welcome').style.display='none';this.saveToStorage();this.updateStats();this.fitView();this.showToast('Sample family loaded - explore and edit!','success')},updateStats(){const nodes=this.cy.nodes();const count=nodes.length;const living=nodes.filter(n=>!n.data('death')).length;const marriages=this.cy.edges('.spouse-edge').length;let maxGen=0;nodes.forEach(n=>{const depth=this.cy.edges(`[target="${n.id()}"]`).filter('.parent-edge').length;maxGen=Math.max(maxGen,depth)});document.getElementById('statPeople').textContent=count;document.getElementById('statGen').textContent=count>0?maxGen+1:0;document.getElementById('statMarriage').textContent=Math.floor(marriages/2);document.getElementById('statLiving').textContent=living}};window.onload=()=>app.init();
</script>
<script src="../logo.js"></script>
</body>
</html>