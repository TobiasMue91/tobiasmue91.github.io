<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <meta name="description" content="Remove password protection from PDF files directly in your browser. No upload, no server â€” all processing happens locally and privately.">
    <meta name="keywords" content="PDF password remover, unlock PDF, remove PDF password, PDF unlocker, browser PDF tool, offline PDF tool">
    <meta name="author" content="Claude Opus 4.6 prompted by Tobias MÃ¼ller">
    <meta name="robots" content="index, follow">
    <link rel="canonical" href="https://www.gptgames.dev/tools/pdf_password_unlocker.html">
    <meta property="og:type" content="website">
    <meta property="og:title" content="PDF Password Unlocker â€” Remove PDF Protection Locally">
    <meta property="og:description" content="Remove password protection from PDF files directly in your browser. No upload, no server â€” all processing happens locally and privately.">
    <meta property="og:url" content="https://www.gptgames.dev/tools/pdf_password_unlocker.html">
    <meta property="og:image" content="https://www.gptgames.dev/screenshots/screenshot_248.webp">
    <meta property="og:site_name" content="GPT Games">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="PDF Password Unlocker â€” Remove PDF Protection Locally">
    <meta name="twitter:description" content="Remove password protection from PDF files directly in your browser. No upload, no server â€” all processing happens locally and privately.">
    <meta name="twitter:image" content="https://www.gptgames.dev/screenshots/screenshot_248.webp">
    <title>PDF Password Unlocker</title>
    <link rel="icon"
          href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ðŸ”“</text></svg>">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box
        }

        :root {
            --bg: #f0f2f5;
            --surface: #fff;
            --surface-alt: #f7f8fa;
            --border: #e0e3e8;
            --text: #1a1a2e;
            --text2: #6b7280;
            --text3: #9ca3af;
            --accent: #2563eb;
            --accent-h: #1d4ed8;
            --accent-soft: #eff4ff;
            --danger: #dc2626;
            --danger-soft: #fef2f2;
            --success: #16a34a;
            --success-soft: #f0fdf4;
            --info: #0284c7;
            --info-soft: #f0f9ff;
            --sh: 0 1px 3px rgba(0, 0, 0, .06), 0 1px 2px rgba(0, 0, 0, .04);
            --sh-lg: 0 4px 12px rgba(0, 0, 0, .08)
        }

        @media (prefers-color-scheme: dark) {
            :root {
                --bg: #0c0d12;
                --surface: #16181f;
                --surface-alt: #1e2028;
                --border: #2a2d38;
                --text: #e4e6eb;
                --text2: #9ca3af;
                --text3: #6b7280;
                --accent: #3b82f6;
                --accent-h: #60a5fa;
                --accent-soft: #1e2a4a;
                --danger: #ef4444;
                --danger-soft: #2a1515;
                --success: #22c55e;
                --success-soft: #152a18;
                --info: #38bdf8;
                --info-soft: #0c2a3e;
                --sh: 0 1px 3px rgba(0, 0, 0, .2);
                --sh-lg: 0 4px 12px rgba(0, 0, 0, .3)
            }
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--bg);
            color: var(--text);
            min-height: 100vh;
            min-height: 100dvh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 20px
        }

        .container {
            max-width: 520px;
            width: 100%
        }

        .card {
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 16px;
            padding: 40px 32px;
            box-shadow: var(--sh)
        }

        .header {
            text-align: center;
            margin-bottom: 32px
        }

        .logo {
            width: 52px;
            height: 52px;
            background: var(--accent-soft);
            border: 1px solid color-mix(in srgb, var(--accent) 20%, transparent);
            border-radius: 14px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 16px
        }

        .logo svg {
            width: 26px;
            height: 26px;
            color: var(--accent)
        }

        h1 {
            font-size: 1.4rem;
            font-weight: 700;
            letter-spacing: -.02em;
            margin-bottom: 4px
        }

        .subtitle {
            font-size: .85rem;
            color: var(--text2)
        }

        .dropzone {
            border: 2px dashed var(--border);
            border-radius: 12px;
            padding: 32px 24px;
            text-align: center;
            cursor: pointer;
            transition: border-color .2s, background .2s;
            position: relative
        }

        .dropzone:hover, .dropzone.dragover {
            border-color: var(--accent);
            background: var(--accent-soft)
        }

        .dropzone.has-file {
            border-style: solid;
            border-color: var(--border);
            background: var(--surface-alt);
            cursor: default
        }

        .dropzone.has-file:hover {
            border-color: var(--border);
            background: var(--surface-alt)
        }

        .dz-icon {
            margin-bottom: 10px;
            color: var(--text3)
        }

        .dz-icon svg {
            width: 32px;
            height: 32px
        }

        .dz-text {
            font-size: .875rem;
            color: var(--text2);
            line-height: 1.6
        }

        .dz-text strong {
            color: var(--accent);
            font-weight: 600
        }

        .fi {
            display: flex;
            align-items: center;
            gap: 12px;
            text-align: left
        }

        .fi-icon {
            flex-shrink: 0;
            width: 40px;
            height: 40px;
            background: var(--danger-soft);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center
        }

        .fi-icon svg {
            width: 20px;
            height: 20px;
            color: var(--danger)
        }

        .fi-details {
            flex: 1;
            min-width: 0
        }

        .fi-name {
            font-weight: 600;
            font-size: .875rem;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis
        }

        .fi-size {
            font-size: .78rem;
            color: var(--text2);
            margin-top: 1px
        }

        .fi-rm {
            flex-shrink: 0;
            background: none;
            border: none;
            cursor: pointer;
            color: var(--text3);
            padding: 6px;
            border-radius: 8px;
            transition: all .15s
        }

        .fi-rm:hover {
            color: var(--danger);
            background: var(--danger-soft)
        }

        .fi-rm svg {
            width: 16px;
            height: 16px;
            display: block
        }

        /* Messages */
        .msg {
            margin-top: 16px;
            padding: 12px 14px;
            border-radius: 10px;
            font-size: .84rem;
            line-height: 1.5;
            display: none;
            align-items: flex-start;
            gap: 10px;
            animation: fadeIn .25s ease
        }

        .msg.vis {
            display: flex
        }

        .msg svg {
            width: 18px;
            height: 18px;
            flex-shrink: 0;
            margin-top: 1px
        }

        .msg-err {
            background: var(--danger-soft);
            color: var(--danger);
            border: 1px solid color-mix(in srgb, var(--danger) 15%, transparent)
        }

        .msg-info {
            background: var(--info-soft);
            color: var(--info);
            border: 1px solid color-mix(in srgb, var(--info) 15%, transparent)
        }

        .msg-analyzing {
            background: var(--surface-alt);
            color: var(--text2);
            border: 1px solid var(--border)
        }

        /* Password */
        .pw-sec {
            margin-top: 20px;
            display: none;
            animation: fadeIn .25s ease
        }

        .pw-sec.vis {
            display: block
        }

        .pw-label {
            font-size: .8rem;
            font-weight: 600;
            color: var(--text2);
            margin-bottom: 8px;
            text-transform: uppercase;
            letter-spacing: .04em
        }

        .ig {
            position: relative
        }

        .ig input {
            width: 100%;
            padding: 12px 44px 12px 14px;
            border: 1px solid var(--border);
            border-radius: 10px;
            font-size: .9rem;
            background: var(--surface);
            color: var(--text);
            outline: none;
            transition: border-color .2s, box-shadow .2s
        }

        .ig input:focus {
            border-color: var(--accent);
            box-shadow: 0 0 0 3px color-mix(in srgb, var(--accent) 12%, transparent)
        }

        .ig input::placeholder {
            color: var(--text3)
        }

        .ig.shake {
            animation: shake .4s ease
        }

        .tpw {
            position: absolute;
            right: 8px;
            top: 50%;
            transform: translateY(-50%);
            background: none;
            border: none;
            cursor: pointer;
            color: var(--text3);
            padding: 4px;
            border-radius: 6px;
            transition: color .15s
        }

        .tpw:hover {
            color: var(--text)
        }

        .tpw svg {
            width: 20px;
            height: 20px;
            display: block
        }

        /* Quality */
        .qs {
            margin-top: 20px;
            display: none;
            animation: fadeIn .25s ease
        }

        .qs.vis {
            display: block
        }

        .qs-label {
            font-size: .8rem;
            font-weight: 600;
            color: var(--text2);
            margin-bottom: 8px;
            text-transform: uppercase;
            letter-spacing: .04em
        }

        .qs-o {
            display: flex;
            gap: 6px
        }

        .qo {
            flex: 1;
            padding: 8px 10px;
            border: 1px solid var(--border);
            border-radius: 8px;
            background: var(--surface);
            color: var(--text2);
            font-size: .82rem;
            cursor: pointer;
            text-align: center;
            transition: all .15s;
            line-height: 1.3
        }

        .qo:hover:not(.act) {
            border-color: var(--text3)
        }

        .qo.act {
            border-color: var(--accent);
            color: var(--accent);
            background: var(--accent-soft);
            font-weight: 600
        }

        .qo small {
            display: block;
            font-size: .7rem;
            font-weight: 400;
            opacity: .7;
            margin-top: 2px
        }

        /* Buttons */
        .ubtn {
            margin-top: 20px;
            width: 100%;
            padding: 13px;
            border: none;
            border-radius: 10px;
            background: var(--accent);
            color: #fff;
            font-size: .9rem;
            font-weight: 600;
            cursor: pointer;
            transition: background .15s, opacity .15s;
            display: none
        }

        .ubtn.vis {
            display: block
        }

        .ubtn:hover:not(:disabled) {
            background: var(--accent-h)
        }

        .ubtn:disabled {
            opacity: .5;
            cursor: not-allowed
        }

        /* Progress */
        .prog {
            margin-top: 20px;
            display: none;
            animation: fadeIn .2s ease
        }

        .prog.vis {
            display: block
        }

        .pb-wrap {
            height: 6px;
            background: var(--surface-alt);
            border: 1px solid var(--border);
            border-radius: 4px;
            overflow: hidden
        }

        .pb {
            height: 100%;
            background: var(--accent);
            border-radius: 4px;
            width: 0%;
            transition: width .3s ease
        }

        .prog-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 8px
        }

        .pt {
            font-size: .8rem;
            color: var(--text2)
        }

        .cancel-btn {
            font-size: .78rem;
            color: var(--danger);
            background: none;
            border: none;
            cursor: pointer;
            padding: 2px 6px;
            border-radius: 4px;
            font-weight: 500;
            transition: background .15s
        }

        .cancel-btn:hover {
            background: var(--danger-soft)
        }

        /* Results */
        .res {
            margin-top: 20px;
            display: none;
            animation: fadeIn .3s ease
        }

        .res.vis {
            display: block
        }

        .rc {
            padding: 24px;
            background: var(--surface-alt);
            border: 1px solid var(--border);
            border-radius: 12px;
            text-align: center
        }

        .thumb {
            margin-bottom: 16px
        }

        .thumb img {
            height: 100px;
            border-radius: 4px;
            box-shadow: var(--sh-lg);
            border: 1px solid var(--border)
        }

        .ri {
            color: var(--success);
            margin-bottom: 8px
        }

        .ri svg {
            width: 28px;
            height: 28px
        }

        .rt {
            font-size: .9rem;
            font-weight: 700;
            margin-bottom: 6px
        }

        .rd {
            font-size: .8rem;
            color: var(--text2);
            line-height: 1.5;
            margin-bottom: 16px
        }

        .res-btns {
            display: flex;
            gap: 8px;
            justify-content: center;
            flex-wrap: wrap
        }

        .dbtn {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 10px 22px;
            border: none;
            border-radius: 8px;
            background: var(--success);
            color: #fff;
            font-size: .85rem;
            font-weight: 600;
            cursor: pointer;
            transition: opacity .15s
        }

        .dbtn:hover {
            opacity: .88
        }

        .dbtn svg {
            width: 16px;
            height: 16px
        }

        .again-btn {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 10px 18px;
            border: 1px solid var(--border);
            border-radius: 8px;
            background: var(--surface);
            color: var(--text2);
            font-size: .85rem;
            font-weight: 500;
            cursor: pointer;
            transition: all .15s
        }

        .again-btn:hover {
            border-color: var(--text3);
            color: var(--text)
        }

        .again-btn svg {
            width: 16px;
            height: 16px
        }

        .note {
            font-size: .74rem;
            color: var(--text3);
            margin-top: 12px;
            text-align: center;
            line-height: 1.4
        }

        /* Footer */
        .footer {
            margin-top: 20px;
            text-align: center;
            font-size: .76rem;
            color: var(--text3);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px
        }

        .footer svg {
            width: 14px;
            height: 14px;
            flex-shrink: 0
        }

        /* Spinner */
        .spinner {
            width: 16px;
            height: 16px;
            border: 2px solid var(--border);
            border-top-color: var(--text2);
            border-radius: 50%;
            animation: spin .6s linear infinite;
            flex-shrink: 0
        }

        /* Animations */
        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(6px)
            }
            to {
                opacity: 1;
                transform: translateY(0)
            }
        }

        @keyframes shake {
            0%, 100% {
                transform: translateX(0)
            }
            20%, 60% {
                transform: translateX(-6px)
            }
            40%, 80% {
                transform: translateX(6px)
            }
        }

        @keyframes spin {
            to {
                transform: rotate(360deg)
            }
        }

        @media (max-width: 560px) {
            .card {
                padding: 28px 18px
            }
        }
    </style>
</head>
<body>
<div class="container">
    <div class="card">
        <div class="header">
            <div class="logo">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2"
                     stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round"
                          d="M13.5 10.5V6.75a4.5 4.5 0 119 0v3.75M3.75 21.75h10.5a2.25 2.25 0 002.25-2.25v-6.75a2.25 2.25 0 00-2.25-2.25H3.75a2.25 2.25 0 00-2.25 2.25v6.75a2.25 2.25 0 002.25 2.25z"/>
                </svg>
            </div>
            <h1>PDF Password Unlocker</h1>
            <p class="subtitle">Remove password protection from your PDF files</p>
        </div>
        <div id="dz" class="dropzone">
            <div id="dz-def">
                <div class="dz-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5"
                         stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round"
                              d="M3 16.5v2.25A2.25 2.25 0 005.25 21h13.5A2.25 2.25 0 0021 18.75V16.5m-13.5-9L12 3m0 0l4.5 4.5M12 3v13.5"/>
                    </svg>
                </div>
                <p class="dz-text"><strong>Click to upload</strong> or drag &amp; drop<br>PDF files only</p>
            </div>
            <div id="dz-fi" style="display:none">
                <div class="fi">
                    <div class="fi-icon">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2"
                             stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round"
                                  d="M19.5 14.25v-2.625a3.375 3.375 0 00-3.375-3.375h-1.5A1.125 1.125 0 0113.5 7.125v-1.5a3.375 3.375 0 00-3.375-3.375H8.25m2.25 0H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 00-9-9z"/>
                        </svg>
                    </div>
                    <div class="fi-details">
                        <div id="fn" class="fi-name"></div>
                        <div id="fs" class="fi-size"></div>
                    </div>
                    <button class="fi-rm" id="rm" title="Remove file">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2"
                             stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12"/>
                        </svg>
                    </button>
                </div>
            </div>
        </div>
        <input type="file" id="finp" accept=".pdf" hidden>
        <!-- Messages -->
        <div id="msg-analyzing" class="msg msg-analyzing">
            <div class="spinner"></div>
            <span>Analyzing PDFâ€¦</span></div>
        <div id="msg-info" class="msg msg-info">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2"
                 stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round"
                      d="M11.25 11.25l.041-.02a.75.75 0 011.063.852l-.708 2.836a.75.75 0 001.063.853l.041-.021M21 12a9 9 0 11-18 0 9 9 0 0118 0zm-9-3.75h.008v.008H12V8.25z"/>
            </svg>
            <span id="info-text"></span></div>
        <div id="msg-err" class="msg msg-err">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2"
                 stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round"
                      d="M12 9v3.75m9-.75a9 9 0 11-18 0 9 9 0 0118 0zm-9 3.75h.008v.008H12v-.008z"/>
            </svg>
            <span id="err-text"></span></div>
        <!-- Password -->
        <div id="pw-sec" class="pw-sec">
            <div class="pw-label">Password</div>
            <div class="ig" id="ig">
                <input type="password" id="pw" placeholder="Enter the PDF password" autocomplete="off">
                <button class="tpw" id="tpw" title="Show password">
                    <svg id="eye-open" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
                         stroke-width="2" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round"
                              d="M2.036 12.322a1.012 1.012 0 010-.639C3.423 7.51 7.36 4.5 12 4.5c4.64 0 8.577 3.007 9.963 7.178.07.207.07.431 0 .639C20.577 16.49 16.64 19.5 12 19.5c-4.64 0-8.577-3.007-9.963-7.178z"/>
                        <path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/>
                    </svg>
                    <svg id="eye-closed" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
                         stroke-width="2" stroke="currentColor" style="display:none">
                        <path stroke-linecap="round" stroke-linejoin="round"
                              d="M3.98 8.223A10.477 10.477 0 001.934 12c1.292 4.338 5.31 7.5 10.066 7.5.993 0 1.953-.138 2.863-.395M6.228 6.228A10.45 10.45 0 0112 4.5c4.756 0 8.773 3.162 10.065 7.498a10.523 10.523 0 01-4.293 5.774M6.228 6.228L3 3m3.228 3.228l3.65 3.65m7.894 7.894L21 21m-3.228-3.228l-3.65-3.65m0 0a3 3 0 10-4.243-4.243m4.242 4.242L9.88 9.88"/>
                    </svg>
                </button>
            </div>
        </div>
        <!-- Quality -->
        <div id="qs" class="qs">
            <div class="qs-label">Output quality</div>
            <div class="qs-o">
                <button class="qo" data-scale="1.5" data-q=".85">Standard<small>Smaller file</small></button>
                <button class="qo act" data-scale="2" data-q=".92">High<small>Balanced</small></button>
                <button class="qo" data-scale="3" data-q=".95">Maximum<small>Best quality</small></button>
            </div>
        </div>
        <button id="ubtn" class="ubtn">Unlock PDF</button>
        <!-- Progress -->
        <div id="prog" class="prog">
            <div class="pb-wrap">
                <div id="pb" class="pb"></div>
            </div>
            <div class="prog-row"><span id="pt" class="pt">Preparingâ€¦</span>
                <button id="cancel-btn" class="cancel-btn">Cancel</button>
            </div>
        </div>
        <!-- Results -->
        <div id="res" class="res">
            <div class="rc">
                <div id="thumb" class="thumb" style="display:none"><img id="thumb-img" alt="First page preview"></div>
                <div class="ri">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2"
                         stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round"
                              d="M9 12.75L11.25 15 15 9.75M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
                    </svg>
                </div>
                <div class="rt">PDF Unlocked</div>
                <div id="rd" class="rd"></div>
                <div class="res-btns">
                    <button id="dbtn" class="dbtn">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2"
                             stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round"
                                  d="M3 16.5v2.25A2.25 2.25 0 005.25 21h13.5A2.25 2.25 0 0021 18.75V16.5M16.5 12L12 16.5m0 0L7.5 12m4.5 4.5V3"/>
                        </svg>
                        Download
                    </button>
                    <button id="again-btn" class="again-btn">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2"
                             stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round"
                                  d="M16.023 9.348h4.992v-.001M2.985 19.644v-4.992m0 0h4.992m-4.993 0l3.181 3.183a8.25 8.25 0 0013.803-3.7M4.031 9.865a8.25 8.25 0 0113.803-3.7l3.181 3.182"/>
                        </svg>
                        New file
                    </button>
                </div>
            </div>
            <p class="note">Pages are rendered as images â€” text is not selectable in the output.</p>
        </div>
    </div>
    <div class="footer">
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round"
                  d="M9 12.75L11.25 15 15 9.75m-3-7.036A11.959 11.959 0 013.598 6 11.99 11.99 0 003 9.749c0 5.592 3.824 10.29 9 11.623 5.176-1.332 9-6.03 9-11.622 0-1.31-.21-2.571-.598-3.751h-.152c-3.196 0-6.1-1.248-8.25-3.285z"/>
        </svg>
        All processing happens locally in your browser
    </div>
</div>
<script>
    pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';
    const {jsPDF} = window.jspdf;
    const $ = id => document.getElementById(id);
    const dz = $('dz'), finp = $('finp'), dzDef = $('dz-def'), dzFi = $('dz-fi'), fnEl = $('fn'), fsEl = $('fs'),
        rmBtn = $('rm');
    const pwSec = $('pw-sec'), pwIn = $('pw'), tpwBtn = $('tpw'), eyeO = $('eye-open'), eyeC = $('eye-closed'),
        ig = $('ig');
    const qSec = $('qs'), ubtn = $('ubtn'), prog = $('prog'), pb = $('pb'), pt = $('pt');
    const msgAnalyzing = $('msg-analyzing'), msgInfo = $('msg-info'), infoText = $('info-text');
    const msgErr = $('msg-err'), errText = $('err-text');
    const res = $('res'), rd = $('rd'), dbtn = $('dbtn'), againBtn = $('again-btn');
    const thumbEl = $('thumb'), thumbImg = $('thumb-img'), cancelBtn = $('cancel-btn');
    const qopts = document.querySelectorAll('.qo');
    let file = null, buf = null, needsPw = false, scale = 2, jpegQ = .92, blob = null, outName = '', cancelled = false;

    function fmtSize(b) {
        if (b < 1024) return b + ' B';
        if (b < 1048576) return (b / 1024).toFixed(1) + ' KB';
        return (b / 1048576).toFixed(1) + ' MB'
    }

    function fmtTime(ms) {
        if (ms < 1000) return '<1s';
        const s = Math.round(ms / 1000);
        return s < 60 ? s + 's' : Math.floor(s / 60) + 'm ' + s % 60 + 's'
    }

    function hideAllMsg() {
        msgAnalyzing.classList.remove('vis');
        msgInfo.classList.remove('vis');
        msgErr.classList.remove('vis')
    }

    function showErr(m) {
        hideAllMsg();
        errText.textContent = m;
        msgErr.classList.add('vis')
    }

    function showInfo(m) {
        hideAllMsg();
        infoText.textContent = m;
        msgInfo.classList.add('vis')
    }

    function showAnalyzing() {
        hideAllMsg();
        msgAnalyzing.classList.add('vis')
    }

    function reset() {
        file = null;
        buf = null;
        needsPw = false;
        blob = null;
        cancelled = false;
        dzDef.style.display = '';
        dzFi.style.display = 'none';
        dz.classList.remove('has-file');
        pwSec.classList.remove('vis');
        qSec.classList.remove('vis');
        ubtn.classList.remove('vis');
        prog.classList.remove('vis');
        res.classList.remove('vis');
        hideAllMsg();
        pwIn.value = '';
        pb.style.width = '0%';
        ubtn.disabled = false;
        ubtn.textContent = 'Unlock PDF';
        thumbEl.style.display = 'none';
        thumbImg.src = '';
    }

    async function checkPDF(buffer) {
        hideAllMsg();
        showAnalyzing();
        try {
            const pdf = await pdfjsLib.getDocument({data: buffer.slice(0)}).promise;
            const n = pdf.numPages;
            pdf.destroy();
            hideAllMsg();
            showInfo('This PDF is not password-protected' + (n ? ' (' + n + ' page' + (n > 1 ? 's' : '') + ').' : '.'));
        } catch (e) {
            hideAllMsg();
            if (e.name === 'PasswordException') {
                needsPw = true;
                pwSec.classList.add('vis');
                qSec.classList.add('vis');
                ubtn.classList.add('vis');
                setTimeout(() => pwIn.focus(), 100);
            } else {
                showErr('This file could not be read. It may be invalid or corrupted.')
            }
        }
    }

    async function handleFile(f) {
        if (!f) return;
        if (f.type !== 'application/pdf' && !f.name.toLowerCase().endsWith('.pdf')) {
            showErr('Please select a PDF file.');
            return
        }
        reset();
        file = f;
        buf = await f.arrayBuffer();
        fnEl.textContent = f.name;
        fsEl.textContent = fmtSize(f.size);
        dzDef.style.display = 'none';
        dzFi.style.display = '';
        dz.classList.add('has-file');
        await checkPDF(buf);
    }

    /* Dropzone events */
    dz.addEventListener('click', e => {
        if (!rmBtn.contains(e.target) && !dz.classList.contains('has-file')) finp.click()
    });
    dz.addEventListener('dragover', e => {
        e.preventDefault();
        dz.classList.add('dragover')
    });
    dz.addEventListener('dragleave', () => dz.classList.remove('dragover'));
    dz.addEventListener('drop', e => {
        e.preventDefault();
        dz.classList.remove('dragover');
        if (e.dataTransfer.files[0]) handleFile(e.dataTransfer.files[0])
    });
    finp.addEventListener('change', () => {
        if (finp.files[0]) handleFile(finp.files[0]);
        finp.value = ''
    });
    rmBtn.addEventListener('click', e => {
        e.stopPropagation();
        reset()
    });

    /* Password toggle */
    tpwBtn.addEventListener('click', () => {
        const show = pwIn.type === 'password';
        pwIn.type = show ? 'text' : 'password';
        eyeO.style.display = show ? 'none' : '';
        eyeC.style.display = show ? '' : 'none';
        tpwBtn.title = show ? 'Hide password' : 'Show password';
    });

    /* Clear error on typing */
    pwIn.addEventListener('input', () => {
        if (msgErr.classList.contains('vis')) hideAllMsg()
    });

    /* Quality selector */
    qopts.forEach(o => o.addEventListener('click', () => {
        qopts.forEach(x => x.classList.remove('act'));
        o.classList.add('act');
        scale = parseFloat(o.dataset.scale);
        jpegQ = parseFloat(o.dataset.q);
    }));

    /* Enter to unlock */
    pwIn.addEventListener('keydown', e => {
        if (e.key === 'Enter') ubtn.click()
    });

    /* Cancel */
    cancelBtn.addEventListener('click', () => {
        cancelled = true;
        cancelBtn.textContent = 'Cancellingâ€¦';
        cancelBtn.disabled = true
    });

    /* Unlock */
    ubtn.addEventListener('click', async () => {
        if (!buf || !needsPw) return;
        const password = pwIn.value;
        if (!password) {
            showErr('Please enter the password.');
            pwIn.focus();
            return
        }
        hideAllMsg();
        cancelled = false;
        cancelBtn.textContent = 'Cancel';
        cancelBtn.disabled = false;
        ubtn.disabled = true;
        ubtn.textContent = 'Processingâ€¦';
        prog.classList.add('vis');
        res.classList.remove('vis');
        thumbEl.style.display = 'none';
        pb.style.width = '5%';
        pt.textContent = 'Decryptingâ€¦';
        const t0 = performance.now();
        let pdf;
        try {
            pdf = await pdfjsLib.getDocument({data: buf.slice(0), password}).promise;
        } catch (e) {
            if (e.name === 'PasswordException') {
                showErr('Incorrect password. Please try again.');
                ig.classList.add('shake');
                ig.addEventListener('animationend', () => ig.classList.remove('shake'), {once: true});
                pwIn.select();
            } else {
                showErr('Failed to decrypt: ' + (e.message || 'Unknown error'))
            }
            prog.classList.remove('vis');
            ubtn.disabled = false;
            ubtn.textContent = 'Unlock PDF';
            return;
        }
        try {
            const n = pdf.numPages;
            pb.style.width = '10%';
            pt.textContent = 'Rendering page 1 of ' + n + 'â€¦';
            let doc = null, thumbData = null;
            const cvs = document.createElement('canvas');
            const ctx = cvs.getContext('2d');
            for (let i = 1; i <= n; i++) {
                if (cancelled) {
                    pdf.destroy();
                    prog.classList.remove('vis');
                    ubtn.disabled = false;
                    ubtn.textContent = 'Unlock PDF';
                    return
                }
                const page = await pdf.getPage(i);
                const vp = page.getViewport({scale});
                cvs.width = vp.width;
                cvs.height = vp.height;
                ctx.fillStyle = '#fff';
                ctx.fillRect(0, 0, cvs.width, cvs.height);
                await page.render({canvasContext: ctx, viewport: vp}).promise;
                /* Capture thumbnail from first page */
                if (i === 1) {
                    const tw = 140, th = Math.round(tw * (vp.height / vp.width));
                    const tc = document.createElement('canvas');
                    tc.width = tw;
                    tc.height = th;
                    const tctx = tc.getContext('2d');
                    tctx.drawImage(cvs, 0, 0, tw, th);
                    thumbData = tc.toDataURL('image/jpeg', .8);
                }
                const wMm = (vp.width / scale) * 25.4 / 72, hMm = (vp.height / scale) * 25.4 / 72;
                const img = cvs.toDataURL('image/jpeg', jpegQ);
                if (i === 1) doc = new jsPDF({unit: 'mm', format: [wMm, hMm], compress: true});
                else doc.addPage([wMm, hMm]);
                doc.addImage(img, 'JPEG', 0, 0, wMm, hMm);
                const pct = 10 + Math.round(i / n * 88);
                pb.style.width = pct + '%';
                pt.textContent = 'Rendering page ' + i + ' of ' + n + 'â€¦';
                await new Promise(r => setTimeout(r, 0));
            }
            if (cancelled) {
                pdf.destroy();
                prog.classList.remove('vis');
                ubtn.disabled = false;
                ubtn.textContent = 'Unlock PDF';
                return
            }
            pdf.destroy();
            pb.style.width = '100%';
            pt.textContent = 'Finalizingâ€¦';
            await new Promise(r => setTimeout(r, 50));
            const bytes = doc.output('arraybuffer');
            blob = new Blob([bytes], {type: 'application/pdf'});
            outName = file.name.replace(/\.pdf$/i, '') + '_unlocked.pdf';
            const elapsed = fmtTime(performance.now() - t0);
            rd.innerHTML = n + ' page' + (n > 1 ? 's' : '') + ' &middot; ' + fmtSize(blob.size) + ' &middot; ' + elapsed;
            if (thumbData) {
                thumbImg.src = thumbData;
                thumbEl.style.display = ''
            }
            res.classList.add('vis');
            prog.classList.remove('vis');
        } catch (e) {
            showErr('Processing failed: ' + (e.message || 'Unknown error'));
            prog.classList.remove('vis');
        }
        ubtn.disabled = false;
        ubtn.textContent = 'Unlock PDF';
    });

    /* Download */
    dbtn.addEventListener('click', () => {
        if (!blob) return;
        const u = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = u;
        a.download = outName;
        a.click();
        setTimeout(() => URL.revokeObjectURL(u), 1000);
    });

    /* Process another */
    againBtn.addEventListener('click', () => {
        reset();
        finp.click()
    });
</script>
<script src="../logo.js"></script>
</body>
</html>