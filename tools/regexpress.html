<!DOCTYPE html>
<html lang="en">
<head>
    <link rel="icon"
          href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üîç</text></svg>">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RegExpress - AI-Powered Regex Generator</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .highlight {
            background: #fbbf24;
            color: #000;
            padding: 2px 0;
            border-radius: 2px
        }

        .toast {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #10b981;
            color: #fff;
            padding: 12px 20px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, .3);
            animation: slideIn .3s ease-out, fadeOut .3s ease-in 2.7s;
            z-index: 1000
        }

        @keyframes slideIn {
            from {
                transform: translateX(400px);
                opacity: 0
            }
            to {
                transform: translateX(0);
                opacity: 1
            }
        }

        @keyframes fadeOut {
            to {
                opacity: 0
            }
        }

        .spinner {
            border: 3px solid #374151;
            border-top: 3px solid #3b82f6;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            animation: spin .8s linear infinite;
            display: inline-block
        }

        @keyframes spin {
            to {
                transform: rotate(360deg)
            }
        }

        .history-item {
            transition: all .2s
        }

        .history-item:hover {
            background: #1f2937;
            transform: translateX(4px)
        }
    </style>
</head>
<body class="bg-gray-900 text-white min-h-screen">
<div class="container mx-auto py-8 px-4 max-w-5xl">
    <header class="mb-8">
        <h1 class="text-3xl font-bold mb-2 text-center">RegExpress</h1>
        <p class="text-center text-gray-400 mb-6">AI-Powered Regex Generation & Testing</p>
    </header>
    <div class="grid md:grid-cols-2 gap-6">
        <div class="bg-gray-800 p-6 rounded-lg">
            <h2 class="text-xl font-bold mb-4">Generate Regex</h2>
            <label for="nlInput" class="block mb-2 text-sm font-semibold">Describe Your Pattern</label>
            <textarea id="nlInput" placeholder="e.g., Find all email addresses"
                      class="w-full p-3 rounded bg-gray-700 text-white border border-gray-600 mb-3 resize-none" rows="3"
                      aria-label="Natural Language Description"></textarea>
            <button id="genBtn" onclick="generateRegex()"
                    class="py-2.5 px-4 bg-blue-600 hover:bg-blue-700 rounded w-full mb-4 font-semibold transition-colors">
                Generate Regex
            </button>
            <div id="regexContainer" class="hidden">
                <div class="flex items-center justify-between mb-2">
                    <label class="text-sm font-semibold">Generated Pattern</label>
                    <button onclick="copyRegex()"
                            class="text-xs bg-gray-700 hover:bg-gray-600 px-3 py-1 rounded transition-colors">Copy
                    </button>
                </div>
                <div id="regexOutput" class="p-3 bg-gray-700 rounded font-mono text-sm break-all mb-3"></div>
                <div class="flex gap-2 mb-3">
                    <label class="flex items-center gap-2 text-sm cursor-pointer"><input type="checkbox" id="flagG"
                                                                                         onchange="updateTest()"
                                                                                         class="w-4 h-4"><span>global (g)</span></label>
                    <label class="flex items-center gap-2 text-sm cursor-pointer"><input type="checkbox" id="flagI"
                                                                                         onchange="updateTest()"
                                                                                         class="w-4 h-4"><span>ignore case (i)</span></label>
                    <label class="flex items-center gap-2 text-sm cursor-pointer"><input type="checkbox" id="flagM"
                                                                                         onchange="updateTest()"
                                                                                         class="w-4 h-4"><span>multiline (m)</span></label>
                </div>
                <button onclick="explainRegex()"
                        class="py-2 px-4 bg-purple-600 hover:bg-purple-700 rounded w-full mb-2 text-sm font-semibold transition-colors">
                    Explain Pattern
                </button>
                <div id="explanation" class="hidden p-3 bg-gray-700 rounded text-sm"></div>
            </div>
            <div id="history" class="mt-6 hidden">
                <h3 class="text-sm font-semibold mb-2">Recent Patterns</h3>
                <div id="historyList" class="space-y-1"></div>
            </div>
        </div>
        <div class="bg-gray-800 p-6 rounded-lg">
            <h2 class="text-xl font-bold mb-4">Test Your Regex</h2>
            <label for="testInput" class="block mb-2 text-sm font-semibold">Test String</label>
            <textarea id="testInput" placeholder="Enter text to test against..."
                      class="w-full p-3 rounded bg-gray-700 text-white border border-gray-600 mb-3 resize-none" rows="6"
                      oninput="updateTest()" aria-label="Test Input"></textarea>
            <div id="matchInfo" class="hidden mb-3 p-2 bg-blue-900 rounded text-sm"></div>
            <label class="block mb-2 text-sm font-semibold">Result</label>
            <div id="testOutput" class="p-3 bg-gray-700 rounded min-h-[100px] text-sm whitespace-pre-wrap"></div>
        </div>
    </div>
    <div class="mt-6 bg-gray-800 p-6 rounded-lg">
        <h3 class="text-lg font-bold mb-3">Example Patterns</h3>
        <div class="grid grid-cols-2 md:grid-cols-4 gap-2">
            <button onclick="setExample('Find all valid email addresses')"
                    class="py-2 px-3 bg-green-700 hover:bg-green-800 rounded text-sm transition-colors">Emails
            </button>
            <button onclick="setExample('Match phone numbers in formats like (123) 456-7890 or 123-456-7890')"
                    class="py-2 px-3 bg-green-700 hover:bg-green-800 rounded text-sm transition-colors">Phone Numbers
            </button>
            <button onclick="setExample('Extract all URLs including http, https, and www')"
                    class="py-2 px-3 bg-green-700 hover:bg-green-800 rounded text-sm transition-colors">URLs
            </button>
            <button onclick="setExample('Match dates in MM-DD-YYYY format')"
                    class="py-2 px-3 bg-green-700 hover:bg-green-800 rounded text-sm transition-colors">Dates
            </button>
            <button onclick="setExample('Extract hashtags starting with # followed by alphanumeric characters')"
                    class="py-2 px-3 bg-green-700 hover:bg-green-800 rounded text-sm transition-colors">Hashtags
            </button>
            <button onclick="setExample('Validate strong passwords with 8+ chars, uppercase, lowercase, and number')"
                    class="py-2 px-3 bg-green-700 hover:bg-green-800 rounded text-sm transition-colors">Passwords
            </button>
            <button onclick="setExample('Find credit card numbers with 13-19 digits')"
                    class="py-2 px-3 bg-green-700 hover:bg-green-800 rounded text-sm transition-colors">Credit Cards
            </button>
            <button onclick="setExample('Match IPv4 addresses')"
                    class="py-2 px-3 bg-green-700 hover:bg-green-800 rounded text-sm transition-colors">IP Addresses
            </button>
        </div>
    </div>
    <details class="mt-6 bg-gray-800 p-6 rounded-lg">
        <summary class="text-lg font-bold cursor-pointer">Quick Reference</summary>
        <div class="mt-4 grid md:grid-cols-2 gap-4 text-sm">
            <div><strong>Common Patterns:</strong><br><code class="bg-gray-700 px-1">.</code> - Any character<br><code
                    class="bg-gray-700 px-1">\d</code> - Digit<br><code class="bg-gray-700 px-1">\w</code> - Word
                character<br><code class="bg-gray-700 px-1">\s</code> - Whitespace<br><code
                        class="bg-gray-700 px-1">^</code> - Start of line<br><code class="bg-gray-700 px-1">$</code> -
                End of line
            </div>
            <div><strong>Quantifiers:</strong><br><code class="bg-gray-700 px-1">*</code> - 0 or more<br><code
                    class="bg-gray-700 px-1">+</code> - 1 or more<br><code class="bg-gray-700 px-1">?</code> - 0 or
                1<br><code class="bg-gray-700 px-1">{n}</code> - Exactly n<br><code
                        class="bg-gray-700 px-1">{n,m}</code> - Between n and m<br><code
                        class="bg-gray-700 px-1">[abc]</code> - Character set
            </div>
        </div>
    </details>
</div>
<script>
    const API = 'https://chatgpt.tobiasmue91.workers.dev/';
    let currentRegex = '';

    async function generateRegex() {
        const input = document.getElementById('nlInput').value.trim();
        if (!input) {
            showToast('Please enter a description', '#ef4444');
            return
        }
        const btn = document.getElementById('genBtn');
        btn.innerHTML = '<span class="spinner"></span> Generating...';
        btn.disabled = true;
        try {
            const res = await fetch(API, {
                method: 'POST',
                headers: {"Content-Type": "application/json"},
                body: JSON.stringify({
                    model: "gpt-4o-mini",
                    max_tokens: 150,
                    temperature: 0.1,
                    messages: [{
                        role: "system",
                        content: "You are a regex expert. Convert descriptions into regex patterns. Return ONLY the pattern without delimiters or explanations."
                    }, {role: "user", content: input}]
                })
            });
            if (res.ok) {
                const data = await res.json();
                currentRegex = data.choices[0].message.content.trim();
                document.getElementById('regexOutput').textContent = currentRegex;
                document.getElementById('regexContainer').classList.remove('hidden');
                document.getElementById('explanation').classList.add('hidden');
                saveToHistory(input, currentRegex);
                updateTest();
                showToast('Regex generated successfully!');
            } else {
                showToast('Generation failed. Try again.', '#ef4444');
            }
        } catch (e) {
            console.error(e);
            showToast('Network error', '#ef4444');
        } finally {
            btn.innerHTML = 'Generate Regex';
            btn.disabled = false;
        }
    }

    async function explainRegex() {
        if (!currentRegex) return;
        const btn = event.target;
        const exp = document.getElementById('explanation');
        btn.innerHTML = '<span class="spinner"></span> Explaining...';
        btn.disabled = true;
        try {
            const res = await fetch(API, {
                method: 'POST',
                headers: {"Content-Type": "application/json"},
                body: JSON.stringify({
                    model: "gpt-4o-mini",
                    max_tokens: 200,
                    temperature: 0.3,
                    messages: [{
                        role: "system",
                        content: "You are a regex expert. Explain regex patterns in simple terms."
                    }, {role: "user", content: `Explain this regex pattern: ${currentRegex}`}]
                })
            });
            if (res.ok) {
                const data = await res.json();
                exp.textContent = data.choices[0].message.content;
                exp.classList.remove('hidden');
            } else {
                showToast('Explanation failed', '#ef4444');
            }
        } catch (e) {
            console.error(e);
            showToast('Network error', '#ef4444');
        } finally {
            btn.innerHTML = 'Explain Pattern';
            btn.disabled = false;
        }
    }

    function updateTest() {
        if (!currentRegex) return;
        const testStr = document.getElementById('testInput').value;
        const flags = (document.getElementById('flagG').checked ? 'g' : '') + (document.getElementById('flagI').checked ? 'i' : '') + (document.getElementById('flagM').checked ? 'm' : '');
        try {
            const regex = new RegExp(currentRegex, flags);
            const matches = testStr.match(regex);
            const info = document.getElementById('matchInfo');
            const output = document.getElementById('testOutput');
            if (matches && matches.length > 0) {
                info.textContent = `Found ${matches.length} match${matches.length > 1 ? 'es' : ''}`;
                info.classList.remove('hidden');
                output.innerHTML = highlightMatches(testStr, regex, flags.includes('g'));
            } else {
                info.textContent = 'No matches found';
                info.classList.remove('hidden');
                output.textContent = testStr || 'No input to test';
            }
        } catch (e) {
            document.getElementById('matchInfo').classList.add('hidden');
            document.getElementById('testOutput').textContent = 'Invalid regex pattern';
        }
    }

    function highlightMatches(str, regex, global) {
        if (!str) return '';
        const matches = [];
        let match;
        const re = new RegExp(regex.source, regex.flags);
        while ((match = re.exec(str)) !== null) {
            matches.push({start: match.index, end: match.index + match[0].length});
            if (!global) break;
        }
        if (matches.length === 0) return escapeHtml(str);
        matches.sort((a, b) => a.start - b.start);
        let result = '';
        let lastIdx = 0;
        for (const m of matches) {
            result += escapeHtml(str.slice(lastIdx, m.start));
            result += `<span class="highlight">${escapeHtml(str.slice(m.start, m.end))}</span>`;
            lastIdx = m.end;
        }
        result += escapeHtml(str.slice(lastIdx));
        return result;
    }

    function escapeHtml(str) {
        return str.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;').replace(/"/g, '&quot;').replace(/'/g, '&#039;');
    }

    function copyRegex() {
        navigator.clipboard.writeText(currentRegex);
        showToast('Regex copied to clipboard!');
    }

    function showToast(msg, bg = '#10b981') {
        const toast = document.createElement('div');
        toast.className = 'toast';
        toast.textContent = msg;
        toast.style.background = bg;
        document.body.appendChild(toast);
        setTimeout(() => toast.remove(), 3000);
    }

    function setExample(text) {
        document.getElementById('nlInput').value = text;
    }

    function saveToHistory(desc, pattern) {
        let history = JSON.parse(localStorage.getItem('regexHistory') || '[]');
        history.unshift({desc, pattern, date: Date.now()});
        history = history.slice(0, 5);
        localStorage.setItem('regexHistory', JSON.stringify(history));
        loadHistory();
    }

    function loadHistory() {
        const history = JSON.parse(localStorage.getItem('regexHistory') || '[]');
        const list = document.getElementById('historyList');
        const container = document.getElementById('history');
        if (history.length === 0) {
            container.classList.add('hidden');
            return
        }
        container.classList.remove('hidden');
        list.innerHTML = history.map(h => `<div class="history-item p-2 bg-gray-700 rounded cursor-pointer text-xs" onclick='loadFromHistory(${JSON.stringify(h.pattern).replace(/'/g, "\\'")})'><div class="font-semibold truncate">${escapeHtml(h.desc)}</div><code class="text-gray-400">${escapeHtml(h.pattern)}</code></div>`).join('');
    }

    function loadFromHistory(pattern) {
        currentRegex = pattern;
        document.getElementById('regexOutput').textContent = pattern;
        document.getElementById('regexContainer').classList.remove('hidden');
        updateTest();
    }

    document.getElementById('nlInput').addEventListener('keydown', e => {
        if (e.key === 'Enter' && e.ctrlKey) {
            generateRegex();
        }
    });
    loadHistory();
</script>
<script src="../logo.js"></script>
</body>
</html>