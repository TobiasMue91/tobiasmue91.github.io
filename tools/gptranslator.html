<!DOCTYPE html>
<html lang="en">
<head>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üåê</text></svg>">
    <link rel="manifest" href="/tools/gptranslator/manifest.json">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <title>GPTranslator</title>
    <meta name="description" content="Explore the linguistic universe with GPTranslator, your go-to language translation tool. Now with text scanning capabilities, easily translate printed materials into over 100 languages, including Pirate Speak, Hieroglyphics, and more. Whether you're deciphering ancient scripts or engaging in modern-day conversations, GPTranslator bridges language barriers with a touch of creativity. Start your journey today.">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/choices.js/10.2.0/choices.min.css" integrity="sha512-oW+fEHZatXKwZQ5Lx5td2J93WJnSFLbnALFOFqy/pTuQyffi9gsUylGGZkD3DTSv8zkoOdU7MT7I6LTDcV8GBQ==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <script src="https://cdn.jsdelivr.net/npm/jsonrepair@3.7.0/lib/umd/jsonrepair.min.js" integrity="sha256-GeV/G8RiIuQ50Y8l5XYdLvdZAiYcZwTy0NoSJGcy17I=" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/choices.js/10.2.0/choices.min.js" integrity="sha512-OrRY3yVhfDckdPBIjU2/VXGGDjq3GPcnILWTT39iYiuV6O3cEcAxkgCBVR49viQ99vBFeu+a6/AoFAkNHgFteg==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script src="https://cdn.jsdelivr.net/npm/tesseract.js@5.0.5/dist/tesseract.min.js" integrity="sha256-NHTd7fofgnm/zoaz+LJ8rXjGCdVDypyq35wz4Di6+nY=" crossorigin="anonymous"></script>
    <style>
        * {
            box-sizing: border-box;
        }

        body {
            font-family: Arial, sans-serif;
            background-color: #f0f0f0;
            margin: 0;
            padding: 0;
        }

        main {
            max-width: 600px;
            background-color: #ffffff;
            box-shadow: 0px 0px 10px rgba(0, 0, 0, 0.1);
            padding: 20px;
        }

        h1, h4 {
            text-align: center;
            margin-bottom: 20px;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group.flex {
            display: flex;
        }

        .form-group.flex > div {
            flex-basis: 50%;
        }

        #custom-target-language {
            height: 44px;
        }

        label {
            display: block;
            font-weight: bold;
            margin-bottom: 5px;
        }

        input, textarea, select {
            width: 100%;
            padding: 5px;
            font-size: 1rem;
        }

        textarea {
            resize: vertical;
            min-height: 100px;
        }

        button {
            width: 100%;
            padding: 10px;
            background-color: #007bff;
            color: #ffffff;
            font-size: 1rem;
            font-weight: bold;
            border: none;
            cursor: pointer;
        }

        button:hover {
            background-color: #0056b3;
        }

        #translate-button:disabled {
            cursor: not-allowed;
            background-color: #89bdff;
        }

        #translation-results {
            margin-top: 20px;
        }

        .about {
            margin-top: 40px;
            margin-bottom: 20px;
            text-align: center;
        }

        .camera-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 10;
            background-color: rgba(0, 0, 0, 0.85);
        }

        #camera-stream {
            max-width: 100%;
            max-height: 100%;
        }

        .camera-btn, .modal-close-btn {
            position: absolute;
            font-size: 24px;
            border: none;
            background-color: transparent;
            color: white;
            cursor: pointer;
            width: auto;
        }

        .modal-close-btn {
            top: 20px;
            right: 20px;
        }

        #switch-camera {
            bottom: 20px;
            right: 20px;
        }

        #take-snapshot {
            font-size: 40px;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
        }

        #char-count {
            display: block;
            margin-top: 5px;
            font-size: 12px;
        }

        #favoritesTable td span {
            white-space: pre-wrap;
            display: block;
            max-height: 100px;
            overflow-y: auto;
        }

        #favoritesTable td span::-webkit-scrollbar {
            width: 6px;
            height: 6px;
        }

        #favoritesTable td span::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 6px;
        }

        #favoritesTable td span::-webkit-scrollbar-thumb {
            background: #888;
            border-radius: 6px;
        }

        #favoritesTable td span::-webkit-scrollbar-thumb:hover {
            background: #555;
        }

        @media (min-width: 768px) {
            main {
                margin: 50px auto;
                width: 90%;
            }
        }

        body.dark-mode {
            background-color: #121212;
            color: #e0e0e0;

            main {
                background-color: #1e1e1e;
                box-shadow: 0px 0px 10px rgba(255, 255, 255, 0.1);
            }

            a {
                color: #4a90e2;
                text-decoration: none;
            }

            a:hover, a:focus {
                color: #d1eaff;
                text-decoration: underline;
            }

            input, textarea, select {
                background-color: #333;
                color: #ffffff;
                border-color: #444;
            }

            .choices .choices__inner, .choices .choices__list, .choices [name="search_terms"].choices__input {
                background-color: #333;
                border: none;
            }

            .choices .choices__list .choices__item.is-highlighted {
                background-color: #444;
            }

            #favoritesTable {
                background-color: #333;
                color: #f1f1f1;
            }

            #favoritesContainer {
                background-color: #000000;
            }

            #favoritesTable th {
                background-color: #007bff;
            }

            #favoritesTable, #favoritesTable th, #favoritesTable td {
                border-color: #777;
            }

            #favoritesTable tr:nth-child(even) {
                background-color: #424242;
            }

            #favoritesTable tr:hover {
                background-color: #555;
            }

            .remove-favorite-btn {
                color: #f9f9f9;
                background-color: #555;
                border-color: #777;
            }

            .remove-favorite-btn:hover {
                background-color: #e74c3c;
                border-color: #e74c3c;
            }
        }

        #theme-toggle {
            position: fixed;
            width: auto;
            top: 30px;
            right: 20px;
            text-align: right;
            font-size: 24px;
            background: none;
            border: none;
            cursor: pointer;
            z-index: 5;
        }

        #favoritesContainer {
            margin-top: 20px;
            background-color: #f9f9f9;
            padding: 10px;
            border-radius: 5px;
        }

        #favoritesTable {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            border: none;
        }

        #favoritesTable th, #favoritesTable td {
            text-align: left;
            padding: 8px;
        }

        #favoritesTable th {
            background-color: #007bff;
            text-align: center;
            color: white;
        }

        #favoritesTable tr:nth-child(even) {
            background-color: #f2f2f2;
        }

        #favoritesTable tr:hover {
            background-color: #ddd;
        }

        .remove-favorite-btn {
            display: inline-block;
            padding: 4px 8px;
            cursor: pointer;
            color: #333;
            background-color: #f9f9f9;
            border: 1px solid #ddd;
            border-radius: 5px;
        }

        .favorite-btn {
            text-shadow: 0 0 2px #000;
        }

        .remove-favorite-btn:hover {
            background-color: #e74c3c;
            color: white;
            border-color: #e74c3c;
        }
    </style>
</head>
<body>
<main>
    <button id="theme-toggle" title="Toggle dark/light mode">üåû</button>
    <h1>GPTranslator</h1>
    <form id="translator-form">
        <div class="form-group">
            <span id="open-camera" style="cursor: pointer; font-size: 25px;" title="Open Camera to read input text">üì∑</span>
            <label for="input-string" style="display: inline-block;">Input Text:</label>
            <textarea id="input-string" placeholder="Enter text to translate" maxlength="2000"></textarea>
            <span id="char-count">0 / 2000</span>
        </div>
        <div id="camera-modal" class="camera-modal" style="display:none;">
            <video id="camera-stream" autoplay></video>
            <button id="close-camera" class="modal-close-btn" title="Close Camera">X</button>
            <button id="switch-camera" class="camera-btn" title="Change Camera">‚Üî</button>
            <button id="take-snapshot" class="camera-btn" title="Take Picture and Read Text">üî¥</button>
        </div>
        <div class="form-group">
            <label for="context">Context (optional):</label>
            <input type="text" id="context" placeholder="Provide context">
        </div>
        <div class="form-group flex">
            <div>
                <label for="target-language">Target Language:</label>
                <select id="target-language">
                    <option value="af">Afrikaans</option>
                    <option value="ain">Ainu</option>
                    <option value="sq">Albanian</option>
                    <option value="algi">Alien Gibberish</option>
                    <option value="aneghi">Ancient Egyptian Hieroglyphics</option>
                    <option value="am">Amharic</option>
                    <option value="ar">Arabic</option>
                    <option value="hy">Armenian</option>
                    <option value="asmr">ASMR Slang</option>
                    <option value="aua">Australian accent</option>
                    <option value="aym">Aymara</option>
                    <option value="az">Azerbaijani</option>
                    <option value="bam">Bambara</option>
                    <option value="eu">Basque</option>
                    <option value="bay">Bavarian (Bayrisch)</option>
                    <option value="batr">Bavarian Trump</option>
                    <option value="be">Belarusian</option>
                    <option value="bn">Bengali</option>
                    <option value="ber">Berlin dialect (Berlinerisch)</option>
                    <option value="biden">Biden Slang</option>
                    <option value="bis">Bislama</option>
                    <option value="bs">Bosnian</option>
                    <option value="bra">Braille</option>
                    <option value="bg">Bulgarian</option>
                    <option value="cat">Cat Speech</option>
                    <option value="ca">Catalan</option>
                    <option value="cagr">Caveman Grunts</option>
                    <option value="ceb">Cebuano</option>
                    <option value="zh-CN">Chinese (Simplified)</option>
                    <option value="zh-TW">Chinese (Traditional)</option>
                    <option value="cor">Cornish</option>
                    <option value="co">Corsican</option>
                    <option value="hr">Croatian</option>
                    <option value="cs">Czech</option>
                    <option value="cy">Cynicism</option>
                    <option value="da">Danish</option>
                    <option value="do">Dothraki</option>
                    <option value="nl">Dutch</option>
                    <option value="dzo">Dzongkha</option>
                    <option value="emo">Emoji</option>
                    <option value="en" selected>English</option>
                    <option value="eo">Esperanto</option>
                    <option value="et">Estonian</option>
                    <option value="eus">Euskara Batua (Unified Basque)</option>
                    <option value="fao">Faroese</option>
                    <option value="fil">Filipino</option>
                    <option value="fi">Finnish</option>
                    <option value="fr">French</option>
                    <option value="frsl">French with slang</option>
                    <option value="fy">Frisian</option>
                    <option value="gl">Galician</option>
                    <option value="gasl">Gamer slang</option>
                    <option value="gl">Gangster slang</option>
                    <option value="glf">Gallifreyan</option>
                    <option value="ka">Georgian</option>
                    <option value="de">German</option>
                    <option value="el">Greek</option>
                    <option value="grn">Guaran√≠</option>
                    <option value="gu">Gujarati</option>
                    <option value="ht">Haitian Creole</option>
                    <option value="ha">Hausa</option>
                    <option value="haw">Hawaiian</option>
                    <option value="iw">Hebrew</option>
                    <option value="hi">Hindi</option>
                    <option value="hv">High Valyrian</option>
                    <option value="hmn">Hmong</option>
                    <option value="hu">Hungarian</option>
                    <option value="is">Icelandic</option>
                    <option value="ig">Igbo</option>
                    <option value="id">Indonesian</option>
                    <option value="isl">Internet slang</option>
                    <option value="iku">Inuktitut</option>
                    <option value="ga">Irish</option>
                    <option value="ira">Irish accent</option>
                    <option value="it">Italian</option>
                    <option value="ja">Japanese</option>
                    <option value="jw">Javanese</option>
                    <option value="kal">Kalaallisut (Greenlandic)</option>
                    <option value="kn">Kannada</option>
                    <option value="knr">Kanuri</option>
                    <option value="kho">Khoisan (!X√≥√µ)</option>
                    <option value="kl">Klingon</option>
                    <option value="kk">Kazakh</option>
                    <option value="km">Khmer</option>
                    <option value="ko">Korean</option>
                    <option value="ku">Kurdish</option>
                    <option value="ky">Kyrgyz</option>
                    <option value="lo">Lao</option>
                    <option value="la">Latin</option>
                    <option value="lv">Latvian</option>
                    <option value="lgbtq">LGBTQ+ Slang</option>
                    <option value="lin">Lingala</option>
                    <option value="lt">Lithuanian</option>
                    <option value="lut">Lushootseed</option>
                    <option value="lb">Luxembourgish</option>
                    <option value="mk">Macedonian</option>
                    <option value="mg">Malagasy</option>
                    <option value="ms">Malay</option>
                    <option value="ml">Malayalam</option>
                    <option value="mt">Maltese</option>
                    <option value="glv">Manx</option>
                    <option value="mi">Maori</option>
                    <option value="mr">Marathi</option>
                    <option value="mesl">Medical slang</option>
                    <option value="mn">Mongolian</option>
                    <option value="morse">Morse Code</option>
                    <option value="my">Myanmar (Burmese)</option>
                    <option value="nah">Nahuatl</option>
                    <option value="nav">Navajo</option>
                    <option value="nv">Na'vi</option>
                    <option value="ne">Nepali</option>
                    <option value="nesl">Nerd Slang</option>
                    <option value="no">Norwegian</option>
                    <option value="ny">Nyanja (Chichewa)</option>
                    <option value="oci">Occitan</option>
                    <option value="ock">Ockm√§nisch</option>
                    <option value="oji">Ojibwe</option>
                    <option value="oesi">Austrian (√ñsterreichisch)</option>
                    <option value="ps">Pashto</option>
                    <option value="pr">Parseltongue</option>
                    <option value="fa">Persian</option>
                    <option value="pisp">Pirate Speak</option>
                    <option value="pl">Polish</option>
                    <option value="pt">Portuguese</option>
                    <option value="pa">Punjabi</option>
                    <option value="qu">Quenya</option>
                    <option value="robeep">Robot Beeps and Boops</option>
                    <option value="rom">Romani</option>
                    <option value="ro">Romanian</option>
                    <option value="ru">Russian</option>
                    <option value="sme">Saami (S√°pmi)</option>
                    <option value="sae">S√§chsisch</option>
                    <option value="sar">Sarcasm</option>
                    <option value="sah">Sakha (Yakut)</option>
                    <option value="sm">Samoan</option>
                    <option value="srd">Sardinian</option>
                    <option value="swide">Swiss German (Schweizerdeutsch)</option>
                    <option value="gd">Scots Gaelic</option>
                    <option value="sca">Scottish accent</option>
                    <option value="sec">Secret Agent Code</option>
                    <option value="sr">Serbian</option>
                    <option value="st">Sesotho</option>
                    <option value="shaen">Shakespearean English</option>
                    <option value="sn">Shona</option>
                    <option value="sd">Sindhi</option>
                    <option value="sa">Sindarin</option>
                    <option value="si">Sinhala (Sinhalese)</option>
                    <option value="sim">Simlish</option>
                    <option value="sk">Slovak</option>
                    <option value="sl">Slovenian</option>
                    <option value="so">Somali</option>
                    <option value="es">Spanish</option>
                    <option value="su">Sundanese</option>
                    <option value="susl">Surfer slang</option>
                    <option value="stsl">Stoner slang</option>
                    <option value="sw">Swahili</option>
                    <option value="sv">Swedish</option>
                    <option value="tah">Tahitian</option>
                    <option value="tg">Tajik</option>
                    <option value="ta">Tamil</option>
                    <option value="tt">Tatar</option>
                    <option value="te">Telugu</option>
                    <option value="th">Thai</option>
                    <option value="tir">Tigrinya</option>
                    <option value="tpi">Tok Pisin</option>
                    <option value="tr">Turkish</option>
                    <option value="tk">Turkmen</option>
                    <option value="trump">Trump Slang</option>
                    <option value="twitch">Twitch Chat Slang</option>
                    <option value="uk">Ukrainian</option>
                    <option value="ur">Urdu</option>
                    <option value="ug">Uyghur</option>
                    <option value="uwu">UwU Speech</option>
                    <option value="uz">Uzbek</option>
                    <option value="vi">Vietnamese</option>
                    <option value="viki">Viking War Chants</option>
                    <option value="vu">Vulcan</option>
                    <option value="war">Waray-Waray</option>
                    <option value="cy">Welsh</option>
                    <option value="wh">Whale</option>
                    <option value="wiz">Wizard Incantations</option>
                    <option value="woke">Woke Slang</option>
                    <option value="xh">Xhosa</option>
                    <option value="yi">Yiddish</option>
                    <option value="yo">Yoruba</option>
                    <option value="zu">Zulu</option>
                </select>
            </div>
            <div>
                <label for="custom-target-language">Custom:</label>
                <input type="text" id="custom-target-language">
            </div>
        </div>
        <div class="form-group">
            <label for="creativity">Creativity:</label>
            <input type="range" id="creativity" name="creativity" min="0" max="1" step="0.1" value="0.2">
            <span id="creativity-value">20%</span>
        </div>
        <button type="submit" id="translate-button">Translate</button>
    </form>
    <div id="translation-results"></div>
    <div id="favoritesContainer" style="display:none;">
        <h2>Favorites</h2>
        <table id="favoritesTable"></table>
    </div>
    <div class="about" id="aboutSection">
        <h3 style="cursor: pointer;" data-target="#aboutText">About Ô∏èüëÜ</h3>
        <p id="aboutText" style="display:none;">
            GPTranslator is a versatile language companion that effortlessly translates text across a wide range of
            languages, from conventional to quirky and imaginative. Our collection of fun languages includes Pirate
            Speak, Ancient Egyptian Hieroglyphics, Nerd Slang, Shakespearean English, Viking War Chants and many more.
            <br><br>
            Dive into a world of linguistic possibilities while GPTranslator automatically detects your input language
            and delivers accurate translations, considering the context you provide. Adjust the "Creativity" slider to
            control the translation's variability: a higher value introduces more diverse and inventive translations,
            while a lower value yields more focused and deterministic outcomes.
            <br><br>
            <strong>Warning:</strong> Having a creativity level above 60% can be risky. It often leads to failing
            translations.
            <br><br>
            This tool has been written by ChatGPT as a part of the open source project <a href="https://www.gptgames.dev/" target="_blank">https://www.gptgames.dev/</a>. It makes use of the OpenAI API with the GPT-3.5-turbo model in order to fix OCR (text recognition) errors and translate the input text.
            <br><br>
            <small>
            This app utilizes Tesseract.js for its text recognition functionalities. Tesseract.js is an open-source Optical Character Recognition (OCR) software licensed under the Apache-2.0 License. For more information and the source code, please visit <a href="https://github.com/naptha/tesseract.js" target="_blank">https://github.com/naptha/tesseract.js</a>.
            <br><br>
            Tesseract.js is based on the Tesseract OCR Engine, originally developed by HP and now maintained by Google. Tesseract is available under the Apache-2.0 License, which permits free use, modification, and distribution of the software, provided that the license conditions are met. For more details on the license, visit <a href="http://www.apache.org/licenses/LICENSE-2.0" target="_blank">http://www.apache.org/licenses/LICENSE-2.0</a>.
            </small>
        </p>
    </div>
</main>
<script type="text/javascript">
    const { jsonrepair } = JSONRepair;
    let isTranslating = false;
    const resultsContainer = document.getElementById("translation-results");

    function getTargetLanguage() {
        const targetLanguageValue = document.getElementById("target-language").value;
        const targetLanguageText = document.querySelector(`option[value=${targetLanguageValue}]`).innerText;
        const customTargetLanguage = document.getElementById("custom-target-language").value;
        return customTargetLanguage || targetLanguageText;
    }

    document.getElementById("translator-form").addEventListener("submit", async function (event) {
        event.preventDefault();
        if (isTranslating) {
            return;
        }
        isTranslating = true;
        const translateButton = document.getElementById("translate-button");
        translateButton.textContent = "Translating...";
        const inputString = document.getElementById("input-string").value;
        const context = document.getElementById("context").value;
        const creativity = Number(document.getElementById("creativity").value);
        const targetLanguage = getTargetLanguage();
        const response = await fetch('https://chatgpt.tobiasmue91.workers.dev/', {
            method: 'POST',
            headers: {"Content-Type": "application/json", "Accept": "*/*"},
            body: JSON.stringify({
                model: "gpt-3.5-turbo",
                max_tokens: 2000,
                temperature: creativity * 2,
                messages: [
                    {
                        role: "assistant",
                        content: `
I am GPTranslator. I will respond in JSON-Format and return accurate translations while I automatically detect the input language. \n
When the target language is fictional or an animal language, I will still give a creative and convincing response.\n\n
I will respond in this JSON format: { "detected_language": "COUNTRY_CODE", "translation_options": [ { "translation": "TRANSLATION_1", "fitting_score": 0.XX }, { "translation": "TRANSLATION_2", "fitting_score": 0.XX }, ... ] }\n\n
Provide the input string, (optional) context and the target language and I will provide the translation(s).\n
I will provide at least one translation result and the fitting_score can range between 0.0 and 1.0. \n
I will preserve the line breaks from the input text. If no line breaks are present, I will add them at appropriate positions to enhance readability.`,
                    },
                    {
                        role: "user",
                        content: `
Input string: "${inputString}";\n` +
                            (context ? `Context: "${context}";\n` : ``) +
                            `Target language: "${targetLanguage}";`,
                    },
                ],
            })
        });


        if (!response.ok) {
            resultsContainer.innerHTML = `<p>Could not retrieve translations.</p>`;
            isTranslating = false;
            translateButton.textContent = "Translate";
            return;
        }

        const data = await response.json();
        localStorage.setItem('latest_translation', JSON.stringify(data));
        localStorage.setItem('latest_input', inputString);
        displayTranslations(data);
        isTranslating = false;
        translateButton.textContent = "Translate";
    });

    function displayTranslations(data) {
        resultsContainer.innerHTML = "";
        const responseContent = data.choices[0].message.content;
        const responseJsonStr = responseContent.substring(responseContent.indexOf("{"), responseContent.lastIndexOf("}") + 1);
        let responseJsonData;
        try {
            responseJsonData = fixJSON(responseJsonStr);
        } catch (e) {
            console.log(e);
            resultsContainer.innerHTML = `<p>Could not parse translations. But here is the response (most likely) in JSON format:</p><pre>${responseContent}</pre>`;
            return;
        }
        if (responseJsonData && responseJsonData.translation_options) {
            const {detected_language, translation_options} = responseJsonData;
            resultsContainer.innerHTML += `<p><strong>Detected Language:</strong> ${detected_language}</p>`;
            translation_options.forEach(option => {
                const fittingScore = option.hasOwnProperty('fitting_score') ? ` (${option.fitting_score.toFixed(2)})` : '';
                resultsContainer.innerHTML += `
<p class="translation">
    <strong>Translation:${fittingScore}</strong>
    <span class="value" style="cursor: pointer; white-space: pre-wrap;">${option.translation}</span>
    <span class="favorite-btn" style="cursor: pointer; float: right;" title="Add to Favorites">‚≠ê</span>
</p>
`;
            });
            resultsContainer.querySelectorAll('p.translation').forEach(translation => {
                translation.querySelector('.value').addEventListener('click', function() {
                    const spanText = this.innerText;
                    navigator.clipboard.writeText(spanText).then(() => {
                        alert('Text copied to clipboard');
                    }).catch(err => {
                        console.error('Error in copying text: ', err);
                    });
                });
                translation.querySelector('.favorite-btn').addEventListener('click', function() {
                    const translationText = this.previousElementSibling.innerText;
                    const inputText = document.getElementById('input-string').value;
                    addFavorite(inputText, translationText);
                });
            })
        } else {
            resultsContainer.innerHTML = `<p>Could not retrieve translations.</p>`;
        }
    }

    document.addEventListener('DOMContentLoaded', function () {
        displayFavorites();

        // recover saved translations
        const latest = localStorage.getItem('latest_translation');
        const latestInput = localStorage.getItem('latest_input');
        if (latest && latestInput) {
            displayTranslations(JSON.parse(jsonrepair(latest)));
            document.getElementById('input-string').value = localStorage.getItem('latest_input');
        }

        // disable translate button when offline
        const updateButtonState = () => {
            const button = document.getElementById("translate-button");
            button.disabled = !navigator.onLine;
            button.title = navigator.onLine ? '' : 'You appear to be offline.';
        };

        updateButtonState();
        window.addEventListener('online',  updateButtonState);
        window.addEventListener('offline', updateButtonState);

        // Choices.js
        const targetLanguageSelect = document.getElementById('target-language');
        new Choices(targetLanguageSelect, {
            itemSelectText: 'Select'
        });
        document.getElementById("creativity").addEventListener("input", function (event) {
            document.getElementById("creativity-value").textContent = Number(event.target.value) * 100 + '%';
        });

        // Toggle visibility of the about text when the h3 is clicked
        document.querySelector('h3[data-target="#aboutText"]').addEventListener('click', function() {
            var targetId = this.getAttribute('data-target');
            var targetElement = document.querySelector(targetId);
            if (targetElement.style.display === "none") {
                targetElement.style.display = "block";
            } else {
                targetElement.style.display = "none";
            }
        });

        // Character count
        var textarea = document.getElementById('input-string');
        var charCount = document.getElementById('char-count');

        textarea.addEventListener('input', function() {
            var currentLength = this.value.length;
            charCount.textContent = `${currentLength} / 2000`;
        });

        // Dark mode toggle
        const toggle = document.getElementById('theme-toggle');
        const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
        let theme = localStorage.getItem('theme') || (prefersDark ? 'dark' : 'light');

        const applyTheme = () => {
            document.body.classList[theme === 'dark' ? 'add' : 'remove']('dark-mode');
            toggle.textContent = theme === 'dark' ? 'üåû' : 'üåú';
        };

        applyTheme();

        toggle.addEventListener('click', () => {
            theme = theme === 'dark' ? 'light' : 'dark';
            localStorage.setItem('theme', theme);
            applyTheme();
        });
    });

    const fixJSON = (jsonStr) => {
        try {
            return JSON.parse(jsonrepair(jsonStr));
        } catch (error) {
            while (true) {
                // Search json string specifically for '"'
                const match = jsonStr.match(/[\w|"]\s?(")\s?[\w|"]/);

                // If we don't find any, then we come out of the loop
                if (!match) {
                    break;
                }

                // Get the location of \"
                const s = match.index + match[0].indexOf('"');
                const e = s + 1;
                let c = jsonStr.substring(s, e);

                // Replace \" with \'
                c = c.replace(/"/g, "'");
                jsonStr = jsonStr.substring(0, s) + c + jsonStr.substring(e);
            }
            return JSON.parse(jsonrepair(jsonStr));
        }
    };


    // Additional JavaScript for Camera and OCR Functionality
    document.getElementById('close-camera').addEventListener('click', closeCameraModal);
    document.getElementById('open-camera').addEventListener('click', openCamera);
    document.getElementById('switch-camera').addEventListener('click', switchCamera);
    document.getElementById('take-snapshot').addEventListener('click', takeSnapshotAndClose);

    let videoStream = null;
    let currentDeviceId = null;
    let devices = [];

    async function openCamera() {
        devices = await navigator.mediaDevices.enumerateDevices();
        devices = devices.filter(device => device.kind === 'videoinput');
        if (devices.length === 0) {
            alert("No camera found.");
            return;
        }
        currentDeviceId = devices[0].deviceId;
        startStream(currentDeviceId);
        document.getElementById('camera-modal').style.display = 'flex';
    }

    async function startStream(deviceId) {
        if (videoStream) {
            videoStream.getTracks().forEach(track => track.stop());
        }
        videoStream = await navigator.mediaDevices.getUserMedia({ video: { deviceId: { exact: deviceId } } });
        document.getElementById('camera-stream').srcObject = videoStream;
    }

    async function switchCamera(event) {
        event.preventDefault();
        const currentIndex = devices.findIndex(device => device.deviceId === currentDeviceId);
        const nextIndex = (currentIndex + 1) % devices.length;
        currentDeviceId = devices[nextIndex].deviceId;
        startStream(currentDeviceId);
    }

    function closeCameraModal(event) {
        event.preventDefault();
        if (videoStream) {
            videoStream.getTracks().forEach(track => track.stop());
        }
        document.getElementById('camera-modal').style.display = 'none';
    }

    async function takeSnapshotAndClose(event) {
        event.preventDefault();
        const video = document.getElementById('camera-stream');
        const canvas = document.createElement('canvas'); // Use a temporary canvas
        canvas.width = video.videoWidth;
        canvas.height = video.videoHeight;
        canvas.getContext('2d').drawImage(video, 0, 0, canvas.width, canvas.height);

        processImage(canvas.toDataURL('image/png'));
        closeCameraModal(new Event("close"));
        document.getElementById('input-string').value = "Reading Text, please wait...";
    }

    async function processImage(imageSrc) {
        Tesseract.recognize(imageSrc).then(({ data: { text } }) => {
            correctOCR(text);
        });
    }

    async function correctOCR(extractedText) {
        const correctedText = await correctTextWithGPTAPI(extractedText);
        document.getElementById('input-string').value = correctedText;
    }

    async function correctTextWithGPTAPI(text) {
        let responseJson;
        try {
            const response = await fetch('https://chatgpt.tobiasmue91.workers.dev/', {
                method: 'POST',
                headers: {
                    "Content-Type": "application/json",
                    "Accept": "*/*"
                },
                body: JSON.stringify({
                    model: "gpt-3.5-turbo",
                    max_tokens: 200,
                    temperature: 0.4,
                    messages: [
                        {
                            role: "system",
                            content: "Correct OCR errors in the following text by removing any random characters or fixing words that contain faulty letters. Only return the fixed text and nothing else!"
                        },
                        {
                            role: "user",
                            content: text
                        }
                    ]
                })
            });

            if (!response.ok) {
                throw new Error('Failed to correct OCR errors');
            }

            responseJson = await response.json();
        } catch (error) {
            console.error('Error correcting text:', error);
            return text; // Return original text in case of failure
        }

        return responseJson.choices[0].message.content;
    }


    // Adding, Removing and Displaying Favorites
    function addFavorite(inputText, translation) {
        let favorites = JSON.parse(localStorage.getItem('favorites')) || [];
        // Check if the favorite already exists
        const exists = favorites.some(fav => fav.inputText === inputText && fav.translation === translation);
        if (!exists) {
            favorites.push({ inputText, translation });
            localStorage.setItem('favorites', JSON.stringify(favorites));
            displayFavorites(); // Update the favorites list display
        }
    }

    function removeFavorite(inputText, translation) {
        const isConfirmed = confirm(`Are you sure you want to remove this favorite translation?`);
        if (!isConfirmed) {
            return;
        }

        let favorites = JSON.parse(localStorage.getItem('favorites')) || [];
        const index = favorites.findIndex(fav => fav.inputText === inputText && fav.translation === translation);
        if (index > -1) {
            favorites.splice(index, 1);
            localStorage.setItem('favorites', JSON.stringify(favorites));
            displayFavorites();
        }
    }

    function displayFavorites() {
        const favorites = JSON.parse(localStorage.getItem('favorites')) || [];
        const container = document.getElementById('favoritesContainer');
        const table = document.getElementById("favoritesTable");
        table.innerHTML = `
                        <thead>
                            <tr>
                                <th>Input</th>
                                <th>Translation</th>
                                <th>Action</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${favorites.map((fav, index) => `
                                <tr>
                                    <td><span>${fav.inputText}</span></td>
                                    <td><span>${fav.translation}</span></td>
                                    <td style="text-align: center;"><span class="remove-favorite-btn" style="cursor: pointer;" data-index="${index}">üóëÔ∏è</span></td>
                                </tr>
                            `).join('')}
                        </tbody>
                    `;

        if (favorites.length > 0) {
            container.style.display = '';

            // Add click event listeners for removing from favorites
            document.querySelectorAll('.remove-favorite-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const index = this.getAttribute('data-index');
                    const { inputText, translation } = favorites[index];
                    removeFavorite(inputText, translation);
                });
            });
        } else {
            container.style.display = 'none';
        }
    }
</script>
<script>
    if ('serviceWorker' in navigator) {
        navigator.serviceWorker.register('/tools/service-worker.js', { scope: '/tools/' })
            .then(function(registration) {
                console.log('Service worker registration succeeded:', registration);
            })
            .catch(function(error) {
                console.log('Service worker registration failed:', error);
            });
    }
</script>
<script data-goatcounter="https://gptgames.goatcounter.com/count" async src="//gc.zgo.at/count.js"></script>
<script src="../logo.js"></script>
</body>
</html>
