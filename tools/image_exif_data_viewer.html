<!DOCTYPE html>
<html lang="en" class="light">
<head>
    <link rel="icon"
          href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ðŸ“·</text></svg>">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <meta name="description"
          content="Analyze EXIF data of your images with this advanced, user-friendly Image EXIF Data Viewer tool.">
    <title>Advanced Image EXIF Data Viewer</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>tailwind.config = {
        darkMode: 'class',
        theme: {
            extend: {
                colors: {
                    primary: {
                        50: '#f0f9ff',
                        100: '#e0f2fe',
                        200: '#bae6fd',
                        300: '#7dd3fc',
                        400: '#38bdf8',
                        500: '#0ea5e9',
                        600: '#0284c7',
                        700: '#0369a1',
                        800: '#075985',
                        900: '#0c4a6e'
                    }
                }
            }
        }
    }</script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/exif-js/2.3.0/exif.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <style>.tooltip {
        position: relative
    }

    .tooltip:hover .tooltip-text {
        visibility: visible;
        opacity: 1
    }

    .tooltip-text {
        visibility: hidden;
        opacity: 0;
        width: 200px;
        background-color: rgba(0, 0, 0, 0.8);
        color: #fff;
        text-align: center;
        border-radius: 6px;
        padding: 5px;
        position: absolute;
        z-index: 1000;
        bottom: 125%;
        left: 50%;
        transform: translateX(-50%);
        transition: opacity 0.3s
    }

    #map {
        height: 400px;
        width: 100%;
        border-radius: 0.375rem
    }

    .animate-pulse-slow {
        animation: pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite
    }

    @keyframes pulse {
        0%, 100% {
            opacity: 1
        }
        50% {
            opacity: .5
        }
    }

    .grid-auto-fit {
        grid-template-columns:repeat(auto-fit, minmax(200px, 1fr))
    }

    @media (prefers-color-scheme: dark) {
        html:not(.light) {
            --tw-bg-opacity: 1;
            background-color: rgb(17 24 39/var(--tw-bg-opacity))
        }
    }

    .exif-table tr:nth-child(odd) {
        background-color: rgba(0, 0, 0, 0.05)
    }

    .dark .exif-table tr:nth-child(odd) {
        background-color: rgba(255, 255, 255, 0.05)
    }

    .img-overlay {
        pointer-events: none
    }</style>
</head>
<body class="bg-gray-50 dark:bg-gray-900 text-gray-800 dark:text-gray-200 transition-colors duration-300">
<div class="container mx-auto px-4 py-8 max-w-6xl">
    <header class="mb-8">
        <div class="flex justify-between items-center"><h1
                class="text-3xl md:text-4xl font-bold bg-gradient-to-r from-primary-600 to-blue-500 text-transparent bg-clip-text">
            Advanced Image EXIF Data Viewer</h1>
            <button id="themeToggle" class="p-2 rounded-full bg-gray-200 dark:bg-gray-700 focus:outline-none">
                <svg id="lightIcon" class="w-5 h-5 hidden dark:block" fill="currentColor" viewBox="0 0 20 20">
                    <path d="M10 2a1 1 0 011 1v1a1 1 0 11-2 0V3a1 1 0 011-1zm4 8a4 4 0 11-8 0 4 4 0 018 0zm-.464 4.95l.707.707a1 1 0 001.414-1.414l-.707-.707a1 1 0 00-1.414 1.414zm2.12-10.607a1 1 0 010 1.414l-.706.707a1 1 0 11-1.414-1.414l.707-.707a1 1 0 011.414 0zM17 11a1 1 0 100-2h-1a1 1 0 100 2h1zm-7 4a1 1 0 011 1v1a1 1 0 11-2 0v-1a1 1 0 011-1zM5.05 6.464A1 1 0 106.465 5.05l-.708-.707a1 1 0 00-1.414 1.414l.707.707zm1.414 8.486l-.707.707a1 1 0 01-1.414-1.414l.707-.707a1 1 0 011.414 1.414zM4 11a1 1 0 100-2H3a1 1 0 000 2h1z"
                          fill-rule="evenodd" clip-rule="evenodd"></path>
                </svg>
                <svg id="darkIcon" class="w-5 h-5 block dark:hidden" fill="currentColor" viewBox="0 0 20 20">
                    <path d="M17.293 13.293A8 8 0 016.707 2.707a8.001 8.001 0 1010.586 10.586z"></path>
                </svg>
            </button>
        </div>
        <p class="mt-2 text-gray-600 dark:text-gray-400">Upload images to analyze their EXIF metadata, view camera
            statistics, and see photo locations.</p></header>
    <div class="mb-6">
        <div class="flex flex-wrap gap-4 items-center justify-center mb-4">
            <div class="relative"><input type="file" id="imageInput" accept="image/*" class="hidden" multiple><label
                    for="imageInput"
                    class="flex items-center gap-2 bg-primary-600 hover:bg-primary-700 text-white font-medium py-2 px-4 rounded-lg cursor-pointer transition duration-300 ease-in-out">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                          d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
                </svg>
                Select Image(s)</label></div>
            <button id="clearBtn"
                    class="flex items-center gap-2 bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 dark:hover:bg-gray-600 text-gray-800 dark:text-gray-200 font-medium py-2 px-4 rounded-lg transition duration-300 ease-in-out hidden">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                          d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
                </svg>
                Clear All
            </button>
            <div class="tooltip">
                <button id="helpBtn"
                        class="flex items-center gap-2 bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 dark:hover:bg-gray-600 text-gray-800 dark:text-gray-200 font-medium py-2 px-4 rounded-lg transition duration-300 ease-in-out">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                              d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                    </svg>
                    Help
                </button>
                <span class="tooltip-text">Upload one or more images to analyze EXIF data. Click on thumbnails to view detailed info.</span>
            </div>
        </div>
        <div id="dragDropArea"
             class="border-3 border-dashed border-gray-300 dark:border-gray-700 rounded-lg p-10 text-center cursor-pointer hover:border-primary-500 transition duration-300 bg-white dark:bg-gray-800 shadow-sm">
            <div class="space-y-3">
                <svg class="mx-auto h-12 w-12 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                          d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"></path>
                </svg>
                <div class="text-lg font-medium">Drag and drop images here</div>
                <p class="text-sm text-gray-500 dark:text-gray-400">Supports JPG, PNG, TIFF, and other image formats
                    with EXIF data</p></div>
        </div>
    </div>
    <div id="loadingIndicator" class="hidden my-8">
        <div class="flex flex-col items-center justify-center space-y-3">
            <div class="animate-spin rounded-full h-10 w-10 border-4 border-primary-500 border-t-transparent"></div>
            <p class="text-gray-600 dark:text-gray-400">Processing image data...</p></div>
    </div>
    <div id="noExifMessage"
         class="hidden text-center bg-yellow-50 dark:bg-yellow-900/30 border border-yellow-200 dark:border-yellow-800 text-yellow-800 dark:text-yellow-200 p-4 rounded-lg my-6">
        <div class="flex items-center justify-center space-x-3">
            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                      d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"></path>
            </svg>
            <span>No EXIF data found in the uploaded image(s). Try another image that contains embedded metadata.</span>
        </div>
    </div>
    <div id="contentContainer" class="hidden space-y-8">
        <div class="flex flex-col md:flex-row gap-6">
            <div class="md:w-1/3 space-y-6">
                <div class="bg-white dark:bg-gray-800 p-6 rounded-lg shadow-md">
                    <h2 class="text-xl font-semibold mb-4 flex items-center">
                        <svg class="w-5 h-5 mr-2 text-primary-500" fill="none" stroke="currentColor"
                             viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                  d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                        </svg>
                        Uploaded Images (<span id="imageCount">0</span>)
                    </h2>
                    <div id="imageContainer" class="grid grid-cols-2 gap-3 max-h-[500px] overflow-y-auto p-1"></div>
                </div>
                <div id="statsContainer" class="bg-white dark:bg-gray-800 p-6 rounded-lg shadow-md hidden">
                    <h2 class="text-xl font-semibold mb-4 flex items-center">
                        <svg class="w-5 h-5 mr-2 text-primary-500" fill="none" stroke="currentColor"
                             viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                  d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
                        </svg>
                        Collection Stats
                    </h2>
                    <div id="statsContent" class="space-y-3 text-sm"></div>
                </div>
            </div>
            <div class="md:w-2/3 space-y-6">
                <div id="exifDataContainer" class="bg-white dark:bg-gray-800 p-6 rounded-lg shadow-md hidden">
                    <div class="flex justify-between items-center mb-4">
                        <h2 class="text-xl font-semibold flex items-center">
                            <svg class="w-5 h-5 mr-2 text-primary-500" fill="none" stroke="currentColor"
                                 viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                      d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                            EXIF Data
                        </h2>
                        <select id="exifDisplayMode"
                                class="bg-gray-100 dark:bg-gray-700 border-0 rounded-md p-1 text-sm">
                            <option value="categorized">Categorized</option>
                            <option value="all">All Tags</option>
                        </select></div>
                    <div id="selectedImageName" class="text-sm mb-3 text-gray-600 dark:text-gray-400"></div>
                    <div id="exifData" class="max-h-[400px] overflow-y-auto"></div>
                </div>
                <div id="chartContainer" class="bg-white dark:bg-gray-800 p-6 rounded-lg shadow-md hidden">
                    <h2 class="text-xl font-semibold mb-4 flex items-center">
                        <svg class="w-5 h-5 mr-2 text-primary-500" fill="none" stroke="currentColor"
                             viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                  d="M11 3.055A9.001 9.001 0 1020.945 13H11V3.055z"></path>
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                  d="M20.488 9H15V3.512A9.025 9.025 0 0120.488 9z"></path>
                        </svg>
                        Charts
                    </h2>
                    <div class="tabs flex mb-4 border-b border-gray-200 dark:border-gray-700">
                        <button class="tab-btn tab-active py-2 px-4 border-b-2 border-primary-500 -mb-px text-primary-600 dark:text-primary-400"
                                data-tab="camera">Cameras
                        </button>
                        <button class="tab-btn py-2 px-4 text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300"
                                data-tab="exposure">Exposure
                        </button>
                        <button class="tab-btn py-2 px-4 text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300"
                                data-tab="iso">ISO
                        </button>
                        <button class="tab-btn py-2 px-4 text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300"
                                data-tab="lens">Lenses
                        </button>
                    </div>
                    <div class="tab-content" data-tab="camera">
                        <canvas id="cameraModelChart" height="300"></canvas>
                    </div>
                    <div class="tab-content hidden" data-tab="exposure">
                        <canvas id="exposureTimeChart" height="300"></canvas>
                    </div>
                    <div class="tab-content hidden" data-tab="iso">
                        <canvas id="isoChart" height="300"></canvas>
                    </div>
                    <div class="tab-content hidden" data-tab="lens">
                        <canvas id="lensChart" height="300"></canvas>
                    </div>
                </div>
                <div id="mapContainer" class="bg-white dark:bg-gray-800 p-6 rounded-lg shadow-md hidden">
                    <h2 class="text-xl font-semibold mb-4 flex items-center">
                        <svg class="w-5 h-5 mr-2 text-primary-500" fill="none" stroke="currentColor"
                             viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                  d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"></path>
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                  d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"></path>
                        </svg>
                        Location Map
                    </h2>
                    <div id="map"></div>
                    <div id="noLocationData" class="hidden text-center text-gray-500 dark:text-gray-400 my-4">No
                        location data available in the selected image.
                    </div>
                </div>
            </div>
        </div>
    </div>
    <footer class="mt-12 text-center text-sm text-gray-500 dark:text-gray-400"><p>Advanced Image EXIF Data Viewer - For
        photographers and privacy-conscious users</p>
        <p class="mt-1">All processing happens locally in your browser. No images are uploaded to any server.</p>
    </footer>
</div>
<div id="helpModal" class="fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center hidden">
    <div class="bg-white dark:bg-gray-800 rounded-lg max-w-2xl w-full mx-4 shadow-xl">
        <div class="p-6">
            <div class="flex justify-between items-center mb-4"><h3 class="text-xl font-bold">How to Use This Tool</h3>
                <button id="closeHelpModal" class="text-gray-500 hover:text-gray-700 dark:hover:text-gray-300">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                              d="M6 18L18 6M6 6l12 12"></path>
                    </svg>
                </button>
            </div>
            <div class="space-y-4">
                <div><h4 class="font-medium">What is EXIF data?</h4>
                    <p class="text-gray-600 dark:text-gray-400">EXIF (Exchangeable Image File Format) data includes
                        technical information embedded in your photos, such as camera model, exposure settings, date
                        taken, and sometimes GPS location.</p></div>
                <div><h4 class="font-medium">How to use:</h4>
                    <ol class="list-decimal list-inside text-gray-600 dark:text-gray-400 space-y-1 ml-4">
                        <li>Upload one or more images by clicking the "Select Image(s)" button or dragging files onto
                            the drop area
                        </li>
                        <li>Click on a thumbnail to view its detailed EXIF information</li>
                        <li>Use the tabs to view different charts about your collection</li>
                        <li>If your images contain GPS data, they'll appear on the map</li>
                    </ol>
                </div>
                <div><h4 class="font-medium">Privacy Note:</h4>
                    <p class="text-gray-600 dark:text-gray-400">This tool processes all data locally in your browser. No
                        images or data are uploaded to any server.</p></div>
            </div>
            <div class="mt-6 pt-4 border-t border-gray-200 dark:border-gray-700">
                <button id="closeModalBtn"
                        class="bg-primary-600 hover:bg-primary-700 text-white font-medium py-2 px-4 rounded-lg w-full transition duration-300">
                    Got it!
                </button>
            </div>
        </div>
    </div>
</div>
<script>const imageInput = document.getElementById('imageInput');
const dragDropArea = document.getElementById('dragDropArea');
const loadingIndicator = document.getElementById('loadingIndicator');
const imageContainer = document.getElementById('imageContainer');
const exifDataDiv = document.getElementById('exifData');
const exifDataContainer = document.getElementById('exifDataContainer');
const chartContainer = document.getElementById('chartContainer');
const mapContainer = document.getElementById('mapContainer');
const statsContainer = document.getElementById('statsContainer');
const contentContainer = document.getElementById('contentContainer');
const noExifMessage = document.getElementById('noExifMessage');
const imageCountSpan = document.getElementById('imageCount');
const clearBtn = document.getElementById('clearBtn');
const noLocationData = document.getElementById('noLocationData');
const selectedImageName = document.getElementById('selectedImageName');
const exifDisplayMode = document.getElementById('exifDisplayMode');
const helpBtn = document.getElementById('helpBtn');
const helpModal = document.getElementById('helpModal');
const closeHelpModal = document.getElementById('closeHelpModal');
const closeModalBtn = document.getElementById('closeModalBtn');
const themeToggle = document.getElementById('themeToggle');
let allImages = [];
let allExifData = [];
let charts = {};
let map = null;
let markers = [];
themeToggle.addEventListener('click', () => {
    document.documentElement.classList.toggle('light');
    document.documentElement.classList.toggle('dark');
    updateCharts()
});
if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
    document.documentElement.classList.add('dark');
    document.documentElement.classList.remove('light')
}
document.querySelectorAll('.tab-btn').forEach(button => {
    button.addEventListener('click', () => {
        document.querySelectorAll('.tab-btn').forEach(btn => {
            btn.classList.remove('tab-active');
            btn.classList.remove('border-primary-500');
            btn.classList.remove('text-primary-600');
            btn.classList.remove('dark:text-primary-400');
            btn.classList.add('text-gray-500');
            btn.classList.add('dark:text-gray-400')
        });
        button.classList.add('tab-active');
        button.classList.add('border-primary-500');
        button.classList.add('text-primary-600');
        button.classList.add('dark:text-primary-400');
        button.classList.remove('text-gray-500');
        button.classList.remove('dark:text-gray-400');
        document.querySelectorAll('.tab-content').forEach(content => {
            content.classList.add('hidden')
        });
        const tabName = button.getAttribute('data-tab');
        document.querySelector(`.tab-content[data-tab="${tabName}"]`).classList.remove('hidden')
    })
});
helpBtn.addEventListener('click', () => {
    helpModal.classList.remove('hidden')
});
closeHelpModal.addEventListener('click', () => {
    helpModal.classList.add('hidden')
});
closeModalBtn.addEventListener('click', () => {
    helpModal.classList.add('hidden')
});
helpModal.addEventListener('click', (e) => {
    if (e.target === helpModal) {
        helpModal.classList.add('hidden')
    }
});

function initMap() {
    if (map) return;
    map = L.map('map').setView([0, 0], 2);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'}).addTo(map)
}

function handleFiles(files) {
    if (files.length === 0) return;
    loadingIndicator.classList.remove('hidden');
    contentContainer.classList.add('hidden');
    noExifMessage.classList.add('hidden');
    allImages = [];
    allExifData = [];
    markers = [];
    imageContainer.innerHTML = '';
    exifDataDiv.innerHTML = '';
    clearBtn.classList.remove('hidden');
    let processedFiles = 0;
    let hasExifData = false;
    for (const file of files) {
        if (!file.type.startsWith('image/')) {
            processedFiles++;
            continue
        }
        const reader = new FileReader();
        reader.onload = (e) => {
            const imgContainer = document.createElement('div');
            imgContainer.className = 'relative group cursor-pointer';
            const img = document.createElement('img');
            img.src = e.target.result;
            img.className = 'w-full h-24 object-cover rounded-lg shadow-sm transition duration-300';
            img.setAttribute('data-index', allImages.length);
            imgContainer.appendChild(img);
            imageContainer.appendChild(imgContainer);
            allImages.push({element: img, file: file, src: e.target.result});
            EXIF.getData(file, function () {
                const exifData = EXIF.getAllTags(this);
                if (Object.keys(exifData).length > 0) {
                    hasExifData = true
                }
                allExifData.push(exifData);
                processedFiles++;
                const overlay = document.createElement('div');
                overlay.className = 'absolute inset-0 bg-black bg-opacity-0 group-hover:bg-opacity-10 flex items-center justify-center rounded-lg transition duration-300 img-overlay';
                imgContainer.appendChild(overlay);
                const fileNameElement = document.createElement('div');
                fileNameElement.className = 'text-xs mt-1 text-center truncate';
                fileNameElement.textContent = file.name;
                imgContainer.appendChild(fileNameElement);
                imgContainer.onclick = () => {
                    document.querySelectorAll('#imageContainer img').forEach(img => {
                        img.classList.remove('ring-2', 'ring-primary-500')
                    });
                    img.classList.add('ring-2', 'ring-primary-500');
                    showExifData(parseInt(img.getAttribute('data-index')))
                };
                if (processedFiles === files.length) {
                    loadingIndicator.classList.add('hidden');
                    contentContainer.classList.remove('hidden');
                    if (!hasExifData) {
                        noExifMessage.classList.remove('hidden')
                    }
                    imageCountSpan.textContent = allImages.length;
                    analyzeExifData();
                    if (allImages.length > 0) {
                        const firstImg = document.querySelector('#imageContainer img');
                        if (firstImg) {
                            firstImg.classList.add('ring-2', 'ring-primary-500');
                            showExifData(0)
                        }
                    }
                }
            })
        };
        reader.readAsDataURL(file)
    }
}

function showExifData(index) {
    const exifData = allExifData[index];
    const imageFile = allImages[index].file;
    selectedImageName.textContent = imageFile.name;
    const mode = exifDisplayMode.value;
    if (Object.keys(exifData).length === 0) {
        exifDataDiv.innerHTML = '<div class="text-center py-4 text-gray-500">No EXIF data found in this image.</div>';
        exifDataContainer.classList.remove('hidden');
        return
    }
    let html = '';
    if (mode === 'categorized') {
        const categories = {
            'Camera Information': ['Make', 'Model', 'Software', 'LensMake', 'LensModel'],
            'Exposure Settings': ['ExposureTime', 'FNumber', 'ISO', 'ExposureProgram', 'ExposureMode', 'ExposureCompensation', 'MeteringMode', 'Flash'],
            'Image Details': ['DateTimeOriginal', 'CreateDate', 'PixelXDimension', 'PixelYDimension', 'Orientation', 'ColorSpace'],
            'Focal Length': ['FocalLength', 'FocalLengthIn35mmFormat', 'DigitalZoomRatio'],
            'GPS Information': ['GPSLatitude', 'GPSLongitude', 'GPSAltitude', 'GPSDateStamp', 'GPSTimeStamp']
        };
        const formatters = {
            ExposureTime: value => {
                if (value <= 0) return 'Unknown';
                if (value < 1) return `1/${Math.round(1 / value)} sec`;
                return `${value} sec`
            },
            FNumber: value => `f/${value}`,
            FocalLength: value => `${value} mm`,
            ISO: value => `ISO ${value}`,
            DateTimeOriginal: value => {
                try {
                    const parts = value.split(' ');
                    const dateParts = parts[0].split(':');
                    return `${dateParts[0]}-${dateParts[1]}-${dateParts[2]} ${parts[1]}`
                } catch (e) {
                    return value
                }
            }
        };
        const exifProgramModes = {
            0: 'Not defined',
            1: 'Manual',
            2: 'Program AE',
            3: 'Aperture-priority AE',
            4: 'Shutter-priority AE',
            5: 'Creative (slow speed)',
            6: 'Action (high speed)',
            7: 'Portrait',
            8: 'Landscape',
            9: 'Bulb'
        };
        for (const [category, tags] of Object.entries(categories)) {
            let hasData = false;
            let categoryHtml = `<div class="mb-4"><h3 class="font-medium text-lg mb-2">${category}</h3><table class="w-full exif-table text-sm"><tbody>`;
            for (const tag of tags) {
                if (exifData[tag] !== undefined) {
                    hasData = true;
                    let displayValue = exifData[tag];
                    if (formatters[tag]) {
                        displayValue = formatters[tag](displayValue)
                    }
                    if (tag === 'ExposureProgram' && exifProgramModes[displayValue]) {
                        displayValue = exifProgramModes[displayValue]
                    }
                    if (tag.startsWith('GPS') && Array.isArray(displayValue)) {
                        if (tag === 'GPSLatitude' || tag === 'GPSLongitude') {
                            const degrees = displayValue[0];
                            const minutes = displayValue[1];
                            const seconds = displayValue[2];
                            displayValue = `${degrees}Â° ${minutes}' ${seconds}"`
                        }
                    }
                    categoryHtml += `<tr><td class="py-1 px-2 font-medium w-1/3">${tag}</td><td class="py-1 px-2">${displayValue}</td></tr>`
                }
            }
            categoryHtml += `</tbody></table></div>`;
            if (hasData) {
                html += categoryHtml
            }
        }
        let otherHtml = `<div class="mb-4"><h3 class="font-medium text-lg mb-2">Other Tags</h3><table class="w-full exif-table text-sm"><tbody>`;
        let hasOtherData = false;
        for (const tag in exifData) {
            let isInCategory = false;
            for (const tags of Object.values(categories)) {
                if (tags.includes(tag)) {
                    isInCategory = true;
                    break
                }
            }
            if (!isInCategory) {
                hasOtherData = true;
                otherHtml += `<tr><td class="py-1 px-2 font-medium w-1/3">${tag}</td><td class="py-1 px-2">${exifData[tag]}</td></tr>`
            }
        }
        otherHtml += `</tbody></table></div>`;
        if (hasOtherData) {
            html += otherHtml
        }
    } else {
        html = `<table class="w-full exif-table text-sm"><tbody>`;
        for (const tag in exifData) {
            html += `<tr><td class="py-1 px-2 font-medium w-1/3">${tag}</td><td class="py-1 px-2">${exifData[tag]}</td></tr>`
        }
        html += `</tbody></table>`
    }
    exifDataDiv.innerHTML = html;
    exifDataContainer.classList.remove('hidden');
    showLocationOnMap(exifData)
}

function showLocationOnMap(exifData) {
    if (exifData.GPSLatitude && exifData.GPSLongitude) {
        initMap();
        const latRef = exifData.GPSLatitudeRef || 'N';
        const lonRef = exifData.GPSLongitudeRef || 'E';
        let lat = exifData.GPSLatitude[0] + exifData.GPSLatitude[1] / 60 + exifData.GPSLatitude[2] / 3600;
        if (latRef === 'S') lat = -lat;
        let lon = exifData.GPSLongitude[0] + exifData.GPSLongitude[1] / 60 + exifData.GPSLongitude[2] / 3600;
        if (lonRef === 'W') lon = -lon;
        map.setView([lat, lon], 13);
        markers.forEach(marker => map.removeLayer(marker));
        markers = [];
        const marker = L.marker([lat, lon]).addTo(map);
        markers.push(marker);
        mapContainer.classList.remove('hidden');
        noLocationData.classList.add('hidden')
    } else {
        if (map) {
            markers.forEach(marker => map.removeLayer(marker));
            markers = []
        }
        noLocationData.classList.remove('hidden');
        mapContainer.classList.remove('hidden')
    }
}

function analyzeExifData() {
    if (allExifData.length === 0) return;
    const cameraModels = {};
    const lensModels = {};
    const focalLengths = [];
    const exposureTimes = [];
    const isoValues = [];
    const apertures = [];
    const dates = [];
    let hasGpsCount = 0;
    allExifData.forEach(exifData => {
        if (exifData.Model) {
            cameraModels[exifData.Model] = (cameraModels[exifData.Model] || 0) + 1
        }
        if (exifData.LensModel) {
            lensModels[exifData.LensModel] = (lensModels[exifData.LensModel] || 0) + 1
        }
        if (exifData.FocalLength) {
            focalLengths.push(exifData.FocalLength)
        }
        if (exifData.ExposureTime) {
            exposureTimes.push(exifData.ExposureTime)
        }
        if (exifData.ISO) {
            isoValues.push(exifData.ISO)
        }
        if (exifData.FNumber) {
            apertures.push(exifData.FNumber)
        }
        if (exifData.DateTimeOriginal) {
            dates.push(exifData.DateTimeOriginal)
        }
        if (exifData.GPSLatitude && exifData.GPSLongitude) {
            hasGpsCount++
        }
    });
    let statsHtml = '';
    if (Object.keys(cameraModels).length > 0) {
        statsHtml += `<div><span class="font-medium">Cameras:</span> ${Object.keys(cameraModels).length} different model(s)</div>`
    }
    if (Object.keys(lensModels).length > 0) {
        statsHtml += `<div><span class="font-medium">Lenses:</span> ${Object.keys(lensModels).length} different model(s)</div>`
    }
    if (dates.length > 0) {
        statsHtml += `<div><span class="font-medium">Images with dates:</span> ${dates.length}</div>`
    }
    if (hasGpsCount > 0) {
        statsHtml += `<div><span class="font-medium">Images with GPS data:</span> ${hasGpsCount}</div>`
    }
    if (statsHtml) {
        document.getElementById('statsContent').innerHTML = statsHtml;
        statsContainer.classList.remove('hidden')
    }
    createCameraModelChart(cameraModels);
    createExposureTimeChart(exposureTimes);
    createISOChart(isoValues);
    createLensChart(lensModels);
    if (Object.keys(cameraModels).length > 0 || exposureTimes.length > 0 || isoValues.length > 0 || Object.keys(lensModels).length > 0) {
        chartContainer.classList.remove('hidden')
    }
}

function createCameraModelChart(cameraModels) {
    if (Object.keys(cameraModels).length === 0) return;
    const ctx = document.getElementById('cameraModelChart').getContext('2d');
    const isDarkMode = document.documentElement.classList.contains('dark');
    if (charts.cameraModel) {
        charts.cameraModel.destroy()
    }
    const sortedLabels = Object.keys(cameraModels).sort((a, b) => cameraModels[b] - cameraModels[a]);
    const data = sortedLabels.map(label => cameraModels[label]);
    charts.cameraModel = new Chart(ctx, {
        type: 'doughnut',
        data: {
            labels: sortedLabels,
            datasets: [{
                data: data,
                backgroundColor: ['#3b82f6', '#8b5cf6', '#ec4899', '#f43f5e', '#f97316', '#eab308', '#22c55e', '#14b8a6', '#0ea5e9', '#6366f1'],
                borderWidth: 1
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: {
                    position: 'right',
                    labels: {color: isDarkMode ? '#f3f4f6' : '#374151', padding: 20, font: {size: 12}}
                },
                tooltip: {
                    backgroundColor: isDarkMode ? 'rgba(30, 41, 59, 0.8)' : 'rgba(255, 255, 255, 0.8)',
                    titleColor: isDarkMode ? '#f3f4f6' : '#1f2937',
                    bodyColor: isDarkMode ? '#e5e7eb' : '#374151',
                    borderColor: isDarkMode ? 'rgba(226, 232, 240, 0.2)' : 'rgba(30, 41, 59, 0.2)',
                    borderWidth: 1
                }
            }
        }
    })
}

function createExposureTimeChart(exposureTimes) {
    if (exposureTimes.length === 0) return;
    const ctx = document.getElementById('exposureTimeChart').getContext('2d');
    const isDarkMode = document.documentElement.classList.contains('dark');
    if (charts.exposureTime) {
        charts.exposureTime.destroy()
    }
    const exposureCategories = {
        'Below 1/1000': 0,
        '1/1000 - 1/500': 0,
        '1/500 - 1/250': 0,
        '1/250 - 1/125': 0,
        '1/125 - 1/60': 0,
        '1/60 - 1/30': 0,
        '1/30 - 1/15': 0,
        '1/15 - 1/8': 0,
        '1/8 - 1/4': 0,
        '1/4 - 1/2': 0,
        '1/2 - 1 sec': 0,
        'Over 1 sec': 0
    };
    const boundaries = [0, 0.001, 0.002, 0.004, 0.008, 0.0166, 0.0333, 0.0666, 0.125, 0.25, 0.5, 1];
    const labels = Object.keys(exposureCategories);
    exposureTimes.forEach(time => {
        let binIndex = boundaries.findIndex(boundary => time < boundary);
        if (binIndex === -1) binIndex = labels.length - 1;
        exposureCategories[labels[binIndex]]++
    });
    charts.exposureTime = new Chart(ctx, {
        type: 'bar',
        data: {
            labels: labels,
            datasets: [{
                label: 'Number of Photos',
                data: Object.values(exposureCategories),
                backgroundColor: '#0ea5e9',
                borderColor: '#0284c7',
                borderWidth: 1
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            scales: {
                y: {
                    beginAtZero: true,
                    ticks: {color: isDarkMode ? '#e5e7eb' : '#374151'},
                    grid: {color: isDarkMode ? 'rgba(255, 255, 255, 0.1)' : 'rgba(0, 0, 0, 0.1)'}
                }, x: {ticks: {color: isDarkMode ? '#e5e7eb' : '#374151'}, grid: {display: false}}
            },
            plugins: {
                legend: {display: false},
                tooltip: {
                    backgroundColor: isDarkMode ? 'rgba(30, 41, 59, 0.8)' : 'rgba(255, 255, 255, 0.8)',
                    titleColor: isDarkMode ? '#f3f4f6' : '#1f2937',
                    bodyColor: isDarkMode ? '#e5e7eb' : '#374151',
                    borderColor: isDarkMode ? 'rgba(226, 232, 240, 0.2)' : 'rgba(30, 41, 59, 0.2)',
                    borderWidth: 1
                }
            }
        }
    })
}

function createISOChart(isoValues) {
    if (isoValues.length === 0) return;
    const ctx = document.getElementById('isoChart').getContext('2d');
    const isDarkMode = document.documentElement.classList.contains('dark');
    if (charts.iso) {
        charts.iso.destroy()
    }
    const isoCategories = {
        'ISO 100 or less': 0,
        'ISO 101-400': 0,
        'ISO 401-800': 0,
        'ISO 801-1600': 0,
        'ISO 1601-3200': 0,
        'ISO 3201-6400': 0,
        'ISO 6401+': 0
    };
    isoValues.forEach(iso => {
        if (iso <= 100) isoCategories['ISO 100 or less']++; else if (iso <= 400) isoCategories['ISO 101-400']++; else if (iso <= 800) isoCategories['ISO 401-800']++; else if (iso <= 1600) isoCategories['ISO 801-1600']++; else if (iso <= 3200) isoCategories['ISO 1601-3200']++; else if (iso <= 6400) isoCategories['ISO 3201-6400']++; else isoCategories['ISO 6401+']++
    });
    charts.iso = new Chart(ctx, {
        type: 'bar',
        data: {
            labels: Object.keys(isoCategories),
            datasets: [{
                label: 'Number of Photos',
                data: Object.values(isoCategories),
                backgroundColor: '#8b5cf6',
                borderColor: '#7c3aed',
                borderWidth: 1
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            scales: {
                y: {
                    beginAtZero: true,
                    ticks: {color: isDarkMode ? '#e5e7eb' : '#374151'},
                    grid: {color: isDarkMode ? 'rgba(255, 255, 255, 0.1)' : 'rgba(0, 0, 0, 0.1)'}
                }, x: {ticks: {color: isDarkMode ? '#e5e7eb' : '#374151'}, grid: {display: false}}
            },
            plugins: {
                legend: {display: false},
                tooltip: {
                    backgroundColor: isDarkMode ? 'rgba(30, 41, 59, 0.8)' : 'rgba(255, 255, 255, 0.8)',
                    titleColor: isDarkMode ? '#f3f4f6' : '#1f2937',
                    bodyColor: isDarkMode ? '#e5e7eb' : '#374151',
                    borderColor: isDarkMode ? 'rgba(226, 232, 240, 0.2)' : 'rgba(30, 41, 59, 0.2)',
                    borderWidth: 1
                }
            }
        }
    })
}

function createLensChart(lensModels) {
    if (Object.keys(lensModels).length === 0) return;
    const ctx = document.getElementById('lensChart').getContext('2d');
    const isDarkMode = document.documentElement.classList.contains('dark');
    if (charts.lens) {
        charts.lens.destroy()
    }
    const sortedLabels = Object.keys(lensModels).sort((a, b) => lensModels[b] - lensModels[a]);
    const data = sortedLabels.map(label => lensModels[label]);
    const displayLabels = sortedLabels.slice(0, 8);
    const displayData = data.slice(0, 8);
    if (sortedLabels.length > 8) {
        displayLabels.push('Others');
        displayData.push(data.slice(8).reduce((a, b) => a + b, 0))
    }
    charts.lens = new Chart(ctx, {
        type: 'pie',
        data: {
            labels: displayLabels,
            datasets: [{
                data: displayData,
                backgroundColor: ['#22c55e', '#14b8a6', '#0ea5e9', '#6366f1', '#8b5cf6', '#ec4899', '#f43f5e', '#f97316', '#737373'],
                borderWidth: 1
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: {
                    position: 'right',
                    labels: {color: isDarkMode ? '#f3f4f6' : '#374151', padding: 20, font: {size: 11}}
                },
                tooltip: {
                    backgroundColor: isDarkMode ? 'rgba(30, 41, 59, 0.8)' : 'rgba(255, 255, 255, 0.8)',
                    titleColor: isDarkMode ? '#f3f4f6' : '#1f2937',
                    bodyColor: isDarkMode ? '#e5e7eb' : '#374151',
                    borderColor: isDarkMode ? 'rgba(226, 232, 240, 0.2)' : 'rgba(30, 41, 59, 0.2)',
                    borderWidth: 1
                }
            }
        }
    })
}

function updateCharts() {
    if (charts.cameraModel) createCameraModelChart(Object.fromEntries(Object.entries(charts.cameraModel.data.datasets[0].data).map(([i, v]) => [charts.cameraModel.data.labels[i], v])));
    if (charts.exposureTime) {
        const data = charts.exposureTime.data.datasets[0].data;
        const exposureBins = {};
        charts.exposureTime.data.labels.forEach((label, i) => {
            exposureBins[label] = data[i]
        });
        createExposureTimeChart(Object.values(exposureBins))
    }
    if (charts.iso) {
        const data = charts.iso.data.datasets[0].data;
        const isoBins = {};
        charts.iso.data.labels.forEach((label, i) => {
            isoBins[label] = data[i]
        });
        createISOChart(Object.values(isoBins))
    }
    if (charts.lens) {
        const data = charts.lens.data.datasets[0].data;
        const lensBins = {};
        charts.lens.data.labels.forEach((label, i) => {
            lensBins[label] = data[i]
        });
        createLensChart(lensBins)
    }
}

exifDisplayMode.addEventListener('change', () => {
    const selectedIndex = document.querySelector('#imageContainer img.ring-2');
    if (selectedIndex) {
        showExifData(parseInt(selectedIndex.getAttribute('data-index')))
    }
});
clearBtn.addEventListener('click', () => {
    allImages = [];
    allExifData = [];
    imageContainer.innerHTML = '';
    exifDataDiv.innerHTML = '';
    exifDataContainer.classList.add('hidden');
    chartContainer.classList.add('hidden');
    mapContainer.classList.add('hidden');
    statsContainer.classList.add('hidden');
    contentContainer.classList.add('hidden');
    noExifMessage.classList.add('hidden');
    clearBtn.classList.add('hidden');
    imageCountSpan.textContent = '0';
    if (map) {
        markers.forEach(marker => map.removeLayer(marker));
        markers = []
    }
    Object.values(charts).forEach(chart => chart.destroy());
    charts = {}
});
imageInput.addEventListener('change', (e) => handleFiles(e.target.files));
dragDropArea.addEventListener('dragover', (e) => {
    e.preventDefault();
    e.stopPropagation();
    dragDropArea.classList.add('border-primary-500');
    dragDropArea.classList.add('bg-primary-50');
    dragDropArea.classList.add('dark:bg-primary-900/10')
});
dragDropArea.addEventListener('dragleave', (e) => {
    e.preventDefault();
    e.stopPropagation();
    dragDropArea.classList.remove('border-primary-500');
    dragDropArea.classList.remove('bg-primary-50');
    dragDropArea.classList.remove('dark:bg-primary-900/10')
});
dragDropArea.addEventListener('drop', (e) => {
    e.preventDefault();
    e.stopPropagation();
    dragDropArea.classList.remove('border-primary-500');
    dragDropArea.classList.remove('bg-primary-50');
    dragDropArea.classList.remove('dark:bg-primary-900/10');
    const files = e.dataTransfer.files;
    handleFiles(files)
});
dragDropArea.addEventListener('click', () => {
    imageInput.click()
});</script>
<script src="../logo.js"></script>
</body>
</html>