<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Image Converter</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 flex flex-col items-center justify-center min-h-screen">
<div class="container mx-auto px-4">
    <h1 class="text-2xl font-bold text-center mb-4">Image Converter</h1>
    <div class="space-y-4">
        <input type="file" multiple class="file-input" id="imageInput" accept="image/*" />
        <select id="outputFormat" class="block w-full mt-1 border-gray-300 rounded-md shadow-sm">
            <option value="image/jpeg">JPEG</option>
            <option value="image/png">PNG</option>
            <option value="image/webp">WEBP</option>
        </select>
        <div>
            <label for="compressionSlider" class="block">Compression Level: <span id="compressionValue">75</span>%</label>
            <input type="range" id="compressionSlider" min="0" max="100" value="75" class="slider w-full" oninput="document.getElementById('compressionValue').textContent=value">
        </div>
        <button id="convertBtn" class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded">
            Convert Images
        </button>
        <div id="conversionResults" class="mt-4"></div>
        <button id="downloadAllBtn" class="bg-green-500 hover:bg-green-700 text-white font-bold py-2 px-4 rounded hidden">
            Download All
        </button>
    </div>
</div>

<script type="module">
    import imageConversion from 'https://cdn.jsdelivr.net/npm/image-conversion@2.1.1/+esm';
    import jszip from 'https://cdn.jsdelivr.net/npm/jszip@3.10.1/+esm';

    const convertBtn = document.getElementById('convertBtn');
    const downloadAllBtn = document.getElementById('downloadAllBtn');
    const conversionResults = document.getElementById('conversionResults');

    convertBtn.addEventListener('click', async () => {
        const files = document.getElementById('imageInput').files;
        const outputFormat = document.getElementById('outputFormat').value;
        const compressionLevel = document.getElementById('compressionSlider').value / 100;
        conversionResults.innerHTML = ''; // Clear previous results

        const zip = new jszip();
        let hasFiles = false;

        for (const file of files) {
            const convertedBlob = await imageConversion.compress(file, {
                quality: compressionLevel,
                type: outputFormat
            });

            const blobUrl = URL.createObjectURL(convertedBlob);
            const fileName = `${file.name.split('.').slice(0, -1).join('.')}.${outputFormat.split('/')[1]}`;
            zip.file(fileName, convertedBlob);

            const fileInfoRow = document.createElement('div');
            fileInfoRow.className = "flex justify-between items-center bg-white shadow p-4 rounded mb-2";
            fileInfoRow.innerHTML = `
                    <span>${fileName}</span>
                    <span>${(convertedBlob.size / 1024).toFixed(2)} KB</span>
                    <span>${Math.round(compressionLevel * 100)}%</span>
                    <a href="${blobUrl}" download="${fileName}" class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded">Download</a>
                `;
            conversionResults.appendChild(fileInfoRow);
            hasFiles = true;
        }

        if (hasFiles) {
            downloadAllBtn.classList.remove('hidden');
            downloadAllBtn.onclick = async () => {
                const content = await zip.generateAsync({type:"blob"});
                const url = URL.createObjectURL(content);
                const a = document.createElement("a");
                a.href = url;
                a.download = "converted_images.zip";
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
            };
        }
    });
</script>
</body>
</html>
